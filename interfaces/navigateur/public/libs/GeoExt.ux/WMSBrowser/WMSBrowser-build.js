/*! Igo - v1.1.0 - 2015-06-22 */
Ext.namespace("Ext.data.Store"),Ext.data.Store.prototype.getValueArray=function(a){for(var b=[],c=this.getCount(),d=0;c>d;d++)b.push(this.getAt(d).get(a));return b},Ext.namespace("GeoExt.ux.data"),GeoExt.ux.data.WMSBrowserWMSCapabilitiesStore=Ext.extend(GeoExt.data.WMSCapabilitiesStore,{url:null,layerOptions:null,wmsbrowser:null,gridPanel:null,map:null,constructor:function(a){Ext.apply(this,a),this.map=this.wmsbrowser.layerStore.map,arguments.callee.superclass.constructor.call(this,a),this.on("load",this.onCapabilitiesLoad,this),this.on("loadexception",this.onCapabilitiesLoadException,this)},onCapabilitiesLoad:function(a,b,c){var d=this.map.getProjection(),e=this.map.getMaxExtent().clone().transform(new OpenLayers.Projection(this.map.getProjection()),new OpenLayers.Projection("EPSG:4326"));this.wmsbrowser.resetLayerPreview();for(var f=0;f<b.length;f++){var g=b[f];g.get("srs")[d]===!0||OpenLayers.Util.indexOf(g.get("srs"),d)>=0?g.set("srsCompatible",!0):g.set("srsCompatible",!1);var h,i=g.get("llbbox");i&&("string"==typeof i?h=OpenLayers.Bounds.fromString(i):i instanceof Array&&(h=OpenLayers.Bounds.fromArray(i))),!h||e.intersectsBounds(h,!1)?g.set("extentCompatible",!0):g.set("extentCompatible",!1)}if(this.getCount()>0){this.wmsbrowser.fireEvent("getcapabilitiessuccess"),this.gridPanel&&this.wmsbrowser.selectFirstRecordOnStoreLoad&&this.gridPanel.getSelectionModel().selectRow(0);var j=this.wmsbrowser.serverComboBox.getXType();if(j==Ext.form.ComboBox.xtype){var k=this.wmsbrowser.serverComboBox.store.getValueArray("url"),l=OpenLayers.Util.indexOf(k,this.wmsbrowser.currentUrl);if(-1==l){var g=new Ext.data.Record({url:this.wmsbrowser.currentUrl});this.wmsbrowser.serverComboBox.store.add([g])}}}else this.wmsbrowser.fireEvent("genericerror",this.wmsbrowser.noLayerReturnedText)},onCapabilitiesLoadException:function(){this.wmsbrowser.fireEvent("getcapabilitiesfail")}}),Ext.namespace("GeoExt.ux.plugins"),GeoExt.ux.plugins.WMSBrowserAlerts=Ext.extend(Ext.util.Observable,{wmsbrowser:null,autoHidePopup:!1,popupTimeout:4e3,init:function(a,b){this.wmsbrowser=a,this.popupTimeout=this.wmsbrowser.alertPopupTimeout,this.autoHidePopup=this.wmsbrowser.alertPopupAutoHide,this.wmsbrowser.on("getcapabilitiesfail",this.onGetCapabilitiesFail,this),this.wmsbrowser.on("genericerror",this.onGenericError,this)},showPopup:function(a,b,c){c||(c=Ext.MessageBox.WARNING),Ext.MessageBox.getDialog().manager.zseed<=Ext.WindowMgr.zseed&&(Ext.MessageBox.getDialog().manager=new Ext.WindowGroup,Ext.MessageBox.getDialog().manager.zseed=Ext.WindowMgr.zseed+1e3),Ext.MessageBox.show({title:a,msg:b,modal:!1,width:300,buttons:Ext.MessageBox.OK,icon:c}),this.autoHidePopup&&setTimeout(function(){Ext.MessageBox.hide()},this.popupTimeout)},onGetCapabilitiesFail:function(){this.showPopup(this.wmsbrowser.errorText,this.wmsbrowser.urlInvalidText)},onGenericError:function(a){this.showPopup(this.wmsbrowser.warningText,a)}}),Ext.namespace("GeoExt.ux"),GeoExt.ux.WMSBrowser=Ext.extend(Ext.Panel,{CUSTOM_EVENTS:["beforegetcapabilities","getcapabilitiessuccess","getcapabilitiesfail","genericerror","beforelayeradded","layeradded"],DEFAULT_CAPABILITIES_PARAMS:{service:"WMS",request:"GetCapabilities",version:"1.1.1"},DEFAULT_LAYER_BROWSER_XTYPE:Ext.tree.TreePanel.xtype,inputURLText:"Select or input a server address (URL)",connectText:"Connect",pleaseInputURLText:"Please, select or input a server adress (URL) in the dropdown list first.",srsCompatibleText:"SRS compatible",extentCompatibleText:"Extent compatible",titleText:"Title",nameText:"Name",queryableText:"Queryable",descriptionText:"Description",yesText:"Yes",noText:"No",addLayerText:"Add layer",addSelectedLayersText:"Add currently selected layers as one single layer.",mapPanelPreviewTitleText:"Map preview",layerCantBeAddedText:"This layer can't be added : ",srsNotSupportedText:"This layer can't be added to the current map because it doesn't support its projection.",srsNotSupportedShortText:"it doesn't support the map current projection",extentNotSupportedShortText:"it is out of the map bounds",pleaseSelectALayerText:"Please, select one or more layers from the grid first.",pleaseCheckALayerInTreeText:"Please, check one or more layers from the tree first.",closeWindowText:"Close this window",closeText:"Close",inputURLInvalidText:"The url address entered is not valid.",layerNameText:"Layer name :",noLayerReturnedText:"The url address is valid but returned no layers.",layersSuccessfullyLoadedText:"Layers successfully loaded.",layerAddedText:"Layer(s) successfully added to the map.",urlInvalidText:"The server address (url) is invalid or is not a valid WMS server.",pleaseInputLayerNameText:"Please, input a layer name in the textfield below.",warningText:"Warning",errorText:"Error",layerStore:null,serverStore:null,serverStoreDisplayField:"url",layout:"border",defaultType:"textfield",defaults:{style:"padding:2px;margin:0px;"},capabilitiesParams:{},mapPanelPreviewOptions:{},layerNameFieldOptions:{},layerOptions:null,useIcons:!1,zoomOnLayerAdded:!1,closeOnLayerAdded:!1,allowInvalidUrl:!1,selectFirstRecordOnStoreLoad:!1,alertPopupAutoHide:!1,proxyHost:null,layerBrowserXtype:null,alertPopupTimeout:4e3,currentUrl:null,layerPreview:null,mapPanelPreview:null,gridPanel:null,infoPanel:null,centerPanel:null,serverComboBox:null,layerNameField:null,statusBar:null,treePanel:null,constructor:function(a){Ext.apply(this,a),this.serverStore||(this.serverStore=new Ext.data.SimpleStore({fields:["url"],data:[]})),Ext.applyIf(this.capabilitiesParams,this.DEFAULT_CAPABILITIES_PARAMS),this.layerBrowserXtype=this.layerBrowserXtype||this.DEFAULT_LAYER_BROWSER_XTYPE,this.addEvents(this.CUSTOM_EVENTS),this.initMyItems(),this.initMyToolbar(),arguments.callee.superclass.constructor.call(this,a),this.on("afterrender",this.onAfterRender,this)},initMyItems:function(){this.serverComboBox=new Ext.form.ComboBox({style:"padding:0px;margin:0px;",columnWidth:.85,name:"wms_url",xtype:"combo",store:this.serverStore,displayField:this.serverStoreDisplayField,typeAhead:!0,mode:"local",forceSelection:!1,triggerAction:"all",allowBlank:!1,validator:this.urlValidator,invalidText:this.inputURLInvalidText,emptyText:this.inputURLText,selectOnFocus:!0});var a=new Ext.form.FormPanel({height:"auto",autoHeight:!0,border:!1,region:"north",layout:"column",items:[this.serverComboBox,{columnWidth:.15,width:"100%",style:"padding:0px;margin:0px;",xtype:"button",text:this.connectText,scope:this,handler:function(a,b){this.triggerGetCapabilities()}}]});switch(this.mapPanelPreview=new GeoExt.MapPanel(Ext.applyIf(this.mapPanelPreviewOptions,{xtype:"gx_mappanel",title:this.mapPanelPreviewTitleText,region:"south",collapsible:!0,collapsed:!0,border:!1,height:200,floatable:!1,minSize:100,split:!0,layers:[new OpenLayers.Layer("dummy")]})),this.mapPanelPreview.on("collapse",this.hideLayerPreview,this),this.mapPanelPreview.on("expand",this.showLayerPreview,this),this.layerBrowserXtype){case Ext.grid.GridPanel.xtype:this.capStore=this.createCapStore(),this.gridPanel=this.createGridPanel(),this.capStore.gridPanel=this.gridPanel,this.layerBrowser=this.gridPanel;break;case Ext.tree.TreePanel.xtype:this.treePanel=this.createTreePanel(),this.layerBrowser=this.treePanel}this.statusBar=GeoExt.ux.WMSBrowserStatusBar?new GeoExt.ux.WMSBrowserStatusBar({wmsbrowser:this}):null,this.statusBar||Ext.apply(this,{plugins:[new GeoExt.ux.plugins.WMSBrowserAlerts]}),this.infoPanel=new Ext.Panel({anchor:"50% 100%",x:"50%",y:"0",region:"east",width:"50%",layout:"border",border:!0,items:[this.createFormPanel(),this.mapPanelPreview]});var b=new Ext.form.FormPanel({tbar:this.statusBar,region:"center",layout:"border",border:!1,items:[this.treePanel||this.gridPanel,this.infoPanel]});b.on("bodyresize",function(){this.infoPanel.setWidth("50%")},this),this.centerPanel=b,Ext.apply(this,{items:[a,b]})},createCapStore:function(){return new GeoExt.ux.data.WMSBrowserWMSCapabilitiesStore({url:"",layerOptions:this.layerOptions,wmsbrowser:this})},createGridPanel:function(){return new GeoExt.ux.grid.WMSBrowserGridPanel({store:this.capStore,wmsbrowser:this})},createTreePanel:function(){var a={wmsbrowser:this};return new GeoExt.ux.tree.WMSBrowserTreePanel(a)},createFormPanel:function(){this.descriptionField=new Ext.form.TextArea({name:"abstract",x:0,y:15,anchor:"100% 100%"});var a={xtype:"fieldset",layout:"absolute",region:"center",labelWidth:80,anchor:"100% 100%",defaultType:"textfield",border:!1,items:[{x:0,y:0,xtype:"label",text:this.descriptionText},this.descriptionField]};return a},resetCenterFormPanel:function(){this.centerPanel.getForm().reset()},initMyToolbar:function(){var a=[];a.push("->"),a.push({xtype:"label",text:this.layerNameText}),this.layerNameField=new Ext.form.TextField(Ext.applyIf(this.layerNameFieldOptions,{width:275,xtype:"textfield"})),a.push(this.layerNameField),a.push("-");var b={handler:this.addLayer,scope:this,tooltip:this.addSelectedLayersText};this.useIcons===!0?b.iconCls="gx-wmsbrowser-addlayer":b.text=this.addLayerText;var c=new Ext.Action(b);a.push(c),Ext.apply(this,{bbar:new Ext.Toolbar(a)})},triggerGetCapabilities:function(){var a=this.serverComboBox.getValue();if(this.resetAll(),!this.serverComboBox.isValid()){if(!a)return void this.fireEvent("genericerror",this.pleaseInputURLText);if(!this.allowInvalidUrl)return void this.fireEvent("genericerror",this.inputURLInvalidText)}this.fireEvent("beforegetcapabilities"),this.currentUrl=a;var b=OpenLayers.Util.getParameterString(this.capabilitiesParams);a=OpenLayers.Util.urlAppend(a,b),a=Igo.Aide.utiliserProxy(a),this.gridPanel?(this.capStore.proxy.setUrl(a),this.capStore.proxy.setApi(Ext.data.Api.actions.read,a),this.capStore.load()):this.treePanel&&this.treePanel.loadURL(a)},addLayer:function(){this.layerBrowser.addLayer()&&this.closeOnLayerAdded&&this.ownerCt.getXType()==Ext.Window.xtype&&this.closeWindow()},onAfterRender:function(){this.ownerCt.getXType()==Ext.Window.xtype&&this.addCloseButton()},addCloseButton:function(){var a={handler:this.closeWindow,scope:this,tooltip:this.closeWindowText};this.useIcons===!0?a.iconCls="gx-wmsbrowser-close":a.text=this.closeText;var b=new Ext.Action(a);this.getBottomToolbar().add(b)},closeWindow:function(){this.ownerCt.hide()},urlValidator:function(a){return Ext.form.VTypes.url(a)},zoomToRecordLLBBox:function(a,b){null==b&&(b=!0);var c,d=!1;if(c=a instanceof OpenLayers.Layer?a.metadata.llbbox:a.get("llbbox")){var e;"string"==typeof c?e=OpenLayers.Bounds.fromString(c):c instanceof Array&&(e=OpenLayers.Bounds.fromArray(c)),e&&(this.mapPanelPreview.map.zoomToExtent(e),d=!0)}b&&!d&&this.mapPanelPreview.map.zoomToMaxExtent()},hideLayerPreview:function(){this.layerPreview&&(this.layerPreview instanceof OpenLayers.Layer?this.layerPreview.setVisibility(!1):this.layerPreview.get("layer").setVisibility(!1))},showLayerPreview:function(){this.layerPreview&&(this.layerPreview instanceof OpenLayers.Layer?this.layerPreview.setVisibility(!0):this.layerPreview.get("layer").setVisibility(!0))},resetLayerPreview:function(){this.layerPreview&&(this.mapPanelPreview.layers.removeAll(),this.mapPanelPreview.map.addLayer(new OpenLayers.Layer("dummy")),this.layerPreview=null)},isLayerNameValid:function(){var a=!0,b=this.layerNameField.getValue();return b&&""!=b||(this.fireEvent("genericerror",this.pleaseInputLayerNameText),a=!1),a},resetLayerName:function(){this.layerNameField.reset()},resetAll:function(){this.resetLayerPreview(),this.resetLayerName(),this.resetCenterFormPanel()}}),Ext.namespace("GeoExt.ux"),Ext.ux.StatusBar&&(GeoExt.ux.WMSBrowserStatusBar=Ext.extend(Ext.ux.StatusBar,{text:"Ready",busyText:"Loading layers...",defaultText:"Ready",iconCls:"x-status-valid",defaultIconCls:"x-status-valid",wmsbrowser:null,constructor:function(a){Ext.apply(this,a),arguments.callee.superclass.constructor.call(this,a),this.wmsbrowser.on("beforegetcapabilities",this.onBeforeGetCapabilities,this),this.wmsbrowser.on("getcapabilitiessuccess",this.onGetCapabilitiesSuccess,this),this.wmsbrowser.on("getcapabilitiesfail",this.onGetCapabilitiesFail,this),this.wmsbrowser.on("genericerror",this.onGenericError,this),this.wmsbrowser.on("layeradded",this.onLayerAdded,this)},onBeforeGetCapabilities:function(){this.showBusy()},onGetCapabilitiesSuccess:function(){this.setStatus({text:this.wmsbrowser.layersSuccessfullyLoadedText,iconCls:"x-status-valid",clear:!0})},onGetCapabilitiesFail:function(){this.setStatus({text:this.wmsbrowser.urlInvalidText,iconCls:"x-status-error",clear:!0})},onGenericError:function(a){this.setStatus({text:a,iconCls:"x-status-error",clear:!0})},onLayerAdded:function(){this.setStatus({text:this.wmsbrowser.layerAddedText,iconCls:"x-status-valid",clear:!0})}})),Ext.namespace("GeoExt.ux.grid"),GeoExt.ux.grid.WMSBrowserGridPanel=Ext.extend(Ext.grid.GridPanel,{layout:"absolute",x:0,y:0,region:"center",anchor:"50% 100%",store:null,columns:null,sm:null,autoExpandColumn:"title",width:"auto",autoWidth:!0,border:!0,wmsbrowser:null,map:null,layerStore:null,constructor:function(a){Ext.apply(this,a),this.layerStore=this.wmsbrowser.layerStore,this.map=this.layerStore.map;var b=new Ext.grid.CheckboxSelectionModel({singleSelect:!1,renderer:function(a,b,c){return 0==c.get("srsCompatible")||c.get(!1)?void 0:Ext.grid.CheckboxSelectionModel.prototype.renderer.apply(this,arguments)},listeners:{beforerowselect:function(a,b,c,d){return a.scope.isRecordSelectable(d)},rowselect:function(a,b,c){a.scope.wmsbrowser.centerPanel.getForm().loadRecord(c),a.scope.addLayerToPreview(c),a.scope.setLayerNameFromSelectedRecords()},rowdeselect:function(a,b,c){a.scope.wmsbrowser.centerPanel.getForm().reset(),a.scope.removeLayerFromPreview(c),a.scope.setLayerNameFromSelectedRecords()}},scope:this}),c=[b,{header:this.wmsbrowser.srsCompatibleText,scope:this,dataIndex:"srsCompatible",hidden:!1,renderer:this.boolRenderer,width:30,hidden:!0},{header:this.wmsbrowser.extentCompatibleText,scope:this,dataIndex:"extentCompatible",hidden:!1,renderer:this.boolRenderer,width:30,hidden:!0},{header:this.wmsbrowser.titleText,scope:this,dataIndex:"title",id:"title",sortable:!0},{header:this.wmsbrowser.nameText,scope:this,dataIndex:"name",sortable:!0},{header:this.wmsbrowser.queryableText,scope:this,dataIndex:"queryable",sortable:!0,hidden:!0,renderer:this.boolRenderer,width:30},{header:this.wmsbrowser.descriptionText,scope:this,dataIndex:"abstract",hidden:!0}];Ext.apply(this,{columns:c,sm:b}),arguments.callee.superclass.constructor.call(this,a)},boolRenderer:function(a){return a?'<span style="color:green;">'+this.wmsbrowser.yesText+"</span>":'<span style="color:red;">'+this.wmsbrowser.noText+"</span>"},addLayerToPreview:function(a){this.wmsbrowser.layerPreview?(this.wmsbrowser.layerPreview.get("layer").params.LAYERS.push(a.get("layer").params.LAYERS),this.wmsbrowser.layerPreview.get("layer").mergeNewParams({LAYERS:this.wmsbrowser.layerPreview.get("layer").params.LAYERS}),this.wmsbrowser.zoomToRecordLLBBox(a,!1)):(this.wmsbrowser.layerPreview=a.clone(),this.wmsbrowser.layerPreview.data.layer=a.data.layer.clone(),this.wmsbrowser.layerPreview.get("layer").mergeNewParams({format:"image/png",transparent:"true"}),this.wmsbrowser.layerPreview.get("layer").mergeNewParams({LAYERS:[this.wmsbrowser.layerPreview.get("layer").params.LAYERS]}),this.wmsbrowser.mapPanelPreview.layers.add(this.wmsbrowser.layerPreview),this.wmsbrowser.mapPanelPreview.collapsed&&this.wmsbrowser.hideLayerPreview(),this.wmsbrowser.zoomToRecordLLBBox(this.wmsbrowser.layerPreview))},removeLayerFromPreview:function(a){if(this.wmsbrowser.layerPreview){var b=this.wmsbrowser.layerPreview.get("layer").params.LAYERS,c=OpenLayers.Util.indexOf(b,a.get("layer").params.LAYERS);-1!=c&&b.splice(c,1),this.wmsbrowser.layerPreview.get("layer").mergeNewParams({LAYERS:b})}},getLayerNameFromSelectedRecords:function(){for(var a=[],b=this.getSelectionModel().getSelections(),c=0,d=b.length;d>c;c++){var e=b[c];""!=e.get("title")?a.push(e.get("title")):""!=e.get("name")&&a.push(e.get("name"))}return a.join(", ")},setLayerNameFromSelectedRecords:function(){this.wmsbrowser.layerNameField.setValue(this.getLayerNameFromSelectedRecords())},isRecordSelectable:function(a){var b=!0,c=[];if(a.get("srsCompatible")||(b=!1,c.push(this.wmsbrowser.srsNotSupportedShortText+" ("+this.map.getProjection()+")")),a.get("extentCompatible")||(b=!1,c.push(this.wmsbrowser.extentNotSupportedShortText+" ("+this.map.getExtent().toBBOX()+")")),!b){var d="";""!=a.get("title")?d=a.get("title")+" : ":""!=a.get("name")&&(d=a.get("name")+" : ");var e=d+this.wmsbrowser.layerCantBeAddedText+c.join(", ");this.wmsbrowser.fireEvent("genericerror",e)}return b},addLayer:function(){var a=this.getSelectionModel().getSelections();if(0==a.length)return void(this.store.getTotalCount()>0?this.wmsbrowser.fireEvent("genericerror",this.wmsbrowser.pleaseSelectALayerText):this.wmsbrowser.fireEvent("genericerror",this.wmsbrowser.pleaseInputURLText));if(this.wmsbrowser.isLayerNameValid()){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];if(e.get("srsCompatible")!==!1)if(f)b.push(e.get("layer").params.LAYERS);else{var f=e.clone();f.data.layer=e.data.layer.clone(),f.get("layer").mergeNewParams({format:"image/png",transparent:"true"}),b.push(f.get("layer").params.LAYERS)}else alert(this.wmsbrowser.srsNotSupportedText)}if(f){f.get("layer").mergeNewParams({LAYERS:b}),f.get("layer").name=this.wmsbrowser.layerNameField.getValue();var g=this.wmsbrowser.fireEvent("beforelayeradded",{layerRecord:f});g!==!1&&(this.layerStore.add(f),this.wmsbrowser.fireEvent("layeradded",{layerRecord:f}),this.wmsbrowser.zoomOnLayerAdded&&this.map.zoomToExtent(OpenLayers.Bounds.fromArray(f.get("llbbox")).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(this.map.getProjection()))))}}}}),Ext.namespace("GeoExt.ux.tree");var url_init_msp=Igo.nav.barreOutils.obtenirOutilsParType("OutilAjoutWMS")[0]._MyWMSBrowser.Store.data.first().data.url+"?service=WMS&request=GetCapabilities&version=1.1.1";url_init_msp=Igo.Aide.utiliserProxy(url_init_msp),GeoExt.ux.tree.WMSBrowserRootNode=Ext.extend(Ext.tree.AsyncTreeNode,{INIT_URL:"",wmsbrowser:null,loader:null,constructor:function(a){Ext.apply(this,a),Ext.apply(this,{loader:new GeoExt.tree.WMSCapabilitiesLoader({url:url_init_msp,layerOptions:{buffer:0,ratio:1,singleTile:!0,transitionEffect:"null"},layerParams:{TRANSPARENT:"TRUE"},createNode:function(a){return a.checked=a.leaf?!1:void 0,GeoExt.tree.WMSCapabilitiesLoader.prototype.createNode.apply(this,[a])}})}),arguments.callee.superclass.constructor.call(this,a),this.on("load",this.onWMSCapabilitiesLoad,this),this.on("loadexception",this.onWMSCapabilitiesLoadException,this)},setLoaderURL:function(a){this.loader.url=a,this.reload()},onWMSCapabilitiesLoad:function(){this.hasChildNodes()?this.wmsbrowser.fireEvent("getcapabilitiessuccess"):this.loader.url!=this.INIT_URL&&this.onWMSCapabilitiesStoreLoadException()},onWMSCapabilitiesStoreLoadException:function(){this.wmsbrowser.fireEvent("getcapabilitiesfail")},getLayerNameFromCheckedNodes:function(){var a=[];return this.cascade(function(){var b=this.attributes.layer;b&&this.getUI().isChecked()&&(""!=b.metadata.title?a.push(b.metadata.title):""!=b.metadata.name&&a.push(b.metadata.name))}),a.join(", ")},getNewLayerFromCheckedNodes:function(){var a;return this.cascade(function(){var b=this.attributes.layer;b&&this.getUI().isChecked()&&(a?(a.mspClassMeta=b.metadata.name,a.params.LAYERS.push(b.params.LAYERS),a.mergeNewParams({LAYERS:a.params.LAYERS})):(a=b.clone(),a.mspClassMeta=b.metadata.name,a.mergeNewParams({format:"image/png",mspClassMeta:b.mspClassMeta,transparent:"true",transitionEffect:"null"}),a.mergeNewParams({LAYERS:[a.params.LAYERS]})))}),a}}),Ext.namespace("GeoExt.ux.tree"),GeoExt.ux.tree.WMSBrowserTreePanel=Ext.extend(Ext.tree.TreePanel,{rootVisible:!1,layout:"absolute",x:0,y:0,region:"center",anchor:"50% 100%",border:!1,autoScroll:!0,useArrows:!0,animate:!0,root:null,wmsbrowser:null,constructor:function(a){Ext.apply(this,a),Ext.apply(this,{listeners:{checkchange:function(a,b){b===!0?this.isLayerCompatible(a.attributes.layer)?(this.addLayerToPreview(a.attributes.layer),this.setLayerNameFromCheckedNodes(),this.loadLayerMetadata(a.attributes.layer)):a.getUI().checkbox.checked=!1:(this.removeLayerFromPreview(a.attributes.layer),this.setLayerNameFromCheckedNodes(),this.wmsbrowser.resetCenterFormPanel())}}}),this.root=new GeoExt.ux.tree.WMSBrowserRootNode(a),this.layerStore=this.wmsbrowser.layerStore,this.map=this.layerStore.map,arguments.callee.superclass.constructor.call(this,a)},loadURL:function(a){this.getRootNode().setLoaderURL(a)},addLayerToPreview:function(a){var b=this.wmsbrowser.layerPreview,c=this.wmsbrowser.mapPanelPreview;b?(b.params.LAYERS.push(a.params.LAYERS),b.mergeNewParams({LAYERS:b.params.LAYERS}),this.wmsbrowser.zoomToRecordLLBBox(b,!1)):(b=a.clone(),b.mergeNewParams({format:"image/png",transparent:"TRUE"}),b.mergeNewParams({LAYERS:[b.params.LAYERS]}),b.url=Igo.Aide.utiliserProxy(b.url),c.map.addLayer(b),c.collapsed&&this.wmsbrowser.hideLayerPreview(),this.wmsbrowser.zoomToRecordLLBBox(b),this.wmsbrowser.layerPreview=b)},removeLayerFromPreview:function(a){var b=this.wmsbrowser.layerPreview;if(b){var c=b.params.LAYERS,d=OpenLayers.Util.indexOf(c,a.params.LAYERS);-1!=d&&c.splice(d,1),0==c.length?this.wmsbrowser.resetLayerPreview():b.mergeNewParams({LAYERS:c})}},setLayerNameFromCheckedNodes:function(){this.wmsbrowser.layerNameField.setValue(this.root.getLayerNameFromCheckedNodes())},addLayer:function(){var a=!1,b=this.wmsbrowser.layerPreview,c=this.wmsbrowser.layerStore.map;if(this.root.hasChildNodes())if(b){if(this.wmsbrowser.isLayerNameValid()){var d=this.root.getNewLayerFromCheckedNodes();d.name=this.wmsbrowser.layerNameField.getValue();var e=this.wmsbrowser.fireEvent("beforelayeradded",{layer:d});if(e!==!1){var f=new Igo.Couches.WMS({layerOL:d});if(Igo.Aide.obtenirNavigateur().carte.gestionCouches.ajouterCouche(f),this.wmsbrowser.fireEvent("layeradded",{layer:d}),a=!0,this.wmsbrowser.zoomOnLayerAdded){var g=OpenLayers.Bounds.fromArray(d.metadata.llbbox);c.zoomToExtent(g.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(c.getProjection())))}}}}else this.wmsbrowser.fireEvent("genericerror",this.wmsbrowser.pleaseCheckALayerInTreeText);else this.wmsbrowser.fireEvent("genericerror",this.wmsbrowser.pleaseInputURLText);return a},loadLayerMetadata:function(a){a&&a.metadata["abstract"]?this.wmsbrowser.descriptionField.setValue(a.metadata["abstract"]):this.wmsbrowser.descriptionField.setValue("")},isLayerCompatible:function(a){var b=!0,c=[],d=this.map.getProjection(),e=this.map.getMaxExtent().clone().transform(new OpenLayers.Projection(this.map.getProjection()),new OpenLayers.Projection("EPSG:4326"));a.metadata.srs[d]===!0||OpenLayers.Util.indexOf(a.metadata.srs,d)>=0||(b=!1,c.push(this.wmsbrowser.srsNotSupportedShortText+" ("+this.map.getProjection()+")"));var f,g=a.metadata.llbbox;if(g&&("string"==typeof g?f=OpenLayers.Bounds.fromString(g):g instanceof Array&&(f=OpenLayers.Bounds.fromArray(g))),f&&!e.intersectsBounds(f,!1)&&(b=!1,c.push(this.wmsbrowser.extentNotSupportedShortText+" ("+this.map.getExtent().toBBOX()+")")),!b){var h="";""!=a.metadata.title?h=a.metadata.title+" : ":""!=a.metadata.name&&(h=a.metadata.name+" : ");var i=h+this.wmsbrowser.layerCantBeAddedText+c.join(", ");this.wmsbrowser.fireEvent("genericerror",i)}return b}}),Ext.override(GeoExt.tree.WMSCapabilitiesLoader,{processResponse:function(a,b,c,d){var e;if("Explorer"==Igo.BrowserDetect.browser){e=a.responseText;var f=new ActiveXObject("Microsoft.XMLDOM");f.async=!1,f.validateOnParse=!1,f.resolveExternals=!1;var g=f.loadXML(e);if(g)e=f;else{var h=f.parseError;alert(h.reason)}}else e=a.responseXML||a.responseText;var i=(new OpenLayers.Format.WMSCapabilities).read(e);i.capability?(this.processLayer(i.capability,i.capability.request.getmap.href,b),"function"==typeof c&&c.apply(d||b,[b])):(d.loading=!1,b.wmsbrowser.fireEvent("getcapabilitiesfail"))}}),Ext.namespace("GeoExt.ux"),GeoExt.ux.WMSBrowser&&Ext.apply(GeoExt.ux.WMSBrowser.prototype,{inputURLText:"Sélectionner ou entrer une adresse de serveur (URL)",connectText:"Connexion",pleaseInputURLText:"Veuillez sélectionner ou entrer une adresse de serveur (URL) dans la boîte déroulante d'abord.",srsCompatibleText:"SRS compatible",extentCompatibleText:"Extent compatible",titleText:"Titre",nameText:"Nom",queryableText:"Interrogeable",descriptionText:"Description",yesText:"Oui",noText:"Non",addLayerText:"Ajouter",addSelectedLayersText:"Ajouter les couches présentement sélectionnées en tant qu'une seule couche.",mapPanelPreviewTitleText:"Aperçu de la carte",layerCantBeAddedText:"Cette couche ne peut être ajoutée : ",srsNotSupportedText:"Cette couche ne peut être ajoutée à la présente carte parce qu'elle ne supporte pas sa projection.",srsNotSupportedShortText:"elle ne supporte pas la projection de la carte",extentNotSupportedShortText:"elle est en dehors de l'extent de la carte",pleaseSelectALayerText:"Veuillez sélectionner une ou plusieurs couches dans la grille d'abord.",pleaseCheckALayerInTreeText:"Veuillez cocher une ou plusieurs couches dans l'arbre d'abord.",closeWindowText:"Fermer cette fenêtre",closeText:"Fermer",inputURLInvalidText:"L'adresse (url) entrée n'est pas valide.",layerNameText:"Nom de la couche :",noLayerReturnedText:"L'adresse entrée est valide mais n'a retourné aucune couches.",layersSuccessfullyLoadedText:"Couches chargées avec succès.",layerAddedText:"Couche(s) ajoutée(s) avec succès à la carte",urlInvalidText:"L'adresse de serveur (url) n'est pas valide ou n'est pas un serveur WMS valide.",pleaseInputLayerNameText:"Veuillez saisir un nom de couche dans la boîte de texte ci-dessous.",warningText:"Avertissement",errorText:"Erreur"}),GeoExt.ux.WMSBrowserStatusBar&&Ext.apply(GeoExt.ux.WMSBrowserStatusBar.prototype,{text:"Prêt",defaultText:"Prêt",busyText:"Chargement des couches..."});
//# sourceMappingURL=WMSBrowser-build.js.map