define("aide",[],function(){function Aide(){}return Aide._obtenirTermeAnglais=function(region){region=region.toLowerCase();switch(region){case"droite":case"est":return"east";case"gauche":case"ouest":return"west";case"bas":case"sud":return"south";case"haut":case"nord":return"north";default:return""}},Aide.toBoolean=function(valeur){if(typeof valeur=="boolean")return valeur;if(typeof valeur=="string")switch(valeur.toLowerCase()){case"true":case"oui":case"vrai":case"1":return!0;case"false":case"non":case"faux":case"0":case null:return!1;default:return!1}else if(valeur===null)return!1},Aide.obtenirHote=function(sansSlash){var hote=window.location.protocol+"//"+window.location.host;return sansSlash?hote:hote+"/"},Aide.obtenirUrlServices=function(){return this.obtenirConfig("uri.services")},Aide.obtenirConfig=function(param){if(this.config&&param){var obj=this.config,proprieteSplited=param.split(".");return $.each(proprieteSplited,function(key,value){if(!obj)return undefined;obj=obj[value]}),
obj}return this.config},Aide.definirConfig=function(config){this.config=config},Aide.obtenirConfigXML=function(param){if(this.configXML&&param){var obj=this.configXML,proprieteSplited=param.split(".");return $.each(proprieteSplited,function(key,value){if(!obj)return undefined;obj=obj[value]}),obj}return this.configXML},Aide.definirConfigXML=function(configXML){this.configXML=configXML},Aide.obtenirProfil=function(param){return this.profil&&param?this.profil[param]:this.profil},Aide.definirProfil=function(profil){this.profil=profil},Aide.obtenirProxy=function(avecParam){return avecParam?this.obtenirConfig("uri.api")+"service/?_service=":this.obtenirConfig("uri.api")+"service/"},Aide.utiliserProxy=function(url,toujoursUtiliser){url=this.utiliserBaseUri(url)||"";var r=new RegExp("^(http|https)","i"),urlExclusProxy=this.obtenirConfig("urlExclusProxy")||[],exclu=!1;$.each(urlExclusProxy,function(key,value){if(url.search(value)===0)return exclu=!0,!1});if(exclu)return url;var iAdresse=url.search
(/\?|&/),adresse,params,urlC;return iAdresse===-1?(adresse=url,urlC=adresse):(adresse=url.substr(0,iAdresse),params=url.substr(iAdresse+1),urlC=params?adresse+"&"+params:adresse),adresse[0]==="["&&adresse[adresse.length-1]==="]"?(adresse=adresse.substr(1,adresse.length-2),urlC=params?adresse+"&"+params:adresse,this.obtenirProxy(!0)+encodeURI(urlC)):toujoursUtiliser&&!r.test(adresse)?this.obtenirProxy(!0)+encodeURI(this.obtenirHote(!0)+urlC):!toujoursUtiliser&&(adresse.search(this.obtenirHote())===0||!r.test(adresse))?params?adresse+"?"+params:adresse:this.obtenirProxy(!0)+encodeURI(urlC)},Aide.utiliserBaseUri=function(url,cheminRacine){var lBracket=url.indexOf("["),rBracket=lBracket!==-1?url.indexOf("]"):-1;if(rBracket!==-1){var uriConfig=url.substring(lBracket+1,rBracket),uri=this.obtenirConfig("uri")[uriConfig];if(!uri)return url;url=url.substring(0,lBracket)+uri+url.substring(rBracket+1)}if(!url)return undefined;var r=new RegExp("^(http|https|/)","i");return r.test(url)?url:cheminRacine===
undefined||cheminRacine===!0?this.obtenirCheminRacine()+url:cheminRacine?cheminRacine+url:url},Aide.obtenirCheminRacine=function(){return this.obtenirConfig("uri.navigateur")},Aide.obtenirParametreURL=function(sParam,url){if(url){var urlArray=url.split("?");urlArray.length===2&&(url=urlArray[1])}var sPageURL=url||window.location.search.substring(1),sURLVariables=sPageURL.split("&");for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split("=");if(sParameterName[0]==sParam)return decodeURIComponent(sParameterName[1])}},Aide.obtenirNavigateur=function(){return this.navigateur},Aide.definirNavigateur=function(nav){this.navigateur=nav},Aide.definirVersion=function(version){this.version=version},Aide.obtenirVersion=function(){return this.version},Aide.chargerCSS=function(url,base){var windowIGO=typeof window!="undefined"?window:null;if(!windowIGO)return!0;var link=windowIGO.document.createElement("link");link.type="text/css",link.rel="stylesheet",base&&(url=this.obtenirCheminRacine
()+url),link.href=url+"?version="+Aide.obtenirVersion(),$("link[href='"+url+"']").length||windowIGO.document.getElementsByTagName("head")[0].appendChild(link)},Aide.chargerJS=function(url,arg1,arg2){var cache=!0,callback=null;$.isFunction(arg1)?(callback=arg1,cache=arg2||cache):(cache=arg1||cache,callback=arg2||callback);var load=!0;jQuery('script[type="text/javascript"]').each(function(){return load=url!=$(this).attr("src")}),load?jQuery.ajax({type:"GET",url:url,success:callback,dataType:"script",cache:cache}):jQuery.isFunction(callback)&&callback.call(this)},Aide.afficherMessage=function(titre,message,boutons,icone){var opt={};titre instanceof Object&&(opt=titre,message=opt.message,boutons=opt.boutons,icone=opt.icone,titre=opt.titre);var boutonExt=Ext.MessageBox.OK;if(boutons)switch(boutons.toUpperCase()){case"OKCANCEL":case"OKANNULER":boutonExt=Ext.MessageBox.OKCANCEL;break;case"YESNO":case"OUINON":boutonExt=Ext.MessageBox.YESNO;break;case"YESNOCANCEL":case"OUINONANNULER":boutonExt=Ext
.MessageBox.YESNOCANCEL;break;case"OK":default:boutonExt=Ext.MessageBox.OK}var iconeExt=Ext.MessageBox.INFO;if(icone)switch(icone.toUpperCase()){case"QUESTION":iconeExt=Ext.MessageBox.QUESTION;break;case"WARNING":case"ATTENTION":iconeExt=Ext.MessageBox.WARNING;break;case"ERROR":case"ERREUR":iconeExt=Ext.MessageBox.ERROR;break;case"INFO":default:iconeExt=Ext.MessageBox.INFO}var extOptions={title:titre,msg:message,buttons:boutonExt,icon:iconeExt};opt.action&&(extOptions.fn=opt.action),Ext.MessageBox.show(extOptions)},Aide.afficherMessageChargement=function(opt){opt=opt||{},Ext.MessageBox.show({title:opt.titre||"Chargement...",msg:opt.message||"Patientez un moment...",progressText:"Chargement...",width:300,wait:!0,buttons:opt.boutons,fn:opt.callback,waitConfig:{interval:200}})},Aide.cacherMessageChargement=function(){Ext.MessageBox.hide()},Aide.getRequisObjet=function(listRequis,args,upperCase){var listRequireObj={};return $.each(listRequis,function(key,value){if(upperCase!==!1)var value=value
.charAt(0).toUpperCase()+value.substring(1);listRequireObj[value]=args[key]}),listRequireObj},Aide.afficherMessageConsole=function(message,niveau){var opt={},bouton=Ext.get("boutonConsole"),boutonDiv=Ext.get("boutonConsoleDiv"),styleNiveauFaible=" style='color:black;'",styleNiveauMoyen=" style='color:orange;'",styleNiveauEleve=" style='color:red;'";if(message instanceof Object){opt=message;var message=opt.message,niveau=opt.niveau}switch(niveau){case"faible":message="<p"+styleNiveauFaible+">"+message+"<p>";break;case"moyen":message="<p"+styleNiveauMoyen+">"+message+"<p>";break;case"eleve":message="<p"+styleNiveauEleve+">"+message+"<p>";break;default:message="<p"+styleNiveauFaible+">"+message+"<p>"}if(!bouton){var nav=this.obtenirNavigateur();return nav&&nav.analyseur&&nav.analyseur.avertissements.push(message),!0}bouton.win?(bouton.dom.textContent=Number(bouton.dom.textContent)+1,bouton.win.getComponent("message").setValue(bouton.win.getComponent("message").getValue()+message)):(bouton.
dom.textContent=1,bouton.win=new Ext.Window({applyTo:"windowConsole",layout:"fit",width:"40%",height:300,closeAction:"hide",title:"Log des messages IGO",plain:!0,items:{xtype:"htmleditor",itemId:"message",hideLabel:!0,readOnly:!0,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableSourceEdit:!1,width:500,height:50,allowBlank:!0,value:message},buttons:[{text:"Fermer",handler:function(){bouton.win.hide()}}]}),bouton.win.getComponent("message").getToolbar().hide(),bouton.on("click",function(){this.win.show(this)})),boutonDiv.setVisible(!0)},Aide.afficherFenetre=function(opt){opt=opt||{},this.win&&this.win.destroy(),this.win=new Ext.Window({title:opt.titre,width:300,closeAction:"destroy",resizable:!0,minimizable:!1,html:opt.message,padding:5,buttons:[{text:"Fermer",scope:this,handler:function(){this.win.destroy()}}]}),this.win.show()},Aide.afficherInfobulle=function(contenu,options){options=options||{};var $divInfobulle=$("#divInfobulle")
;$divInfobulle.length==0&&($("<div />").attr("id","divInfobulle").css({position:"absolute",height:"auto",width:"auto","z-index":"99999",display:"none"}).appendTo(document.body),$divInfobulle=$("#divInfobulle")),$divInfobulle.html(contenu),options.css&&$divInfobulle.css(options.css);if(options.x)$divInfobulle.css({left:options.x+"px"});else{var x=this.obtenirNavigateur().obtenirPanneauxParType("PanneauCarte")[0]._panel.x+Math.round(this.obtenirNavigateur().carte.coordSouris.x);x+$divInfobulle.width()>$(window).width()&&(x-=$divInfobulle.width()),$divInfobulle.css({left:x+"px"})}if(options.y)$divInfobulle.css({top:options.y+"px"});else{var y=Math.round(this.obtenirNavigateur().carte.coordSouris.y)+this.obtenirNavigateur().obtenirPanneauxParType("PanneauCarte")[0]._panel.y-$divInfobulle.height();this.obtenirNavigateur().obtenirBarreOutils()&&(y+=this.obtenirNavigateur().obtenirBarreOutils()._panelContainer.getTopToolbar().getHeight()),y-$divInfobulle.height()<0&&(y+=$divInfobulle.height())
,$divInfobulle.css({top:y+"px"})}$divInfobulle.show()},Aide.cacherInfobulle=function(){$("#divInfobulle").hide()},Aide.obtenirDebug=function(){return this.debug},Aide.estDebug=function(){return!!this.debug},Aide.definirDebug=function(debug){this.debug=debug},Aide}),define("evenement",["aide"],function(Aide){var compteur=0;function Evenement(){}return Evenement.prototype={constructor:Evenement,ajouterDeclencheur:function(type,action,options){options=options||{};var id=options.id;id||(compteur++,id="declencheur"+compteur),this.declencheurs=this.declencheurs||{},typeof this.declencheurs[type]=="undefined"&&(this.declencheurs[type]=[]),options.avant==1||options.avant=="true"?options.avant=!0:options.avant=!1,typeof action!="function"&&(action=new Function("e","return "+action+";"));var declencheurObj={id:id,action:action,options:options};return this.declencheurs[type].push(declencheurObj),this},declencher:function(event,checkGlobal){typeof event=="string"&&(event={type:event}),event.target||
(event.target=this),event.avant||(event.avant=!1);if(!event.type)throw new Error("La propri\u00e9t\u00e9 'type' de l'\u00e9v\u00e9nement est manquant.");if(this.declencheurs&&this.declencheurs[event.type]instanceof Array){var declencheurs=this.declencheurs[event.type].slice();for(var i=0,len=declencheurs.length;i<len;i++){if(!declencheurs[i])break;if(event.avant===declencheurs[i].options.avant){var options=declencheurs[i].options;if(options.filtre){var respecteFiltre=!0;$.each(options.filtre,function(attribut,valeur){if(event.target[attribut]!=valeur)return respecteFiltre=!1,!1})}if(respecteFiltre==1||!options.filtre){var scope=options.scope||this;event.options=options,declencheurs[i].action.call(scope,event)}}}}if(checkGlobal!==!1){var nav=Aide.obtenirNavigateur();nav&&nav.evenements&&nav.evenements.declencher(event,!1)}},obtenirTypeClasse:function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},enleverDeclencheur:function(type,id,action){$.isFunction(id)&&
(action=id,id=undefined);if(!type){this.declencheurs={};return}if(this.declencheurs&&this.declencheurs[type]instanceof Array){if(!action&&!id){delete this.declencheurs[type];return}var declencheurs=this.declencheurs[type];if(!id){for(var i=0,len=declencheurs.length;i<len;i++){if(!declencheurs[i])break;declencheurs[i].action===action&&(declencheurs.splice(i,1),i--)}return}for(var i=0,len=declencheurs.length;i<len;i++){if(!declencheurs[i])break;declencheurs[i].id===id&&(declencheurs.splice(i,1),i--)}}},obtenirDeclencheur:function(type,id,action){if(!type)return[];if(this.declencheurs&&this.declencheurs[type]instanceof Array){if(!action&&!id)return this.declencheurs[type]||[];var declencheurs=this.declencheurs[type],listeDeclencheurs=[];if(!id){for(var i=0,len=declencheurs.length;i<len;i++)declencheurs[i].action===action&&listeDeclencheurs.push(declencheurs[i]);return listeDeclencheurs}for(var i=0,len=declencheurs.length;i<len;i++)declencheurs[i].id===id&&listeDeclencheurs.push(declencheurs
[i]);return listeDeclencheurs}return[]}},Evenement}),define("fonctions",[],function(){function Fonctions(){}return Fonctions.afficherProprietes=function(input,options){require(["aide","analyseurGeoJSON","handlebars"],function(Aide,AnalyseurGeoJSON,Handlebars){options=options||{};var defautTitre="Couche inconnue",defautGabarit="template/afficherProprietes",messageErreur=options.messageErreur||"Aucun enregistrement n'a \u00e9t\u00e9 trouv\u00e9",titreErreur=options.messageTitre||"Propri\u00e9t\u00e9s";if(!input)return Aide.afficherMessage(titreErreur,messageErreur),!1;if(!input.obtenirTypeClasse||input.obtenirTypeClasse()!=="Vecteur"&&input.obtenirTypeClasse()!=="VecteurCluster"&&input.obtenirTypeClasse()!=="WFS")$.isArray(input)||(input=[input]);else{var occGroupe={};occGroupe[input.id]=input.obtenirOccurences(),input=occGroupe}if(input.length===0&&!$.isPlainObject(occGroupe))return Aide.afficherMessage(titreErreur,messageErreur),!1;if(input[0]&&input[0].obtenirTypeClasse&&input[0].obtenirTypeClasse
()==="Occurence"){var occGroupe={};$.each(input,function(key,value){var id=value.vecteur?value.vecteur.id:"sansCouche";occGroupe[id]||(occGroupe[id]=[]),occGroupe[id].push(value)}),input=occGroupe}var analyseur=new AnalyseurGeoJSON,arrayOccGeoJson=[],gabarits=[];$.each(input,function(key,value){var obj;if($.isArray(value)){if(!value[0])return!0;var infoTemplate,titre;value[0].vecteur?(infoTemplate=value[0].vecteur.templates.info||{},titre=value[0].vecteur.obtenirTitre()):(infoTemplate={},titre=defautTitre),obj={titre:titre,gabarit:infoTemplate.gabarit||defautGabarit,alias:infoTemplate.alias,occurencesGeoJSON:JSON.parse(analyseur.ecrire(value))}}else if(value.html)obj={titre:value.titre||defautTitre,html:value.html};else{value.occurences||(value={occurences:value});var occ=value.occurences;typeof value.occurences=="string"?occ=JSON.parse(value.occurences):value.occurences.obtenirTypeClasse&&(value.occurences.obtenirTypeClasse()==="Vecteur"||value.occurences.obtenirTypeClasse()==="VecteurCluster"||
value.occurences.obtenirTypeClasse()==="WFS")&&(value.occurences=value.occurences.obtenirOccurences()),value.occurences[0]&&value.occurences[0].obtenirTypeClasse&&value.occurences[0].obtenirTypeClasse()==="Occurence"&&(occ=JSON.parse(analyseur.ecrire(value.occurences)),value.occurences[0].vecteur&&(value.titre||(value.titre=value.occurences[0].vecteur.obtenirTitre()),!value.gabarit&&value.occurences[0].vecteur.templates.info&&(value.gabarit=value.occurences[0].vecteur.templates.info.gabarit)));if(!occ.features||!occ.features.length)return!0;obj={titre:value.titre||defautTitre,gabarit:value.gabarit||defautGabarit,alias:value.alias,occurencesGeoJSON:jQuery.extend({},occ)}}gabarits.push("hbars!"+obj.gabarit),arrayOccGeoJson.push(obj)});if(!arrayOccGeoJson.length)return Aide.afficherMessage(titreErreur,messageErreur),!1;var oResultWindow=Ext.getCmp("occurencesResultatsWindow");if(!Ext.get("occurencesResultatsWindow")){var tabs=new Ext.TabPanel({activeTab:0,enableTabScroll:!0,height:490});oResultWindow=new 
Ext.Window({id:"occurencesResultatsWindow",title:"R\u00e9sultats de la requ\u00eate",width:700,minWidth:450,minHeight:300,maxHeight:700,height:575,border:!1,modal:!0,plain:!0,closable:!0,resizable:!0,autoScroll:!1,constrain:!0,layout:"fit",items:[tabs]})}if(!("utiliserAlias"in Handlebars.helpers)){Handlebars.registerHelper("utiliserAlias",function(key,alias,opts){if(!alias)return key;if(alias[key])return alias[key];var keySplit=key.split("."),firstKey=keySplit.shift(),out=alias[firstKey]||firstKey;while(keySplit.length){var nextKey=keySplit.shift();out+=".",out+=alias["*"+nextKey]||nextKey}return out}),Handlebars.registerHelper("requireJS",function(js){require([js],function(){})}),Handlebars.registerHelper("ifObjet",function(content,opts){return $.isPlainObject(content)||$.isArray(content)?opts.fn(content):opts.inverse(content)});var loopRecursiveObjet=function(children,options,audaciousFn,previousKey,previousIndex){var out="",index=0;return $.each(children,function(key,child){out+=audaciousFn
({index:previousIndex+"."+index,key:previousKey+"."+key,value:child,visible:!1});if($.isPlainObject(child)||$.isArray(child))out+=loopRecursiveObjet(child,options,audaciousFn,previousKey+"."+key,previousIndex+"."+index);index++}),out};Handlebars.registerHelper("recursive",function(children,options){var audaciousFn;options.fn!==undefined&&(audaciousFn=options.fn);var out=audaciousFn({index:options.data.index,key:options.data.key,value:children,visible:!0});return!$.isPlainObject(children)&&!$.isArray(children)?out:(out+=loopRecursiveObjet(children,options,audaciousFn,options.data.key,options.data.index),out)})}require(gabarits,function(){var args=arguments;$.each(arrayOccGeoJson,function(key,value){var html=value.html;value.occurencesGeoJSON&&(value.occurencesGeoJSON.alias=value.alias,html=args[key](value.occurencesGeoJSON)),oResultWindow.items.get(0).add({title:value.titre,html:html})}),oResultWindow.show()})})},Fonctions.createDateFromIsoString=function(isoDateString){var date=new Date
,strArray=isoDateString.split("-");switch(strArray.length){case 0:alert("Le format de la date pour cette couche n'est pas support\u00e9.");break;case 1:date.setUTCFullYear(strArray[0]);break;case 2:date.setUTCFullYear(strArray[0]),date.setUTCMonth(strArray[1]-1);break;case 3:strArray[2].split("T")[1]&&date.setUTCHours(strArray[2].split("T")[1].split(":")[0]),date.setUTCDate(strArray[2].split("T")[0]),date.setUTCMonth(strArray[1]-1),date.setUTCFullYear(strArray[0])}return date},Fonctions.rgbToHex=function(r,g,b){var componentToHex=function(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex};return"#"+componentToHex(r)+componentToHex(g)+componentToHex(b)},Fonctions.convertirMesure=function(mesure,uniteDepart,uniteConvertie){if(!mesure||!uniteDepart||!uniteConvertie)return 0;var metresParUniteDepart=this.obtenirMetresParUnite(uniteDepart),metresParUniteConvertie=this.obtenirMetresParUnite(uniteConvertie);return!metresParUniteDepart||!metresParUniteConvertie?0:mesure*metresParUniteDepart/
metresParUniteConvertie},Fonctions.obtenirMetresParUnite=function(unite){var metres;switch(unite){case"m":case"m\u00e8tre":metres=1;break;case"km":case"kilom\u00e8tre":metres=1e3;break;case"pied":metres=.304799999536704;break;case"mile":metres=1609.344;break;case"m\u00b2":case"m\u00e8tre\u00b2":metres=1;break;case"km\u00b2":case"kilom\u00e8tre\u00b2":metres=1e6;break;case"pied\u00b2":metres=.09290304;break;case"mile\u00b2":metres=2589988.110336;break;case"acre":metres=4046.85642;break;case"hectare":metres=1e4}return metres},Fonctions.executerAction=function(options){var action=options.action,scope=options.scope||this,params=options.params||undefined;if(typeof action=="string")var actionLength=action.length,isActionJs=action.substr(actionLength-3,actionLength)===".js";if(isActionJs){var action=action.substr(0,actionLength-3),idAction=options.requireId||action;if(!requirejs.estDansConfig(idAction)){var path={};path[idAction]=action,require.ajouterConfig({paths:path})}var requireFct=options
.requireFct||function(actionJs){actionJs&&Fonctions.executerAction({action:actionJs,params:params,scope:scope})};require([idAction],requireFct)}else{typeof scope=="string"&&(scope=(new Function("params","                        return "+scope+";\n                    ")).call(this,params)),options.paramsStr&&(params=(new Function("params","                        return "+options.paramsStr+";\n                    ")).call(scope,params));if(typeof action!="function"){var fn=(new Function("params","                        return "+action+";\n                     ")).call(scope,params);typeof fn=="function"&&fn.call(scope,params);return}action.call(scope,params)}},Fonctions}),define("outil",["aide","evenement","fonctions"],function(Aide,Evenement,Fonctions){var compteur=0;function Outil(options){this._bouton,this.carte,this.options=options||{},this.defautOptions={id:"outil",icone:"",titre:"",infobulle:"",visible:!0,actif:!0,groupe:undefined,_allowDepress:!0,executer:function(){(!this.options
.groupe||this._bouton.pressed||this._bouton.pressed===undefined)&&this.executer()}}}return Outil.prototype=new Evenement,Outil.prototype.constructor=Outil,Outil.prototype._init=function(){this.options.css&&Aide.chargerCSS(this.options.css);if(!this._bouton){compteur++,this.defautOptions.id=this.defautOptions.id+compteur,this.defautOptions=$.extend({},this.defautOptions,Aide.obtenirConfig(this.obtenirTypeClasse())),this.options=$.extend({},this.defautOptions,this.options);var opt=this.options,isUrlIcon=opt.icone.match(/\.|\//);this._extOptions=$.extend({xtype:opt.xtype,text:opt.titre,boxLabel:opt.xtype?opt.titre:undefined,name:opt.nom,iconCls:isUrlIcon?"":opt.icone,icon:isUrlIcon?Aide.utiliserBaseUri(opt.icone):"",itemId:opt.id,tooltip:opt.infobulle,hidden:!Aide.toBoolean(opt.visible),disabled:!Aide.toBoolean(opt.actif),toggleGroup:opt.groupe,allowDepress:opt._allowDepress,scope:this,handler:opt.executer,toggleHandler:function(a,b){!b&&!a.pressing?this.eteindre():this.options.groupe=="carte"&&
this.declencher({type:"controleCarteActiver"}),a.pressing=!1}},this._extOptions,this.options._extOptions),this._creerBouton(opt)}return this},Outil.prototype._creerBouton=function(opt){if(opt.controle||opt.elementMenu){if(opt.xtype){opt.xtype==="menucheckitem"&&delete opt.icone,this._bouton=new Ext.create(this._extOptions);return}var geoExtOptions=$.extend({control:opt.controle,map:this.carte?this.carte._getCarte():undefined,allowDepress:!1},this._extOptions);this._bouton=new GeoExt.Action(Ext.applyIf(geoExtOptions));return}if(opt.xtype){this._bouton=new Ext.create(this._extOptions);return}this._bouton=new Ext.Toolbar.Button(this._extOptions)},Outil.prototype.executer=function(){var that=this,action=this.options.action||this.defautOptions.action;Fonctions.executerAction({scope:this.options.actionScope||this,action:action,params:this.options.actionParams,paramsStr:this.options.actionParamsStr,requireFct:function(actionJs){actionJs&&(that.options.action=actionJs,that.executer())}})},Outil
.prototype.eteindre=function(){},Outil.prototype._ajoutCallback=function(target,callback,opt){typeof callback=="function"&&callback.call(target,this,opt)},Outil.prototype.obtenirId=function(){return this._getBouton().itemId},Outil.prototype._getBouton=function(){if(!this._bouton)throw new Error("Igo.Outils."+this.constructor.name+"._getBouton()");return this._bouton},Outil.prototype.rafraichir=function(){this._getBouton().doLayout&&this._getBouton().doLayout()},Outil.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Outil.prototype.desactiver=function(){this._bouton&&this._bouton.setDisabled(!0)},Outil.prototype.activer=function(){this._bouton.setDisabled()},Outil.prototype.afficher=function(){if(this._bouton.setHidden)return this._bouton.setHidden(!1),!0;this._bouton.setVisible(!0)},Outil.prototype.cacher=function(){if(this._bouton.setHidden)return this._bouton.setHidden(!0),!0;this._bouton.setVisible(!1)},Outil.prototype
.enfoncerBouton=function(e){var that=this;that._bouton.pressed||that._bouton.toggle(!0),this instanceof Outil?that.executer():that=e.options.scope},Outil.prototype.releverBouton=function(e){var that=this;this instanceof Outil?that.eteindre():that=e.options.scope,that._bouton.pressing=!0,that._bouton.pressed?that._bouton.toggle(!1):that._bouton.control&&that._bouton.control.active&&that._bouton.control.deactivate()},Outil.prototype.changerTitre=function(titre){this._bouton.setText(titre)},Outil.prototype.changerIcone=function(icone){if(!icone)return this._bouton.setIconClass(),!0;var isUrlIcon=icone.match(/\.|\//);isUrlIcon?this._bouton.setIcon(icone):this._bouton.setIconClass(icone)},Outil.prototype.estEnfonce=function(){return this._bouton.pressed},Outil}),define("barreOutils",["outil"],function(Outil){function BarreOutils(carte){this.listeOutilsDroite=[],this.listeOutilsGauche=[],this.carte=carte}return BarreOutils.prototype.ajouterOutils=function(outils,options){var that=this;options=
options||{};var rafraichir=options.rafraichir;$.each(outils,function(key,outil){options.rafraichir=!1,that.ajouterOutil(outil,options)}),rafraichir!==!1&&this.rafraichir()},BarreOutils.prototype.ajouterOutil=function(outil,options){outil instanceof Outil?(outil.carte=this.carte,outil._init(),outil._ajoutCallback(this,this._ajouterOutilCallback,options)):outil==="-"&&this.ajouterDivision(options)},BarreOutils.prototype._ajouterOutilCallback=function(outil,options){var opt=options||{};if(this._panelContainer){if(outil instanceof Outil)if(opt.position!=="droite"){var len=this.listeOutilsGauche.length;this._panelContainer.topToolbar.insert(len,outil._getBouton())}else this._panelContainer.topToolbar.add(outil._getBouton());opt.rafraichir!==!1&&this.rafraichir()}opt.position==="droite"?this.listeOutilsDroite.push(outil):this.listeOutilsGauche.push(outil)},BarreOutils.prototype.enleverTousOutils=function(){this._panelContainer.topToolbar.removeAll(),this.listeOutilsDroite=[],this.listeOutilsGauche=
[]},BarreOutils.prototype.obtenirOutils=function(position){return position==="gauche"?this.listeOutilsGauche:position==="droite"?this.listeOutilsDroite:this.listeOutilsGauche.concat("->").concat(this.listeOutilsDroite)},BarreOutils.prototype.obtenirOutilsParType=function(type,niveau){niveau=niveau||1;var outils=[];return $.each(this.obtenirOutils(),function(key,value){value.obtenirTypeClasse&&value.obtenirTypeClasse()===type&&outils.push(value),(niveau>1||niveau<0)&&value.obtenirOutilsParType&&(outils=outils.concat(value.obtenirOutilsParType(type,niveau-1)))}),outils},BarreOutils.prototype.obtenirOutilParId=function(id,niveau){niveau=niveau||1;var outil;return $.each(this.obtenirOutils(),function(key,value){if(value.obtenirId&&value.obtenirId()===id)return outil=value,!1;if((niveau>1||niveau<0)&&value.obtenirOutilParId){outil=value.obtenirOutilParId(id,niveau-1);if(outil)return!1}}),outil},BarreOutils.prototype.obtenirOutilsParChemin=function(chemin){var that=this,outils=[],cheminSplit=
chemin.split(",");$.each(cheminSplit,function(key,sChemin){var indexFin,outilsTemp=[that];do{var separator,nbCaractere;sChemin.search(/>| /)===0&&(separator=sChemin[0],sChemin=sChemin.substr(1));var indexDeb=sChemin.search(/#|\.|>| /),directive=sChemin[indexDeb];indexFin=sChemin.substr(indexDeb+1).search(/#|\.|>| /),indexFin!==-1&&(nbCaractere=indexFin-indexDeb);var identifiant=sChemin.substr(indexDeb+1,nbCaractere);sChemin=sChemin.substr(indexFin+1);var outilsLoop,niveau;directive==="#"?(niveau=-1,separator===">"&&(niveau=1),!separator&&outilsTemp[0].obtenirTypeClasse()!==that.obtenirTypeClasse()?(outilsLoop=[],$.each(outilsTemp,function(keyTemp,outilTemp){outilTemp.obtenirId()===identifiant&&(outilsLoop=outilsLoop.concat([outilTemp]))}),outilsTemp=outilsLoop):(outilsLoop=[],$.each(outilsTemp,function(keyTemp,outilTemp){if(outilTemp.obtenirOutilParId){var p=outilTemp.obtenirOutilParId(identifiant,niveau);p&&(outilsLoop=outilsLoop.concat([p]))}}),outilsTemp=outilsLoop)):directive==="."?
(niveau=-1,separator===">"&&(niveau=1),!separator&&outilsTemp[0].obtenirTypeClasse()!==that.obtenirTypeClasse()?(outilsLoop=[],$.each(outilsTemp,function(keyTemp,outilTemp){outilTemp.obtenirTypeClasse()===identifiant&&(outilsLoop=outilsLoop.concat([outilTemp]))}),outilsTemp=outilsLoop):(outilsLoop=[],$.each(outilsTemp,function(keyTemp,outilTemp){outilTemp.obtenirOutilsParType&&(outilsLoop=outilsLoop.concat(outilTemp.obtenirOutilsParType(identifiant,niveau)))}),outilsTemp=outilsLoop)):outilsTemp=[],outilsTemp.length||(indexFin=-1)}while(indexFin!==-1);outils=outils.concat(outilsTemp)});var outilsUniques=outils.filter(function(itm,i,a){return i==a.indexOf(itm)});return outilsUniques},BarreOutils.prototype._getToolbar=function(){var listeBoutons=[];return $.each(this.obtenirOutils(),function(key,value){value instanceof Outil?value._getBouton()&&listeBoutons.push(value._getBouton()):listeBoutons.push(value)}),listeBoutons},BarreOutils.prototype.ajouterDivision=function(options){options=options||
{};if(this._panelContainer){if(options.position!=="droite"){var items=this._panelContainer.topToolbar.items.items;this._panelContainer.topToolbar.add("-");var division=items.pop(),len=this.listeOutilsGauche.length;items.splice(len,0,division)}else this._panelContainer.topToolbar.add("-");options.rafraichir!==!1&&this.rafraichir()}options.position==="droite"?this.listeOutilsDroite.push("-"):this.listeOutilsGauche.push("-")},BarreOutils.prototype.rafraichir=function(){this._panelContainer&&this._panelContainer.topToolbar.doLayout(),this.carte._getCarte().updateSize()},BarreOutils.prototype._setPanelContainer=function(panel){this._panelContainer=panel},BarreOutils.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},BarreOutils.prototype.eteindreOutils=function(){var outils=this.obtenirOutils();$.each(outils,function(key,outil){outil.releverBouton!==undefined&&outil.releverBouton()})},BarreOutils}),define("panneau",["aide","evenement"
],function(Aide,Evenement){var compteur=0;function Panneau(options){this._panel,this.carte,this.options=options||{},this.defautOptions={position:"nord",id:"panneau",titre:"",dimension:100,minDimension:100,maxDimension:750,_margins:"0 5 5 5",reductible:!0,_layout:"auto",ouvert:!0}}return Panneau.prototype=new Evenement,Panneau.prototype.constructor=Panneau,Panneau.prototype._init=function(){var that=this;this.options&&this.options.css&&Aide.chargerCSS(this.options.css),compteur++,this.options.id||(this.options.id=this.defautOptions.id+compteur),this.defautOptions=$.extend({},this.defautOptions,Aide.obtenirConfig(this.obtenirTypeClasse())),this.options=$.extend({},this.defautOptions,this.options);if(!this._panel&&this.options.init!=0){var opt=this.options;opt.listeners=opt.listeners||{},opt.defaults=opt.defaults||{},opt.items=opt.items||[],opt.listeners.afterrender||(opt.listeners.afterrender=function(e){that.callbackCreation()}),this._extOptions=$.extend({region:Aide._obtenirTermeAnglais
(opt.position),id:opt.id,title:opt.titre,split:!0,width:Number(opt.dimension),height:Number(opt.dimension),minSize:Number(opt.minDimension),maxSize:Number(opt.maxDimension),collapsible:Aide.toBoolean(opt.reductible),collapsed:!Aide.toBoolean(opt.ouvert),closable:Aide.toBoolean(opt.fermable),floatable:!1,margins:opt._margins,layout:opt._layout,defaults:opt.defaults,items:opt.items,scope:this,listeners:opt.listeners},this._extOptions,this.options._extOptions),this._extOptions.xtype?this._extOptions.xtype==="grid"?this._panel=new Ext.grid.GridPanel(this._extOptions):this._extOptions.xtype==="editorgrid"?this._panel=new Ext.grid.EditorGridPanel(this._extOptions):this._panel=this._extOptions:this._panel=new Ext.Panel(this._extOptions)}},Panneau.prototype.callbackCreation=function(){this.declencher({type:"init"+this.obtenirTypeClasse(),panneau:this})},Panneau.prototype._getPanel=function(){if(!this._panel)throw new Error("Igo.Panneaux."+this.constructor.name+"._getPanel()");return this._panel
},Panneau.prototype.obtenirId=function(){return this._getPanel().id},Panneau.prototype.obtenirTitre=function(){return this._panel&&this._panel.title?this._panel.title:this.options.titre},Panneau.prototype.definirTitre=function(titre){if(!this._panel)return!1;this._panel.setTitle(titre)},Panneau.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Panneau.prototype.rafraichir=function(){this._getPanel().doLayout()},Panneau.prototype.definirCarte=function(carte){this.carte=carte},Panneau.prototype.ouvrir=function(){return this._getPanel().expand()},Panneau.prototype.fermer=function(){return this._getPanel().collapse()},Panneau.prototype.avantFermeture=function(){},Panneau.prototype.majContenu=function(contenu){this._panel.body.update(contenu)},Panneau}),define("point",["aide"],function(Aide){function Point(x,y,proj){if(!x)throw new Error("new Point : Param\u00e8tres obligatoires");typeof x!="number"&&typeof x!="string"||typeof 
y!="number"&&typeof y!="string"?x.CLASS_NAME=="OpenLayers.Geometry.Point"&&x.x&&x.y?(this.x=parseFloat(x.x),this.y=parseFloat(x.y),proj=y):$.isArray(x)&&(typeof x[0]=="number"||typeof x[0]=="string")&&(typeof x[1]=="number"||typeof x[1]=="string")&&(this.x=parseFloat(x[0]),this.y=parseFloat(x[1]),proj=y):(this.x=parseFloat(x),this.y=parseFloat(y));if(!this.x||!this.y)throw new Error("new Point : Param\u00e8tres invalides");var nav=Aide.obtenirNavigateur();nav&&nav.carte&&nav.carte.options.precision&&(this.precision=parseInt(nav.carte.options.precision),this.definirNombreDecimales());if(!proj)nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857";else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new Point : Projection EPSG invalide");this.projection=proj.toUpperCase()}return Point.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/
)[1]},Point.prototype.obtenirProjection=function(){return this.projection},Point.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("Point.definirProjection : Projection EPSG invalide");this.projection=proj},Point.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("Point.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("Point.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),pointOL=new OpenLayers.LonLat(this.x,this.y),pointProj=pointOL.transform(projSource
,projDest);return new Point(pointProj.lon,pointProj.lat,dest)},Point.prototype._obtenirGeomOL=function(){return new OpenLayers.Geometry.Point(this.x,this.y)},Point.prototype._obtenirLonLatOL=function(){return new OpenLayers.LonLat(this.x,this.y)},Point.prototype.estEgal=function(p2){return p2 instanceof Point?this.x===p2.x&&this.y===p2.y&&this.projection===p2.projection:!1},Point.prototype.distanceDe=function(p2){if(p2 instanceof Point){if(this.projection!==p2.projection)throw new Error("Point.distanceDe : Les points ne sont pas dans la m\u00eame projection");return this._obtenirGeomOL().distanceTo(p2._obtenirGeomOL())}throw new Error("Point.distanceDe : L'argument n'est pas un point")},Point.prototype.deplacer=function(point){if(point instanceof Point){if(this.projection!==point.projection)throw new Error("Point.deplacer : Les points ne sont pas dans la m\u00eame projection");return this.x=parseFloat(point.x),this.y=parseFloat(point.y),this.definirNombreDecimales(),this._feature&&this.
_feature.move(point._obtenirLonLatOL()),this}throw new Error("Point.deplacer : L'argument n'est pas un point")},Point.prototype.deplacerDe=function(dx,dy){this.x=parseFloat(this.x+dx),this.y=parseFloat(this.y+dy),this.definirNombreDecimales();var point=new Point(this.x,this.y,this.projection);return this._feature&&this._feature.move(point._obtenirLonLatOL()),this},Point.prototype.definirNombreDecimales=function(nombre){if(nombre)this.precision=nombre;else if(!this.precision)return!0;var multi=Math.pow(10,this.precision);this.x=Math.round((this.x*multi).toFixed(this.precision+1))/multi,this.y=Math.round((this.y*multi).toFixed(this.precision+1))/multi},Point}),define("limites",["aide","point"],function(Aide,Point){function Limites(gauche,bas,droite,haut,proj){this.gauche=Number(gauche),this.bas=Number(bas),this.droite=Number(droite),this.haut=Number(haut);if(!this.gauche||!this.bas||!this.droite||!this.haut)throw new Error("new Limites : Param\u00e8tre absent");if(!proj){var nav=Aide.obtenirNavigateur
();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new Limites : Projection EPSG invalide");this.projection=proj}return Limites.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Limites.prototype.obtenirProjection=function(){return this.projection},Limites.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("Limites.definirProjection : Projection EPSG invalide");this.projection=proj},Limites.prototype.contientPoint=function(point){if(point instanceof Point){if(this.projection!==point.projection)throw new Error("Limites.contientPoint : Le point n'est pas dans la m\u00eame projection");var limitesOL=this._obtenirBoundsOL();return limitesOL.containsLonLat
(point._obtenirLonLatOL())}throw new Error("Limites.contientPoint : L'argument n'est pas un point")},Limites.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("Limites.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("Limites.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),limitesOL=this._obtenirBoundsOL(),limitesProj=limitesOL.transform(projSource,projDest);return new Limites(limitesProj.left,limitesProj.bottom,limitesProj.right,limitesProj.top,dest)},Limites.prototype._obtenirGeomOL=function(){return this._obtenirBoundsOL().toGeometry()},Limites.prototype._obtenirBoundsOL=
function(){return new OpenLayers.Bounds(this.gauche,this.bas,this.droite,this.haut)},Limites.prototype.fusionnerLimites=function(autreLimite){var limitesOL=this._obtenirBoundsOL();limitesOL.extend(autreLimite._obtenirBoundsOL());var limites=new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top);return limites},Limites.prototype.obtenirCentroide=function(){var x=Number(this.gauche)+(Number(this.droite)-Number(this.gauche))/2,y=Number(this.bas)+(Number(this.haut)-Number(this.bas))/2;return new Point(x,y,this.projection)},Limites}),OpenLayers.Filter.Function.prototype.clone=function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Function,this)},define("libs/extension/OpenLayers/FilterClone",function(){}),define("style",["evenement","fonctions","aide","libs/extension/OpenLayers/FilterClone"],function(Evenement,Fonctions,Aide){function Style(style){this.propriete=style||{},this.defautPropriete={cursor:"inherit",rayon:6,couleur:"#ee9900",opacite:.4,limiteOpacite:1,limiteCouleur
:"#ee9900",limiteEpaisseur:1,limiteStyleExtremite:"round",limiteStyle:"solid"},this.propriete.icone&&(this.defautPropriete.opacite=1),this._lookupOptionsOL={cursor:"cursor",rayon:"pointRadius",opacite:"fillOpacity",couleur:"fillColor",limiteOpacite:"strokeOpacity",limiteCouleur:"strokeColor",limiteEpaisseur:"strokeWidth",limiteStyle:"strokeDashstyle",limiteStyleExtremite:"strokeLinecap",icone:"externalGraphic",iconeHauteur:"graphicHeight",iconeLargeur:"graphicWidth",iconeOffsetX:"graphicXOffset",iconeOffsetY:"graphicYOffset",etiquette:"label",etiquetteOffsetX:"labelXOffset",etiquetteOffsetY:"labelYOffset",etiquetteAlignement:"labelAlign",etiquetteCouleur:"fontColor",etiquetteEpaisseur:"fontWeight",etiquetteTaille:"fontSize",etiquettePolice:"fontFamily",visible:"display",rotation:"rotation"},this.contexte=this.propriete.contexte||undefined,this._filtresOL=[],this.filtres=[],this.propriete.filtres&&this.ajouterFiltres(this.propriete.filtres)}return Style.prototype=new Evenement,Style.prototype
.constructor=Style,Style.prototype._getStyleOptionsOL=function(){var that=this,opt=$.extend({},this.defautPropriete,this.propriete),_optionsOL={};return $.each(this._lookupOptionsOL,function(valueIGO,valueOL){var vTemp=opt[valueIGO];vTemp=that._traiterValeurIGO(valueIGO,vTemp),_optionsOL[valueOL]=vTemp}),_optionsOL},Style.prototype._traiterValeurIGO=function(propriete,valeur){if(propriete!=="couleur"&&propriete!=="limiteCouleur"&&propriete!=="etiquetteCouleur"||!valeur)return propriete==="visible"?Aide.toBoolean(valeur)===!1?"none":"":valeur;if(valeur==="aleatoire"){var min=0,max=255;valeur=Fonctions.rgbToHex(Math.floor(Math.random()*(max-min+1)+min),Math.floor(Math.random()*(max-min+1)+min),Math.floor(Math.random()*(max-min+1)+min))}else if(valeur[0]!=="#"){var splitValeur=valeur.split(" ");splitValeur.length===3&&(valeur=Fonctions.rgbToHex(Number(splitValeur[0]),Number(splitValeur[1]),Number(splitValeur[2])))}return valeur},Style.prototype._getStyleOL=function(){var that=this,contexte
;this.contexte&&(contexte={},$.each(this.contexte,function(key,value){contexte[key]=function(feature){var occ;return that.parent&&(occ=that.parent.obtenirOccurenceParId(feature.id),!occ&&that.parent.obtenirClusterParId&&(occ=that.parent.obtenirClusterParId(feature.id))),that.contexte[key](occ)}}));var styleOL=new OpenLayers.Style(this._getStyleOptionsOL(),{context:contexte});return styleOL.addRules(this._filtresOL),styleOL.title=this.propriete.titre||"Style",styleOL},Style.prototype.obtenirPropriete=function(nom){var opt=$.extend({},this.defautPropriete,this.propriete);return opt[nom]},Style.prototype.definirPropriete=function(nom,valeur){valeur?this.propriete[nom]=valeur:delete this.propriete[nom];if(this.parent){var nomOL=this._lookupOptionsOL[nom],vTemp=this._traiterValeurIGO(nom,valeur);this.parent.obtenirTypeClasse()==="Vecteur"||this.parent.obtenirTypeClasse()==="VecteurCluster"||this.parent.obtenirTypeClasse()==="WFS"?(this.regle==="defaut"&&(this.parent._layer.styleMap.styles["default"
].defaultStyle[nomOL]=vTemp),this.parent._layer.styleMap.styles[this.regle].defaultStyle[nomOL]=vTemp,this.parent.rafraichir()):this.parent.obtenirTypeClasse()==="Occurence"&&(this.parent._feature.style||(this.parent._feature.style={}),vTemp?this.parent._feature.style[nomOL]=vTemp:delete this.parent._feature.style[nomOL],$.isEmptyObject(this.propriete)&&(this.parent._feature.style=undefined),this.parent.rafraichir())}},Style.prototype.ajouterFiltres=function(filtres){var that=this;$.each(filtres,function(key,value){that.ajouterFiltre(value)})},Style.prototype.ajouterFiltre=function(options){var filtre=options.filtre,style=options.style,that=this,comparatorArray=[],logicSeparator;filtre&&(filtre=filtre.replace(/ /g,""),logicSeparator=filtre.match(/&&|\|\|/g),comparatorArray=filtre.split(/&&|\|\|/g));var filterLast;$.each(comparatorArray,function(key,value){if(value==="")return!0;var propriete=value.substring(1,value.indexOf("]")),operatorMatch=value.match(/==|!=|<=|>=|<|>/);if(!operatorMatch
)throw new Error("Style.ajouterFiltre : Op\u00e9rateur invalide");var operator=operatorMatch[0],rule={};rule.value=value.split(operator)[1],rule.type=operator,rule.property=propriete;var filterComparison=new OpenLayers.Filter.Function({evaluate:function(attributes){var obj=attributes,proprieteSplited=rule.property.split(".");return $.each(proprieteSplited,function(key,value){if(!obj)return undefined;obj=obj[value]}),eval("obj"+operator+rule.value)}});if(key!==0)var filterLogical=new OpenLayers.Filter.Logical({type:logicSeparator[key-1],filters:[filterLast,filterComparison]});filterLast=filterLogical||filterComparison});var _optionsOL={};style instanceof Style?_optionsOL=style._getStyleOptionsOL():$.each(this._lookupOptionsOL,function(valueIGO,valueOL){var vTemp=style[valueIGO];vTemp=that._traiterValeurIGO(valueIGO,vTemp),_optionsOL[valueOL]=vTemp});var filtreCombinaison;filterLast?filtreCombinaison=new OpenLayers.Rule({name:options.titre,filter:filterLast,maxScaleDenominator:options.echelleMax
,minScaleDenominator:options.echelleMin,symbolizer:_optionsOL}):filtreCombinaison=new OpenLayers.Rule({name:options.titre,elseFilter:!0,maxScaleDenominator:options.echelleMax,minScaleDenominator:options.echelleMin,symbolizer:_optionsOL}),this._filtresOL.push(filtreCombinaison),this.filtres.push({filtre:filtre,style:style}),this.parent&&(this.parent.obtenirTypeClasse()==="Vecteur"||this.parent.obtenirTypeClasse()==="VecteurCluster"||this.parent.obtenirTypeClasse()==="WFS")&&(this.regle==="defaut"&&(this.parent._layer.styleMap.styles["default"].rules=this._filtresOL),this.parent._layer.styleMap.styles[this.regle].rules=this._filtresOL,this.parent.rafraichir())},Style.prototype.cloner=function(){return jQuery.extend(!0,{},this)},Style.prototype.reinitialiserFiltres=function(){this._filtresOL=[],this.filtres=[],this.parent&&(this.parent.obtenirTypeClasse()==="Vecteur"||this.parent.obtenirTypeClasse()==="VecteurCluster"||this.parent.obtenirTypeClasse()==="WFS")&&(this.regle==="defaut"&&(this
.parent._layer.styleMap.styles["default"].rules=this._filtresOL),this.parent._layer.styleMap.styles[this.regle].rules=this._filtresOL,this.parent.rafraichir())},Style.prototype.evaluerFiltre=function(filtre,occurence){var that=this,out=!1;return $.each(this.filtres,function(key,value){if(value===filtre)return that._filtresOL[key]&&that._filtresOL[key].evaluate&&occurence&&(out=that._filtresOL[key].evaluate(occurence._feature)),!1}),out},Style.prototype.obtenirStyleFiltreParOccurence=function(occurence){var that=this;if(!this.filtres.length)return this;var styleFiltre=$.extend({},this.propriete),estDansUnFiltre=!1;$.each(this.filtres,function(key,value){if(that._filtresOL[key]&&that._filtresOL[key].evaluate&&occurence&&that._filtresOL[key].evaluate(occurence._feature)){estDansUnFiltre=!0;var styleFiltreT=value.style;styleFiltreT&&styleFiltreT.propriete&&(styleFiltreT=styleFiltreT.propriete),$.extend(styleFiltre,styleFiltreT)}});if($.isEmptyObject(styleFiltre))return!1;var style=new Style
($.extend({},this.propriete,styleFiltre));return style.defautPropriete=this.defautPropriete,style},Style}),define("ligne",["point","aide"],function(Point,Aide){function Ligne(arrayPoint,proj){var that=this;this.points=[];if(!proj){var nav=Aide.obtenirNavigateur();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new Ligne : Projection EPSG invalide");this.projection=proj,arrayPoint&&(arrayPoint.CLASS_NAME==="OpenLayers.Geometry.LineString"||arrayPoint.CLASS_NAME==="OpenLayers.Geometry.LinearRing")&&(arrayPoint=arrayPoint.components);if(arrayPoint instanceof Array==0)throw new Error("new Ligne : Param\u00e8tre invalide");$.each(arrayPoint,function(index,value){if(value instanceof Array)that.points.push(new Point(value[0],value[1],that.projection));else if(value instanceof Point){if(value.projection!==that.projection)throw new Error("new Ligne : Les Points ne sont pas dans la m\u00eame projection"
);that.points.push(value)}else{if(value.CLASS_NAME!=="OpenLayers.Geometry.Point")throw new Error("new Ligne : Param\u00e8tre invalide");that.points.push(new Point(value.x,value.y,that.projection))}});if(that.points.length<2)throw new Error("new Ligne : La ligne doit \u00eatre compos\u00e9e d'au moins 2 points")}return Ligne.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Ligne.prototype.obtenirProjection=function(){return this.projection},Ligne.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("Ligne.definirProjection : Projection EPSG invalide");this.projection=proj},Ligne.prototype.obtenirLongueur=function(){return this._obtenirGeomOL().getGeodesicLength(this.projection)},Ligne.prototype.ajouterPoint=function(point){point instanceof Array&&(point=new Point(point[0],point[1],this.projection));
if(point instanceof Point==0)throw new Error("Ligne.ajouterPoint : L'argument n'est pas un point");if(point.projection!==this.projection)throw new Error("Ligne.ajouterPoint : Le point n'est pas dans la m\u00eame projection");return this.points.push(point),this._feature&&this._feature.geometry.addPoint(point._obtenirGeomOL()),this},Ligne.prototype.estFerme=function(){return this.points[0].estEgal(this.points[this.points.length-1])},Ligne.prototype.fermerLigne=function(){return this.estFerme()||this.ajouterPoint(this.points[0]),this},Ligne.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("Ligne.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("Ligne.projeter : Projection voulue invalide"
);var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),ligneOL=this._obtenirGeomOL(),ligneProj=ligneOL.transform(projSource,projDest);return new Ligne(ligneProj,dest)},Ligne.prototype.simplifier=function(tolerance){var ligneSimplifiee=this._obtenirGeomOL().simplify(tolerance);return new Ligne(ligneSimplifiee)},Ligne.prototype._obtenirGeomOL=function(tolerance){var ligneOL=[],ligneSimplifiee=this;return tolerance&&(ligneSimplifiee=this.simplifier(tolerance)),$.each(ligneSimplifiee.points,function(index,value){ligneOL.push(value._obtenirGeomOL())}),new OpenLayers.Geometry.LineString(ligneOL)},Ligne.prototype._obtenirGeomFermeOL=function(tolerance){var ligneOL=[],ligneSimplifiee=this;return tolerance&&(ligneSimplifiee=this.simplifier(tolerance)),$.each(ligneSimplifiee.points,function(index,value){ligneOL.push(value._obtenirGeomOL())}),new OpenLayers.Geometry.LinearRing(ligneOL)},Ligne}),define("polygone",["ligne","point","aide"],function(Ligne,Point,Aide
){function Polygone(arrayLigne,proj){var that=this;this.lignes=[];if(!proj){var nav=Aide.obtenirNavigateur();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new Polygone : Projection EPSG invalide");this.projection=proj;if(!arrayLigne)throw new Error("new Polygone : Le param\u00e8tre est obligatoire");arrayLigne.CLASS_NAME==="OpenLayers.Geometry.Polygon"?arrayLigne=arrayLigne.components:arrayLigne instanceof Ligne||arrayLigne.CLASS_NAME==="OpenLayers.Geometry.LineString"||arrayLigne.CLASS_NAME==="OpenLayers.Geometry.LinearRing"?arrayLigne=[arrayLigne]:$.isArray(arrayLigne)&&arrayLigne[0]&&(arrayLigne[0]instanceof Ligne||arrayLigne[0].CLASS_NAME==="OpenLayers.Geometry.LineString"||arrayLigne[0].CLASS_NAME==="OpenLayers.Geometry.LinearRing")||$.isArray(arrayLigne[0])&&arrayLigne[0][0]&&(arrayLigne[0][0]instanceof Point||arrayLigne[0
][0]instanceof Array||arrayLigne[0][0].CLASS_NAME==="OpenLayers.Geometry.Point")||(arrayLigne=[arrayLigne]),$.each(arrayLigne,function(index,value){if(value instanceof Array)that.lignes.push((new Ligne(value,that.projection)).fermerLigne());else if(value instanceof Ligne){if(value.projection!==that.projection)throw new Error("new Polygone : Les lignes ne sont pas dans la m\u00eame projection");that.lignes.push(value.fermerLigne())}else{if(value.CLASS_NAME!=="OpenLayers.Geometry.LineString"&&value.CLASS_NAME!="OpenLayers.Geometry.LinearRing")throw new Error("new Polygone : Param\u00e8tre invalide");that.lignes.push(new Ligne(value.components,that.projection))}});if(that.lignes.length<1)throw new Error("new Polygone : Le polygone doit \u00eatre compos\u00e9 d'au moins une ligne")}return Polygone.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Polygone.prototype.obtenirProjection=function(){return this.projection},Polygone
.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("Polygone.definirProjection : Projection EPSG invalide");this.projection=proj},Polygone.prototype.obtenirPerimetre=function(){return this._obtenirGeomOL().getGeodesicLength(this.projection)},Polygone.prototype.obtenirSuperficie=function(){return this._obtenirGeomOL().getGeodesicArea(this.projection)},Polygone.prototype.obtenirExterieur=function(){return this.lignes[0]},Polygone.prototype.obtenirInterieurs=function(){return this.lignes.slice(1)},Polygone.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("Polygone.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0
,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("Polygone.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),polyOL=this._obtenirGeomOL(),polyProj=polyOL.transform(projSource,projDest);return new Polygone(polyProj,dest)},Polygone.prototype.simplifier=function(tolerance){var lignesSimplifiees=[];return $.each(this.lignes,function(index,value){var ligneSimp=value.simplifier(tolerance);if(index!==0&&ligneSimp.points.length<4)return!0;lignesSimplifiees.push(ligneSimp)}),new Polygone(lignesSimplifiees)},Polygone.prototype._obtenirGeomOL=function(tolerance){var polygoneOL=[];return $.each(this.lignes,function(index,value){polygoneOL.push(value._obtenirGeomFermeOL(tolerance))}),new OpenLayers.Geometry.Polygon(polygoneOL)},Polygone}),define("multiPoint",["aide","point"],function(Aide,Point){function MultiPoint(arrayPoint,proj){var that=this;this.points=[];if(!proj){var nav=Aide.obtenirNavigateur
();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new MultiPoint : Projection EPSG invalide");this.projection=proj,arrayPoint&&arrayPoint.CLASS_NAME==="OpenLayers.Geometry.MultiPoint"&&(arrayPoint=arrayPoint.components);if(arrayPoint instanceof Array==0)throw new Error("new MultiPoint : Param\u00e8tre invalide");$.each(arrayPoint,function(index,value){if(value instanceof Array)that.points.push(new Point(value[0],value[1],that.projection));else if(value instanceof Point){if(value.projection!==that.projection)throw new Error("new MultiPoint : Les Points ne sont pas dans la m\u00eame projection");that.points.push(value)}else{if(value.CLASS_NAME!=="OpenLayers.Geometry.Point")throw new Error("new MultiPoint : Param\u00e8tre invalide");that.points.push(new Point(value.x,value.y,that.projection))}});if(this.points.length<1)throw new Error
("new MultiPoint : Le multiPoint doit \u00eatre compos\u00e9 d'au moins 1 point")}return MultiPoint.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},MultiPoint.prototype.obtenirProjection=function(){return this.projection},MultiPoint.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("MultiPoint.definirProjection : Projection EPSG invalide");this.projection=proj},MultiPoint.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("MultiPoint.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0
])throw new Error("MultiPoint.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),multiPointsOL=this._obtenirGeomOL(),multiPointsProj=multiPointsOL.transform(projSource,projDest);return new MultiPoint(multiPointsProj,dest)},MultiPoint.prototype._obtenirGeomOL=function(){var pointsOL=[];return $.each(this.points,function(index,value){pointsOL.push(value._obtenirGeomOL())}),new OpenLayers.Geometry.MultiPoint(pointsOL)},MultiPoint}),define("multiLigne",["aide","point","ligne"],function(Aide,Point,Ligne){function MultiLigne(arrayLigne,proj){var that=this;this.lignes=[];if(!proj){var nav=Aide.obtenirNavigateur();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new MultiLigne : Projection EPSG invalide");this.projection=proj;if(!arrayLigne)throw new Error("new MultiLigne : Le param\u00e8tre est obligatoire"
);arrayLigne.CLASS_NAME==="OpenLayers.Geometry.MultiLineString"?arrayLigne=arrayLigne.components:arrayLigne instanceof Ligne||arrayLigne.CLASS_NAME==="OpenLayers.Geometry.LineString"||arrayLigne.CLASS_NAME==="OpenLayers.Geometry.LinearRing"?arrayLigne=[arrayLigne]:$.isArray(arrayLigne)&&arrayLigne[0]&&(arrayLigne[0]instanceof Ligne||arrayLigne[0].CLASS_NAME==="OpenLayers.Geometry.LineString"||arrayLigne[0].CLASS_NAME==="OpenLayers.Geometry.LinearRing")||$.isArray(arrayLigne[0])&&arrayLigne[0][0]&&(arrayLigne[0][0]instanceof Point||arrayLigne[0][0]instanceof Array||arrayLigne[0][0].CLASS_NAME==="OpenLayers.Geometry.Point")||(arrayLigne=[arrayLigne]),$.each(arrayLigne,function(index,value){if(value instanceof Array)that.lignes.push(new Ligne(value,that.projection));else if(value instanceof Ligne){if(value.projection!==that.projection)throw new Error("new MultiLigne : Les lignes ne sont pas dans la m\u00eame projection");that.lignes.push(value)}else{if(value.CLASS_NAME!=="OpenLayers.Geometry.LineString"&&
value.CLASS_NAME!="OpenLayers.Geometry.LinearRing")throw new Error("new MultiLigne : Param\u00e8tre invalide");that.lignes.push(new Ligne(value.components,that.projection))}});if(that.lignes.length<1)throw new Error("new MultiLigne : Le MultiLigne doit \u00eatre compos\u00e9 d'au moins une ligne")}return MultiLigne.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},MultiLigne.prototype.obtenirProjection=function(){return this.projection},MultiLigne.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("MultiLigne.definirProjection : Projection EPSG invalide");this.projection=proj},MultiLigne.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source
.substr(5).match(/[0-9]+/)[0])throw new Error("MultiLigne.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("MultiLigne.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),multiLignesOL=this._obtenirGeomOL(),multiLignesProj=multiLignesOL.transform(projSource,projDest);return new MultiLigne(multiLignesProj,dest)},MultiLigne.prototype._obtenirGeomOL=function(){var lignesOL=[];return $.each(this.lignes,function(index,value){lignesOL.push(value._obtenirGeomOL())}),new OpenLayers.Geometry.MultiLineString(lignesOL)},MultiLigne}),define("multiPolygone",["polygone","aide"],function(Polygone,Aide){function MultiPolygone(polygones,proj){var that=this;this.polygones=[];if(!proj){var nav=Aide.obtenirNavigateur();nav&&nav.carte?proj=nav.carte.obtenirProjection():proj="EPSG:3857"}else if(typeof proj!="string"||
proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("new Polygone : Projection EPSG invalide");this.projection=proj,polygones&&polygones.CLASS_NAME==="OpenLayers.Geometry.MultiPolygon"&&(polygones=polygones.components);if(polygones instanceof Array==0)throw new Error("new MultiPolygone : Param\u00e8tre invalide");$.each(polygones,function(index,value){value instanceof Polygone?that.polygones.push(value):that.polygones.push(new Polygone(value,proj))});if(that.polygones.length===0)throw new Error("new MultiPolygone : Le multipolygone doit \u00eatre compos\u00e9 d'au moins 1 polygone")}return MultiPolygone.prototype.obtenirProjection=function(){return this.projection},MultiPolygone.prototype.definirProjection=function(proj){if(typeof proj!="string"||proj.toUpperCase().substr(0,5)!=="EPSG:"||proj.substr(5)!==proj.substr(5).match(/[0-9]+/)[0])throw new Error("MultiPolygone.definirProjection : Projection EPSG invalide");this.projection=
proj},MultiPolygone.prototype.obtenirPerimetre=function(){return this._obtenirGeomOL().getGeodesicLength(this.projection)},MultiPolygone.prototype.obtenirSuperficie=function(){return this._obtenirGeomOL().getGeodesicArea(this.projection)},MultiPolygone.prototype.projeter=function(arg1,arg2){var dest,source;arg2?(source=arg1,dest=arg2):(source=this.projection,dest=arg1);if(typeof source!="string"||source.toUpperCase().substr(0,5)!=="EPSG:"||source.substr(5)!==source.substr(5).match(/[0-9]+/)[0])throw new Error("MultiPolygone.projeter : Projection source invalide");if(typeof dest!="string"||dest.toUpperCase().substr(0,5)!=="EPSG:"||dest.substr(5)!==dest.substr(5).match(/[0-9]+/)[0])throw new Error("MultiPolygone.projeter : Projection voulue invalide");var projSource=new OpenLayers.Projection(source),projDest=new OpenLayers.Projection(dest),polyOL=this._obtenirGeomOL(),polyProj=polyOL.transform(projSource,projDest);return new MultiPolygone(polyProj,dest)},MultiPolygone.prototype.obtenirTypeClasse=
function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},MultiPolygone.prototype._obtenirGeomOL=function(tolerance){var polygoneOL=[];return $.each(this.polygones,function(index,value){polygoneOL.push(value._obtenirGeomOL(tolerance))}),new OpenLayers.Geometry.MultiPolygon(polygoneOL)},MultiPolygone}),define("occurence",["limites","style","point","ligne","polygone","multiPoint","multiLigne","multiPolygone","aide","evenement"],function(Limites,Style,Point,Ligne,Polygone,MultiPoint,MultiLigne,MultiPolygone,Aide,Evenement){function Occurence(geometrie,proprietes,style,opt){this._init(geometrie,proprietes,style,opt)}return Occurence.prototype=new Evenement,Occurence.prototype.constructor=Occurence,Occurence.prototype._init=function(geometrie,proprietes,style,opt){opt=opt||{};if(geometrie&&geometrie.CLASS_NAME==="OpenLayers.Feature.Vector"){var vectorOL=geometrie;proprietes=proprietes||vectorOL.attributes,opt._keepFeature||(geometrie=vectorOL.geometry)}this.styles=
{},this._definirGeometrie(geometrie),this.definirProprietes(proprietes),this.accepterModifications(),this.selectionnee=!1,this.definirStyle(style)},Occurence.prototype.estSelectionnee=function(){return this.selectionnee},Occurence.prototype.selectionner=function(){this.estDansCluster||this.appliquerStyle("select"),this.selectionnee=!0,this.declencher({type:"occurenceSelectionnee"}),this.vecteur&&(this.vecteur.obtenirTypeClasse()==="VecteurCluster"&&this.vecteur.rafraichirClusters(),this.vecteur.declencher({type:"vecteurOccurenceSelectionnee",occurence:this}))},Occurence.prototype.deselectionner=function(){this.estDansCluster||this.appliquerStyle("defaut"),this.selectionnee=!1,this.declencher({type:"occurenceDeselectionnee"}),this.vecteur&&(this.vecteur.obtenirTypeClasse()==="VecteurCluster"&&this.vecteur.rafraichirClusters(!0),this.vecteur.declencher({type:"vecteurOccurenceDeselectionnee",occurence:this}))},Occurence.prototype.estVisible=function(){return this._feature.onScreen()},Occurence
.prototype.estAffichee=function(){return this._feature.getVisibility()},Occurence.prototype.obtenirTypeGeometrie=function(){return this.type},Occurence.prototype.obtenirProprietes=function(){return this._feature?this._feature.attributes:undefined},Occurence.prototype.definirProprietes=function(proprietes){if(proprietes&&!$.isPlainObject(proprietes))throw new Error("Occurence.definirProprietes : Param\u00e8tre invalide");this.proprietesOriginales||(this.modifiee=!0,this.proprietesOriginales=$.extend(!0,{},this.obtenirProprietes())),this.proprietes=proprietes||{},this._feature.attributes=this.proprietes,this.rafraichir(),this.declencher({type:"occurenceModifiee",modif:proprietes,modifType:"objetProprietes"}),this.vecteur&&this.vecteur.declencher({type:"vecteurOccurenceModifiee",occurence:this,modif:proprietes,modifType:"objetProprietes"})},Occurence.prototype.obtenirPropriete=function(propriete){if(!propriete)return undefined;var obj=this._feature.attributes;propriete[0]==="/"&&(propriete=
propriete.substr(1),obj=this);var proprieteSplited=propriete.split(".");return $.each(proprieteSplited,function(key,value){if(!obj)return undefined;obj=obj[value]}),obj},Occurence.prototype.definirPropriete=function(propriete,valeur){if(typeof propriete!="string")throw new Error("Occurence.definirPropriete : Nom de la propri\u00e9t\u00e9 invalide");var obj=this._feature.attributes;propriete[0]==="/"&&(propriete=propriete.substr(1),obj=this);var proprieteSplited=propriete.split("."),dernierePropriete=proprieteSplited.pop();$.each(proprieteSplited,function(key,value){if(obj[value]){obj=obj[value];if(!$.isPlainObject(obj)&&!$.isArray(obj))throw new Error("Occurence.definirPropriete : Nom de la propri\u00e9t\u00e9 invalide")}else obj[value]={},obj=obj[value]}),this.proprietesOriginales||(this.modifiee=!0,this.proprietesOriginales=$.extend(!0,{},this.obtenirProprietes())),obj[dernierePropriete]=valeur,this.proprietes=this._feature.attributes,this.rafraichir(),this.declencher({type:"occurenceModifiee"
,modif:{propriete:propriete,valeur:valeur},modifType:"propriete"}),this.vecteur&&this.vecteur.declencher({type:"vecteurOccurenceModifiee",occurence:this,modif:{propriete:propriete,valeur:valeur},modifType:"propriete"})},Occurence.prototype.obtenirErreurs=function(){return this.erreurs},Occurence.prototype.obtenirErreur=function(propriete){if(!propriete)return undefined;var obj=this.erreurs,proprieteSplited=propriete.split(".");return $.each(proprieteSplited,function(key,value){if(!obj)return undefined;obj=obj[value]}),obj},Occurence.prototype.definirErreurs=function(erreurs,categorie){categorie?(this.erreurs||(this.erreurs={}),this.erreurs[categorie]=erreurs):this.erreurs=erreurs||{}},Occurence.prototype.definirErreur=function(propriete,valeur){if(typeof propriete!="string")throw new Error("Occurence.definirErreur : Nom de la propri\u00e9t\u00e9 invalide");var obj=this.erreurs?this.erreurs:this.erreurs={},proprieteSplited=propriete.split("."),dernierePropriete=proprieteSplited.pop(),premierePropriete
;proprieteSplited&&(premierePropriete=proprieteSplited.shift(),obj=obj[premierePropriete]?obj[premierePropriete]:this.erreurs[premierePropriete]={}),$.each(proprieteSplited,function(key,value){obj=obj[value];if(!obj)throw new Error("Occurence.definirErreur : Nom de la propri\u00e9t\u00e9 invalide")}),obj[dernierePropriete]=valeur},Occurence.prototype.obtenirStyle=function(regle,verifierVecteur,verifierFiltre){regle=regle||"courant",regle=regle==="courant"?this.regleCourant:regle;if(!this.styles[regle]||!this.styles[regle].obtenirTypeClasse||!this.styles[regle].obtenirTypeClasse()==="Style"){var style;return verifierVecteur==1&&this.vecteur&&(style=this.vecteur.styles[regle],style&&verifierFiltre===!0&&(style=style.obtenirStyleFiltreParOccurence(this))),style}return this.styles[regle]},Occurence.prototype.definirStyle=function(style,regle){regle=regle||"defaut";if(typeof regle!="string")throw new Error("Occurence.definirStyle : R\u00e8gle du style invalide");style&&style.obtenirTypeClasse&&
style.obtenirTypeClasse()==="Style"?(this.styles[regle]=style.cloner(),this.styles[regle].parent=this):$.isPlainObject(style)?(this.styles[regle]=new Style(style),this.styles[regle].parent=this):this.styles[regle]=undefined,(!this.regleCourant||this.regleCourant===regle)&&this.appliquerStyle(this.regleCourant)},Occurence.prototype.appliquerStyle=function(regle,survol){regle=regle||"defaut";if(typeof regle!="string")throw new Error("Occurence.appliquerStyle : R\u00e8gle du style invalide");regle==="courant"&&(regle=this.regleCourant),this.regleCourant=regle;if(survol===!1)this.survolStyleActif=!1;else if(survol||this.survolStyleActif)survol==1&&(this.survolStyleActif=!0),this._definirOverStyle(survol),regle="over";this.styles[regle]?(this._feature.style=this.styles[regle]._getStyleOptionsOL(),this._feature.renderIntent=undefined):(this._feature.style=undefined,regle=regle==="defaut"?"default":regle,this._feature.renderIntent=regle),this.rafraichir()},Occurence.prototype._definirOverStyle=
function(type){type=type==="survolPlus"?"survolPlus":"survol";var opacite=type==="survolPlus"?"0.7":"0.6",styleMap;try{styleMap=this.vecteur._layer.styleMap.styles}catch(e){return!1}if(this.obtenirStyle(type)){var styleCourant;this.obtenirStyle("courant")?styleCourant=this.obtenirStyle("courant").cloner():styleCourant=new Style;var styleSurvol=this.obtenirStyle(type);$.extend(styleCourant.propriete,styleSurvol.propriete),this.definirStyle(styleCourant,"over")}else if(this.obtenirStyle("courant")){var style=this.obtenirStyle("courant").cloner();style.propriete.opacite=opacite,this.definirStyle(style,"over")}else{this.definirStyle(undefined,"over");if(this.vecteur&&this.vecteur.styles&&this.vecteur.styles[type]){var courantStyle=this.vecteur.styles[this.regleCourant]||this.vecteur.styles.defaut,survolStyle=this.vecteur.styles[type];courantStyle&&(survolStyle.defautPropriete=$.extend({},courantStyle.defautPropriete,courantStyle.propriete)),styleMap.over=survolStyle._getStyleOL()}else{try{styleMap
[this.regleCourant]?styleMap.over=styleMap[this.regleCourant].clone():styleMap.over=styleMap["default"].clone()}catch(e){styleMap.over=(new Style)._getStyleOL()}styleMap.over.defaultStyle.fillOpacity=opacite}}return!0},Occurence.prototype.obtenirProprieteStyle=function(nom,regle,evaluer){regle=regle||"courant",regle=regle==="courant"?this.regleCourant:regle;var style=this.obtenirStyle(regle,!0,!0);if(style){var propriete=style.obtenirPropriete(nom),regex=/^\${.+}$/;return evaluer&&propriete!==undefined&&regex.test(propriete)?this.obtenirPropriete(propriete.substring(2,propriete.length-1)):propriete}return undefined},Occurence.prototype.definirProprieteStyle=function(nom,valeur,regle){if(typeof nom!="string")throw new Error("Occurence.definirProprieteStyle : Nom de la propri\u00e9t\u00e9 invalide");regle=regle||"courant",regle=regle=="courant"?this.regleCourant:regle;if(this.obtenirStyle(regle))this.obtenirStyle(regle).definirPropriete(nom,valeur);else if(this.obtenirStyle(regle,!0,!0)){
var style=this.obtenirStyle(regle,!0,!0);$.extend(style.defautPropriete,style.propriete),style.propriete={},this.definirStyle(style,regle),this.definirProprieteStyle(nom,valeur,regle)}else{var opt={};opt[nom]=valeur,this.definirStyle(new Style(opt),regle)}this.styles[regle]&&$.isEmptyObject(this.styles[regle].propriete)&&delete this.styles[regle],this.appliquerStyle("courant")},Occurence.prototype.obtenirLimites=function(){if(this.limites)return this.limites;var limitesOL=this._obtenirGeomOL().getBounds();return new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top)},Occurence.prototype.cacher=function(tousLesStyles){this.definirProprieteStyle("visible","none"),this.vecteur&&this.vecteur.carte.gestionCouches.enleverOccurenceSurvol(this),this.rafraichir(),tousLesStyles&&(this.definirProprieteStyle("visible","none","defaut"),this.definirProprieteStyle("visible","none","select"))},Occurence.prototype.afficher=function(tousLesStyles){this.definirProprieteStyle("visible",
undefined),this.rafraichir(),tousLesStyles&&(this.definirProprieteStyle("visible",undefined,"defaut"),this.definirProprieteStyle("visible",undefined,"select"))},Occurence.prototype.rafraichir=function(){this.vecteur&&this.vecteur.rafraichir(this)},Occurence.prototype.ouvrirInfobulle=function(args){var that=this;args=args||{};if(!this.estAffichee()&&!args.force)return;var position=OpenLayers.LonLat.fromString(this._obtenirGeomOL().getCentroid().toShortString()),dimension=args.dimension?new OpenLayers.Size(args.dimension[0],args.dimension[1]):null,html=args.html||"<p>Aucun contenu.</p>",callbackFermeture=args.callbackFermeture||null,aFermerBouton=args.aFermerBouton===undefined?!0:Aide.toBoolean(args.aFermerBouton);this.fermerInfobulle(),this._infobulle=new OpenLayers.Popup.FramedCloud(null,position,dimension,html,null,aFermerBouton,function(e){callbackFermeture.call(that,e)}),args.minDimension&&args.minDimension.length===2&&(this._infobulle.minSize=new OpenLayers.Size(args.minDimension[0]
,args.minDimension[1])),args.maxDimension&&args.maxDimension.length===2&&(this._infobulle.maxSize=new OpenLayers.Size(args.maxDimension[0],args.maxDimension[1])),this.vecteur&&this.vecteur.carte._carteOL.addPopup(this._infobulle)},Occurence.prototype.fermerInfobulle=function(){this._infobulle&&(this.vecteur&&this.vecteur.carte._carteOL.removePopup(this._infobulle),this._infobulle=null)},Occurence.prototype._definirGeometrie=function(geometrie){var proprietes=this.obtenirProprietes();delete this._feature,delete this.x,delete this.x,delete this.points,delete this.lignes,delete this.polygones,delete this.gauche,delete this.droite,delete this.haut,delete this.bas;if(!geometrie)this._feature=new OpenLayers.Feature.Vector,this.type=undefined;else if(geometrie.CLASS_NAME!==undefined){geometrie.CLASS_NAME==="OpenLayers.Feature.Vector"?(this._feature=geometrie,geometrie=geometrie.geometry,this.id=this._feature.id):this._feature=new OpenLayers.Feature.Vector(geometrie);if(geometrie.CLASS_NAME==="OpenLayers.Geometry.Polygon"
)this.type="Polygone",geometrie=new Polygone(geometrie);else if(geometrie.CLASS_NAME==="OpenLayers.Geometry.MultiPolygon")this.type="MultiPolygone",geometrie=new MultiPolygone(geometrie);else if(geometrie.CLASS_NAME==="OpenLayers.Geometry.MultiLineString")this.type="MultiLigne",geometrie=new MultiLigne(geometrie);else if(geometrie.CLASS_NAME==="OpenLayers.Geometry.MultiPoint")this.type="MultiPoint",geometrie=new MultiPoint(geometrie);else if(geometrie.CLASS_NAME==="OpenLayers.Geometry.Point")this.type="Point",geometrie=new Point(geometrie);else if(geometrie.CLASS_NAME==="OpenLayers.Geometry.LineString"||geometrie.CLASS_NAME==="OpenLayers.Geometry.LinearRing")this.type="Ligne",geometrie=new Ligne(geometrie)}else if(geometrie._obtenirGeomOL){var geomOL=geometrie._obtenirGeomOL();this._feature=new OpenLayers.Feature.Vector(geomOL),this.type=geometrie.obtenirTypeClasse()}if(!this._feature)throw new Error("Occurence._definirGeometrie : La g\u00e9om\u00e9trie est invalide");$.extend(this,geometrie
,{projeter:Occurence.prototype.projeter});if(!this.id){var type=this.type?this.type+"_":"";this.id=this.obtenirTypeClasse()+"_"+type+this._feature.id.substr(this._feature.id.lastIndexOf("_")+1)}return this._feature.id=this.id,this._feature.attributes=proprietes||{},this},Occurence.prototype._obtenirGeometrie=function(){switch(this.obtenirTypeGeometrie()){case"Point":return new Point(this.x,this.y,this.obtenirProjection());case"Ligne":return new Ligne(this.points,this.obtenirProjection());case"Polygone":return new Polygone(this.lignes,this.obtenirProjection());case"MultiPolygone":return new MultiPolygone(this.polygones,this.obtenirProjection());case"Limites":return new Limites(this.gauche,this.bas,this.droite,this.haut);default:return undefined}},Occurence.prototype.majGeometrie=function(geometrie){return this.vecteur&&(this.vecteur.carte.gestionCouches.enleverOccurenceSurvol(this),this.vecteur._layer.removeFeatures(this._feature)),this.geometrieOriginale||(this.modifiee=!0,this.geometrieOriginale=
this._obtenirGeometrie()),this._definirGeometrie(geometrie),this.vecteur&&(this.vecteur._layer.addFeatures(this._feature),this.appliquerStyle(this.regleCourant,!1)),this.declencher({type:"occurenceModifiee",modif:geometrie,modifType:"g\u00e9om\u00e9trie"}),this.vecteur&&this.vecteur.declencher({type:"vecteurOccurenceModifiee",occurence:this,modifGeometrie:geometrie,modifType:"g\u00e9om\u00e9trie"}),this},Occurence.prototype.annulerModifications=function(){this.modifiee&&(this.geometrieOriginale&&(this.majGeometrie(this.geometrieOriginale),this.geometrieOriginale=undefined),this.proprietesOriginales&&(this.definirProprietes($.extend(!0,{},this.proprietesOriginales)),this.proprietesOriginales=undefined),this.modifiee=!1),this.ajoutee=!1,this.enlevee=!1},Occurence.prototype.accepterModifications=function(){this.modifiee&&(delete this.geometrieOriginale,delete this.proprietesOriginales,this.modifiee=!1),this.ajoutee=!1,this.enlevee=!1},Occurence.prototype.projeter=function(arg1,arg2){var geom=
this._obtenirGeometrie().projeter(arg1,arg2);return this.cloner()._definirGeometrie(geom)},Occurence.prototype.cloner=function(garderStyleVecteur){return garderStyleVecteur?new Occurence(this._obtenirGeometrie(),this.proprietes,this.obtenirStyle(this.regleCourant,!0,!0)):new Occurence(this._obtenirGeometrie(),this.proprietes,this.styles)},Occurence.prototype.reinitialiserAttributs=function(){this.definirProprietes(),delete this.proprietesOriginales,this.modifiee=this.geometrieOriginale?!0:!1},Occurence}),define("couche",["evenement","aide"],function(Evenement,Aide){var compteur=0;function Couche(options){this.options=options||{},this._layer,this.carte,this.defautOptions={visible:!0,active:!1}}return Couche.prototype=new Evenement,Couche.prototype.constructor=Couche,Couche.prototype._init=function(){this.defautOptions.groupe="Autres Couches",Aide.toBoolean(this.options.fond)&&(this.defautOptions.groupe="Fond de carte"),this.options=$.extend({},this.defautOptions,Aide.obtenirConfig("Couche"
),Aide.obtenirConfig(this.obtenirTypeClasse()),this.options);var opt=this.options,printOptions={fromLayer:!0};if(opt.impressionUrl){var format=opt.format||"png";printOptions={url:opt.impressionUrl,layers:opt.impressionNom||opt.nom,format:"image/"+format,mapformat:format}}this._optionsOL=$.extend({isBaseLayer:Aide.toBoolean(opt.fond),minScale:opt.echelleMin,maxScale:opt.echelleMax,group:opt.groupe,attribution:opt.droit,typeContexte:opt.typeContexte,displayInLayerSwitcher:Aide.toBoolean(opt.visible),legende:Aide.toBoolean(opt.legende),visibility:Aide.toBoolean(opt.active),opacity:opt.opacite?opt.opacite/100:1,zTree:opt.ordreArborescence,printOptions:printOptions},this._optionsOL,this.options._optionsOL)},Couche.prototype._ajoutCallback=function(target,callback,optCallback){this.options.id?(this.id=this.options.id,target.obtenirCoucheParId(this.options.id)&&(this.id+=this._getLayer().id.substr(this._getLayer().id.lastIndexOf("_")+1),console.warn("Ajout d'une couche: L'identifiant '"+this.options
.id+"' n'est pas unique. L'identifiant de la couche a \u00e9t\u00e9 modifi\u00e9 pour '"+this.id+"'"))):this.id="couche_"+this._getLayer().id.substr(this._getLayer().id.lastIndexOf("_")+1),this._getLayer().id=this.id,typeof callback=="function"&&callback.call(target,this,optCallback),this._getLayer().events.register("loadstart",this,function(e){this.afficherChargement()}),this._getLayer().events.register("loadend",this,function(e){this.masquerChargement()})},Couche.prototype._getLayer=function(){if(!this._layer)throw new Error("Igo.Couches."+this.constructor.name+"._getLayer()");return this._layer},Couche.prototype.obtenirTitre=function(){if(this._getLayer())return this._getLayer().name},Couche.prototype.obtenirGroupe=function(){return this.options.groupe},Couche.prototype.obtenirId=function(){return this.id},Couche.prototype.definirCarte=function(carte){this.carte=carte},Couche.prototype.estFond=function(){return this._layer?this._getLayer().isBaseLayer:this.options.fond},Couche.prototype
.estActive=function(){return this._getLayer().getVisibility()},Couche.prototype.activer=function(bool){if(bool===!1){this.desactiver();return}this.estFond()&&this.carte._carteOL.setBaseLayer(this._getLayer()),this._getLayer().setVisibility(!0)},Couche.prototype.desactiver=function(bool){if(bool===!1){this.activer();return}if(this.estFond())return;this._getLayer().setVisibility(!1)},Couche.prototype.definirOpacite=function(opacite){this._getLayer().setOpacity(opacite)},Couche.prototype.obtenirOrdreAffichageBase=function(){return this.estFond()?this.carte._getCarte().Z_INDEX_BASE.BaseLayer:this.carte._getCarte().Z_INDEX_BASE.Overlay},Couche.prototype.obtenirOrdreAffichage=function(){return Number(this._getLayer().getZIndex())},Couche.prototype.definirOrdreAffichage=function(ordreAffichage){if(!ordreAffichage){var oAffichage;this.options.ordreAffichage?oAffichage=this.options.ordreAffichage:(compteur+=2,oAffichage=compteur),ordreAffichage=this.obtenirOrdreAffichageBase()+Number(oAffichage)
}isNaN(ordreAffichage)||(this._getLayer().setZIndex(ordreAffichage),this._getLayer().z_index_default=ordreAffichage)},Couche.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Couche.prototype.obtenirProjection=function(){return this._layer.projection.projCode},Couche.prototype.obtenirElementDivArbo=function(){var that=this,result=!1;return this._layer.layerContainer&&$.each(this._layer.layerContainer.childNodes,function(index,node){if(node.text==that.obtenirTitre())return result=node.ui.elNode,!1}),result},Couche.prototype.afficherChargement=function(){var div=this.obtenirElementDivArbo(),$layerArboLoading=$(div).find(".layerArboLoading");$layerArboLoading.length?$layerArboLoading.show():div&&$(div).find(".x-tree-node-anchor").after('<img class="layerArboLoading" src="'+Aide.utiliserBaseUri("images/app/loading_14_14.gif")+'" alt="Chargement">')},Couche.prototype.masquerChargement=function(){var div=this.obtenirElementDivArbo
();div&&$(div).find(".layerArboLoading").hide()},Couche}),define("blanc",["couche"],function(Couche){function Blanc(options){this.options=options||{},this.options.fond=!0,this._init(options)}return Blanc.prototype=new Couche,Blanc.prototype.constructor=Blanc,Blanc.prototype._init=function(){Couche.prototype._init.call(this),this.options.titre||(this.options.titre="Blanc"),this._layer=new OpenLayers.Layer(this.options.titre,this._optionsOL)},Blanc.prototype._ajoutCallback=function(target,callback,optCallback){this._layer.numZoomLevels=this.carte._carteOL.numZoomLevels,Couche.prototype._ajoutCallback.call(this,target,callback,optCallback)},Blanc}),define("gestionCouches",["evenement","couche","blanc","limites","aide"],function(Evenement,Couche,Blanc,Limites,Aide){function GestionCouches(carte){this.listeCouches=[],this.listeOccurencesSurvols=[],this.carte=carte,this.controles=new GestionCouches.Controles(this)}return GestionCouches.prototype=new Evenement,GestionCouches.prototype.constructor=
GestionCouches,GestionCouches.prototype.ajouterCouches=function(couches){var that=this;$.each(couches,function(key,value){that.ajouterCouche(value)})},GestionCouches.prototype.ajouterCouche=function(couche){if(!(couche instanceof Couche))throw new Error("Igo.Carte.ajouterCouche(couche) a besoin d'un objet de type Igo.Couches");couche.definirCarte(this.carte),couche._=this,couche._ajoutCallback(this,this._ajouterCoucheCallback)},GestionCouches.prototype._ajouterCoucheCallback=function(couche){var that=this;couche._getLayer()&&(this.listeCouches.push(couche),setTimeout(function(){that.carte._carteOL.addLayer(couche._getLayer()),couche.definirOrdreAffichage(),couche.estFond()&&couche.desactiver(!Aide.toBoolean(couche.options.active))},1),this.declencher({type:"ajouterCouche",couche:couche}))},GestionCouches.prototype.enleverCouche=function(couche){var idx=this.listeCouches.indexOf(couche);idx!==-1&&(this.listeCouches.splice(idx,1),this.carte._carteOL.removeLayer(couche._getLayer()),couche.
declencher({type:"enleverCouche"}),this.declencher({type:"enleverCouche",couche:couche}))},GestionCouches.prototype.enleverToutesLesCouches=function(){var that=this,i=0;this.ajouterCouche(new Blanc);while(this.listeCouches.length>i)that.enleverCouche(that.listeCouches[0]);this.declencher({type:"enleverToutesLesCouches"})},GestionCouches.prototype.obtenirCouches=function(trier){return trier?this.listeCouches.sort(function(a,b){return a.obtenirOrdreAffichage()-b.obtenirOrdreAffichage()}):this.listeCouches},GestionCouches.prototype.obtenirCouchesParTitre=function(titre){var couches=[];return $.each(this.listeCouches,function(index,value){value.obtenirTitre()===titre&&couches.push(value)}),couches},GestionCouches.prototype.trouverCouches=function(regex,opt){opt=opt||{};var testerTitre=opt.testerTitre!==!1?!0:!1,testerGroupe=opt.testerGroupe!==!1?!0:!1;if(typeof regex=="string"){var ignorerCase=opt.ignorerCase!==!1?"i":"",string=regex;opt.exacte!==!0&&(string=string.replace(/ /g,".*")),regex=new 
RegExp(string,ignorerCase)}else if(!(regex instanceof RegExp))return!1;var couches=[];return $.each(this.listeCouches,function(index,value){(testerTitre&&regex.test(value.obtenirTitre())||testerGroupe&&regex.test(value.obtenirGroupe()))&&couches.push(value)}),couches},GestionCouches.prototype.obtenirCouchesDeBase=function(){var couches=[];return $.each(this.listeCouches,function(index,value){value.estFond()&&couches.push(value)}),couches},GestionCouches.prototype.obtenirCouchesParType=function(type,trier){$.isArray(type)||(type=[type]);var couches=[];return $.each(this.listeCouches,function(key,value){type.indexOf(value.obtenirTypeClasse())!==-1&&couches.push(value)}),trier?couches.sort(function(a,b){return a.obtenirOrdreAffichage()-b.obtenirOrdreAffichage()}):couches},GestionCouches.prototype.obtenirCoucheParId=function(id){var couche;return $.each(this.listeCouches,function(key,value){if(value.obtenirId()===id)return couche=value,!1}),couche},GestionCouches.prototype.obtenirCouchesParTypePermis=
function(type,trier){var couches=[];return $.each(this.listeCouches,function(key,value){(value.obtenirTypeClasse()==="Vecteur"||value.obtenirTypeClasse()==="VecteurCluster"||value.obtenirTypeClasse()==="WFS")&&value.options.protege!==!0&&(value.options.typeGeometriePermise===undefined||value.options.typeGeometriePermise===type)&&couches.push(value)}),trier?couches.sort(function(a,b){return a.obtenirOrdreAffichage()-b.obtenirOrdreAffichage()}):couches},GestionCouches.prototype.obtenirOccurencesSelectionnees=function(groupe){if(groupe==0){var occurences=[];return $.each(this.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"]),function(key,value){occurences=occurences.concat(value.obtenirOccurencesSelectionnees())}),occurences}var occurences={};return $.each(this.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"]),function(key,value){occurences[value.obtenirId()]=value.obtenirOccurencesSelectionnees()}),occurences},GestionCouches.prototype.obtenirOccurenceParId=function(id){var occurence
;return $.each(this.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"]),function(key,value){occurence=value.obtenirOccurenceParId(id);if(occurence)return!1}),occurence},GestionCouches.prototype.deselectionnerToutesOccurences=function(){$.each(this.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"]),function(key,value){value.deselectionnerTout()})},GestionCouches.prototype.zoomerSelections=function(maxZoom){var occurences=this.obtenirOccurencesSelectionnees(!1);this.zoomerOccurences(occurences,maxZoom)},GestionCouches.prototype.zoomerOccurences=function(occurences,maxZoom){if(!occurences||occurences.length===0)return!1;var limiteGauche=null,limiteDroite=null,limiteHaut=null,limiteBas=null;$.each(occurences,function(indice,occurence){var limitesOccurence=occurence.obtenirLimites();if(limiteGauche==null||limiteGauche>limitesOccurence.gauche)limiteGauche=limitesOccurence.gauche;if(limiteBas==null||limiteBas>limitesOccurence.bas)limiteBas=limitesOccurence.bas;if(limiteDroite==null||
limiteDroite<limitesOccurence.droite)limiteDroite=limitesOccurence.droite;if(limiteHaut==null||limiteHaut<limitesOccurence.haut)limiteHaut=limitesOccurence.haut});var limiteSelection=new Limites(limiteGauche,limiteBas,limiteDroite,limiteHaut);this.carte.zoomer(limiteSelection,maxZoom)},GestionCouches.prototype.obtenirListeOccurencesSurvols=function(){return this.listeOccurencesSurvols},GestionCouches.prototype.ajouterOccurenceSurvol=function(occurence){$(".olMapViewport").css("cursor","pointer");var index=this.obtenirListeOccurencesSurvols().indexOf(occurence);index===-1&&(occurence.appliquerStyle("courant",!0),this.obtenirListeOccurencesSurvols().push(occurence),occurence.vecteur.declencher({type:"occurenceSurvol",occurence:occurence}))},GestionCouches.prototype.enleverOccurenceSurvol=function(occurence){occurence.appliquerStyle("courant",!1);var index=this.obtenirListeOccurencesSurvols().indexOf(occurence);index!==-1&&this.obtenirListeOccurencesSurvols().splice(index,1),this.obtenirListeOccurencesSurvols
().length===0&&$(".olMapViewport").css("cursor",""),occurence.vecteur&&occurence.vecteur.declencher({type:"occurenceSurvolFin",occurence:occurence})},GestionCouches.prototype.deselectionnerCouchesWMS=function(){var tabCouches=this.obtenirCouchesParType("WMS");$.each(tabCouches,function(index,couche){!couche.estFond()&&couche.estActive()&&couche.desactiver()})},GestionCouches.Controles=function(_){this._=_},GestionCouches}),define("contexteMenu",["point","aide"],function(Point,Aide){function ContexteMenu(options){this.options=options||{},this.init()}return ContexteMenu.prototype.init=function(){var that=this;this.fonctionsConstruction=[],this.$selecteur=this.options.selecteur?$(this.options.selecteur):$(this.options.cible),this.contexteMenu=new Ext.menu.Menu({items:[]}),this.$selecteur.bind("contextmenu",this.options.cible,function(e){var estConstruit=that.construire(e);estConstruit&&that.contexteMenu.showAt([e.clientX,e.clientY]),e.preventDefault()})},ContexteMenu.prototype.obtenirInformation=
function(e){return{}},ContexteMenu.prototype.construire=function(e){this.contexteMenu.removeAll();var info=this.obtenirInformation(e);if(!info)return!1;info.scope=this;var that=this;return $.each(this.fonctionsConstruction,function(key,fn){var resultat=fn(info);if(resultat){if(!resultat.keysMenu)return that.contexteMenu.add(resultat),!0;var menu=that.contexteMenu;try{$.each(resultat.keysMenu,function(key,valueKey){menu=menu.items.map[valueKey].menu}),menu.add(resultat.submenu)}catch(e){console.warn(e)}}}),!0},ContexteMenu.prototype.ajouterFonctionsConstruction=function(fn){this.fonctionsConstruction.push(fn)},ContexteMenu.prototype.ajouter=function(args){var id=args.id,titre=args.titre||"Pas de titre",action=args.action,condition=args.condition,position=args.position,evenement=args.evenement,rendu=args.rendu,fnConstruction=function(args){if(!$.isFunction(condition)||condition(args)){var splitId=id.split("."),lastId=splitId[splitId.length-1];splitId.pop();var submenu;return action?submenu=
{id:lastId,text:titre,handler:function(){action(args)}}:rendu&&evenement?submenu={id:lastId,text:titre,menu:{items:{html:rendu,listeners:{afterrender:function(){evenement(args)}},handler:function(){return!1}}}}:submenu={id:lastId,text:titre,menu:{items:[]}},{submenu:submenu,keysMenu:splitId}}};position?this.fonctionsConstruction.splice(position,0,fnConstruction):this.fonctionsConstruction.push(fnConstruction)},ContexteMenu}),define("analyseurGML",["point","ligne","polygone","multiPoint","multiLigne","multiPolygone","occurence"],function(Point,Ligne,Polygone,MultiPoint,MultiLigne,MultiPolygone,Occurence){function AnalyseurGML(options){this.options=options||{};var carteProj=this.options.projectionCarte||"EPSG:3857",format=OpenLayers.Class(OpenLayers.Format.GML,{parseFeature:function(node){var order=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point"],type,nodeList,geometry,parser;for(var i=0;i<order.length;++i){type=order[i],nodeList=this.getElementsByTagNameNS(node
,this.gmlns,type);if(nodeList.length>0){parser=this.parseGeometry[type.toLowerCase()];if(!parser)throw new TypeError("Unsupported geometry type: "+type);geometry=parser.apply(this,[nodeList[0]]);var proj=nodeList[0].getAttribute("srsName");proj&&(this.externalProjection=new OpenLayers.Projection(proj)),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);break}}var attributes;this.extractAttributes&&(attributes=this.parseAttributes(node),delete attributes.boundedBy,delete attributes.msGeometry);var geometrie;if(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")geometrie=new MultiPolygone(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")geometrie=new MultiLigne(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")geometrie=new MultiPoint(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon")geometrie=new Polygone(geometry);else if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"
)geometrie=new Ligne(geometry);else{if(geometry.CLASS_NAME!="OpenLayers.Geometry.Point")return console.log(geometry.CLASS_NAME),!0;geometrie=new Point(geometry)}var feature=new Occurence(geometrie,attributes);return feature}});this._parser=new format({internalProjection:new OpenLayers.Projection(carteProj)})}return AnalyseurGML.prototype.lire=function(gml){return this._parser.read(gml)},AnalyseurGML.prototype.lireUrl=function(opt){opt=opt||{};var url=opt.url,callback=opt.callback;if(!callback||!url)return!1;var that=this;$.ajax({url:url,success:function(result,status,xhr){var rep=that.lire(result);callback&&callback.call(that,rep,status,xhr)},error:function(xhr,status,error){callback&&callback.call(that,error,status,xhr)}})},AnalyseurGML.prototype.ecrire=function(occurences){if(!occurences)return!1;occurences.obtenirTypeClasse&&(occurences.obtenirTypeClasse()==="Vecteur"||occurences.obtenirTypeClasse()==="VecteurCluster"||occurences.obtenirTypeClasse()==="WFS")&&(occurences=occurences.obtenirOccurences
());if(occurences.obtenirTypeClasse&&occurences.obtenirTypeClasse()==="Occurence")occurences=[occurences];else if(occurences._obtenirGeomOL)return this._parser.write(occurences._obtenirGeomOL());var listFeaturesOL=[];return $.each(occurences,function(key,value){if(!value.obtenirTypeClasse||value.obtenirTypeClasse()!=="Occurence")return!0;listFeaturesOL.push(value._feature)}),this._parser.write(listFeaturesOL)},AnalyseurGML}),define("vecteur",["couche","occurence","limites","style","aide"],function(Couche,Occurence,Limites,Style,Aide){function Vecteur(options){this.options=options||{},this.garderHistorique=this.options.garderHistorique,this._historiqueOccurencesAjoutees=[],this._historiqueOccurencesEnlevees=[],this.defautOptions.selectionnable=!0,this.listeOccurences=[],this.styles={},this.templates={},this.obtenirTypeClasse()==="Vecteur"&&this._init()}return Vecteur.prototype=new Couche,Vecteur.prototype.constructor=Vecteur,Vecteur.prototype._init=function(){if(!this.options.layerOL){Couche
.prototype._init.call(this);var titre=this.options.titre||"vecteur";this._optionsOL.rendererOptions={zIndexing:!0},this._layer=new OpenLayers.Layer.Vector(titre,this._optionsOL);if(!this._optionsOL.styleMap){var styles=this.options.styles||new Style;this.definirStyles(styles)}}else this._layer=this.options.layerOL},Vecteur.prototype._ajoutCallback=function(target,callback,optCallback){var that=this;Couche.prototype._ajoutCallback.call(this,target,callback,optCallback),this.controles=new Vecteur.Controles(this),that.options.source&&that.options.sourceType&&require(["analyseur"+that.options.sourceType],function(Analyseur){if(!Analyseur){var message='Erreur: Couche vecteur "'+that.obtenirTitre()+'" (id: '+that.obtenirId()+")<br>";message+='\u00c9chec lors du chargement "'+that.options.donnees+'"<br>',message+="Message: Type de donnees inconnu.",Aide.afficherMessageConsole(message)}var analyseur=new Analyseur;analyseur.lireUrl({url:Aide.utiliserProxy(that.options.source),callback:function(reponse
,status){if(status==="success")that.ajouterOccurences(reponse);else{var message='Erreur: Couche vecteur "'+that.obtenirTitre()+'" (id: '+that.obtenirId()+")<br>";message+='\u00c9chec lors du chargement "'+that.options.donnees+'"<br>',message+="Message: "+reponse,Aide.afficherMessageConsole(message)}}})})},Vecteur.prototype.obtenirOccurences=function(){return this.listeOccurences},Vecteur.prototype.obtenirOccurencesModifiees=function(ajoutEtRetrait){var occurencesModifiees=[];return $.each(this.obtenirOccurences(),function(key,occurence){ajoutEtRetrait&&(occurence.modifiee||occurence.ajoutee||occurence.enlevee)?occurencesModifiees.push(occurence):occurence.modifiee&&!occurence.ajoutee&&!occurence.enlevee&&occurencesModifiees.push(occurence)}),occurencesModifiees},Vecteur.prototype.obtenirOccurencesEnlevees=function(){return this._historiqueOccurencesEnlevees},Vecteur.prototype.obtenirOccurencesAjoutees=function(){return this._historiqueOccurencesAjoutees},Vecteur.prototype.selectionnerOccurence=
function(occurence){if(!occurence||!occurence._feature)return;occurence.selectionner()},Vecteur.prototype.obtenirOccurencesSelectionnees=function(){var occurences=[];return $.each(this.obtenirOccurences(),function(key,value){value.selectionnee&&occurences.push(value)}),occurences},Vecteur.prototype.obtenirOccurenceParId=function(id){var occurence;return $.each(this.obtenirOccurences(),function(key,value){if(value.id===id)return occurence=value,!1}),occurence},Vecteur.prototype.deselectionnerOccurence=function(occurence){if(!occurence||!occurence._feature)return;occurence.deselectionner()},Vecteur.prototype.deselectionnerTout=function(opt){var that=this,opt=opt||{};$.each(this.obtenirOccurencesSelectionnees(),function(key,value){(!opt.exceptions||$.inArray(value,opt.exceptions)===-1)&&that.deselectionnerOccurence(value)})},Vecteur.prototype.selectionnerTout=function(opt){var that=this,opt=opt||{};$.each(this.obtenirOccurences(),function(key,value){(!opt.exceptions||$.inArray(value,opt.exceptions
)===-1)&&that.selectionnerOccurence(value)})},Vecteur.prototype.selectionnerInverse=function(opt){var that=this,opt=opt||{};$.each(this.obtenirOccurences(),function(key,value){if(!opt.exceptions||$.inArray(value,opt.exceptions)===-1)value.selectionnee?that.deselectionnerOccurence(value):that.selectionnerOccurence(value)})},Vecteur.prototype.creerOccurence=function(geometrie,info,opt){opt=opt||{};if(geometrie instanceof Occurence){this.ajouterOccurence(geometrie,opt);return}var creationOccurence={};opt.existe&&(creationOccurence._keepFeature=!0);var occurence=new Occurence(geometrie,info,undefined,creationOccurence);this.ajouterOccurence(occurence,opt)},Vecteur.prototype.ajouterOccurence=function(occurence,opt){opt=opt||{};if(occurence instanceof Occurence==0){this.creerOccurence(occurence,undefined,opt);return}return this.options.typeGeometriePermise&&this.options.typeGeometriePermise!==occurence.type?(console.warn("Cette couche vecteur accepte seulement le type de g\u00e9om\u00e9trie: "+
this.options.typeGeometriePermise),!1):occurence.type?this.options.protege&&opt.forcer!==!0?(console.warn("Cette couche est prot\u00e9g\u00e9e, elle n'accepte pas l'ajout d'occurrence de cette fa\u00e7on."),!1):(occurence.vecteur=this,this.options.simplificationZoom&&opt.simplificationZoom!==!1&&(occurence._feature.geometry=occurence._obtenirGeomOL(this.carte._carteOL.getResolution()/2)),this.listeOccurences.push(occurence),opt.existe||(occurence._feature.utilisateur=!0,this._layer.addFeatures(occurence._feature)),this.garderHistorique&&(occurence.ajoutee=!0,this._historiqueOccurencesAjoutees.push(occurence)),this.declencher({type:"ajouterOccurence",occurence:occurence}),occurence):(console.warn("L'occurence doit avoir une g\u00e9om\u00e9trie pour \u00eatre ajout\u00e9e \u00e0 la couche vecteur."),!1)},Vecteur.prototype.ajouterOccurences=function(occurences,opt){var that=this;if(!occurences)return!1;$.each(occurences,function(key,value){that.ajouterOccurence(value,opt)}),this.declencher
({type:"ajouterOccurences",occurences:occurences})},Vecteur.prototype.enleverOccurence=function(occurence,opt){var idx=this.listeOccurences.indexOf(occurence);idx!==-1&&(occurence.vecteur=undefined,this.listeOccurences.splice(idx,1),this._layer.removeFeatures(occurence._feature),this.carte.gestionCouches.enleverOccurenceSurvol(occurence),this.garderHistorique&&(occurence.enlevee=!0,occurence.ajoutee?this._historiqueOccurencesAjoutees.remove(occurence):this._historiqueOccurencesEnlevees.push(occurence))),this.declencher({type:"enleverOccurence",occurence:occurence})},Vecteur.prototype.accepterModifications=function(saveFn){var save=saveFn||!1;!save&&this.options.fnSauvegarder&&(save=this.options.fnSauvegarder(this)),save&&($.each(this.obtenirOccurencesModifiees(!0),function(key,occurence){occurence.accepterModifications()}),$.each(this._historiqueOccurencesEnlevees,function(key,occurence){occurence.accepterModifications()}),this._historiqueOccurencesAjoutees=[],this._historiqueOccurencesEnlevees=
[])},Vecteur.prototype.annulerModifications=function(){this.garderHistorique=!1,this.enleverOccurences(this._historiqueOccurencesAjoutees),this._historiqueOccurencesAjoutees=[],this.ajouterOccurences(this._historiqueOccurencesEnlevees),this._historiqueOccurencesEnlevees=[],this.garderHistorique=!0,$.each(this.obtenirOccurencesModifiees(!0),function(key,occurence){occurence.annulerModifications()}),$.each(this._historiqueOccurencesAjoutees,function(key,occurence){occurence.annulerModifications()})},Vecteur.prototype.enleverOccurences=function(occurences,opt){var that=this,occurencesClone=$.extend({},occurences);$.each(occurencesClone,function(key,value){that.enleverOccurence(value,opt)})},Vecteur.prototype.enleverTout=function(opt){this.enleverOccurences(this.listeOccurences,opt)},Vecteur.prototype.cacherOccurence=function(occurence){if(!occurence||occurence.vecteur!==this)return!1;occurence.cacher()},Vecteur.prototype.afficherOccurence=function(occurence){if(!occurence||occurence.vecteur!==
this)return!1;occurence.afficher()},Vecteur.prototype.obtenirLimites=function(){var limitesOL=this._layer.getDataExtent();if(!limitesOL)return!1;var limites=new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top);return limites},Vecteur.prototype.zoomerOccurences=function(occurences,maxZoom){if(!occurences){var limitesOL=this._layer.getDataExtent();if(!limitesOL)return!1;var limites=new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top);return this.carte.zoomer(limites,maxZoom),!0}this.carte.gestionCouches.zoomerOccurences(occurences,maxZoom)},Vecteur.prototype.zoomerOccurence=function(occurence,maxZoom){this.carte.zoomer(occurence.obtenirLimites(),maxZoom),this.declencher({type:"zoomerOccurence",occurence:occurence})},Vecteur.prototype.obtenirStyles=function(){return this.styles},Vecteur.prototype.definirStyles=function(styles){var that=this;if(styles)if(!styles.obtenirTypeClasse||styles.obtenirTypeClasse()!=="Style"){var styleMap={};$.each(styles
,function(key,style){style.obtenirTypeClasse||(style=new Style(style)),that.styles[key]=style.cloner(),that.styles[key].parent=that,that.styles[key].regle=key,styleMap[key]=that.styles[key]._getStyleOL();if(key==="defaut"){var styleOL=that.styles.defaut._getStyleOL();styleMap["default"]=styleOL,styleMap.defaut=styleOL}}),styleMap.select||(styleMap.select=styleMap["default"].clone(),styleMap.select.defaultStyle.fillColor="#0000FF",styleMap.select.defaultStyle.strokeColor="#0000FF",styleMap.select.defaultStyle.strokeWidth=2,styleMap.select.defaultStyle.graphicZIndex=100),this._optionsOL.styleMap=new OpenLayers.StyleMap(styleMap),this._layer&&(this._layer.styleMap=this._optionsOL.styleMap,this.rafraichir())}else this.definirStyle(styles,"defaut")},Vecteur.prototype.obtenirStyle=function(regle){return regle=regle||"defaut",this.styles[regle]},Vecteur.prototype.definirStyle=function(style,regle){regle||(regle="defaut"),style.obtenirTypeClasse||(style=new Style(style)),this.styles[regle]=style
.cloner(),this.styles[regle].parent=this,this.styles[regle].regle=regle;if(this.styles)if(this._optionsOL.styleMap){if(regle==="defaut"){var styleOL=this.styles.defaut._getStyleOL();this._optionsOL.styleMap.styles["default"]=styleOL,this._optionsOL.styleMap.styles.defaut=styleOL}else regle==="select"&&(this._optionsOL.styleMap.styles.select=this.styles.select._getStyleOL());this._layer&&(this._layer.styleMap=this._optionsOL.styleMap,this.rafraichir())}else this.definirStyles(this.styles)},Vecteur.prototype.rafraichir=function(occurence){if(!occurence)return this._layer.redraw(),this.rafraichirLegende(),!0;this._layer.drawFeature(occurence._feature),this.rafraichirLegende()},Vecteur.prototype.rafraichirLegende=function(){this._layer.arborescence&&(this._layer.arborescence.setRules(),this._layer.arborescence.update())},Vecteur.prototype.obtenirOrdreAffichageBase=function(){return this.carte._getCarte().Z_INDEX_BASE.Vecteur},Vecteur.prototype.enlever=function(){return this.carte.gestionCouches
.enleverCouche(this),!0},Vecteur.Controles=function(_){this._=_;if(this._.options.simplificationZoom){var that=this._;that.carte._carteOL.events.register("zoomend",that.carte._carteOL,function(){var zoom=that.carte.obtenirZoom();if(zoom%2===0)return!0;$.each(that.listeOccurences,function(key,occurence){that._layer.removeFeatures(occurence._feature),occurence._geomSimplifiee||(occurence._geomSimplifiee={}),occurence._geomSimplifiee[zoom]||(occurence._geomSimplifiee[zoom]=occurence._obtenirGeomOL(that.carte._carteOL.getResolution()/2)),occurence._feature.geometry=occurence._geomSimplifiee[zoom],that._layer.addFeatures(occurence._feature)})})}},Vecteur.Controles.prototype.activerDeplacement=function(opt){opt=opt||{},this._dragControl||(this._dragControl=new OpenLayers.Control.DragFeature(this._._layer,{onStart:this._debutDeplacement,onDrag:this._deplacement,onComplete:this._finDeplacement,scope:this}),this._.carte._getCarte().addControl(this._dragControl)),this._dragControl.activate()},Vecteur
.Controles.prototype.desactiverDeplacement=function(){this._dragControl&&this._dragControl.deactivate()},Vecteur.Controles.prototype._debutDeplacement=function(feature){var that=this.scope,occurence=that._.obtenirOccurenceParId(feature.id);that._.declencher({type:"debutDeplacementOccurence",occurence:occurence})},Vecteur.Controles.prototype._deplacement=function(feature){var that=this.scope,occurence=that._.obtenirOccurenceParId(feature.id);occurence.x=feature.geometry.x,occurence.y=feature.geometry.y,that._.declencher({type:"deplacementOccurence",occurence:occurence})},Vecteur.Controles.prototype._finDeplacement=function(feature){var that=this.scope,occurence=that._.obtenirOccurenceParId(feature.id);occurence.x=feature.geometry.x,occurence.y=feature.geometry.y,that._.declencher({type:"finDeplacementOccurence",occurence:occurence})},Vecteur.Controles.prototype.activerSelection=function(opt){opt=opt||{};if(this._.obtenirDeclencheur("occurenceClique",null,this._selection).length)return!1;
this._.ajouterDeclencheur("occurenceClique",this._selection,{scope:this})},Vecteur.Controles.prototype.desactiverSelection=function(){this._.carte.enleverDeclencheur("occurenceClique",null,this._selection)},Vecteur.Controles.prototype._selection=function(e){var that=e.options.scope;if(that._.obtenirId()!==e.occurence.vecteur.obtenirId())return!1;Aide.obtenirNavigateur().obtenirCtrl()||that._.carte.gestionCouches.deselectionnerToutesOccurences(),e.occurence.estSelectionnee()?e.occurence.vecteur.deselectionnerOccurence(e.occurence):e.occurence.vecteur.selectionnerOccurence(e.occurence)},Vecteur}),define("contexteMenuCarte",["contexteMenu","point","polygone","occurence","aide","analyseurGML","fonctions","vecteur"],function(ContexteMenu,Point,Polygone,Occurence,Aide,AnalyseurGML,Fonctions,Vecteur){function ContexteMenuCarte(options){this.options=options||{},this.init()}return ContexteMenuCarte.prototype=new ContexteMenu,ContexteMenuCarte.prototype.constructor=ContexteMenuCarte,ContexteMenuCarte
.prototype.init=function(){var that=this;ContexteMenu.prototype.init.call(this),this.ajouterFonctionsConstruction(this.initCoordonneesSubmenu),this.ajouterFonctionsConstruction(this.initImporterOccurenceSubmenu),this.ajouterFonctionsConstruction(this.initOccurencesSubmenu),this.ajouterFonctionsConstruction(this.initSelectionSubmenu),this.$selecteur.on("mousedown",function(e){e.which===1&&that.contexteMenu.isVisible()&&that.contexteMenu.hide()})},ContexteMenuCarte.prototype.obtenirInformation=function(e){var offset=this.$selecteur.offset(),pixel=new OpenLayers.Pixel(e.pageX-offset.left,e.pageY-offset.top),lonlat=this.options.carte._carteOL.getLonLatFromViewPortPx(pixel),point=new Point(lonlat.lon,lonlat.lat),occurencesSurvolees=this.options.carte.gestionCouches.obtenirListeOccurencesSurvols().slice(),occurencesSelectionnees=this.options.carte.gestionCouches.obtenirOccurencesSelectionnees(!1);return{point:point,occurencesSurvolees:occurencesSurvolees,occurencesSelectionnees:occurencesSelectionnees
}},ContexteMenuCarte.prototype.initCoordonneesSubmenu=function(args){return{id:"coordonneesSubmenu",text:"Coordonn\u00e9es",menu:{items:[{id:"coordonneesCarte",text:"Projection de la carte",handler:function(){Aide.afficherMessage("Coordonn\u00e9es",args.point.x+", "+args.point.y)}},{id:"coordonnees4326",text:"Projection EPSG:4326",handler:function(){var pProj=args.point.projeter("EPSG:4326");Aide.afficherMessage("Coordonn\u00e9es",pProj.x+", "+pProj.y)}}]}}},ContexteMenuCarte.prototype.initImporterOccurenceSubmenu=function(args){var that=args.scope,coucheWFSActive=that.options.carte.gestionCouches.coucheWFSActive;if(!coucheWFSActive||!coucheWFSActive.estActive())return!1;var carteEchelle=that.options.carte.obtenirEchelle();return carteEchelle>coucheWFSActive.options.echelleMin||carteEchelle<coucheWFSActive.options.echelleMax?!1:{id:"importerOccurenceSubmenu",text:"Importer occurence",handler:function(){Aide.afficherMessageChargement({message:"Importation en cours, patientez un moment..."
});var pProj=args.point.projeter("EPSG:32198"),resolution=that.options.carte._carteOL.getResolution()*3,minX=pProj.x-resolution,minY=pProj.y-resolution,maxX=pProj.x+resolution,maxY=pProj.y+resolution,filtre="<Filter><BBOX><PropertyName>Geometry</PropertyName><Box srsName='EPSG:32198'><coordinates>"+minX+","+minY+" "+maxX+","+maxY+"</coordinates></Box></BBOX></Filter>";$.ajax({url:coucheWFSActive.options.url,data:{MAP:coucheWFSActive.options.mapdir,SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"getfeature",TYPENAME:coucheWFSActive.options.nom,FILTER:filtre},context:this,success:function(resultat){var id="_"+coucheWFSActive.obtenirId()+"_Importation",couche=that.options.carte.gestionCouches.obtenirCoucheParId(id);couche||(couche=new Igo.Couches.Vecteur({id:id,titre:coucheWFSActive.obtenirTitre()+"-Importation",simplificationZoom:!0,active:!0,selectionnable:!0,ordreAffichage:coucheWFSActive.obtenirOrdreAffichage()+1}),that.options.carte.gestionCouches.ajouterCouche(couche));var formatXML=new AnalyseurGML
({projectionCarte:that.options.carte.obtenirProjection()}),features=formatXML.lire(resultat);Aide.obtenirNavigateur().obtenirCtrl()||couche.enleverTout(),features.length||Aide.afficherMessage("Aucune donn\u00e9e trouv\u00e9e","Aucune donn\u00e9e n'a \u00e9t\u00e9 trouv\u00e9e"),$.each(features,function(key,feature){couche.ajouterOccurence(feature)}),Aide.cacherMessageChargement()},dataType:"XML",error:function(){alert("error...")}})}}},ContexteMenuCarte.prototype.initOccurencesSubmenu=function(args){var that=args.scope;if(args.occurencesSurvolees.length!==0){var menu={id:"occurencesSubmenu",text:"Occurences",menu:{items:[]}};menu.menu.items.push({id:"occurencesInfo",text:"Info",handler:function(){Fonctions.afficherProprietes(args.occurencesSurvolees)}}),$.each(args.occurencesSurvolees,function(key,occurence){var submenu={id:"occurence"+key,text:occurence.vecteur.obtenirTitre(),menu:{items:[]},listeners:{afterrender:function(){$("#occurence"+key).mouseover(function(){occurence.appliquerStyle
("courant","survolPlus")}),$("#occurence"+key).mouseout(function(){occurence.appliquerStyle("courant")})}}},occurenceMenu=submenu.menu.items;occurence.vecteur.options.selectionnable&&occurence.vecteur.options.supprimable!==!1&&occurence.obtenirTypeClasse()!=="Cluster"&&occurence.vecteur.options.protege!==!0&&occurenceMenu.push({id:"occurenceSupprimer"+key,text:"Supprimer",handler:function(){occurence.vecteur.enleverOccurence(occurence)}});if(occurence.type==="Ligne")occurenceMenu.push("-"),occurenceMenu.push({id:"occurenceLongueur"+key,text:"Longueur",handler:function(){var longueur=occurence.obtenirLongueur();Aide.afficherMessage("Longueur",longueur+" "+that.options.carte._carteOL.getUnits())}});else if(occurence.type==="Polygone"||occurence.type==="MultiPolygone")occurenceMenu.push("-"),occurenceMenu.push({id:"occurencePerimetre"+key,text:"P\u00e9rim\u00e8tre",handler:function(){var perimetre=occurence.obtenirPerimetre();Aide.afficherMessage("P\u00e9rim\u00e8tre",perimetre+" "+that.options
.carte._carteOL.getUnits())}},{id:"occurenceSuperficie"+key,text:"Superficie",handler:function(){var superficie=occurence.obtenirSuperficie();Aide.afficherMessage("Superficie",superficie+" "+that.options.carte._carteOL.getUnits()+"\u00b2")}});var submenuCopieVers=that.initSubMenuCopieVers(key,occurence);submenuCopieVers&&occurenceMenu.push(submenuCopieVers),occurenceMenu.length!==0&&menu.menu.items.push(submenu)})}return menu},ContexteMenuCarte.prototype.initSelectionSubmenu=function(args){if(args.occurencesSelectionnees.length!==0){var type="",memeType=!0;$.each(args.occurencesSelectionnees,function(index,occurence){type===""?type=occurence.type:type!==occurence.type&&(memeType=!1)});var subSelection={id:"selectionSubmenu",text:"Selection",menu:{items:[{id:"selectionCompter",text:"Compter",handler:function(){Aide.afficherMessage("Informations",args.occurencesSelectionnees.length+" occurences selectionn\u00e9es")}}]}};subSelection.menu.items.push({id:"selectionInfo",text:"Info",handler:
function(){Fonctions.afficherProprietes(args.occurencesSelectionnees)}});if(memeType){var submenuCopieVers=args.scope.initSubMenuCopieVers("-1",args.occurencesSelectionnees,type);submenuCopieVers&&subSelection.menu.items.push(submenuCopieVers)}return subSelection}},ContexteMenuCarte.prototype.initSubMenuCopieVers=function(key,occurence,type){type||(type=occurence.type);var listeCouche=[];type==="Ligne"||type==="Polygone"?(listeCouche=this.options.carte.gestionCouches.obtenirCouchesParTypePermis("Ligne"),listeCouche=listeCouche.concat(this.options.carte.gestionCouches.obtenirCouchesParTypePermis("Polygone")),$.unique(listeCouche)):listeCouche=this.options.carte.gestionCouches.obtenirCouchesParTypePermis(type),occurence.obtenirTypeClasse&&(occurence=[occurence]);var coucheDe=[];for(var i=0;i<occurence.length;i++){var occu=occurence[i];occu.obtenirTypeClasse()==="Occurence"?coucheDe.push(occu.vecteur):occurence.remove(occu)}$.unique(coucheDe),coucheDe.length===1&&listeCouche.remove(coucheDe
[0]);if(listeCouche.length===0||occurence.length===0)return!1;var submenuCopieVers={id:"copieVers"+key,text:"Copier vers la couche...",menu:{items:[]}};return $.each(listeCouche,function(index,couche){var titre=couche.obtenirTitre();submenuCopieVers.menu.items.push({id:"coucheCopie"+key+titre,text:titre,handler:function(){$.each(occurence,function(ind,occu){var clone=occu.cloner();occu.vecteur===couche&&clone.reinitialiserAttributs(),couche.options.typeGeometriePermise&&couche.options.typeGeometriePermise!==clone.obtenirTypeGeometrie()&&(couche.options.typeGeometriePermise==="Ligne"?clone.obtenirTypeGeometrie()==="Polygone"&&(clone=clone.obtenirExterieur()):couche.options.typeGeometriePermise==="Polygone"&&clone.obtenirTypeGeometrie()==="Ligne"&&(clone=new Polygone(clone._obtenirGeometrie()))),couche.ajouterOccurence(clone)})}})}),submenuCopieVers},ContexteMenuCarte}),OpenLayers.Control.DrawFeatureEx=OpenLayers.Class(OpenLayers.Control.DrawFeature,{initialize:function(handler,options){var layer=
options.handlerOptions.layer;OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[layer,handler,options]),this.keyboardCallbacks={keydown:this.handleKeyDown},this.keyboardHandler=new OpenLayers.Handler.Keyboard(this,this.keyboardCallbacks,{})},handleKeyDown:function(evt){switch(evt.keyCode){case 90:(evt.metaKey||evt.ctrlKey)&&this.undo();break;case 89:(evt.metaKey||evt.ctrlKey)&&this.redo();break;case 27:this.cancel()}},activate:function(){OpenLayers.Control.DrawFeature.prototype.activate.apply(this,arguments),this.keyboardHandler.activate()},deactivate:function(){OpenLayers.Control.DrawFeature.prototype.deactivate.apply(this,arguments),this.keyboardHandler.deactivate()},CLASS_NAME:"OpenLayers.Control.DrawFeatureEx"}),define("libs/extension/OpenLayers/DrawFeatureEx",function(){}),OpenLayers.Handler.CircleToMeasure=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{move:function(evt){var maploc=this.layer.getLonLatFromViewPortPx(evt.xy),point=new OpenLayers.Geometry.Point(maploc
.lon,maploc.lat);if(this.irregular){var ry=Math.sqrt(2)*Math.abs(point.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,ry)}else this.fixedRadius?this.origin=point:(this.calculateAngle(point,evt),this.radius=Math.max(this.map.getResolution()/2,point.distanceTo(this.origin)));this.modifyGeometry();if(this.irregular){var dx=point.x-this.origin.x,dy=point.y-this.origin.y,ratio;dy==0?ratio=dx/(this.radius*Math.sqrt(2)):ratio=dx/dy,this.feature.geometry.resize(1,this.origin,ratio),this.feature.geometry.move(dx/2,dy/2)}this.layer.drawFeature(this.feature,this.style),this.callback("modify",[this.origin,this.feature,1])},CLASS_NAME:"OpenLayers.Handler.CircleToMeasure"}),define("libs/extension/OpenLayers/CircleToMeasure",function(){}),OpenLayers.Control.MeasureCircle=OpenLayers.Class(OpenLayers.Control.Measure,{measureImmediate:function(point,feature,drawing){this.cancelDelay(),this.measure(point,"measurepartial")},CLASS_NAME:"OpenLayers.Control.MeasureCircle"}),define("libs/extension/OpenLayers/MeasureCircle"
,function(){}),OpenLayers.Map.prototype.resetLayersZIndex=function(){for(var i=0,len=this.layers.length;i<len;i++){var layer=this.layers[i];layer.z_index_default?layer.setZIndex(layer.z_index_default):this.setLayerZIndex(layer,i)}},define("libs/extension/OpenLayers/resetLayersZIndex",function(){}),define("carte",["point","occurence","limites","gestionCouches","evenement","aide","contexteMenuCarte","libs/extension/OpenLayers/DrawFeatureEx","libs/extension/OpenLayers/CircleToMeasure","libs/extension/OpenLayers/MeasureCircle","libs/extension/OpenLayers/resetLayersZIndex"],function(Point,Occurence,Limites,GestionCouches,Evenement,Aide,ContexteMenuCarte){function Carte(options){this.gestionCouches=new GestionCouches(this),this.options=options||{},this._init(),this.controles=new Carte.Controles(this)}return Carte.prototype=new Evenement,Carte.prototype.constructor=Carte,Carte.prototype._init=function(){OpenLayers.Lang.setCode("fr"),OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,OpenLayers.Util.onImageLoadErrorColor="transparent"
,OpenLayers.ProxyHost=Aide.obtenirProxy(!0),this.projection=this.options.projection||"EPSG:3857",this.projectionAffichage=this.options.displayProjection||"EPSG:4326";var etendueMax,resolutions,limiteEtendue,resolutionMax;this.options.etendueMax?this.options.etendueMax==="aucune"?etendueMax=undefined:etendueMax=new OpenLayers.Bounds(this.options.etendueMax.split(",")):etendueMax=(new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)).transform(new OpenLayers.Projection("EPSG:3857"),this.projection),this.options.resolutions&&(resolutions=this.options.resolutions.split(/,/).map(parseFloat)),this.options.limiteEtendue?this.options.limiteEtendue==="aucune"?limiteEtendue=undefined:limiteEtendue=new OpenLayers.Bounds(this.options.limiteEtendue):limiteEtendue=(new OpenLayers.Bounds(-11e6,3397938,-4806248,9512143)).transform(new OpenLayers.Projection("EPSG:3857"),this.projection),this.options.resolutionMax&&(resolutionMax=parseFloat(this.options.resolutionMax));var mapOptions=
{numZoomLevels:this.options.niveauZoom||20,projection:new OpenLayers.Projection(this.projection),displayProjection:new OpenLayers.Projection(this.projectionAffichage),units:"m",zoomMethod:null,maxExtent:etendueMax,resolutions:resolutions,maxResolutions:resolutionMax,controls:[],Z_INDEX_BASE:{BaseLayer:100,Overlay:11e3,Vecteur:2e4,Feature:3e4,Popup:4e4,Control:5e4},eventListeners:this._initEvents()};this._carteOL=new OpenLayers.Map("igoInstance",mapOptions),this._carteOL.addControl(new OpenLayers.Control.Attribution),this._carteOL.addControl(new OpenLayers.Control.PanPanel),this._carteOL.addControl(new OpenLayers.Control.ZoomPanel),this._carteOL.addControl(new OpenLayers.Control.Navigation({type:OpenLayers.Control.TYPE_TOGGLE,zoomWheelEnabled:!0}));var scaleLine=new OpenLayers.Control.ScaleLine({bottomOutUnits:"",geodesic:!0});this._carteOL.addControl(scaleLine)},Carte.prototype._initEvents=function(){var that=this;return{featureover:function(e){var couche=that.gestionCouches.obtenirCoucheParId
(e.feature.layer.id);if(!couche)return!1;if(!that.controles.occurenceEvenement.actif&&that.controles.occurenceEvenement.exception!==couche)return!0;var occurence=couche.obtenirOccurenceParId(e.feature.id);!occurence&&couche.obtenirTypeClasse()==="VecteurCluster"&&(occurence=couche.obtenirClusterParId(e.feature.id));if(!occurence)return!1;that.gestionCouches.ajouterOccurenceSurvol(occurence)},featureout:function(e){var couche=that.gestionCouches.obtenirCoucheParId(e.feature.layer.id);if(!couche)return!1;if(!that.controles.occurenceEvenement.actif&&that.controles.occurenceEvenement.exception!==couche)return!0;var occurence=couche.obtenirOccurenceParId(e.feature.id);!occurence&&couche.obtenirTypeClasse()==="VecteurCluster"&&(occurence=couche.obtenirClusterParId(e.feature.id));if(!occurence)return!1;that.gestionCouches.enleverOccurenceSurvol(occurence)},featureclick:function(e){var couche=that.gestionCouches.obtenirCoucheParId(e.feature.layer.id);if(!couche)return!1;if(!that.controles.occurenceEvenement
.actif&&that.controles.occurenceEvenement.exception!==couche)return!0;var occurence=couche.obtenirOccurenceParId(e.feature.id);!occurence&&couche.obtenirTypeClasse()==="VecteurCluster"&&(occurence=couche.obtenirClusterParId(e.feature.id)),couche.declencher({type:"occurenceClique",occurence:occurence})},moveend:function(){that.declencher({type:"limitesModifiees"})},mouseout:function(){that.declencher({type:"quitterSurvolCarte"}),clearInterval(that._timerEvenementPauseSurvol)},mousemove:function(e){that.coordSouris=e.xy;var lonlat=that._carteOL.getLonLatFromViewPortPx(that.coordSouris);if(!lonlat)return!1;that.declencher({type:"survolerCarte",x:lonlat.lon,y:lonlat.lat}),clearInterval(that._timerEvenementPauseSurvol),that._timerEvenementPauseSurvol=setInterval(function(){clearInterval(that._timerEvenementPauseSurvol),that.declencher({type:"pauseSurvolCarte",x:that._carteOL.getLonLatFromViewPortPx(that.coordSouris).lon,y:that._carteOL.getLonLatFromViewPortPx(that.coordSouris).lat})},500)},changelayer
:function(e){if(e.property==="visibility"){var couche=that.gestionCouches.obtenirCoucheParId(e.layer.id);if(!couche)return!1;that.gestionCouches.declencher({type:"coucheVisibilit\u00e9Chang\u00e9e",couche:couche})}}}},Carte.prototype.obtenirProjection=function(){return this.projection},Carte.prototype.obtenirProjectionAffichage=function(){return this.projectionAffichage},Carte.prototype.obtenirCentre=function(){return this._carteOL.getCenter()===null?null:new Point(this._carteOL.getCenter().lon,this._carteOL.getCenter().lat)},Carte.prototype.definirCentre=function(centre){if(!centre)return;var centreArray=centre;centre instanceof Point&&(centreArray=[centre.x,centre.y]),this._carteOL.setCenter(centreArray)},Carte.prototype.definirCoucheDeBase=function(couche){if(!couche)return;this._carteOL.setBaseLayer(couche._layer)},Carte.prototype.definirProjectionAffichage=function(projDemande){if(!projDemande)return;var projActuel=this.obtenirProjectionAffichage();if(projActuel!==projDemande){this
.projectionAffichage=projDemande,this._carteOL.displayProjection=new OpenLayers.Projection(projDemande),this._carteOL.options.displayProjection=new OpenLayers.Projection(projDemande);var controlsMousePosition=this._carteOL.getControlsByClass("OpenLayers.Control.MousePosition");for(var i=0;i<controlsMousePosition.length;i++){controlsMousePosition[i].displayProjection=new OpenLayers.Projection(projDemande),controlsMousePosition[i].displayProjection.getUnits()==="m"?controlsMousePosition[i].numDigits=2:controlsMousePosition[i].numDigits=6;if(!controlsMousePosition[i].lastXy)continue;controlsMousePosition[i].redraw({xy:{x:controlsMousePosition[i].lastXy.x,y:controlsMousePosition[i].lastXy.y}})}}},Carte.prototype.centrer=function(centre){if(!centre)return;if(this.obtenirCentre()===null)return;this._carteOL.panTo([centre.x,centre.y])},Carte.prototype.obtenirZoom=function(){return this._carteOL.getZoom()},Carte.prototype.definirZoom=function(zoom){this._carteOL.zoomTo(zoom)},Carte.prototype.obtenirResolution=
function(){return this._carteOL.resolution},Carte.prototype.obtenirEchelle=function(){return this._carteOL.getScale()},Carte.prototype.obtenirLimites=function(){var limitesOL=this._carteOL.getExtent();return new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top)},Carte.prototype.obtenirLimitesMax=function(){var limitesOL=this._carteOL.restrictedExtent||this._carteOL.getMaxExtent();return new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top)},Carte.prototype.zoomerLimitesMax=function(){this._getCarte().zoomToMaxExtent()},Carte.prototype.zoomer=function(param,maxZoom){if(param instanceof Limites){var limitesOL=new OpenLayers.Bounds(param.gauche,param.bas,param.droite,param.haut);this._getCarte().zoomToExtent(limitesOL),this.obtenirZoom()>maxZoom&&this.definirZoom(maxZoom);return}this.definirZoom(param)},Carte.prototype._getCarte=function(){return this._carteOL},Carte.Controles=function(_){this._=_,this.activerOccurenceEvenement();if(Aide.toBoolean(
this._.options.aContexteMenu)!==!1){var nav=Aide.obtenirNavigateur(),initContexteMenuCarte=function(e){var scope=e.options.scope;scope.contexteMenu=new ContexteMenuCarte({carte:scope._,cible:"#mapComponent .olMapViewport"})};nav&&nav.isReady?initContexteMenuCarte({options:{scope:this}}):this._.ajouterDeclencheur("carteInit",initContexteMenuCarte,{scope:this})}},Carte.Controles.prototype.initDeplacement=function(){this._deplacementControle||(this._deplacementControle=new OpenLayers.Control.DragPan({isDefault:!0}))},Carte.Controles.prototype.activerDeplacement=function(){this.initDeplacement(),this._deplacementControle.activate()},Carte.Controles.prototype.desactiverDeplacement=function(){this._deplacementControle&&this._deplacementControle.deactivate()},Carte.Controles.prototype.initClique=function(){var that=this;this._cliqueControle||(OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},
handleRightClicks:!0,initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,this.eventMethods,this.handlerOptions)}}),this._cliqueControle=new OpenLayers.Control.Click({eventMethods:{click:function(e){that.clique(e)}}}),this._._carteOL.addControl(this._cliqueControle))},Carte.Controles.prototype.activerClique=function(){this.initClique(),this._cliqueControle.activate(),this._.declencher({type:"activerClique"})},Carte.Controles.prototype.desactiverClique=function(){this._cliqueControle&&(this._cliqueControle.deactivate(),this._.declencher({type:"desactiverClique"}))},Carte.Controles.prototype.clique=function(e){var lonlat=this._._carteOL.getLonLatFromPixel(e.xy),point=new Point(lonlat.lon,lonlat.lat);this._.declencher({type:"clique",point:point})},Carte.Controles.prototype.activerOccurenceEvenement=function(){this.occurenceEvenement={actif:!0
}},Carte.Controles.prototype.desactiverOccurenceEvenement=function(couche){this.occurenceEvenement={actif:!1,exception:couche}},Carte.Controles.prototype.activerEdition=function(couche,options){options=options||{},couche=couche==="active"?this._.gestionCouches.coucheVecteurActive:couche,this.controleEdition&&this.controleEdition.layer!==couche._layer&&this._desactiverEventsEdition(),this.controleEdition||(this.controleEdition=new OpenLayers.Control.ModifyFeature(couche._layer),this._._carteOL.addControl(this.controleEdition)),this.controleEdition.activate(),this.desactiverOccurenceEvenement(couche);var occurenceSelectionnee=couche.obtenirOccurencesSelectionnees()[0];occurenceSelectionnee&&(couche.deselectionnerTout(),occurenceSelectionnee.selectionner(),this.controleEdition.selectFeature(occurenceSelectionnee._feature)),this._initEventsEdition(couche),this._activerEventsEdition(),couche.declencher({type:"controleEditionActiver"}),this.snap&&this.activerSnap(couche)},Carte.Controles.prototype
.desactiverEdition=function(couche){if(this.controleEdition){this._desactiverEventsEdition(),this.controleEdition.deactivate(),this._._carteOL.removeControl(this.controleEdition),this.controleEdition.destroy(),this.controleEdition=undefined,this._editionEvents.oModifification=undefined,this._editionEvents.oModifificationTerminee=undefined;if(couche){var oSelected=couche.obtenirOccurencesSelectionnees();oSelected[0]&&oSelected[0].selectionner(),couche.declencher({type:"controleEditionDesactiver"})}this.activerOccurenceEvenement()}},Carte.Controles.prototype._activerEventsEdition=function(){this.controleEdition.layer.events.register("featuremodified",this._editionEvents.couche,this._editionEvents.fnFeatureModified),this.controleEdition.layer.events.register("beforefeaturemodified",this._editionEvents.couche,this._editionEvents.fnBeforeFeatureModified),this.controleEdition.layer.events.register("afterfeaturemodified",this._editionEvents.couche,this._editionEvents.fnAfterFeatureModified),this
._editionEvents.couche.ajouterDeclencheur("vecteurOccurenceSelectionnee",this._editionEvents.fnVecteurOccurenceSelectionnee,{scope:this}),this._editionEvents.couche.ajouterDeclencheur("vecteurOccurenceDeselectionnee",this._editionEvents.fnVecteurOccurenceDeselectionnee,{scope:this})},Carte.Controles.prototype._desactiverEventsEdition=function(){this.controleEdition&&(this.controleEdition.layer.events.remove("featuremodified"),this.controleEdition.layer.events.remove("beforefeaturemodified"),this.controleEdition.layer.events.remove("afterfeaturemodified"),this._editionEvents.couche.enleverDeclencheur("vecteurOccurenceSelectionnee",undefined,this._editionEvents.fnVecteurOccurenceSelectionnee),this._editionEvents.couche.enleverDeclencheur("vecteurOccurenceDeselectionnee",undefined,this._editionEvents.fnVecteurOccurenceDeselectionnee))},Carte.Controles.prototype._initEventsEdition=function(couche){this._editionEvents={},this._editionEvents.couche=couche,this._editionEvents.oModifification=undefined
,this._editionEvents.oModifificationTerminee=this._editionEvents.occurenceModifification;var that=this;this._editionEvents.fnFeatureModified=function(e){if(!e.feature)return!0;var occurence=couche.obtenirOccurenceParId(e.feature.id);if(!occurence)return!0;occurence.majGeometrie(e.feature.geometry)},this._editionEvents.fnBeforeFeatureModified=function(e){if(!e.feature)return!0;var occurence=couche.obtenirOccurenceParId(e.feature.id);if(!occurence)return!0;that._editionEvents.oModifificationTerminee=that._editionEvents.oModifification,that._editionEvents.oModifification=occurence,that._desactiverEventsEdition(),occurence.selectionner(),that._activerEventsEdition()},this._editionEvents.fnAfterFeatureModified=function(){var occurence;that._editionEvents.oModifificationTerminee?(occurence=that._editionEvents.oModifificationTerminee,that._editionEvents.oModifificationTerminee=undefined,that._editionEvents.oModifification.id===occurence.id&&(occurence=undefined)):(occurence=that._editionEvents
.oModifification,that._editionEvents.oModifification=undefined);if(!occurence)return!0;occurence.vecteur||couche._layer.removeFeatures(occurence._feature),that._desactiverEventsEdition(),occurence.deselectionner(),that._activerEventsEdition()},this._editionEvents.fnVecteurOccurenceSelectionnee=function(e){e.options.scope._desactiverEventsEdition(),couche.obtenirOccurencesSelectionnees().length>1&&(couche.deselectionnerTout(),e.occurence.selectionner()),e.options.scope.controleEdition.selectFeature(e.occurence._feature),e.options.scope._activerEventsEdition()},this._editionEvents.fnVecteurOccurenceDeselectionnee=function(e){e.occurence._feature===e.options.scope.controleEdition.feature&&(e.options.scope._desactiverEventsEdition(),e.options.scope.controleEdition.unselectFeature(e.occurence._feature),e.options.scope._activerEventsEdition())}},Carte.Controles.prototype.activerDessin=function(couche,type,options){options=options||{},couche=couche==="active"?this._.gestionCouches.coucheVecteurActive
:couche;if(options.releverBoutonOutil!==!1){var boutonActif=Ext.ButtonToggleMgr.getPressed("carte");boutonActif&&Ext.ButtonToggleMgr.getPressed("carte").toggle()}this._.declencher({type:"controleCarteActiver"});var typeHandler=OpenLayers.Handler.Point;type==="polygone"?typeHandler=OpenLayers.Handler.Polygon:type==="ligne"?typeHandler=OpenLayers.Handler.Path:type==="regulier"?typeHandler=OpenLayers.Handler.RegularPolygon:type==="cercle"&&(typeHandler=OpenLayers.Handler.CircleToMeasure,options.cotes=options.cotes||50);var typeControl=OpenLayers.Control.DrawFeatureEx;options.mesure&&(type==="cercle"?typeControl=OpenLayers.Control.MeasureCircle:typeHandler!==OpenLayers.Handler.Point?typeControl=OpenLayers.Control.Measure:options.mesure=!1);if(!options.mesure&&!couche)throw new Error("Carte.Controles.activerDessin : La couche est obligatoire");this.controleDessin&&(options.detruireControle||!couche||this.controleDessin.layer!==couche._layer||this.controleDessin.handler.CLASS_NAME!==typeHandler
.prototype.CLASS_NAME||this.controleDessin.CLASS_NAME!==typeControl.prototype.CLASS_NAME)&&(this._._carteOL.removeControl(this.controleDessin),this.controleDessin.destroy(),this.controleDessin=undefined),this.controleDessin||(this.controleDessin=new typeControl(typeHandler,{persist:couche?!1:!0,immediate:!0,geodesic:!0,handlerOptions:{holeModifier:"ctrlKey",sides:Number(options.cotes)>2&&Number(options.cotes)<=100?Number(options.cotes):undefined,irregular:Aide.toBoolean(options.irregulier),layer:couche?couche._layer:undefined,layerOptions:{styleMap:couche?couche._layer.styleMap:undefined}},featureAdded:function(feature){var occurence=new Occurence(feature);couche._layer.removeFeatures(feature),couche.ajouterOccurence(occurence,{existe:!1}),occurence.rafraichir()}}),options.mesure&&this.controleDessin.events.on({measure:function(e){var occ=new Occurence(e.geometry);couche?(couche.declencher({type:"mesure",occurence:occ}),couche.ajouterOccurence(occ)):this._.declencher({type:"mesure",occurence
:occ})},measurepartial:function(e){var occ=new Occurence(e.geometry);couche&&couche.declencher({type:"mesurePartielle",occurence:occ})},scope:this}),this._._carteOL.addControl(this.controleDessin)),Aide.obtenirNavigateur().evenements.ajouterDeclencheur("controleCarteActiver",function(e){e.options.scope.desactiverDessin()},{scope:this,id:"activerDessin-OutilExecuter"}),this.controleDessin.activate(),this.snap&&this.activerSnap(couche)},Carte.Controles.prototype.desactiverDessin=function(){this.controleDessin&&(Aide.obtenirNavigateur().evenements.enleverDeclencheur("controleCarteActiver","activerDessin-OutilExecuter"),this.controleDessin.deactivate())},Carte.Controles.prototype.activerSnap=function(couche){this.desactiverSnap(),this.snap=!0,couche=couche==="active"?this._.gestionCouches.coucheVecteurActive:couche;if(!couche)return!0;this.controleSnap||(this.controleSnap=new OpenLayers.Control.Snapping({layer:undefined,targets:[],greedy:!1})),this.controleSnap.setLayer(couche._layer);var listeVecteurs=
this._.gestionCouches.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"]),listLayerOL=[];$.each(listeVecteurs,function(key,value){value.estActive()&&listLayerOL.push(value._layer)}),this.controleSnap.setTargets(listLayerOL),this.controleSnap.activate(),this._.gestionCouches.ajouterDeclencheur("coucheVisibilit\u00e9Chang\u00e9e",function(e){if(e.couche.obtenirTypeClasse()==="Vecteur"||e.couche.obtenirTypeClasse()==="VecteurCluster"||e.couche.obtenirTypeClasse()==="WFS")e.couche.estActive()?this.controleSnap.addTargetLayer(e.couche._layer):this.controleSnap.removeTargetLayer(e.couche._layer)},{scope:this,id:"carteActiverSnap"})},Carte.Controles.prototype.desactiverSnap=function(){this.controleSnap&&(this.snap=!1,this._.gestionCouches.enleverDeclencheur("coucheVisibilit\u00e9Chang\u00e9e","carteActiverSnap"),this.controleSnap.deactivate())},Carte}),define("panneauCarte",["panneau","point","aide"],function(Panneau,Point,Aide){function PanneauCarte(options){this.barreOutils,this.options=
options||{},this.defautOptions=$.extend({},this.defautOptions,{id:"carte-panneau",titre:"",_margins:"0 5 0 0",reductible:!1,_layout:"border"})}return PanneauCarte.prototype=new Panneau,PanneauCarte.prototype.constructor=PanneauCarte,PanneauCarte.prototype._init=function(){var opt=this.options,centreString=Aide.obtenirParametreURL("centre")||opt.centre;if(centreString){var centre=centreString.split(/[,;]/);opt.x=centre[0],opt.y=centre[1];var centreProj=centre[2];if(centreProj){var igoPoint=new Point(opt.x,opt.y,centreProj),igoPointProj=igoPoint.projeter(this.carte.obtenirProjection());opt.x=igoPointProj.x,opt.y=igoPointProj.y}}var x=Aide.obtenirParametreURL("x")||opt.x||-7994004,y=Aide.obtenirParametreURL("y")||opt.y||6034079,z=Aide.obtenirParametreURL("zoom")||opt.zoom||7,barreOutilsExt;this.barreOutils?barreOutilsExt=this.barreOutils._getToolbar():barreOutilsExt=[],this.carte.parent=this;var oMapComponent=new GeoExt.MapPanel({border:!1,id:"mapComponent",region:"center",map:this.carte._getCarte
(),center:new OpenLayers.LonLat(x,y),zoom:z,tbar:barreOutilsExt,items:[{xtype:"gx_zoomslider",id:"idgx_zoomslider",vertical:!0,height:100,x:17,y:90,plugins:new GeoExt.ZoomSliderTip({template:"\u00c9chelle: 1 : {scale}"})},{id:"boutonConsoleDiv",html:"<button id='boutonConsole' class='boutonConsole'></button>"}]});this.barreOutils&&this.barreOutils._setPanelContainer(oMapComponent),this.defautOptions.items=[oMapComponent],this._extOptions={region:"center"},Panneau.prototype._init.call(this)},PanneauCarte.prototype._getMapComponent=function(){return this._panel.items.last()},PanneauCarte}),define("navigateur",["barreOutils","panneau","carte","panneauCarte","aide","evenement"],function(BarreOutils,Panneau,Carte,PanneauCarte,Aide,Evenement){function Navigateur(carte,options){this.options=options||{},Aide.definirNavigateur(this),carte||(carte=new Carte);if(carte.constructor.name!=="Carte"&&carte.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]!=="Carte")throw new Error("new Igo.Navigateur(carte) a besoin d'un objet de type Igo.Carte()"
);this.carte=carte,this.listePanneaux=[]}return Navigateur.prototype=new Evenement,Navigateur.prototype.constructor=Navigateur,Navigateur.prototype.init=function(callback,cible,optCallback){var that=this;Ext.QuickTips.init(),Ext.state.Manager.setProvider(new Ext.state.CookieProvider);var listePanelExt=[],aPanneauCarte=!1;$.each(this.listePanneaux,function(key,value){value.obtenirTypeClasse()==="PanneauCarte"&&(aPanneauCarte=!0),value._getPanel()&&listePanelExt.push(value._getPanel())});if(aPanneauCarte===!1){var panneauCarte=new PanneauCarte;this.ajouterPanneau(panneauCarte),listePanelExt.push(panneauCarte._getPanel())}this.options.div?require(["libs/Ext.ux/FitToParent"],function(){this._viewport=new Ext.Panel({layout:"border",id:"monNavigateurIGO",items:listePanelExt,renderTo:that.options.div,border:that.options.aBordure||!1,plugins:["fittoparent"],scope:that,listeners:{afterrender:function(e){e.scope.isReady=!0,typeof callback=="function"&&callback.call(cible,optCallback),e.scope.carte
.declencher({type:"carteInit"}),e.scope.declencher({type:"navigateurInit"})}}})}):this._viewport=new Ext.Viewport({layout:"border",id:"monNavigateurIGO",items:listePanelExt,scope:this,listeners:{afterrender:function(e){e.scope.isReady=!0,typeof callback=="function"&&callback.call(cible,optCallback),e.scope.carte.declencher({type:"carteInit"}),e.scope.declencher({type:"navigateurInit"})}}}),$(document).on("keyup keydown",function(e){that.ctrlPressed=e.ctrlKey})},Navigateur.prototype.obtenirCtrl=function(){return this.ctrlPressed},Navigateur.prototype.creerBarreOutils=function(){var that=this;return this.barreOutils=new BarreOutils(this.carte),$.each(this.obtenirPanneaux(),function(key,panneau){panneau.obtenirTypeClasse()==="PanneauCarte"&&that.barreOutils._setPanelContainer(panneau._getMapComponent())}),this.barreOutils},Navigateur.prototype.obtenirBarreOutils=function(){return this.barreOutils},Navigateur.prototype.ajouterPanneau=function(panneau){if(panneau instanceof Panneau==0)throw new 
Error("Igo.Navigateur.ajouterPanneau(panneau) a besoin d'un objet de type Igo.Panneaux");panneau.definirCarte(this.carte),panneau.obtenirTypeClasse()==="PanneauCarte"&&(panneau.barreOutils=this.barreOutils),panneau._init(),this.listePanneaux.push(panneau)},Navigateur.prototype.obtenirPanneaux=function(){return this.listePanneaux},Navigateur.prototype.obtenirPanneauxParChemin=function(chemin){var that=this,panneaux=[],cheminSplit=chemin.split(",");$.each(cheminSplit,function(key,sChemin){var indexFin,panneauxTemp=[that];do{var separator;sChemin.search(/>| /)===0&&(separator=sChemin[0],sChemin=sChemin.substr(1));var indexDeb=sChemin.search(/#|\.|>| /),directive=sChemin[indexDeb];indexFin=sChemin.substr(indexDeb+1).search(/#|\.|>| /);var nbCaractere;indexFin!==-1&&(nbCaractere=indexFin-indexDeb);var identifiant=sChemin.substr(indexDeb+1,nbCaractere);sChemin=sChemin.substr(indexFin+1);var panneauxLoop,niveau;directive==="#"?(niveau=-1,separator===">"&&(niveau=1),!separator&&panneauxTemp[0].
obtenirTypeClasse()!==that.obtenirTypeClasse()?(panneauxLoop=[],$.each(panneauxTemp,function(keyTemp,panneauTemp){panneauTemp.obtenirId()===identifiant&&(panneauxLoop=panneauxLoop.concat([panneauTemp]))}),panneauxTemp=panneauxLoop):(panneauxLoop=[],$.each(panneauxTemp,function(keyTemp,panneauTemp){if(panneauTemp.obtenirPanneauParId){var p=panneauTemp.obtenirPanneauParId(identifiant,niveau);p&&(panneauxLoop=panneauxLoop.concat([p]))}}),panneauxTemp=panneauxLoop)):directive==="."?(niveau=-1,separator===">"&&(niveau=1),!separator&&panneauxTemp[0].obtenirTypeClasse()!==that.obtenirTypeClasse()?(panneauxLoop=[],$.each(panneauxTemp,function(keyTemp,panneauTemp){panneauTemp.obtenirTypeClasse()===identifiant&&(panneauxLoop=panneauxLoop.concat([panneauTemp]))}),panneauxTemp=panneauxLoop):(panneauxLoop=[],$.each(panneauxTemp,function(keyTemp,panneauTemp){panneauTemp.obtenirPanneauxParType&&(panneauxLoop=panneauxLoop.concat(panneauTemp.obtenirPanneauxParType(identifiant,niveau)))}),panneauxTemp=panneauxLoop
)):panneauxTemp=[],panneauxTemp.length||(indexFin=-1)}while(indexFin!==-1);panneaux=panneaux.concat(panneauxTemp)});var panneauxUniques=panneaux.filter(function(itm,i,a){return i==a.indexOf(itm)});return panneauxUniques},Navigateur.prototype.obtenirPanneauParId=function(id,niveau){niveau=niveau||1;var panneau;return $.each(this.listePanneaux,function(key,value){if(value.obtenirId()===id)return panneau=value,!1;if((niveau>1||niveau<0)&&value.obtenirPanneauParId){panneau=value.obtenirPanneauParId(id,niveau-1);if(panneau)return!1}}),panneau},Navigateur.prototype.obtenirPanneauxParType=function(type,niveau){niveau=niveau||1;var panneau=[];return $.each(this.listePanneaux,function(key,value){value.obtenirTypeClasse()===type&&panneau.push(value),(niveau>1||niveau<0)&&value.obtenirPanneauxParType&&(panneau=panneau.concat(value.obtenirPanneauxParType(type,niveau-1)))}),panneau},Navigateur}),define("browserDetect",[],function(){var BrowserDetect={init:function(){this.browser=this.searchString(this
.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string,dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)return data[i].identity}else if(dataProp)return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{
string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return BrowserDetect.init(),BrowserDetect}),define("WMS",["couche"
,"aide","browserDetect"],function(Couche,Aide,BrowserDetect){function WMS(options){this.options=options||{};if(!this.options.layerOL){if(!this.options.url)throw new Error("Igo.WMS a besoin d'un url");if(!this.options.nom&&!this.options.mode)throw new Error("Igo.WMS a besoin d'un nom")}this.options.nom&&(this.options.nom=this.options.nom.replace(", ",",")),this.options.url&&this.options.url.lastIndexOf("?")===-1&&(this.options.url=this.options.url+"?"),Aide.toBoolean(this.options.utiliserProxy)&&(this.options.url=Aide.utiliserProxy(this.options.url,!0)),this.defautOptions.version="1.1.1",this._optionsOL={queryable:!0,singleTile:!Aide.toBoolean(this.options.multiTuile)},this.options.mode||this._init()}return WMS.prototype=new Couche,WMS.prototype.constructor=WMS,WMS.prototype._init=function(target,callback,optCalback){if(!this.options.layerOL){Couche.prototype._init.call(this);var transparence=this.options.transparence||!0;if(this.options.format==="jpeg"||this.options.format==="jpg")transparence=!1
;var parametreWMS={layers:this.options.nom,transparent:transparence,version:this.options.version};this.options.mapdir&&(parametreWMS.map=this.options.mapdir),this._layer=new OpenLayers.Layer.WMS(this.options.titre||this.options.nom,this.options.url,parametreWMS,this._optionsOL);if(this.options.extraParams)if($.type(this.options.extraParams)==="string"){var stringExtraParams=this.options.extraParams.replace(/'/g,'"'),arrayExtraParams=stringExtraParams.split(",");for(var i=0;i<arrayExtraParams.length;i++){var splitExtraParams=arrayExtraParams[i].split("=");try{this._layer.mergeNewParams(JSON.parse('{"'+splitExtraParams[0].trim()+'":'+splitExtraParams[1]+"}"))}catch(e){var message="<b>Erreur extra param\u00e8tre: </b>"+this.options.extraParams;message+="<br>Note: Si la valeur est un string, entourer le de simples guillemets",Aide.afficherMessageConsole(message)}}}else this._layer.mergeNewParams(this.options.extraParams);this.options.mode&&Couche.prototype._ajoutCallback.call(this,target,callback
,optCalback)}else this._layer=this.options.layerOL;this._layer.events.register("loadend",this,this._validerChargement)},WMS.prototype._getCapabilities=function(target,callback,optCalback){var tjrsProxy=this.options.encodage?!0:!1;$.ajax({url:Aide.utiliserProxy(this.options.url,tjrsProxy),data:{SERVICE:"WMS",VERSION:this.options.version||this.defautOptions.version,REQUEST:"GetCapabilities",_encodage:this.options.encodage},async:!1,context:this,dataType:"xml",dataFilter:function(response,type){return jQuery.trim(response)},success:function(response){this._getCapabilitiesSuccess(response,target,callback,optCalback)},error:function(e){this._getCapabilitiesError(e,target,callback,optCalback)}})},WMS.prototype._getCapabilitiesSuccess=function(response,target,callback,optCalback){var that=this;if(!response)return this._getCapabilitiesError(),!1;var xml=(new OpenLayers.Format.WMSCapabilities).read(response),iCL=0,xmlOptions={},capabilityLayers,arrayLayers,len;if(!this.options.infoFormat&&xml.capability
.request.getfeatureinfo!==undefined){var arrayInfoFormat=xml.capability.request.getfeatureinfo.formats;for(var i=0;i<arrayInfoFormat.length;i++)arrayInfoFormat[i]=="text/html"?this.options.infoFormat="html":arrayInfoFormat[i]=="application/vnd.ogc.gml"&&(this.options.infoFormat="gml")}this.options.nom?(arrayLayers=this.options.nom.split(","),len=arrayLayers.length,capabilityLayers=xml.capability.layers):capabilityLayers=xml.capability.nestedLayers,$.each(capabilityLayers,function(key,value){if(!that.options.nom||jQuery.inArray(value.name,arrayLayers)>=0){iCL++;if(!that.options._merge){var parcourirLayerXML=function(value,groupe,groupeNiveauBase){var layers=value;if(value.nestedLayers.length!==0)groupeNiveauBase?groupeNiveauBase--:(groupe=groupe?groupe+"/":"",groupe+=value.title),layers=value.nestedLayers,$.each(layers,function(key2,value2){parcourirLayerXML(value2,groupe,groupeNiveauBase)});else{xmlOptions={titre:value.title,droit:value.attribution?value.attribution.href:undefined,echelleMin
:value.minScale,echelleMax:value.maxScale};if(value.dataURL&&value.dataURL.format==="igo"){var idMeta=value.dataURL.href,igoClassMeta=idMeta;xmlOptions.metadonnee=igoClassMeta}$.extend(xmlOptions,that.options),xmlOptions.mode=!1,xmlOptions.nom=value.name;if(!xmlOptions.nom)return Aide.estDebug()&&(console.warn('Le url "'+xmlOptions.url+'" a un groupe vide.'),console.warn(xmlOptions)),!0;groupe&&Aide.toBoolean(that.options.garderGroupe)!==!1&&(xmlOptions.groupe=groupe),value.dimensions.time&&(xmlOptions.wms_timeextent=value.dimensions.time.values[0],xmlOptions.wms_timedefault=value.dimensions.time.defaults),target.ajouterCouche(new WMS(xmlOptions))}};parcourirLayerXML(value,that.options.groupe,that.options.groupeNiveauBase);if(len===1)return!1}else if(iCL===1){xmlOptions={titre:value.title,droit:value.attribution?value.attribution.href:undefined,echelleMin:value.minScale,echelleMax:value.maxScale,groupe:"Couches WMS ajout\u00e9es"};if(len===1)return!1}else{xmlOptions.titre=xmlOptions.titre?
xmlOptions.titre+", ":"",xmlOptions.titre+=value.title;if(!xmlOptions.echelleMin||value.minScale>xmlOptions.echelleMin)xmlOptions.echelleMin=value.minScale;if(!xmlOptions.echelleMax||value.maxScale<xmlOptions.echelleMax)xmlOptions.echelleMax=value.maxScale}}});if(iCL===0)return Aide.afficherMessageConsole("Couche(s) introuvable(s): "+this.options.nom),!1;len===1&&that.options._merge&&(this.options=$.extend(xmlOptions,this.options),this._init(target,callback,optCalback))},WMS.prototype._getCapabilitiesError=function(response,target,callback,optCalback){response=response||{};if(response.status!=200)return Aide.afficherMessageConsole("Erreur WMS: GetCapabilities: <br>Le GetCapabilities pour '"+this.options.url+"' a \u00e9chou\u00e9. <br>"+response.responseText),!1;if(BrowserDetect.browser=="Explorer"){var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=!1,xmlDoc.validateOnParse=!1,xmlDoc.resolveExternals=!1;var parsed=xmlDoc.loadXML(response.responseText);if(!parsed){var myErr=xmlDoc
.parseError;Aide.afficherMessage("Erreur WMS: GetCapabilities","Le GetCapabilities pour '"+this.options.url+"' a \u00e9chou\u00e9. <br>"+myErr.reason,"OK","ERREUR")}else this._getCapabilitiesSuccess(xmlDoc,target,callback,optCalback);return!1}Aide.afficherMessage("Erreur WMS: GetCapabilities","Le GetCapabilities pour '"+this.options.url+"' a \u00e9chou\u00e9.","OK","ERREUR")},WMS.prototype._ajoutCallback=function(target,callback,optCallback){this.options.mode==="getCapabilities"?this._getCapabilities(target,callback,optCallback):Couche.prototype._ajoutCallback.call(this,target,callback,optCallback)},WMS.prototype._validerChargement=function(e,a){e.object.div.innerHTML.indexOf("olImageLoadError")>-1&&$.ajax({url:Aide.utiliserProxy(decodeURIComponent($("<textarea/>").html(/src="(.*)"/.exec(e.object.div.innerHTML)[1]).text())),data:{SERVICE:"WMS",VERSION:this.options.version,REQUEST:"GetMap"},async:!1,context:this,success:function(response){var message="<b>"+this.options.titre+":</b><br>";
if(typeof response=="object"){var tagError=response.getElementsByTagName("ServiceException");tagError&&(message+=tagError.item(0).textContent,Aide.afficherMessageConsole(message))}else message+=response,Aide.afficherMessageConsole(message)},error:function(e){var message="<b>"+e.statusText+":</b><br>";Aide.afficherMessageConsole(message)}})},WMS.prototype.rafraichir=function(){this._layer&&this._layer.redraw(!0)},WMS}),define("contexte",["aide","WMS"],function(Aide,WMS){function Contexte(options){this.defautOptions=$.extend({},this.defautOptions,Aide.obtenirConfig(this.obtenirTypeClasse())),this.options=$.extend({},this.defautOptions,this.options)}return Contexte.prototype.charger=function(){var idContexte=Aide.obtenirParametreURL("id")||this.options.contexte;if(idContexte){this.carte=Aide.obtenirNavigateur().carte;var url=this.options.service+"?id="+idContexte;Ext.Ajax.request({url:Aide.utiliserProxy(url),success:function(response){if(!response.responseText)return;var oJSON=Ext.util.JSON
.decode(response.responseText);oJSON&&oJSON!==""&&this.appliquerContexte(oJSON)},scope:this})}},Contexte.prototype.appliquerContexte=function(contexte){if(!contexte)return;contexte.center&&contexte.center.length==2&&contexte.zoomlevel&&!this.options.ignorePosition&&(this.carte.definirCentre(contexte.center),this.carte.definirZoom(contexte.zoomlevel)),contexte.layers&&this.setContexteDesCouches(contexte.layers)},Contexte.prototype.setContexteDesCouches=function(contexte){if(contexte.length<=0)return;for(var i=0;i<contexte.length;i++){var coucheContexte=contexte[i],coucheCarte=this.carte.gestionCouches.obtenirCouchesParTitre(coucheContexte.name);if(coucheCarte){var trouveCoucheCarte=null;for(var j=0;j<coucheCarte.length;j++)if(coucheCarte[j].options.groupe==coucheContexte.group){trouveCoucheCarte=coucheCarte[j];break}coucheCarte=trouveCoucheCarte}else coucheCarte=null;if(coucheCarte){coucheCarte.activer(coucheContexte.visibility),coucheContexte.opacity&&coucheCarte.definirOpacite(coucheContexte
.opacity);if(coucheContexte.group&&coucheCarte.options.groupe!=coucheContexte.group){var nav=Aide.obtenirNavigateur(),arborescence=nav.obtenirPanneauxParType("Arborescence")[0];if(!arborescence){var menu=nav.obtenirPanneauxParType("PanneauMenu");for(var j=0;j<menu.length;j++){arborescence=menu[j].obtenirPanneauxParType("Arborescence")[0];if(arborescence)break}}var tree=arborescence._panel,oldParent=tree.getNodeById("layercontainer_"+coucheCarte.options.groupe),newParent=tree.getNodeById("layercontainer_"+coucheContexte.group);coucheCarte.options.groupe=coucheContexte.group,oldParent&&oldParent.isExpanded()&&oldParent.reload(),newParent&&newParent.isExpanded()&&newParent.reload()}}if(!coucheCarte&&coucheContexte&&coucheContexte.wmsurl){var coucheAjouter=new OpenLayers.Layer.WMS(coucheContexte.name,coucheContexte.wmsurl,coucheContexte.wmsparams,coucheContexte.wmsoptions),coucheIGO=new WMS({layerOL:coucheAjouter});this.carte.gestionCouches.ajouterCouche(coucheIGO),coucheIGO.activer(coucheContexte
.visibility),coucheIGO.definirOrdreAffichage(coucheContexte.index),coucheContexte.opacity&&coucheIGO.definirOpacite(coucheContexte.opacity)}}},Contexte.prototype.obtenirTypeClasse=function(){return this.constructor.toString().match(/function ([A-Z]{1}[a-zA-Z]*)/)[1]},Contexte}),define("analyseurConfig",["aide","navigateur","carte","contexte","evenement"],function(Aide,Navigateur,Carte,Contexte,Evenement){function AnalyseurConfig(options){this.options=options||{},this.defautOptions={configuration:"defaut"},this.fin={},this._init(),this.igo={}}return AnalyseurConfig.prototype._init=function(){this.options=$.extend({},this.defautOptions,this.options)},AnalyseurConfig.prototype.charger=function(){this.avertissements=this.options.avertissements?[this.options.avertissements]:[];if($.isPlainObject(this.options.configuration))this._chargementConfigSuccess(this.options.configuration);else if(this.options.configuration&&Aide.obtenirConfig("uri.api")){var url=Aide.obtenirConfig("uri.api")+"configuration/"+
this.options.configuration;$.ajax({url:url,context:this,success:function(data){this._chargementConfigSuccess(data)},error:this._chargementConfigError,async:!1,dataType:"json"})}return this.igo},AnalyseurConfig.prototype._chargementConfigError=function(XMLHttpRequest,textStatus,errorThrown){$("#igoLoading").remove();var message=XMLHttpRequest.responseJSON?XMLHttpRequest.responseJSON.error:XMLHttpRequest.responseText;message||(message="Erreur lors du chargement de la configuration. ("+textStatus+")"),Aide.afficherMessage("Erreur chargement configuration",message,null,"ERROR")},AnalyseurConfig.prototype._chargementConfigSuccess=function(config){var that=this;this.dataType=="xml"&&(config=this._xml2Json(config).root),Aide.definirConfigXML(config);var presentation=config.presentation||{};this.avertissements.concat(config.avertissements),this.chargerContexte(0),this._analyserActions(config.actions),this._analyserPanneaux(presentation.panneaux),this._analyserOutils(presentation.outils)},AnalyseurConfig
.prototype.chargerContexte=function(index){var that=this,config=Aide.obtenirConfigXML(),contexte=config.contexte||{};contexte=$.isArray(contexte)?contexte[index]:contexte;var couchesApp=config.couches||[],groupeCouches=[];if(couchesApp){var cAttributs=couchesApp["@attributes"]||couchesApp.attributs;couchesApp.couche&&groupeCouches.push({"@attributes":cAttributs,couche:couchesApp.couche});var c1=couchesApp["groupe-couches"];if(c1){var c2=$.isArray(c1)?c1:[c1];$.each(c2,function(key,value){value.attributs?value.attributs=$.extend({},cAttributs,value.attributs):value["@attributes"]=$.extend({},cAttributs,value["@attributes"])}),groupeCouches=groupeCouches.concat(c2)}}this.contexteAttributs={};if(contexte){var couchesContexte=contexte.couches||contexte||[];if(couchesContexte){var cAttributs=couchesContexte["@attributes"]||couchesContexte.attributs;couchesContexte.couche&&groupeCouches.push({"@attributes":cAttributs,couche:couchesContexte.couche});var c1=couchesContexte["groupe-couches"];if(
c1){var c2=$.isArray(c1)?c1:[c1];$.each(c2,function(key,value){value.attributs?value.attributs=$.extend({},cAttributs,value.attributs):value["@attributes"]=$.extend({},cAttributs,value["@attributes"])}),groupeCouches=groupeCouches.concat(c2)}}this.contexteAttributs=contexte["@attributes"]||contexte.attributs||{}}this.igo.nav?(Aide.afficherMessageChargement({titre:"Chargement des couches"}),require(["point"],function(Point){if(that.contexteAttributs.centre){var x,y,centre=that.contexteAttributs.centre.split(/[,;]/);x=centre[0],y=centre[1];var centreProj=centre[2],igoPoint=new Point(x,y,centreProj);centreProj&&(igoPoint=igoPoint.projeter(that.igo.nav.carte.obtenirProjection())),that.igo.nav.carte.centrer(igoPoint)}that.contexteAttributs.zoom&&that.igo.nav.carte.zoomer(that.contexteAttributs.zoom),that.igo.nav.carte.gestionCouches.enleverToutesLesCouches(),that._analyserCouches(groupeCouches)})):(this.igo.nav=new Navigateur(new Carte(this.contexteAttributs),Aide.obtenirConfigXML("attributs"
)),this.igo.nav.analyseur=this,this.igo.nav.evenements=new Evenement,this._analyserCouches(groupeCouches))},AnalyseurConfig.prototype._xml2Json=function(xml){var obj={};if(xml.nodeType==1){if(xml.attributes.length>0){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else xml.nodeType==3&&(obj=xml.nodeValue);if(xml.hasChildNodes())for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i),nodeName=item.nodeName,itemJson;if(typeof obj[nodeName]=="undefined")itemJson=this.xml2Json(item),obj[nodeName]=itemJson;else{if(typeof obj[nodeName].push=="undefined"){var old=obj[nodeName];obj[nodeName]=[],obj[nodeName].push(old)}itemJson=this.xml2Json(item),obj[nodeName].push(itemJson)}}return obj},AnalyseurConfig.prototype._analyserRequire=function(json,modulesReq,niveauForage){var that=this;return niveauForage=niveauForage||1,modulesReq=modulesReq||[],json?$.isArray(json)?($.
each(json,function(key,value){modulesReq=that._analyserRequire(value,modulesReq,niveauForage)}),modulesReq):($.each(json,function(key,propriete){if(key.substr(0,1).search(/[#@]/)!==-1)return!0;propriete=$.isArray(propriete)?propriete:[propriete],$.each(propriete,function(key,enfant){var attributs=enfant["@attributes"]||enfant.attributs;if(attributs&&(attributs.classe||attributs.protocole)){var classe=attributs.classe||attributs.protocole,classeLowerCase=classe;classe!==classe.toUpperCase()&&(classeLowerCase=classe.charAt(0).toLowerCase()+classe.slice(1)),$.inArray(classeLowerCase,modulesReq)==-1&&modulesReq.push(classeLowerCase);if(attributs.urlModule){var paths={};paths[classeLowerCase]=attributs.urlModule,require.ajouterConfig({paths:paths})}}niveauForage>1&&(modulesReq=that._analyserRequire(enfant,modulesReq,niveauForage-1))})}),modulesReq):modulesReq},AnalyseurConfig.prototype._analyserPanneaux=function(json,panneauOccurence){var that=this,parent=panneauOccurence||this.igo.nav,tagPermis=
["panneau","element-accordeon","element"],modulesReq=["panneau"];modulesReq=this._analyserRequire(json,modulesReq),require(modulesReq,function(){Igo.Panneaux=$.extend(Igo.Panneaux,Aide.getRequisObjet(modulesReq,arguments)),json&&$.each(json,function(key,propriete){if($.inArray(key,tagPermis)===-1)return!0;propriete=$.isArray(propriete)?propriete:[propriete],$.each(propriete,function(key,panneau){var options=panneau["@attributes"]||panneau.attributs,classe=options.classe||"Panneau";if(!Igo.Panneaux[classe])throw new Error("Erreur: "+classe+" n'existe pas. Veuillez entrer un urlModule.");classe==="PanneauCarte"&&(options.centre||(options.centre=that.contexteAttributs.centre),options.zoom||(options.zoom=that.contexteAttributs.zoom));var panneauOccurence=new Igo.Panneaux[classe](options);parent.ajouterPanneau(panneauOccurence),(panneau.element||panneau["element-accordeon"])&&that._analyserPanneaux(panneau,panneauOccurence)})}),panneauOccurence||that.igo.nav.init(function(){that.fin.panneaux=!0
,that._analyserContexte(),$("#igoLoading").remove()})})},AnalyseurConfig.prototype._analyserContexte=function(){if(this.fin.panneaux&&this.fin.couches&&this.fin.actions){var contexte=new Contexte;contexte.charger(),this._fin()}},AnalyseurConfig.prototype._fin=function(){if(this.fin.analyse)return Aide.cacherMessageChargement(),!0;this.fin.analyse=!0,this._analyserDeclencheurs(Aide.obtenirConfigXML("declencheurs")),$("#igoLoading").remove(),this.options.callback&&this.options.callback.call(this.igo.nav),this._analyserAvertissements()},AnalyseurConfig.prototype._analyserOutils=function(json,outilOccurence){var that=this;if(!json)return!1;var barreOutils=outilOccurence||this.igo.nav.creerBarreOutils(),tagPermis=["outil","menu"],modulesReq=["outil","outilMenu"];modulesReq=this._analyserRequire(json,modulesReq,2),require(modulesReq,function(){Igo.Outils=$.extend(Igo.Outils,Aide.getRequisObjet(modulesReq,arguments));var arrayGroupeOutils;json["groupe-outils"]?arrayGroupeOutils=json["groupe-outils"
]:arrayGroupeOutils=[json],arrayGroupeOutils=$.isArray(arrayGroupeOutils)?arrayGroupeOutils:[arrayGroupeOutils],$.each(arrayGroupeOutils,function(key,groupeOutils){var listOutils=[],groupeOutilsOptions=groupeOutils["@attributes"]||groupeOutils.attributs||{};Aide.toBoolean(groupeOutilsOptions.division)!==!1&&listOutils.push("-"),$.each(groupeOutils,function(tag,propriete){if($.inArray(tag,tagPermis)===-1)return!0;propriete=$.isArray(propriete)?propriete:[propriete],$.each(propriete,function(key,outil){var options=outil["@attributes"]||outil.attributs;options=$.extend({},groupeOutilsOptions,options);var classe=options.classe;classe||(tag==="menu"?classe="OutilMenu":classe="Outil");if(!Igo.Outils[classe])throw new Error("Erreur: "+classe+" n'existe pas. Veuillez entrer un urlModule.");options.action&&(options.action=that._pathShortToLong(options.action)),options.actionScope&&(options.actionScope=that._pathShortToLong(options.actionScope));var outilOccurence=new Igo.Outils[classe](options);
listOutils.push(outilOccurence);if(outil.outil||outil["groupe-outils"])delete outil["@attributes"],delete outil.attributes,that._analyserOutils(outil,outilOccurence)})}),groupeOutilsOptions.rafraichir=!1,barreOutils.ajouterOutils(listOutils,groupeOutilsOptions)}),outilOccurence||barreOutils.rafraichir()})},AnalyseurConfig.prototype._analyserCouches=function(json){var that=this,igoGeometrieReq=["occurence","point","ligne","polygone","multiPoint","multiLigne","multiPolygone","limites","style"],modulesReq=["google","blanc","OSM","TMS","WMS","vecteur","vecteurCluster","marqueurs"];modulesReq=this._analyserRequire(json,modulesReq);var igoGeoReq=igoGeometrieReq.concat(modulesReq);require(igoGeoReq,function(){var gReqSize=igoGeometrieReq.length,cReqSize=modulesReq.length,argsObj=$.map(arguments,function(value){return[value]});Igo.Geometrie=Aide.getRequisObjet(igoGeometrieReq,argsObj.splice(0,gReqSize)),Igo.Couches=Aide.getRequisObjet(modulesReq,argsObj.splice(0,cReqSize));var listCouches=[],arrayCouches=
$.isArray(json)?json:[json];$.each(arrayCouches,function(key,couches){if(!couches||!couches.couche)return!0;var couchesOptions=couches["@attributes"]||couches.attributs,propriete=$.isArray(couches.couche)?couches.couche:[couches.couche];$.each(propriete,function(key,couche){var options=couche["@attributes"]||couche.attributs;options.infoAction&&(options.infoAction=that._pathShortToLong(options.infoAction)),options.droit=options.droit||couche.droit,options=$.extend({},couchesOptions,options);var classe=options.protocole;options.typeContexte="contexte";var coucheOccurence=new Igo.Couches[classe](options);listCouches.push(coucheOccurence)})});if(listCouches.length===0||!listCouches[0].estFond()||listCouches[0].obtenirTypeClasse()==="Google")return that._ajouterCoucheBlanc(listCouches),!0;that._analyserCouchesSuccess(listCouches)})},AnalyseurConfig.prototype._analyserCouchesSuccess=function(listCouches){this.igo.nav.carte.gestionCouches.ajouterCouches(listCouches),this.options.coucheId?this
._analyserCoucheBD(this.options.coucheId):this._analyserContexteBD()},AnalyseurConfig.prototype._ajouterCoucheBlanc=function(listCouches){listCouches.unshift(new Igo.Couches.Blanc({visible:!1})),this._analyserCouchesSuccess(listCouches)},AnalyseurConfig.prototype._analyserContexteBD=function(){var that=this,contexteId=this.contexteAttributs.id,contexteCode=this.contexteAttributs.code;$.isArray(this.options.contexteCode)?this.contexteAttributs.code&&this.contexteAttributs.code!=="null"&&$.each(this.options.contexteCode,function(key,value){if(that.contexteAttributs.code===value.split("?v=")[0])return contexteCode=value,!1}):this.options.contexteCode&&(contexteCode=this.options.contexteCode),$.isArray(this.options.contexteId)?this.contexteAttributs.id&&this.contexteAttributs.id!=="null"&&$.each(this.options.contexteId,function(key,value){if(that.contexteAttributs.id===value.split("?v=")[0])return contexteId=value,!1}):this.options.contexteId&&(contexteId=this.options.contexteId);var contexteUrl
;if(contexteId&&contexteId!=="null")contexteUrl=Aide.obtenirConfig("uri.api")+"contexte/"+contexteId;else{if(!contexteCode||contexteCode==="null")return this.fin.couches=!0,this._analyserContexte(),!0;contexteUrl=Aide.obtenirConfig("uri.api")+"contexteCode/"+contexteCode}$.ajax({url:contexteUrl,context:this,success:this._analyserContexteBDSuccess,error:this._analyserContexteBDError,dataType:"json"})},AnalyseurConfig.prototype._analyserContexteBDError=function(XMLHttpRequest,textStatus,errorThrown){$("#igoLoading").remove();var message=XMLHttpRequest.responseJSON?XMLHttpRequest.responseJSON.error:XMLHttpRequest.responseText;message||(message="Erreur lors du chargement du contexte. ("+textStatus+")"),Aide.afficherMessage("Erreur chargement contexte",message,null,"ERROR")},AnalyseurConfig.prototype._analyserContexteBDSuccess=function(data){var that=this,listCouches=[],couches=$.isArray(data)?data:data.couches||[];$.each(couches,function(key,couche){var options={id:couche.couche_id,url:couche
.mf_map_meta_onlineresource||data.mf_map_meta_onlineresource,nom:couche.mf_layer_name||couche.mf_layer_meta_name,titre:couche.mf_layer_meta_title,active:couche.est_active,visible:couche.est_visible,ordreAffichage:couche.mf_layer_meta_z_order,fond:couche.est_fond_de_carte,echelleMin:couche.mf_layer_maxscale_denom,echelleMax:couche.mf_layer_minscale_denom,opacite:couche.mf_layer_opacity,groupe:couche.mf_layer_meta_group_title||undefined,metadonnee:couche.fiche_csw_id,typeContexte:couche.type_contexte||"contexte",impression_url:couche.print_option_url,impression_nom:couche.print_option_layer_name,zoomMax:couche.max_zoom_level,zoomMin:couche.min_zoom_level,droit:couche.mf_layer_meta_attribution_title,wms_timeitem:couche.wms_timeitem,wms_timeextent:couche.wms_timeextent,msp_wmst_multiplevalues:couche.msp_wmst_multiplevalues,wms_timeformat:couche.wms_timeformat};Aide.obtenirConfig("uri.mapserver")?Aide.obtenirConfig("uri.mapserver")!==!0&&(options.url=Aide.obtenirConfig("uri.mapserver")+options
.url):options.url=Aide.obtenirConfig("uri.api")+"wms/"+data.id;var classe=couche.protocole;options=$.extend({},that.contexteAttributs,options);var coucheOccurence=new Igo.Couches[classe](options);listCouches.push(coucheOccurence)}),this.igo.nav.carte.gestionCouches.ajouterCouches(listCouches),data.avertissements&&(this.avertissements=this.avertissements.concat(data.avertissements)),that.fin.couches=!0,that._analyserContexte()},AnalyseurConfig.prototype._pathShortToLong=function(objet){if(objet&&(objet[0]==="/"||objet[0]==="#"||objet[0]==="@")){var prefix="Igo.Aide.obtenirNavigateur()",objetR=objet.substr(1);if(objet[0]==="@")prefix+=".actions";else if(objet[0]==="#"){var nav=Aide.obtenirNavigateur(),index=objet.indexOf(".");index=index!==-1?index-1:undefined;var id=objet.substr(1,index),panneau=nav.obtenirPanneauParId(id,-1);if(panneau)prefix+=".obtenirPanneauParId('"+id+"', -1)",index?objetR=objet.substr(index+2):objetR="";else{var outil=nav.barreOutils.obtenirOutilParId(id,-1);outil&&
(prefix+=".barreOutils.obtenirOutilParId('"+id+"', -1)",index?objetR=objet.substr(index+2):objetR="")}}objetR.length!==0&&(prefix+="."),objet=prefix+objetR}return objet},AnalyseurConfig.prototype._analyserDeclencheurs=function(declencheurs){if(!declencheurs)return!0;var that=this,arrayDeclencheurs=$.isArray(declencheurs.declencheur)?declencheurs.declencheur:[declencheurs.declencheur];$.each(arrayDeclencheurs,function(key,declencheur){if(!declencheur)return!1;var options=declencheur["@attributes"]||declencheur.attributs||{};if(!options.evenement||!options.action)return!0;var objet=options.objet||"/evenements";objet=that._pathShortToLong(objet);var action=that._pathShortToLong(options.action),scope=that._pathShortToLong(options.scope),code=objet+".ajouterDeclencheur('"+options.evenement+"', "+action+", {scope:"+scope+", avant:"+options.avant+", id:"+options.id+"})";(new Function(code))()})},AnalyseurConfig.prototype._analyserActions=function(actions){var that=this;if(!actions)return this.
fin.actions=!0,!0;var arrayActions=$.isArray(actions.action)?actions.action:[actions.action],listActionsReq=[];$.each(arrayActions,function(key,action){var options=action["@attributes"]||action.attributs,id=options.id;listActionsReq.push(id);if(options.source){var source=options.source,aJSExt=source.lastIndexOf(".js");aJSExt!==-1&&(source=source.substr(0,aJSExt));var paths={};paths[id]=source,require.ajouterConfig({paths:paths})}}),require(listActionsReq,function(){that.igo.nav.actions=Aide.getRequisObjet(listActionsReq,arguments,!1),that.fin.actions=!0,that._analyserContexte()})},AnalyseurConfig.prototype._analyserCoucheBD=function(coucheId){var contexteUrl=Aide.obtenirConfig("uri.api")+"couche/"+coucheId;$.ajax({url:contexteUrl,context:this,success:this._analyserContexteBDSuccess,error:this._analyserContexteBDError,dataType:"json"})},AnalyseurConfig.prototype._analyserAvertissements=function(avertissements){avertissements=avertissements||[],this.avertissements&&(avertissements=avertissements
.concat(this.avertissements)),avertissements.length>0&&$.each(avertissements,function(key,avertissement){Aide.afficherMessageConsole(avertissement)})},AnalyseurConfig}),define("analyseurGeoJSON",["occurence"],function(Occurence){function AnalyseurGeoJSON(options){this.options=options||{};var carteProj=this.options.projectionCarte||"EPSG:3857",format=OpenLayers.Class(OpenLayers.Format.GeoJSON,{parseFeature:function(obj){var feature,geometry,attributes,bbox;attributes=obj.properties?obj.properties:{};try{geometry=this.parseGeometry(obj.geometry)}catch(err){throw err}return this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection),feature=new Occurence(geometry,attributes),feature},read:function(json,type,filter){type=type?type:"FeatureCollection";var results=null,obj=null;typeof json=="string"?obj=OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter]):obj=json;if(!obj)OpenLayers.Console.error("Bad JSON: "+json);else if(typeof 
obj.type!="string")OpenLayers.Console.error("Bad GeoJSON - no type: "+json);else if(this.isValidType(obj,type))switch(type){case"Geometry":var resultsOL=[];try{resultsOL=this.parseGeometry(obj)}catch(err){OpenLayers.Console.error(err)}for(var i=0,len=resultsOL.length;i<len;++i)results.push(new Occurence(resultsOL[i]));break;case"Feature":try{results=this.parseFeature(obj),results.type="Feature"}catch(err){OpenLayers.Console.error(err)}break;case"FeatureCollection":results=[];switch(obj.type){case"Feature":try{results.push(this.parseFeature(obj))}catch(err){results=null,OpenLayers.Console.error(err)}break;case"FeatureCollection":var proj="EPSG:4326";if(obj.crs){var crs=obj.crs.properties.name;proj="EPSG:"+crs.substr(crs.search("EPSG::")+6).split(":")[0]}this.externalProjection=new OpenLayers.Projection(proj);for(var i=0,len=obj.features.length;i<len;++i)try{results.push(this.parseFeature(obj.features[i]))}catch(err){results=null,OpenLayers.Console.error(err)}break;default:try{var resultsOL=
[],geom=this.parseGeometry(obj);resultsOL.push(new OpenLayers.Feature.Vector(geom));for(var i=0,len=resultsOL.length;i<len;++i)results.push(new Occurence(resultsOL[i]))}catch(err){results=null,OpenLayers.Console.error(err)}}}return results}});this._parser=new format({internalProjection:new OpenLayers.Projection(carteProj)})}return AnalyseurGeoJSON.prototype.lire=function(geoJson){return this._parser.read(geoJson)},AnalyseurGeoJSON.prototype.lireUrl=function(opt){opt=opt||{};var url=opt.url,callback=opt.callback;if(!callback||!url)return!1;var that=this;$.ajax({url:url,success:function(result,status,xhr){var rep=that.lire(result);callback&&callback.call(that,rep,status,xhr)},error:function(xhr,status,error){callback&&callback.call(that,error,status,xhr)}})},AnalyseurGeoJSON.prototype.ecrire=function(occurences){if(!occurences)return!0;occurences.obtenirTypeClasse&&(occurences.obtenirTypeClasse()==="Vecteur"||occurences.obtenirTypeClasse()==="VecteurCluster"||occurences.obtenirTypeClasse(
)==="WFS")&&(occurences=occurences.obtenirOccurences());if(occurences.obtenirTypeClasse&&occurences.obtenirTypeClasse()==="Occurence")occurences=[occurences];else if(occurences._obtenirGeomOL)return this._parser.write(occurences._obtenirGeomOL());var listFeaturesOL=[];return $.each(occurences,function(key,value){if(!value.obtenirTypeClasse||value.obtenirTypeClasse()!=="Occurence")return!0;listFeaturesOL.push(value._feature)}),this._parser.write(listFeaturesOL)},AnalyseurGeoJSON}),define("metadonnee",["aide","browserDetect"],function(Aide,BrowserDetect){function Metadonnee(){}return Metadonnee.getLayerCapabilities=function(couche){this.couche=couche;var nomClasse=couche.options.metadonnee;Aide.toBoolean(nomClasse)===!0&&(nomClasse=couche.options.nom);var lienExt=couche.options.metadonneeLien||Aide.obtenirConfig("Metadonnee.lien");if(couche.options.metadonneeExterne&&couche.options.metadonneeExterne.toLowerCase()!=="false"){lienExt||(lienExt=couche.options.metadonneeExterne);if(lienExt&&Aide
.toBoolean(lienExt)!==!0)return lienExt=decodeURIComponent(lienExt).replace("{id}",nomClasse),window.open(lienExt,"M\u00e9tadonnees","resizable=yes,scrollbars=yes,toolbar=yes,status=yes"),!0}if(lienExt&&Aide.toBoolean(lienExt)!==!0)return lienExt=decodeURIComponent(lienExt).replace("{id}",nomClasse),this.parse({responseText:"<iframe style='width:800px; height:800px;' src='"+lienExt+"'></iframe>"}),!0;var szURL=Aide.utiliserProxy(Aide.obtenirUrlServices()+"metaGN/meta_requete_gn.php?id="+encodeURIComponent(nomClasse)),catalogue=Aide.obtenirConfig("Metadonnee.catalogueUrl")||couche.options.metadonneeCatalogueUrl;catalogue&&(nomClasse=decodeURIComponent(catalogue).replace("{id}",nomClasse)),decodeURIComponent(nomClasse).search("://")!==-1&&(szURL=Aide.utiliserProxy(Aide.obtenirUrlServices()+"metaGN/meta_requete_gn.php?url_metadata="+encodeURIComponent(decodeURIComponent(nomClasse)))),OpenLayers.Request.GET({url:szURL,scope:this,callback:this.parseXML})},Metadonnee.parseXML=function(response
){var liste_id=response.responseXML.getElementsByTagName("geonetwork_metaid"),id_nomClasse=liste_id[0].getElementsByTagName("nomClasseid")[0].textContent,id_GN=liste_id[0].getElementsByTagName("id")[0].textContent;BrowserDetect.browser=="Explorer"&&(id_GN=liste_id[0].getElementsByTagName("id")[0].text);if(id_GN==-99||id_GN==null){var message={responseText:"Aucune information disponible.\r\n"};this.parse(message)}else{BrowserDetect.browser=="Explorer"&&(id_nomClasse=liste_id[0].getElementsByTagName("nomClasseid")[0].text);var szURL_GN2=Aide.utiliserProxy(Aide.obtenirUrlServices()+"metaGN/iframewrapper.php"),metaURL=Aide.obtenirUrlServices()+"metaGN/meta_gn-details.php?id="+encodeURIComponent(id_nomClasse);decodeURIComponent(id_nomClasse).search("://")!==-1&&(metaURL=Aide.obtenirUrlServices()+"metaGN/meta_gn-details.php?url_metadata="+encodeURIComponent(decodeURIComponent(id_nomClasse)));if(this.couche.options.metadonneeExterne)return window.open(metaURL,"M\u00e9tadonnees","resizable=yes,scrollbars=yes,toolbar=yes,status=yes"
),!0;OpenLayers.Request.GET({url:szURL_GN2,params:{url_iframe:Aide.utiliserProxy(metaURL)},scope:this,callback:this.parse})}},Metadonnee.parse=function(response){var szResponse=response.responseText,oMetadataWindow=new Ext.Window({title:"Information de la couche ",closable:!0,width:800,autoHeight:!0,border:!1,modal:!0,plain:!0,resizable:!0,autoScroll:!0,constrain:!0,region:"center"}),oMetadataPanel=new Ext.Panel({html:szResponse,border:!1});oMetadataWindow.add(oMetadataPanel),oMetadataWindow.show()},Metadonnee}),define("contexteMenuTable",["contexteMenu","aide","fonctions"],function(ContexteMenu,Aide,Fonctions){function ContexteMenuTable(options){this.options=options||{},this.carte=this.options.panneauTable.carte,this.init()}return ContexteMenuTable.prototype=new ContexteMenu,ContexteMenuTable.prototype.constructor=ContexteMenuTable,ContexteMenuTable.prototype.init=function(){ContexteMenu.prototype.init.call(this),this.ajouterFonctionsConstruction(this.initOccurencesSubmenu),this.ajouterFonctionsConstruction
(this.initFermerSubmenu)},ContexteMenuTable.prototype.obtenirInformation=function(e){var rowHtml,$target=$(e.target);rowHtml=$target.parentsUntil(this.$selecteur,"div.x-grid3-row");var index=this.options.panneauTable.obtenirIndexParEnregistrementHtml(rowHtml[0]);if(index==="undefined"||index===!1)return!1;var enregistrement=this.options.panneauTable.obtenirEnregistrementParIndex(index);if(!enregistrement.json.obtenirTypeClasse||enregistrement.json.obtenirTypeClasse()!=="Occurence")return!1;var occurence=enregistrement.json;return Aide.obtenirNavigateur().obtenirCtrl()||occurence.vecteur.deselectionnerTout(),this.options.panneauTable.selectionnerParIndex(index,undefined,!1),{occurence:occurence}},ContexteMenuTable.prototype.initOccurencesSubmenu=function(args){var that=args.scope,menu=[];return menu.push({text:"Plus d'info",handler:function(){Fonctions.afficherProprietes([args.occurence])}}),menu.push({text:"Zoomer",handler:function(){var min=Math.max(that.carte.obtenirZoom(),15);args.occurence
.vecteur.zoomerOccurence(args.occurence,min)}}),args.occurence.vecteur.options.selectionnable&&args.occurence.vecteur.options.supprimable!==!1&&args.occurence.obtenirTypeClasse()!=="Cluster"&&args.occurence.vecteur.options.protege!==!0&&menu.push({text:"Supprimer",handler:function(){args.occurence.vecteur.enleverOccurence(args.occurence)}}),args.occurence.type==="Ligne"?(menu.push("-"),menu.push({text:"Longueur",handler:function(){var longueur=args.occurence.obtenirLongueur();Aide.afficherMessage("Longueur",longueur+" "+that.carte._carteOL.getUnits())}})):args.occurence.type==="Polygone"&&(menu.push("-"),menu.push({text:"P\u00e9rim\u00e8tre",handler:function(){var perimetre=args.occurence.obtenirPerimetre();Aide.afficherMessage("P\u00e9rim\u00e8tre",perimetre+" "+that.carte._carteOL.getUnits())}},{text:"Superficie",handler:function(){var superficie=args.occurence.obtenirSuperficie();Aide.afficherMessage("Superficie",superficie+" "+that.carte._carteOL.getUnits()+"\u00b2")}})),menu},ContexteMenuTable
.prototype.initFermerSubmenu=function(args){return{text:"Fermer"}},ContexteMenuTable}),define("outilTableSelection",["outil","aide"],function(Outil,Aide){function OutilTableSelection(options){this.options=options||{},this.options.type==="efface"?this.defautOptions=$.extend({},this.defautOptions,{id:"selection_effacer",titre:"Effacer la s\u00e9lection",infobulle:"Effacer la s\u00e9lection",icone:Aide.obtenirCheminRacine()+"images/toolbar/gui-pointer.gif"}):this.options.type==="inverse"?this.defautOptions=$.extend({},this.defautOptions,{id:"selection_inverse",allowDepress:!1,infobulle:"Inverser la selection",titre:"Inverser la s\u00e9lection",icone:Aide.obtenirCheminRacine()+"images/toolbar/gui-pointer.gif"}):this.options.type==="complet"?this.defautOptions=$.extend({},this.defautOptions,{id:"selection_tout",infobulle:"Tout s\u00e9lectionner",titre:"Tout s\u00e9lectionner",icone:Aide.obtenirCheminRacine()+"images/toolbar/gui-pointer.gif"}):this.options.type==="zoom"?this.defautOptions=$.extend
({},this.defautOptions,{id:"zoom_selection",titre:"Zoom sur la s\u00e9lection",infobulle:"Zoom sur la s\u00e9lection",icone:Aide.obtenirCheminRacine()+"images/toolbar/moveto.png"}):this.options.type==="pan"?this.defautOptions=$.extend({},this.defautOptions,{id:"pan_selection",titre:"Zoom sur la s\u00e9lection",infobulle:"Zoom sur la s\u00e9lection",icone:Aide.obtenirCheminRacine()+"images/toolbar/icon_pan.png"}):this.options.type==="auto"&&(this.defautOptions=$.extend({},this.defautOptions,{id:"zoom_auto",xtype:"menucheckitem",titre:"Zoom auto sur la s\u00e9lection",infobulle:"Zoom auto sur la s\u00e9lection"}))}return OutilTableSelection.prototype=new Outil,OutilTableSelection.prototype.constructor=OutilTableSelection,OutilTableSelection.prototype._init=function(){this.initEvent(),Outil.prototype._init.call(this)},OutilTableSelection.prototype.executer=function(){this.options.type==="efface"?this.options.couche.deselectionnerTout():this.options.type==="inverse"?this.options.couche.selectionnerInverse
():this.options.type==="complet"?this.options.couche.selectionnerTout():this.options.type==="zoom"?this.options.couche.zoomerOccurences(this.options.couche.obtenirOccurencesSelectionnees()):this.options.type==="auto"&&(this.options.couche.zoomAuto=!this._bouton.checked)},OutilTableSelection.prototype.initEvent=function(){var that=this;if(this.options.type==="inverse"||this.options.type==="complet")this.options.couche.ajouterDeclencheur("controleEditionActiver",function(){that.desactiver()}),this.options.couche.ajouterDeclencheur("controleEditionDesactiver",function(){that.activer()})},OutilTableSelection}),define("outilMenu",["outil"],function(Outil){function OutilMenu(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{titre:"Menu",items:[],outils:[]}),this.listeOutils=[],this._listeOutilsTemp=[]}return OutilMenu.prototype=new Outil,OutilMenu.prototype.constructor=OutilMenu,OutilMenu.prototype._init=function(){this._pasInit=!1;var outils=this.options.outils||
this.defautOptions.outils;outils=outils.concat(this._listeOutilsTemp),outils&&this.ajouterOutils(outils),this._extOptions={menu:new Ext.menu.Menu({items:this.options.items||this.defautOptions.items})},Outil.prototype._init.call(this)},OutilMenu.prototype.obtenirOutils=function(type,niveau){return this.listeOutils},OutilMenu.prototype.obtenirOutilsParType=function(type,niveau){niveau=niveau||1;var outils=[];return $.each(this.obtenirOutils(),function(key,value){value.obtenirTypeClasse&&value.obtenirTypeClasse()===type&&outils.push(value),(niveau>1||niveau<0)&&value.obtenirOutilsParType&&(outils=outils.concat(value.obtenirOutilsParType(type,niveau-1)))}),outils},OutilMenu.prototype.obtenirOutilParId=function(id,niveau){niveau=niveau||1;var outil;return $.each(this.obtenirOutils(),function(key,value){if(value.obtenirId&&value.obtenirId()===id)return outil=value,!1;if((niveau>1||niveau<0)&&value.obtenirOutilParId){outil=value.obtenirOutilParId(id,niveau-1);if(outil)return!1}}),outil},OutilMenu
.prototype.ajouterOutils=function(outils){var that=this;$.each(outils,function(key,outil){that.ajouterOutil(outil)})},OutilMenu.prototype.ajouterOutil=function(outil){if(this._pasInit!==!1)return this._listeOutilsTemp.push(outil),!0;outil instanceof Outil?(outil.carte=this.carte,outil.parent=this,outil.defautOptions.elementMenu=!0,outil._init(),outil._ajoutCallback(this,this._ajouterElementCallback)):outil==="-"&&this.ajouterSeparateur()},OutilMenu.prototype._ajouterElementCallback=function(outil){if(this._bouton){if(!this._getBouton().menu)return console.warn(this.obtenirTypeClasse()+" (id->"+this.obtenirId()+") ne peut ajouter de nouvel outil apr\u00e8s l'initialisation"),!1;this._getBouton().menu.add(outil._getBouton())}else this.defautOptions.items.push(outil._getBouton());this.listeOutils.push(outil)},OutilMenu.prototype.ajouterSeparateur=function(){if(this._bouton){if(!this._getBouton().menu)return console.warn("outilMenu (id->"+this.obtenirId()+") ne peut ajouter de nouvel outil apr\u00e8s l'initialisation"
),!1;this._getBouton().menu.addSeparator()}else this.defautOptions.items.push("-");this.listeOutils.push("-")},OutilMenu.prototype.afficher=function(){},OutilMenu.prototype.cacher=function(){},OutilMenu}),define("outilDessin",["outil","aide"],function(Outil,Aide){function OutilDessin(options){this.options=options||{},this._type,this.options.type==="ligne"?this.defautOptions=$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/dessiner_ligne_20.png",id:"idDessinLigne",infobulle:"Outil de dessin - Ligne"}):this.options.type==="polygone"?this.defautOptions=$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/dessiner_polygone_20.png",id:"idDessinPolygone",infobulle:"Outil de dessin - Polygone"}):this.options.type==="regulier"?this.defautOptions=$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/dessiner_polygone_20.png",id:"idDessinRegulier",infobulle:"Outil de dessin - Polygone r\u00e9guilier"}):this.defautOptions=
$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/dessiner_point_20.png",id:"idDessinPoint",infobulle:"Outil de dessin - Point"}),this.defautOptions.groupe="carte"}return OutilDessin.prototype=new Outil,OutilDessin.prototype.constructor=OutilDessin,OutilDessin.prototype._init=function(){Outil.prototype._init.call(this),this.options.couche&&(typeof this.options.couche=="string"&&(this.options.couche=this.carte.gestionCouches.obtenirCoucheParId(this.options.couche)),!this.options.couche.obtenirTypeClasse||this.options.couche.obtenirTypeClasse()!=="Vecteur"&&this.options.couche.obtenirTypeClasse()!=="VecteurCluster"&&this.options.couche.obtenirTypeClasse()!=="WFS"?this.options.couche=undefined:this.couche=this.options.couche),this.initEvent()},OutilDessin.prototype.initEvent=function(){var that=this;if(this.options.couche)return!0;this.parent?this.parent.desactiver():this.desactiver(),that.carte.ajouterDeclencheur("changerCoucheEdition",function(e){that.changerCoucheDessin
(e.couche)});var nav=Aide.obtenirNavigateur(),arbo=nav.obtenirPanneauxParType("Arborescence",2)[0];if(arbo)return this._ajouterContexteSubmenu(arbo.contexteMenu),!0;nav.evenements.obtenirDeclencheur("initArborescence","outilEditionAjouterContexteSubmenu").length||nav.evenements.ajouterDeclencheur("initArborescence",function(e){that._ajouterContexteSubmenu(e.target.contexteMenu),nav.evenements.enleverDeclencheur("initArborescence","outilEditionAjouterContexteSubmenu")},{id:"outilEditionAjouterContexteSubmenu"})},OutilDessin.prototype._ajouterContexteSubmenu=function(contexteMenu){if(contexteMenu._edtionSubmenuBool)return!0;contexteMenu._edtionSubmenuBool=!0;var that=this;contexteMenu.ajouter({id:"startEditVecteur",titre:"\u00c9diter",action:function(args){that.carte.gestionCouches.coucheVecteurActive&&(that.carte.gestionCouches.coucheVecteurActive.editionActif=!1,that.carte.gestionCouches.coucheVecteurActive._nodeHtml.css("background-color","")),args.couche._nodeHtml=args.nodeHtml,that.carte
.gestionCouches.coucheVecteurActive=args.couche,args.nodeHtml.css("background-color","#c8dadb"),that.carte.declencher({type:"changerCoucheEdition",couche:args.couche})},condition:function(args){return(args.couche.obtenirTypeClasse()==="Vecteur"||args.couche.obtenirTypeClasse()==="VecteurCluster")&&that.carte.gestionCouches.coucheVecteurActive!==args.couche&&Aide.toBoolean(args.couche.options.editable)!==!1},position:4}),contexteMenu.ajouter({id:"stopEditVecteur",titre:"Arr\u00eater l'\u00e9dition",action:function(args){args.couche.editionActif=!1,that.carte.gestionCouches.coucheVecteurActive=undefined,args.nodeHtml.css("background-color",""),that.carte.declencher({type:"changerCoucheEdition",couche:undefined})},condition:function(args){return(args.couche.obtenirTypeClasse()==="Vecteur"||args.couche.obtenirTypeClasse()==="VecteurCluster")&&that.carte.gestionCouches.coucheVecteurActive===args.couche},position:5})},OutilDessin.prototype.executer=function(){this.carte.controles.activerDessin
(this.couche,this.options.type,{sides:this.options.cote,irregular:this.options.irregulier,releverBoutonOutil:!1})},OutilDessin.prototype.eteindre=function(){this.carte.controles.desactiverDessin()},OutilDessin.prototype.changerCoucheDessin=function(couche){if(!couche)return this.parent?(this.parent.desactiver(),this.parent.estEnfonce()&&this.parent.eteindre()):(this.desactiver(),this.estEnfonce()&&this.eteindre()),this.couche=this.options.couche,!0;this.couche=couche,this.parent?this.parent.activer():this.activer(),(this.estEnfonce()||this.parent&&this.parent.estEnfonce()&&this.parent.outilActif===this)&&this.executer()},OutilDessin}),define("outilEdition",["outil","aide"],function(Outil,Aide){function OutilEdition(options){this.options=options||{},this.couche=this.options.couche,this.defautOptions=$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/shape_square_red.png",id:"idEdition",infobulle:"Outil d'\u00e9dition"}),this.defautOptions.groupe="carte"}return OutilEdition
.prototype=new Outil,OutilEdition.prototype.constructor=OutilEdition,OutilEdition.prototype._init=function(){this.initEvent(),Outil.prototype._init.call(this)},OutilEdition.prototype.initEvent=function(){var that=this;if(this.options.couche)return!0;this.parent?this.parent.desactiver():this.desactiver(),that.carte.ajouterDeclencheur("changerCoucheEdition",function(e){that.changerCoucheEdition(e.couche)});var nav=Aide.obtenirNavigateur(),arbo=nav.obtenirPanneauxParType("Arborescence",2)[0];if(arbo)return this._ajouterContexteSubmenu(arbo.contexteMenu),!0;nav.evenements.obtenirDeclencheur("initArborescence","outilEditionAjouterContexteSubmenu").length||nav.evenements.ajouterDeclencheur("initArborescence",function(e){that._ajouterContexteSubmenu(e.target.contexteMenu),nav.evenements.enleverDeclencheur("initArborescence","outilEditionAjouterContexteSubmenu")},{id:"outilEditionAjouterContexteSubmenu"})},OutilEdition.prototype._ajouterContexteSubmenu=function(contexteMenu){if(contexteMenu._edtionSubmenuBool
)return!0;contexteMenu._edtionSubmenuBool=!0;var that=this;contexteMenu.ajouter({id:"startEditVecteur",titre:"\u00c9diter",action:function(args){that.carte.gestionCouches.coucheVecteurActive&&(that.carte.gestionCouches.coucheVecteurActive.editionActif=!1,that.carte.gestionCouches.coucheVecteurActive._nodeHtml.css("background-color","")),args.couche._nodeHtml=args.nodeHtml,that.carte.gestionCouches.coucheVecteurActive=args.couche,args.nodeHtml.css("background-color","#c8dadb"),that.carte.declencher({type:"changerCoucheEdition",couche:args.couche})},condition:function(args){return(args.couche.obtenirTypeClasse()=="Vecteur"||args.couche.obtenirTypeClasse()=="VecteurCluster")&&that.carte.gestionCouches.coucheVecteurActive!==args.couche&&Aide.toBoolean(args.couche.options.editable)!==!1},position:4}),contexteMenu.ajouter({id:"stopEditVecteur",titre:"Arr\u00eater l'\u00e9dition",action:function(args){args.couche.editionActif=!1,that.carte.gestionCouches.coucheVecteurActive=undefined,args.nodeHtml
.css("background-color",""),that.carte.declencher({type:"changerCoucheEdition",couche:undefined})},condition:function(args){return(args.couche.obtenirTypeClasse()=="Vecteur"||args.couche.obtenirTypeClasse()=="VecteurCluster")&&that.carte.gestionCouches.coucheVecteurActive===args.couche},position:5})},OutilEdition.prototype.executer=function(){this.couche.editionActif=!0,this.carte.controles.activerEdition(this.couche)},OutilEdition.prototype.eteindre=function(){this.couche&&(this.couche.editionActif=!1),this.carte.controles.desactiverEdition(this.couche)},OutilEdition.prototype.changerCoucheEdition=function(couche){if(!couche)return this.parent?(this.parent.desactiver(),this.parent.estEnfonce()&&this.parent.eteindre()):(this.desactiver(),this.estEnfonce()&&this.eteindre()),this.couche=undefined,!0;this.parent?this.parent.activer():this.activer(),this.couche=couche,this.parent?this.parent.activer():this.activer(),(this.estEnfonce()||this.parent&&this.parent.estEnfonce()&&this.parent.outilActif===
this)&&this.executer()},OutilEdition}),define("outilControleMenu",["outilMenu","aide","outil"],function(OutilMenu,Aide,Outil){function OutilControleMenu(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{titre:"ControleMenu",items:[],outils:[],groupe:"carte",xtype:"tbsplit"}),this.listeOutils=[]}return OutilControleMenu.prototype=new OutilMenu,OutilControleMenu.prototype.constructor=OutilControleMenu,OutilControleMenu.prototype._ajouterElementCallback=function(outil){var params={scope:this,outil:outil};this.outilActif||this.definirOutilActif(outil,!1),outil._bouton.setHandler(function(){this.scope.definirOutilActif(this.outil)},params),OutilMenu.prototype._ajouterElementCallback.call(this,outil)},OutilControleMenu.prototype.executer=function(){this.outilActif&&this.outilActif.executer()},OutilControleMenu.prototype.eteindre=function(){this.outilActif&&this.outilActif.eteindre()},OutilControleMenu.prototype.definirOutilActif=function(outil,enfoncer){if(!
this._bouton||!(outil instanceof Outil))return!1;this.eteindre(),this.outilActif=outil,Aide.toBoolean(this.options.utiliserSousTitre)&&outil.options.titre&&this.changerTitre(this.options.titre+"-"+outil.options.titre),Aide.toBoolean(this.options.utiliserSousIcone)&&outil.options.icone&&this.changerIcone(outil.options.icone),enfoncer!==!1&&this.enfoncerBouton()},OutilControleMenu.prototype._ajoutCallback=function(target,callback,opt){this.definirOutilActif(this.listeOutils[0],!1),OutilMenu.prototype._ajoutCallback.call(this,target,callback,opt)},OutilControleMenu}),Ext.data.JsonReader.prototype.extractValues=function(data,items,len){var f,values={};for(var j=0;j<len;j++){f=items[j];var v;try{v=this.ef[j](data)}catch(e){v=undefined}values[f.name]=f.convert(v!==undefined?v:f.defaultValue,data)}return values},define("libs/extension/Extjs/JsonReader",function(){}),define("panneauTable",["panneau","aide","contexteMenuTable","barreOutils","outilTableSelection","outil","outilMenu","outilDessin"
,"outilEdition","outilControleMenu","libs/extension/Extjs/JsonReader"],function(Panneau,Aide,ContexteMenuTable,BarreOutils,OutilTableSelection,Outil,OutilMenu,OutilDessin,OutilEdition,OutilControleMenu){function PanneauTable(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{id:"table-panneau"})}return PanneauTable.prototype=new Panneau,PanneauTable.prototype.constructor=PanneauTable,PanneauTable.prototype._init=function(){Ext.QuickTips.init(),this.controles=new PanneauTable.Controles(this),this.template=this.options.template||{colonnes:[]},this.donnees=this.options.donnees||[];var config=this.configurer(this.template,this.donnees);this._extOptions={xtype:"editorgrid",store:config.store,colModel:config.columnModel,stripeRows:!0,stateful:!0,stateId:"grid"+this.options.titre,clicksToEdit:1,width:screen.width,viewConfig:{forceFit:!0},sm:new Ext.grid.RowSelectionModel,tbar:this._obtenirToolbar()},Panneau.prototype._init.call(this),this._initEvent(),this.barreOutils
._setPanelContainer(this._panel),this.options.vecteur&&this.ouvrirTableVecteur()},PanneauTable.prototype._initEvent=function(){var that=this;this._panel.on("beforeedit",function(e){return(!that.donnees.templates.table||!that.donnees.templates.table.colonnes)&&typeof e.value=="object"?!1:that.options.activerEdition===!0||that.donnees.editionActif===!0}),this._panel.on("afteredit",function(e){var occurence=e.record.json;occurence.obtenirPropriete("/"+e.field)!==e.value&&occurence.definirPropriete("/"+e.field,e.value)})},PanneauTable.prototype._obtenirToolbar=function(){var that=this;return this.barreOutils=new BarreOutils(this.carte),this.barreOutils._getToolbar()},PanneauTable.prototype.chargerDonnees=function(donnees,garderDonnees){var that=this;try{that._panel.store.loadData(donnees,garderDonnees)}catch(e){console.warn(e)}if(this._panel.store.sortInfo){var sortInfo=this._panel.store.sortInfo;this._panel.store.sort(sortInfo.field,sortInfo.direction)}else this._panel.store.sort("id","ASC"
)},PanneauTable.prototype.ajouterOccurences=function(occurences,garderDonnees){this.chargerDonnees({listeOccurences:occurences},garderDonnees)},PanneauTable.prototype.enleverParOccurences=function(occurences){var that=this;$.each(occurences,function(key,value){var index=that._panel.store.indexOfId(value.id);if(index===-1)return!0;that.enleverParIndex(index)})},PanneauTable.prototype.enleverParIndex=function(index){this._panel.store.removeAt(index)},PanneauTable.prototype._obtenirColumnModel=function(colTemplate){var editor,rendu=colTemplate.rendu,that=this;if(!colTemplate.editable)editor=undefined;else if(colTemplate.type==="enumeration"){var store;colTemplate.urlEnumeration?store=new Ext.data.ArrayStore({autoDestroy:!0,proxy:new Ext.data.HttpProxy({method:"GET",url:colTemplate.urlEnumeration,listeners:{beforeload:function(a,params){delete params.query,params=colTemplate.enumerationParamsFonction()}}}),root:colTemplate.enumerationRoot,fields:["id","value"]}):store=new Ext.data.JsonStore
({fields:["id","value"],data:colTemplate.valeurs||[]}),editor=new Ext.form.ComboBox({store:store,displayField:"value",valueField:"id",typeAhead:!0,mode:colTemplate.urlEnumeration?undefined:"local",forceSelection:!0,triggerAction:"all",selectOnFocus:!0,allowBlank:!colTemplate.obligatoire}),rendu=function(value){var store=this.editor.store,index=store.find("id",value);return index!=-1?store.data.items[index].data.value:value}}else colTemplate.type==="nombre"||colTemplate.type==="integer"?editor=new Ext.form.NumberField({allowBlank:!colTemplate.obligatoire}):colTemplate.type==="texte"?editor=new Ext.form.TextArea({allowBlank:!colTemplate.obligatoire}):editor=new Ext.form.TextField({allowBlank:!colTemplate.obligatoire});var base="";colTemplate.utiliserBase!==!1&&that.template.proprietesBase&&(base=that.template.proprietesBase+".");var renduDirty=function(value,cell,objet){if(objet.json.modifiee&&objet.json.proprietesOriginales){var propriete=objet.store.fields.get(cell.id).name,proprieteOriginale=
propriete.replace("proprietes.","proprietesOriginales."),valeurOriginale=objet.json.obtenirPropriete("/"+proprieteOriginale),valeur=objet.json.obtenirPropriete("/"+propriete);valeurOriginale!==valeur&&(cell.css=cell.css+" x-grid3-dirty-cell")}return rendu&&(value=rendu.call(this,value,cell,objet)),value},titre;return colTemplate.obligatoire?titre="*"+colTemplate.titre:titre=colTemplate.titre,{header:titre,width:colTemplate.largeur,sortable:colTemplate.triable,alignement:colTemplate.alignement,dataIndex:base+colTemplate.propriete,renderer:renduDirty,editor:editor}},PanneauTable.prototype.afficherErreurs=function(){var that=this;try{$(this._panel.view.el.dom.getElementsByClassName("x-form-invalid")).removeClass("x-form-invalid")}catch(e){}$.each(this.donnees.listeOccurences,function(key,occurence){if($.isEmptyObject(occurence.obtenirErreurs()))return!0;var row=that.obtenirIndexParOccurence(occurence);if(row<0)return!0;var messageGen="",erreurGen=occurence.obtenirErreur("general"),erreurGeom=
occurence.obtenirErreur("geometrie");if(erreurGen||erreurGeom){var cell=that._panel.view.getRow(row).children[0];if(!cell)return!0;cell.classList.add("x-form-invalid"),$.isArray(erreurGen)?$.each(erreurGen,function(errKey,uneErreur){typeof uneErreur=="string"?messageGen+=uneErreur+"\n":uneErreur.message&&(messageGen+=uneErreur.message+"\n")}):erreurGen&&(typeof erreurGen=="string"?messageGen+=erreurGen+"\n":erreurGen.message&&(messageGen+=erreurGen.message+"\n")),$.isArray(erreurGeom)?$.each(erreurGeom,function(errKey,uneErreur){typeof uneErreur=="string"?messageGen+=uneErreur+"\n":uneErreur.message&&(messageGen+=uneErreur.message+"\n")}):erreurGeom&&(typeof erreurGeom=="string"?messageGen+=erreurGeom+"\n":erreurGeom.message&&(messageGen+=erreurGeom.message+"\n")),cell.title=messageGen}$.each(that.template.colonnes,function(colKey,colTemplate){var base="";colTemplate.utiliserBase!==!1&&that.template.proprietesBase&&(base=that.template.proprietesBase+".");var erreur=occurence.obtenirErreur
(base+colTemplate.propriete);if(erreur){var cell=that._panel.view.getCell(row,colKey);if(!cell)return!0;cell.classList.add("x-form-invalid");var message=messageGen;$.isArray(erreur)?$.each(erreur,function(errKey,uneErreur){typeof uneErreur=="string"?message+=uneErreur+"\n":uneErreur.message&&(message+=uneErreur.message+"\n")}):typeof erreur=="string"?message+=erreur:erreur.message&&(message+=erreur.message),cell.title=message}})})},PanneauTable.prototype.configurer=function(template,donnees){var that=this;this.desactiverDeclencheursVecteur(this.donnees),this.template=template||this.template||{},this.donnees=donnees||this.donnees||[],this.template.titre||(this.template.titre=this.options.titre||"Table"),this.definirTitre(this.template.titre);var fields=[],columnModel=[],colonnes=this.template.colonnes||[];$.each(colonnes,function(key,value){var base="";value.utiliserBase!==!1&&that.template.proprietesBase&&(base=that.template.proprietesBase+"."),fields.push({name:base+value.propriete,type
:value.type,allowBlank:!value.obligatoire,useNull:!0}),columnModel.push(that._obtenirColumnModel(value))});var store=new Ext.data.JsonStore({root:this.template.base,fields:fields});try{store.loadData(that.donnees)}catch(e){console.warn(e)}if(this._panel&&this._panel.store&&this._panel.store.sortInfo){var sortInfo=this._panel.store.sortInfo;store.sort(sortInfo.field,sortInfo.direction)}else store.sort("id","ASC");return this.activerDeclencheursVecteur(this.donnees),this.reconfigurerBarreOutils(this.donnees),this.controles.activerSelection(),{columnModel:new Ext.grid.ColumnModel(columnModel),store:store}},PanneauTable.prototype.reconfigurerBarreOutils=function(){var that=this;if(this.donnees.obtenirTypeClasse&&(this.donnees.obtenirTypeClasse()==="Vecteur"||this.donnees.obtenirTypeClasse()==="VecteurCluster"||this.donnees.obtenirTypeClasse()==="WFS")){this.barreOutils.eteindreOutils(),this.barreOutils.enleverTousOutils();var outils=[];if(this.donnees.options.editable){if(this.donnees.options
.typeGeometriePermise==="Point")outils.push(new OutilDessin({type:"point",couche:this.donnees}));else if(this.donnees.options.typeGeometriePermise==="Ligne")outils.push(new OutilDessin({type:"ligne",couche:this.donnees}));else if(this.donnees.options.typeGeometriePermise==="Polygone")outils.push(new OutilDessin({type:"polygone",couche:this.donnees}));else{var outilsDessin=[];outilsDessin.push(new OutilDessin({type:"point",titre:"Point",couche:this.donnees})),outilsDessin.push(new OutilDessin({type:"ligne",titre:"Ligne",couche:this.donnees})),outilsDessin.push(new OutilDessin({type:"polygone",titre:"Polygone",couche:this.donnees}));var menuDessin=new OutilControleMenu({titre:"Dessin",utiliserSousTitre:!0,outils:outilsDessin});outils.push(menuDessin)}outils.push(new OutilEdition({couche:this.donnees,type:"Vertex"})),outils.push(new Outil({icone:Aide.obtenirCheminRacine()+"images/toolbar/supprimer.png",infobulle:"Supprimer l'occurence",action:function(){var oSelected=that.donnees.obtenirOccurencesSelectionnees
();that.donnees.enleverOccurences(oSelected)}})),outils.push(new Outil({icone:Aide.obtenirCheminRacine()+"images/toolbar/disk.png",infobulle:"Sauvegarder les changements",action:function(){that.retirerErreurs();if(!that.verifierTableau())return Aide.afficherMessage("Sauvegarde impossible","La sauvegarde n'a pas \u00e9t\u00e9 effectu\u00e9e. Veillez v\u00e9rifier que tous les champs sont correctement remplis."),!1;that.donnees.accepterModifications(),that.rafraichir()}})),outils.push(new Outil({icone:Aide.obtenirCheminRacine()+"images/toolbar/annuler.png",infobulle:"Annuler tous les changements",action:function(){that.donnees.annulerModifications(),that.rafraichir()}}))}var menuSelection=new OutilMenu({titre:"S\u00e9lection"});outils.push(menuSelection),this.barreOutils.ajouterOutils(outils);var outilsSelection=[];outilsSelection.push(new OutilTableSelection({type:"efface",couche:this.donnees})),outilsSelection.push(new OutilTableSelection({type:"inverse",couche:this.donnees})),outilsSelection
.push(new OutilTableSelection({type:"complet",couche:this.donnees})),outilsSelection.push(new OutilTableSelection({type:"zoom",couche:this.donnees})),outilsSelection.push(new OutilTableSelection({type:"auto",couche:this.donnees})),menuSelection.ajouterOutils(outilsSelection)}},PanneauTable.prototype.reconfigurer=function(template,donnees){var config=this.configurer(template,donnees);this._panel.reconfigure(config.store,config.columnModel);var that=this;setTimeout(function(){that.afficherErreurs()},1)},PanneauTable.prototype.activerDeclencheursVecteur=function(vecteur){this.donnees.obtenirTypeClasse&&(this.donnees.obtenirTypeClasse()==="Vecteur"||this.donnees.obtenirTypeClasse()==="VecteurCluster"||this.donnees.obtenirTypeClasse()==="WFS")&&(vecteur.ajouterDeclencheur("vecteurOccurenceSelectionnee",this._selectionEvent,{scope:this}),vecteur.ajouterDeclencheur("vecteurOccurenceDeselectionnee",this._deselectionEvent,{scope:this}),vecteur.ajouterDeclencheur("vecteurOccurenceModifiee",this._modificationEvent
,{scope:this}),vecteur.ajouterDeclencheur("ajouterOccurence",this._occurenceAjouteeEvent,{scope:this}),vecteur.ajouterDeclencheur("enleverOccurence",this._occurenceEnleveeEvent,{scope:this}),vecteur.ajouterDeclencheur("enleverCouche",this._coucheEnleveeEvent,{scope:this}))},PanneauTable.prototype.desactiverDeclencheursVecteur=function(vecteur){this.donnees.obtenirTypeClasse&&(this.donnees.obtenirTypeClasse()==="Vecteur"||this.donnees.obtenirTypeClasse()==="VecteurCluster"||this.donnees.obtenirTypeClasse()==="WFS")&&(vecteur.enleverDeclencheur("vecteurOccurenceSelectionnee",undefined,this._selectionEvent),vecteur.enleverDeclencheur("vecteurOccurenceDeselectionnee",undefined,this._deselectionEvent),vecteur.enleverDeclencheur("vecteurOccurenceModifiee",undefined,this._modificationEvent),vecteur.enleverDeclencheur("ajouterOccurence",undefined,this._occurenceAjouteeEvent),vecteur.enleverDeclencheur("enleverOccurence",undefined,this._occurenceEnleveeEvent),vecteur.enleverDeclencheur("enleverCouche"
,undefined,this._coucheEnleveeEvent))},PanneauTable.prototype._selectionEvent=function(e){e.options.scope.selectionnerParOccurences([e.occurence])},PanneauTable.prototype._deselectionEvent=function(e){e.options.scope.deselectionnerParOccurences([e.occurence])},PanneauTable.prototype._modificationEvent=function(e){if(e.modifType=="propriete"){var index=this.obtenirIndexParOccurence(e.occurence);if(index===-1)return!1;var pStore="proprietes."+e.modif.propriete,record=this._panel.store.getAt(index);e.modif.valeur!==record.get(pStore)&&record.set(pStore,e.modif.valeur)}else if(e.modifType=="objetProprietes"){var index=this.obtenirIndexParOccurence(e.occurence);if(index===-1)return!1;var record=this._panel.store.getAt(index);$.each(this._panel.store.fields.items,function(key,field){var oValeur=e.occurence.obtenirPropriete("/"+field.name),rValeur=record.get(field.name);oValeur!==rValeur&&record.set(field.name,oValeur)})}},PanneauTable.prototype._occurenceAjouteeEvent=function(e){e.options.scope
.ajouterOccurences([e.occurence],!0)},PanneauTable.prototype._occurenceEnleveeEvent=function(e){e.options.scope.enleverParOccurences([e.occurence])},PanneauTable.prototype._coucheEnleveeEvent=function(e){if(e.options.scope.parent&&e.options.scope.parent.obtenirTypeClasse()==="PanneauOnglet")return e.options.scope.parent.enleverPanneau(e.options.scope),!0;e.options.scope.reconfigurer({},[])},PanneauTable.prototype.obtenirIndexParEnregistrementHtml=function(html){return this._panel.getView().findRowIndex(html)},PanneauTable.prototype.obtenirIndexParOccurence=function(occurence){return occurence?this._panel.store.indexOfId(occurence.id):-1},PanneauTable.prototype.selectionnerParOccurences=function(occurences){var that=this;$.each(occurences,function(key,value){if(!that._panel.store)return!1;var index=that._panel.store.indexOfId(value.id);if(index===-1)return!0;that.selectionnerParIndex(index,!0)})},PanneauTable.prototype.deselectionnerParOccurences=function(occurences){var that=this;$.each
(occurences,function(key,value){if(!that._panel.store)return!1;var index=that._panel.store.indexOfId(value.id);if(index===-1)return!0;that.deselectionnerParIndex(index)})},PanneauTable.prototype.selectionnerParIndex=function(index,garderSelection,scroll){this._panel.selModel.grid&&!this._panel.selModel.isSelected(index)&&(this._panel.selModel.selectRow(String(index),garderSelection),this._panel.getView().getRow(index)&&scroll!==!1&&this._panel.getView().getRow(index).scrollIntoView(this._panel.getView()))},PanneauTable.prototype.deselectionnerParIndex=function(index){this._panel.selModel.grid&&this._panel.selModel.isSelected(index)&&this._panel.selModel.deselectRow(String(index))},PanneauTable.prototype.obtenirEnregistrementParIndex=function(index){return this._panel.getStore().getAt(index)},PanneauTable.prototype.obtenirEnregistrementParId=function(id){return this._panel.getStore().getById(id)},PanneauTable.prototype.ouvrirTableVecteur=function(vecteur){vecteur=vecteur||this.options.vecteur
;var template={titre:this.options.titre||vecteur.obtenirTitre(),base:"listeOccurences",proprietesBase:"proprietes"};vecteur.templates&&vecteur.templates.table&&$.extend(template,vecteur.templates.table),template.colonnes||(template.proprietesBase="proprietes",template.colonnes=[{utiliserBase:!1,titre:"id",largeur:160,triable:!0,propriete:"id"}],vecteur.listeOccurences[0]&&$.each(vecteur.listeOccurences[0].proprietes,function(key,value){template.colonnes.push({titre:key,largeur:160,triable:!0,propriete:key,editable:vecteur.options.editable})})),this.controles.desactiverSelection(),this.reconfigurer(template,vecteur);var that=this;setTimeout(function(){that.selectionnerParOccurences(vecteur.obtenirOccurencesSelectionnees())},1)},PanneauTable.prototype.rafraichir=function(){this.reconfigurer(),Panneau.prototype.rafraichir.call(this)},PanneauTable.prototype.callbackCreation=function(){Aide.toBoolean(this.options.aContexteMenu)!==!1&&(this.contexteMenu=new ContexteMenuTable({panneauTable:this
,selecteur:"#"+this.obtenirId(),cible:".x-grid3-row"})),Panneau.prototype.callbackCreation.call(this)},PanneauTable.prototype.avantFermeture=function(){this.desactiverDeclencheursVecteur(this.donnees),this.declencher({type:"tableFermeture",donnees:this.donnees}),this.barreOutils.eteindreOutils()},PanneauTable.prototype.mettreAJourDonnees=function(donnees,indicateur){var that=this;$.each(donnees,function(index,feature){that.enreg=that.donnees.obtenirOccurenceParId(feature[indicateur]),that.enreg?$.each(feature.properties,function(key,value){that.enreg.definirPropriete("/"+that.template.proprietesBase+"."+key,value)}):console.log("Occurrence "+feature[indicateur]+" non trouv\u00e9e")}),that.enreg=undefined,that.rafraichir()},PanneauTable.prototype.verifierTableau=function(){var erreurs=this._panel.store.queryBy(function(e){return!e.isValid()});return erreurs.length==0?!0:($.each(erreurs.items,function(index,erreur){var occurrence=erreur.json;$.each(erreur.fields.items,function(index2,field
){!field.allowBlank&&(erreur.data[field.name]===""||erreur.data[field.name]===null)&&occurrence.definirErreur(field.name,{message:"Ce champs est obligatoire"})})}),this.afficherErreurs(),!1)},PanneauTable.prototype.ajouterErreurs=function(donnees,categorie){var that=this;$.each(donnees,function(index,erreur){var occurrence=that.donnees.obtenirOccurenceParId(index);occurrence.definirErreurs(erreur,categorie)}),this.afficherErreurs()},PanneauTable.prototype.retirerErreurs=function(){$.each(this.donnees.listeOccurences,function(key,occurrence){occurrence.erreurs=undefined}),this.afficherErreurs()},PanneauTable.Controles=function(_){this._=_,this.activerSelection()},PanneauTable.Controles.prototype.activerClique=function(){this._._panel.on("rowClick",this.clique,this)},PanneauTable.Controles.prototype.clique=function(grid,rowIndex,e){var json=this._._panel.store.data.items[rowIndex].json;this._.declencher({type:"tableEnregistrementClique",indexEnregistrement:rowIndex,enregistrement:json})},
PanneauTable.Controles.prototype.activerSelection=function(){if(!this._._panel)return!1;this._._panel.selModel.on("selectionchange",this._selection,this)},PanneauTable.Controles.prototype.desactiverSelection=function(){if(!this._._panel)return!1;this._._panel.selModel.removeListener("selectionchange",this._selection,this)},PanneauTable.Controles.prototype._selection=function(selection){var selectionIGO=[];$.each(selection.selections.items,function(key,value){selectionIGO.push(value.json)});var vecteur;this._.donnees.obtenirTypeClasse&&(this._.donnees.obtenirTypeClasse()==="Vecteur"||this._.donnees.obtenirTypeClasse()==="VecteurCluster"||this._.donnees.obtenirTypeClasse()==="WFS")&&(vecteur=this._.donnees,vecteur.deselectionnerTout({exceptions:selectionIGO}),$.each(selectionIGO,function(key,value){if(value.estSelectionnee())return!0;value.selectionner()})),this._.donnees.zoomAuto&&this._.donnees.zoomerOccurences(this._.donnees.obtenirOccurencesSelectionnees()),this._.declencher({type:"tableEnregistrementSelection"
,selection:selectionIGO,vecteur:vecteur})},PanneauTable}),require.ajouterConfig({paths:{IGODatePicker:"libs/extension/Extjs/IGODatePicker"}}),define("dateTimeIntervalPicker",["fonctions","IGODatePicker"],function(Fonctions,IGODatePicker){var DateTimeIntervalPicker=Ext.extend(Ext.Component,{startDate:new Date,endDate:new Date,active:!1,mapServerTimeString:"",label:"Date",allowIntervals:!0,minStartDate:null,maxEndDate:null,precision:"seconde",getValue:function(){var retStr=null,y1=this.startDate.getUTCFullYear().toString(),m1="";this.startDate.getUTCMonth()<9?m1="0"+(this.startDate.getUTCMonth()+1).toString():m1=(this.startDate.getUTCMonth()+1).toString();var d1="";this.startDate.getUTCDate()<10?d1="0"+this.startDate.getUTCDate().toString():d1=this.startDate.getUTCDate().toString();var h1="";this.startDate.getUTCHours()<10?h1="0"+this.startDate.getUTCHours().toString():h1=this.startDate.getUTCHours().toString();switch(this.precision){case"seconde":var startDateMapServerString=y1+"-"+m1+"-"+
d1+"T"+h1+":00:00";break;case"minute":var startDateMapServerString=y1+"-"+m1+"-"+d1+"T"+h1+":00";break;case"heure":var startDateMapServerString=y1+"-"+m1+"-"+d1+"T"+h1;break;case"jour":var startDateMapServerString=y1+"-"+m1+"-"+d1;break;case"mois":var startDateMapServerString=y1+"-"+m1;break;case"annee":var startDateMapServerString=y1;break;default:var startDateMapServerString=y1+"-"+m1+"-"+d1+"T"+h1+":00:00Z"}if(this.allowIntervals){var y2=this.endDate.getUTCFullYear().toString(),m2="";this.endDate.getUTCMonth()<9?m2="0"+(this.endDate.getUTCMonth()+1).toString():m2=(this.endDate.getUTCMonth()+1).toString();var d2="";this.endDate.getUTCDate()<10?d2="0"+this.endDate.getUTCDate().toString():d2=this.endDate.getUTCDate().toString();var h2="";this.endDate.getUTCHours()<10?h2="0"+this.endDate.getUTCHours().toString():h2=this.endDate.getUTCHours().toString();switch(this.precision){case"seconde":var endDateMapServerString=y2+"-"+m2+"-"+d2+"T"+h2+":00:00";break;case"minute":var endDateMapServerString=
y2+"-"+m2+"-"+d2+"T"+h2+":00";break;case"heure":var endDateMapServerString=y2+"-"+m2+"-"+d2+"T"+h2;break;case"jour":var endDateMapServerString=y2+"-"+m2+"-"+d2;break;case"mois":var endDateMapServerString=y2+"-"+m2;break;case"annee":var endDateMapServerString=y2;break;default:var endDateMapServerString=y2+"-"+m2+"-"+d2+"T"+h2+":00:00Z"}var retStr=startDateMapServerString+"/"+endDateMapServerString}else var retStr=startDateMapServerString;return retStr},initComponent:function(){Ext.apply(this,{}),DateTimeIntervalPicker.superclass.initComponent.apply(this,arguments),this.addEvents("intervalChanged"),this.handler&&this.on("intervalChanged",this.handler,this.scope||this),this.label="Date ",this.layer.params["TIME"]!=undefined&&this.layer.params["TIME"]!=""&&(this.mapServerTimeString=this.layer.params.TIME);if(undefined!=this.mapServerTimeString&&""!=this.mapServerTimeString){var mapServerFormatIntervalStrArray=this.mapServerTimeString.split("/"),startfilterdtg=Fonctions.createDateFromIsoString
(mapServerFormatIntervalStrArray[0]),endfilterdtg=new Date;this.allowIntervals&&mapServerFormatIntervalStrArray[1]!=undefined&&(endfilterdtg=Fonctions.createDateFromIsoString(mapServerFormatIntervalStrArray[1])),this.startDate=startfilterdtg,this.endDate=endfilterdtg,this.allowIntervals?this.label="Date : "+startfilterdtg.toLocaleDateString()+" - "+endfilterdtg.toLocaleDateString():this.label="Date : "+startfilterdtg.toLocaleDateString(),this.active=!0}},sameDate:function(date1,date2){return date1.getFullYear()-date2.getFullYear()==0&&date1.getMonth()-date2.getMonth()==0&&date1.getDate()-date2.getDate()==0},onRender:function(container,position){DateTimeIntervalPicker.superclass.onRender.apply(this,arguments);var html=null;this.allowIntervals?this.ajoutDivHeure()?html="<div id='dtgDiv1'></div><div id='hd'>Heure Debut (UTC):</div><div id='slider1'></div><div id='dtgDiv2'></div><div id='hf'>Heure Fin (UTC):</div><div id='slider2'></div><div id='enableDiv'></div>":html="<div id='dtgDiv1'></div><div id='slider1'></div><div id='dtgDiv2'></div><div id='slider2'></div><div id='enableDiv'></div>"
:this.ajoutDivHeure?html="<div id='dtgDiv1'></div><div id='hd'>Heure (UTC):</div><div id='slider1'></div><div id='searchDayDiv'></div><div id='searchNightDiv'></div><div id='enableDiv'></div>":html="<div id='dtgDiv1'></div><div id='searchDayDiv'></div><div id='searchNightDiv'></div><div id='enableDiv'></div>";var el=document.createElement("div");el.className="x-date-picker",el.innerHTML=html,container.dom.insertBefore(el,position);var dtg1=new IGODatePicker({renderTo:"dtgDiv1"});dtg1.setValue(this.startDate),dtg1.setMaxDate(this.endDate),this.minStartDate!=null&&dtg1.setMinDate(this.minStartDate),this.allowIntervals||dtg1.setMaxDate(this.maxEndDate);var startHourNumberField=new Ext.form.NumberField({id:"startHour",fieldLabel:"Heure (UTC)",name:"Start Hour",renderTo:"slider1",decimalPrecision:1,value:this.startDate.getHours(),minValue:0,maxValue:23,hidden:!this.ajoutDivHeure()});if(this.allowIntervals)var endHourNumberField=new Ext.form.NumberField({id:"endHour",fieldLabel:"Heure (UTC)",
name:"End Hour",renderTo:"slider2",decimalPrecision:1,value:this.endDate.getHours(),minValue:0,maxValue:23,hidden:!this.ajoutDivHeure()});if(this.allowIntervals){var dtg2=new IGODatePicker({renderTo:"dtgDiv2"});dtg2.setValue(this.endDate),dtg2.setMinDate(this.startDate),this.maxEndDate!=null&&dtg2.setMaxDate(this.maxEndDate)}var enableCheckbox=new Ext.form.Checkbox({id:"enableCheckBox",renderTo:"enableDiv",boxLabel:"Activer le filtre"});this.active||(dtg1.setDisabled(!0),this.allowIntervals&&(dtg2.setDisabled(!0),endHourNumberField.setDisabled(!0)),startHourNumberField.setDisabled(!0)),enableCheckbox.setValue(this.active);var me=this;this.allowIntervals||(me.sameDate(me.maxEndDate,dtg1.getValue())?(startHourNumberField.getValue()>me.maxEndDate.getHours()&&startHourNumberField.setValue(me.maxEndDate.getHours()),startHourNumberField.setMaxValue(me.maxEndDate.getHours())):startHourNumberField.setMaxValue(23),me.sameDate(me.minStartDate,dtg1.getValue())?(startHourNumberField.setMinValue(me.
minStartDate.getHours()),startHourNumberField.getValue()<me.minStartDate.getHours()&&startHourNumberField.setValue(me.minStartDate.getHours())):startHourNumberField.setMinValue(0)),enableCheckbox.on("check",function(e){var enableComponents=enableCheckbox.getValue();dtg1.setDisabled(!enableComponents),me.allowIntervals&&(dtg2.setDisabled(!enableComponents),endHourNumberField.setDisabled(!enableComponents)),startHourNumberField.setDisabled(!enableComponents),me.active=enableComponents,me.fireEvent("intervalChanged",me)}),dtg1.on("select",function(e,date){me.allowIntervals?(dtg2.setMinDate(date),dtg1.getValue()-dtg2.getValue()==0&&startHourNumberField.getValue()>endHourNumberField.getValue()&&startHourNumberField.setValue(endHourNumberField.getValue())):(startHourNumberField.setMinValue(0),startHourNumberField.setMaxValue(23),me.sameDate(me.maxEndDate,dtg1.getValue())?(startHourNumberField.getValue()>me.maxEndDate.getHours()&&startHourNumberField.setValue(me.maxEndDate.getHours()),startHourNumberField
.setMaxValue(me.maxEndDate.getHours())):startHourNumberField.setMaxValue(23),me.sameDate(me.minStartDate,dtg1.getValue())?(startHourNumberField.getValue()<me.minStartDate.getHours()&&startHourNumberField.setValue(me.minStartDate.getHours()),startHourNumberField.setMinValue(me.minStartDate.getHours())):startHourNumberField.setMinValue(0)),me.startDate.setDate(dtg1.getValue().getDate()),me.startDate.setMonth(dtg1.getValue().getMonth()),me.startDate.setFullYear(dtg1.getValue().getFullYear()),me.fireEvent("intervalChanged",me)}),startHourNumberField.on("change",function(field,newValue){document.getElementById("hd").innerHTML="Heure Debut (UTC): "+newValue.toString()+"H",me.allowIntervals&&dtg1.getValue()-dtg2.getValue()==0&&endHourNumberField.getValue()<newValue&&endHourNumberField.setValue(newValue),me.startDate.setHours(newValue),me.fireEvent("intervalChanged",me)}),this.allowIntervals&&dtg2.on("select",function(e,date){dtg1.setMaxDate(date),dtg1.getValue()-dtg2.getValue()==0&&startHourNumberField
.getValue()>endHourNumberField.getValue()&&endHourNumberField.setValue(startHourNumberField.getValue()),me.endDate.setDate(dtg2.getValue().getDate()),me.endDate.setMonth(dtg2.getValue().getMonth()),me.endDate.setFullYear(dtg2.getValue().getFullYear()),me.fireEvent("intervalChanged",me)}),me.allowIntervals&&endHourNumberField.on("change",function(field,newValue){document.getElementById("hf").innerHTML="Heure Fin (UTC): "+newValue.toString()+"H",dtg1.getValue()-dtg2.getValue()==0&&startHourNumberField.getValue()>endHourNumberField&&startHourNumberField.setValue(newValue),me.endDate.setHours(newValue),me.fireEvent("intervalChanged",me)}),this.on("intervalChanged",function(e){e.active?e.layer.mergeNewParams({time:e.getValue()}):(delete e.layer.params.TIME,e.layer.redraw())})},ajoutDivHeure:function(){return this.precision=="seconde"||this.precision=="minute"||this.precision=="heure"?!0:!1}});return Ext.reg("datetimeinvervalpicker",DateTimeIntervalPicker),DateTimeIntervalPicker}),require.ajouterConfig
({paths:{dateTimeIntervalPicker:"libs/extension/Extjs/DateTimeIntervalPicker"}}),define("contexteMenuArborescence",["contexteMenu","aide","fonctions","metadonnee","panneauTable","dateTimeIntervalPicker"],function(ContexteMenu,Aide,Fonctions,Metadonnee,PanneauTable,DateTimeIntervalPicker){function ContexteMenuArborescence(options){this.options=options||{},this.locale={deleteLayerText:"Effacer la couche",deleteLayerConfirmationText:"\u00cates-vous certain de vouloir effacer cette couche: ",changeOpacityText:"Changer l'opacit\u00e9",changeStyleText:"Changer la couleur",bringToText:"Mettre en",frontText:"avant",backText:"arri\u00e8re",closeText:"Fermer",mspMetadataText:"Informations sur la couche"},this.init()}return ContexteMenuArborescence.prototype=new ContexteMenu,ContexteMenuArborescence.prototype.constructor=ContexteMenuArborescence,ContexteMenuArborescence.prototype.init=function(){ContexteMenu.prototype.init.call(this),this.ajouterFonctionsConstruction(this.initOpaciteSubmenu),this.
ajouterFonctionsConstruction(this.initStyleSubmenu),this.ajouterFonctionsConstruction(this.initOrdreAffichageSubmenu),this.ajouterFonctionsConstruction(this.initOuvrirTableVecteur),this.ajouterFonctionsConstruction(this.initZoomEmprise),this.ajouterFonctionsConstruction(this.initSelectionnerTout),this.ajouterFonctionsConstruction(this.initActiverImportationSubmenu),this.ajouterFonctionsConstruction(this.initWMStime),this.ajouterFonctionsConstruction(this.initMetadonneeSubmenu),this.ajouterFonctionsConstruction(this.initSupprimerVecteurSubmenu),this.ajouterFonctionsConstruction(this.initFermerSubmenu)},ContexteMenuArborescence.prototype.obtenirInformation=function(e){var nodeHtml,$target=$(e.target);$target[0].attributes["ext:tree-node-id"]?nodeHtml=$target:nodeHtml=$target.parentsUntil(this.$selecteur,".x-tree-node-el");if(nodeHtml.length===0)return!1;var id=nodeHtml[0].attributes["ext:tree-node-id"].value,node=this.options.arborescence._panel.nodeHash[id];if(!node.layer)return!1;var gestionCouches=
this.options.arborescence.carte.gestionCouches,layer=gestionCouches.obtenirCoucheParId(node.attributes.layer.id);return layer?{couche:layer,nodeHtml:nodeHtml}:!1},ContexteMenuArborescence.prototype.initStyleSubmenu=function(args){var that=args.scope;return Aide.toBoolean(args.couche.options.styleSubmenu)?{id:"arborescenceStyle",text:that.locale.changeStyleText,menu:{id:"arborescenceStyleCouleur",plain:!0,items:{html:"<button id='picker'></button>",listeners:{afterrender:function(){var $picker=$("#picker");require.estDansConfig("colpick")||require.ajouterConfig({paths:{colpick:"libs/jquery/extensions/color-picker/js/colpick"},shim:{colpick:{deps:["css!libs/jquery/extensions/color-picker/css/colpick"]}}});var couleur=args.couche.obtenirStyle().obtenirPropriete("couleur");if(couleur[0]!=="#"){var splitValeur=couleur.split(" ");splitValeur.length===3?couleur=Fonctions.rgbToHex(Number(splitValeur[0]),Number(splitValeur[1]),Number(splitValeur[2])):couleur=""}requirejs(["colpick"],function(){$picker
.colpick({layout:"rgbhex",submit:!0,submitText:"Appliquer",color:couleur.substr(1),onChange:function(hsb,hex,rgb,el,bySetColor){$(el).css("background-color","#"+hex),bySetColor||$(el).val(hex)},onSubmit:function(){args.couche.obtenirStyle().definirPropriete("couleur","#"+$picker.val())}}).keyup(function(){$(this).colpickSetColor(this.value)})}),$picker.val(couleur.substr(1)),$picker.css("background-color",couleur),$picker.css("height","25px"),$picker.css("width","50px"),$picker.parent().css("padding","2px")}},handler:function(){return!1}}}}:!1},ContexteMenuArborescence.prototype.initOpaciteSubmenu=function(args){if(args.couche.options.opaciteSlider!==!1){var that=args.scope,sliderOptions={layer:args.couche._layer,width:200};return sliderOptions.plugins=new GeoExt.SliderTip,{id:"arborescenceOpacite",text:that.locale.changeOpacityText,menu:{id:"arborescenceOpacitySlider",plain:!0,items:[new GeoExt.LayerOpacitySlider(sliderOptions)]}}}},ContexteMenuArborescence.prototype.initWMStime=function(
args){if(args.couche.options.wms_timeextent){var timeExtentArray=args.couche.options.wms_timeextent.split("/"),startDate=Fonctions.createDateFromIsoString(timeExtentArray[0]),endDate=null,allowIntervals=null;timeExtentArray.length>1?(endDate=Fonctions.createDateFromIsoString(timeExtentArray[1]),allowIntervals=!0):(endDate=null,allowIntervals=!1),args.couche.options.wms_timeAllowIntervals&&(allowIntervals=Aide.toBoolean(args.couche.options.wms_timeAllowIntervals));var datePicker=new DateTimeIntervalPicker({id:"datePicker",layer:args.couche._layer,allowIntervals:allowIntervals,minStartDate:startDate,maxEndDate:endDate,mapServerTimeString:args.couche.options.wms_timedefault,precision:args.couche.options.wms_timeprecision||"minute"});return{id:"arborescenceWMST",text:datePicker.label,menu:{plain:!0,items:[datePicker]}}}if(args.couche._layer.options.metadata&&args.couche._layer.options.metadata.dimensions.time){var startDate=null,endDate=null;if(args.couche._layer.options.metadata.extents&&args
.couche._layer.options.metadata.extents.time){var timeExtentArray=args.couche._layer.options.metadata.extents.time.values[0].split("/");startDate=Fonctions.createDateFromIsoString(timeExtentArray[0]),endDate=Fonctions.createDateFromIsoString(timeExtentArray[1])}else if(args.couche._layer.options.metadata.dimensions.time.values){var timeExtentArray=args.couche._layer.options.metadata.dimensions.time.values[0].split("/");startDate=Fonctions.createDateFromIsoString(timeExtentArray[0]),endDate=Fonctions.createDateFromIsoString(timeExtentArray[1])}var datePicker=new DateTimeIntervalPicker({id:"datePicker",layer:args.couche._layer,allowIntervals:endDate!==null?!0:!1,minStartDate:startDate,maxEndDate:endDate,mapServerTimeString:args.couche._layer.options.metadata.dimensions.time["default"],precision:"minute"});return{id:"arborescenceWMST",text:datePicker.label,menu:{plain:!0,items:[datePicker]}}}},ContexteMenuArborescence.prototype.initSupprimerVecteurSubmenu=function(args){var that=args.scope
;if(args.couche._layer.allowDelete||args.couche.options.suppressionPermise)return{id:"arborescenceDeleteLayer",text:that.locale.deleteLayerText,handler:function(){Aide.afficherMessage({title:that.locale.deleteLayerText,message:that.locale.deleteLayerConfirmationText+args.couche.obtenirTitre(),boutons:"OUINON",action:function(btn){if(btn=="yes"){var gestionCouches=that.options.arborescence.carte.gestionCouches;gestionCouches.enleverCouche(args.couche)}}})}}},ContexteMenuArborescence.prototype.initMetadonneeSubmenu=function(args){var that=args.scope;if(args.couche.options.metadonnee)return{id:"arborescenceMetadonnee",text:that.locale.mspMetadataText,handler:function(){Metadonnee.getLayerCapabilities(args.couche)}}},ContexteMenuArborescence.prototype.initActiverImportationSubmenu=function(args){if(args.couche.options.importationWFS){var coucheWFS=args.couche,coucheWFSActive=coucheWFS.carte.gestionCouches.coucheWFSActive,text="Activer importation";return coucheWFSActive==coucheWFS&&(text="Desactiver importation"
,coucheWFS=undefined),{id:"arborescenceActiverImportation",text:text,handler:function(){coucheWFSActive&&coucheWFSActive._nodeHtml.css("background-color",""),coucheWFS&&(args.nodeHtml.css("background-color","#c8dbc9"),coucheWFS._nodeHtml=args.nodeHtml),args.couche.carte.gestionCouches.coucheWFSActive=coucheWFS}}}},ContexteMenuArborescence.prototype.initZoomEmprise=function(args){if(args.couche.obtenirTypeClasse()==="Vecteur"||args.couche.obtenirTypeClasse()==="VecteurCluster"||args.couche.obtenirTypeClasse()==="WFS")return{id:"arborescenceZoomEmpriseVecteur",text:"Zoom sur l'emprise",handler:function(){args.couche.zoomerOccurences()}}},ContexteMenuArborescence.prototype.initSelectionnerTout=function(args){if(args.couche.obtenirTypeClasse()==="Vecteur")return{id:"arborescenceSelectionnerToutVecteur",text:"S\u00e9lectionner tout",handler:function(){args.couche.selectionnerTout()}}},ContexteMenuArborescence.prototype.initOuvrirTableVecteur=function(args){var that=args.scope,arbo=that.options
.arborescence,aPanneauTable=!1,panneauTable;if(arbo.options.idResultatTable&&(args.couche.obtenirTypeClasse()==="Vecteur"||args.couche.obtenirTypeClasse()==="WFS"||args.couche.obtenirTypeClasse()==="VecteurCluster")){var nav=Aide.obtenirNavigateur();panneauTable=nav.obtenirPanneauParId(arbo.options.idResultatTable,-1),panneauTable&&panneauTable.obtenirTypeClasse&&(aPanneauTable=!0)}if(aPanneauTable)return{id:"OuvrirTableVecteur",text:"Ouvrir table propri\u00e9t\u00e9s",handler:function(){if(panneauTable.obtenirTypeClasse()==="PanneauTable")panneauTable.ouvrirTableVecteur(args.couche);else if(panneauTable.obtenirTypeClasse()==="PanneauOnglet"){var existe=!1;$.each(panneauTable.listeOnglets,function(value,onglet){if(onglet.donnees===args.couche)return panneauTable.activerPanneau(onglet),existe=!0,!1});if(!existe){var nouvelleTable=new PanneauTable({reductible:!1,fermable:!0});panneauTable.ajouterPanneau(nouvelleTable),panneauTable.activerPanneau(nouvelleTable),nouvelleTable.ouvrirTableVecteur
(args.couche)}}}}},ContexteMenuArborescence.prototype.initOrdreAffichageSubmenu=function(args){var that=args.scope;return args.couche.estFond()?!1:{id:"arborescenceOrdre",text:that.locale.bringToText,menu:{plain:!0,items:[{text:that.locale.frontText,handler:function(){args.couche.definirOrdreAffichage(29999)}},{text:that.locale.backText,handler:function(){args.couche.definirOrdreAffichage(1e4)}}]}}},ContexteMenuArborescence.prototype.initFermerSubmenu=function(args){var that=args.scope;return{id:"arborescenceClose",text:that.locale.closeText}},ContexteMenuArborescence}),define("OSM",["couche"],function(Couche){function OSM(options){this.options=options||{},this.options.fond=!0,this.defautOptions={titre:"OpenStreetMap"},this._optionsOL={printOptions:!1},this._init()}return OSM.prototype=new Couche,OSM.prototype.constructor=OSM,OSM.prototype._init=function(){Couche.prototype._init.call(this);var type=null;if(this.options.nom)switch(this.options.nom.toLowerCase()){case"velo":type=[window.location
.protocol+"//a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",window.location.protocol+"//b.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",window.location.protocol+"//c.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png"];break;case"humanitaire":var HOTAttribution='<table><tr><td>\u00a9 Contributions<a href="http://hot.openstreetmap.org/" target="_blank"></a></td><td><a class="styleAttributionTable" href="http://hot.openstreetmap.org/" target="_blank"> OpenStreetMap</a> Humanitaire</td></tr></table>',get_my_url=function(bounds){var res=this.map.getResolution(),x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w)),y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h)),z=this.map.getZoom(),path=z+"/"+x+"/"+y+"."+this.type,url=this.url;return url instanceof Array&&(url=this.selectUrl(path,url)),url+path};this.options.url=window.location.protocol+"//a.tile.openstreetmap.fr/hot/",this.options._optionsOL=$.extend(this._optionsOL,{type:"png",getURL:get_my_url,numZoomLevels
:19,transitionEffect:"null",attribution:HOTAttribution}),this._layer=(new Igo.Couches.TMS(this.options))._layer;return;case"defaut":default:type=null}this._layer=new OpenLayers.Layer.OSM(this.options.titre,type,this._optionsOL)},OSM}),define("TMS",["couche","aide"],function(Couche,Aide){function TMS(options){this.options=options||{};if(!this.options.titre||!this.options.url||!this.options.nom)throw new Error("Igo.TMS a besoin d'un titre, d'un url et d'un nom");this._optionsOL=this.options._optionsOL||{layername:options.nom,type:options.format==null?"png":options.format,maxZoomLevel:options.zoomMax==null?null:Number(options.zoomMax),minZoomLevel:options.zoomMin==null?null:Number(options.zoomMin)},Aide.toBoolean(this.options.utiliserProxy)&&(this.options.url=Aide.utiliserProxy(this.options.url,!0)),this._init()}return TMS.prototype=new Couche,TMS.prototype.constructor=TMS,TMS.prototype._init=function(){Couche.prototype._init.call(this),this._layer=new OpenLayers.Layer.TMS(this.options.titre
,this.options.url,this._optionsOL)},TMS}),define("google",["couche","aide"],function(Couche,Aide){var trafficLayer=!1;function Google(options){this.options=options||{},this.options.fond=!0,this.options.opaciteSlider=!1,this._optionsOL={sphericalMercator:!0,numZoomLevels:20,printOptions:!1,visibility:!0}}return Google.prototype=new Couche,Google.prototype.constructor=Google,Google.prototype._init=function(){var type=google.maps.MapTypeId.ROADMAP;if(this.options.nom)switch(this.options.nom.toLowerCase()){case"terrain":type=google.maps.MapTypeId.TERRAIN;break;case"satellite":type=google.maps.MapTypeId.SATELLITE;break;case"hybride":type=google.maps.MapTypeId.HYBRID;break;case"route":default:type=google.maps.MapTypeId.ROADMAP}this._optionsOL.type=type,Couche.prototype._init.call(this),this.options.titre||(this.options.titre="Google"),this._layer=new OpenLayers.Layer.Google(this.options.titre,this._optionsOL)},Google.prototype._ajoutCallback=function(target,callback,optCallback){var that=this
,options=$.extend({},that.defautOptions,Aide.obtenirConfig(that.obtenirTypeClasse()),that.options),googleConnexion=options.url?window.location.protocol+options.url:window.location.protocol+"//maps.google.com/maps/api/js?sensor=false";options.client?(googleConnexion+="&client="+options.client,options.signature&&(googleConnexion+="&signature="+options.signature),options.channel&&(googleConnexion+="&channel="+options.channel)):options.key&&(googleConnexion+="&key="+options.key),require(["async!"+googleConnexion],function(){that._init(),Couche.prototype._ajoutCallback.call(that,target,callback,optCallback);var nav=Aide.obtenirNavigateur(),arbo=nav.obtenirPanneauxParType("Arborescence",2)[0];if(arbo)return that._ajouterContexteSubmenu(arbo.contexteMenu),!0;nav.evenements.obtenirDeclencheur("initArborescence","googleAjouterContexteSubmenu").length||nav.evenements.ajouterDeclencheur("initArborescence",function(e){that._ajouterContexteSubmenu(e.target.contexteMenu),nav.evenements.enleverDeclencheur
("initArborescence","googleAjouterContexteSubmenu")},{id:"googleAjouterContexteSubmenu"})},function(err){Aide.afficherMessage("Google indisponible","Impossible d'ajouter la couche Google","Ok","Error")})},Google.prototype.activerTrafic=function(){trafficLayer||(trafficLayer=new google.maps.TrafficLayer),trafficLayer.setMap(this._layer.mapObject)},Google.prototype.desactiverTrafic=function(){trafficLayer.setMap()},Google.prototype.aTrafic=function(){return trafficLayer},Google.prototype._ajouterContexteSubmenu=function(contexteMenu){if(contexteMenu._googleSubmenuBool)return!0;contexteMenu._googleSubmenuBool=!0;var that=this;contexteMenu.ajouter({id:"afficherTraficGoogle",titre:"Afficher traffic",action:function(args){args.couche.activerTrafic(),args.couche.activer()},condition:function(args){return args.couche.obtenirTypeClasse()==="Google"&&(!trafficLayer||!trafficLayer.getMap())},position:3}),contexteMenu.ajouter({id:"cacherTraficGoogle",titre:"Cacher traffic",action:function(args){args
.couche.desactiverTrafic()},condition:function(args){return args.couche.obtenirTypeClasse()==="Google"&&trafficLayer&&trafficLayer.getMap()},position:3})},Google}),define("marqueurs",["couche","aide","limites"],function(Couche,Aide,Limites){function Marqueurs(options){this.options=options||{},this._init()}return Marqueurs.prototype=new Couche,Marqueurs.prototype.constructor=Marqueurs,Marqueurs.prototype._init=function(){Couche.prototype._init.call(this);var titre=this.options.titre||"marqueurs";this._layer=new OpenLayers.Layer.Markers(titre,this._optionsOL)},Marqueurs.prototype.ajouterMarqueur=function(point,icone,dimension,decalage){dimension=dimension||[21,25];var w=dimension[0],h=dimension[1],sizeOL=new OpenLayers.Size(w,h);decalage=decalage||[-(sizeOL.w/2),-sizeOL.h];var offX=decalage[0],offY=decalage[1],offsetOL=new OpenLayers.Pixel(offX,offY),url=Aide.utiliserBaseUri(icone||"images/marqueur/marker-blue.png"),icon=new OpenLayers.Icon(url,sizeOL,offsetOL);this._getLayer().addMarker(new 
OpenLayers.Marker(point._obtenirLonLatOL(),icon))},Marqueurs.prototype.enleverMarqueurs=function(){this._getLayer().clearMarkers()},Marqueurs.prototype.obtenirOrdreAffichageBase=function(){return this.carte._getCarte().Z_INDEX_BASE.Vecteur},Marqueurs.prototype.zoomerMarqueurs=function(maxZoom){var limitesOL=this._layer.getDataExtent();if(!limitesOL)return!1;var limites=new Limites(limitesOL.left,limitesOL.bottom,limitesOL.right,limitesOL.top);this.carte.zoomer(limites,maxZoom)},Marqueurs}),define("cluster",["occurence"],function(Occurence){function Cluster(geometrie,listeOccurences,proprietes,style,opt){this.listeOccurences=listeOccurences,this._init(geometrie,proprietes,style,opt)}return Cluster.prototype=Object.create(Occurence.prototype),Cluster.prototype.constructor=Cluster,Cluster.prototype.selectionner=function(tout){tout&&$.each(this.listeOccurences,function(key2,occ){occ.estSelectionnee()||occ.selectionner()}),Occurence.prototype.selectionner.call(this)},Cluster.prototype.deselectionner=
function(tout){tout&&$.each(this.listeOccurences,function(key2,occ){occ.estSelectionnee()&&occ.deselectionner()}),Occurence.prototype.deselectionner.call(this)},Cluster}),define("vecteurCluster",["vecteur","occurence","aide","style","cluster"],function(Vecteur,Occurence,Aide,Style,Cluster){function VecteurCluster(options){this.options=options||{},this.garderHistorique=this.options.garderHistorique,this._historiqueOccurencesAjoutees=[],this._historiqueOccurencesEnlevees=[],this.defautOptions.selectionnable=!0,this.listeOccurences=[],this.listeClusters=[],this.styles={},this.templates={},this._init()}return VecteurCluster.prototype=new Vecteur,VecteurCluster.prototype.constructor=VecteurCluster,VecteurCluster.prototype._init=function(){var that=this;this.defautOptions.styles={defaut:{rayon:"${radius}",couleur:"#ffcc66",opacite:.8,limiteCouleur:"#cc6633",contexte:{radius:function(occurence){var rayonMin=that.options.rayonMin||2,rayonMax=that.options.rayonMax||7,pix=rayonMin;return occurence?
occurence.obtenirTypeClasse()==="Cluster"&&(pix=Math.min(occurence.obtenirPropriete("count"),rayonMax)+rayonMin):pix=Number(rayonMin)+2,pix}}}},this._optionsOL={strategies:[new OpenLayers.Strategy.Cluster({threshold:this.options.seuilCluster||1,distance:this.options.distance||20,shouldCluster:$.proxy(this._shouldCluster,this)})]},Vecteur.prototype._init.call(this)},VecteurCluster.prototype._shouldCluster=function(cluster,feature){if(this.options.clusteriser){var clusterIgo=new Cluster(cluster,undefined,undefined,undefined,{_keepFeature:!0});return this.options.clusteriser(clusterIgo,this.obtenirOccurenceParId(feature.id))}var zoom=this.carte.obtenirZoom();if(this.options.clusterZoomMax&&this.options.clusterZoomMax<zoom)return!1;var strategie=this._optionsOL.strategies[0],cc=cluster.geometry.getBounds().getCenterLonLat(),fc=feature.geometry.getBounds().getCenterLonLat(),distance=Math.sqrt(Math.pow(cc.lon-fc.lon,2)+Math.pow(cc.lat-fc.lat,2))/strategie.resolution;return distance<=strategie
.distance},VecteurCluster.prototype._ajoutCallback=function(target,callback,optCallback){var that=this;this._layer.events.register("moveend",this._layer.strategies[0],function(event){that._layer.events.unregister("moveend",this,this.cluster);if(that.carte.obtenirZoom()===that.zoomPrecedent)return!0;that.zoomPrecedent=that.carte.obtenirZoom();if(that.listeOccurences.length&&!this.clustering&&(!event||event.zoomChanged)&&this.features){var resolution=this.layer.map.getResolution();if(resolution!=this.resolution||!this.clustersExist())this.cluster(),that.definirClusters()}}),Vecteur.prototype._ajoutCallback.call(this,target,callback,optCallback)},VecteurCluster.prototype.appliquerCluster=function(){var listFeatures=[];$.each(this.listeOccurences,function(key,value){listFeatures.push(value._feature)}),this._layer.removeAllFeatures(),this._layer.addFeatures(listFeatures),this.definirClusters()},VecteurCluster.prototype.definirClusters=function(){var that=this,cluster=[];return $.each(this.listeClusters
,function(key,value){value.vecteur=undefined,that.carte.gestionCouches.enleverOccurenceSurvol(value)}),$.each(this._layer.features,function(key,value){var listeOccurences=[];if(value.cluster){$.each(value.cluster,function(key2,value2){var occ=that.obtenirOccurenceParId(value2.id);occ&&(occ.estDansCluster=!0,listeOccurences.push(occ))});var clusterT=new Cluster(value,listeOccurences,undefined,undefined,{_keepFeature:!0});clusterT.vecteur=that,cluster.push(clusterT)}else{var occ=that.obtenirOccurenceParId(value.id);occ.estDansCluster=!1}}),this.listeClusters=cluster,this.rafraichirClusters(),cluster},VecteurCluster.prototype.rafraichirClusters=function(reset){$.each(this.obtenirClusters(),function(key,cluster){var doitSelectionner=reset?!1:cluster.estSelectionnee();doitSelectionner||$.each(cluster.listeOccurences,function(key2,occ){if(occ.estSelectionnee())return doitSelectionner=!0,!1}),doitSelectionner&&!cluster.estSelectionnee()?cluster.selectionner():!doitSelectionner&&cluster.estSelectionnee
()&&cluster.deselectionner()}),this.rafraichir()},VecteurCluster.prototype.obtenirClusters=function(){return this.listeClusters},VecteurCluster.prototype.obtenirClusterParId=function(id){var cluster;return $.each(this.obtenirClusters(),function(key,value){if(value.id===id)return cluster=value,!1}),cluster},VecteurCluster.prototype.obtenirClusterParOccurence=function(occurence){var cluster;return $.each(this.obtenirClusters(),function(key,clusterT){$.each(clusterT.listeOccurences,function(key2,value){if(value.id===occurence.id)return cluster=clusterT,!1});if(cluster)return!1}),cluster},VecteurCluster.prototype.ajouterOccurence=function(occurence,opt){opt=opt||{},Vecteur.prototype.ajouterOccurence.call(this,occurence,opt),opt.tableauOccurences||this.appliquerCluster()},VecteurCluster.prototype.ajouterOccurences=function(occurences,opt){opt=opt||{},opt.tableauOccurences=!0,Vecteur.prototype.ajouterOccurences.call(this,occurences,opt),this.appliquerCluster()},VecteurCluster.prototype.enleverOccurence=
function(occurence,opt){opt=opt||{},Vecteur.prototype.enleverOccurence.call(this,occurence,opt),opt.tableauOccurences||this.appliquerCluster()},VecteurCluster.prototype.enleverOccurences=function(occurences,opt){opt=opt||{},opt.tableauOccurences=!0,Vecteur.prototype.enleverOccurences.call(this,occurences,opt),this.appliquerCluster()},VecteurCluster.prototype.enleverTout=function(opt){this.enleverOccurences(this.listeOccurences,opt)},VecteurCluster}),define("requireAide",["aide"],function(Aide){require.estDansConfig=function(indice){return require.s.contexts._.config.paths[indice]?!0:!1},require.ajouterConfig=function(conf){var debug=Aide.obtenirDebug(),base="";conf.baseUrl&&(base=Aide.utiliserBaseUri(conf.baseUrl));var paths={};$.each(conf.paths,function(key,value){if(debug&&(!conf.scope&&require.s.contexts._.config.paths[key]||require.s.contexts._.config.map&&require.s.contexts._.config.map[conf.scope]&&require.s.contexts._.config.map[conf.scope][key]))console.warn(key+" existe d\u00e9j\u00e0 dans la config"
);else{var path=Aide.utiliserBaseUri(value,base);debug?path=path.replace("%-build%","Require"):path=path.replace("%-build%","-build"),paths[key]=path;if(conf.shim&&conf.shim[key]&&conf.shim[key].depsEnOrdre)for(var i=conf.shim[key].depsEnOrdre.length-1;i>0;i--){var plugin="",dep=conf.shim[key].depsEnOrdre[i];if(!dep.match(/:\/\//)){var splitPath=dep.split("!");splitPath.length===2?(plugin=splitPath[0]+"!",dep=base+splitPath[1]):dep=base+dep}require.s.contexts._.config.paths[key+i]&&debug&&console.warn(key+1+" existe d\u00e9j\u00e0 dans la config"),paths[key+i]=dep,i===conf.shim[key].depsEnOrdre.length-1?(require.s.contexts._.config.shim[key]&&debug&&console.warn("Il y a d\u00e9j\u00e0 des d\u00e9pendances pour "+key),conf.shim[key].deps=[plugin+key+i]):(require.s.contexts._.config.shim[key+(i+1)]&&debug&&console.warn("Il y a d\u00e9j\u00e0 des d\u00e9pendances pour "+key+(i+1)),conf.shim[key+(i+1)]={deps:[plugin+key+i]})}}});var config={};conf.scope?(config.map={},config.map[conf.scope]=
paths):config.paths=paths,conf.shim&&(config.shim=conf.shim),conf.map&&(config.map=conf.map),require.config(config)},require.enOrdre=function(modules,callback){if(!modules)return;var shim=require.s.contexts._.config.shim[modules[0]];shim&&(modules=shim.deps.concat(modules));function load(queue,results){queue.length?require([queue.shift()],function(result){results.push(result),load(queue,results)}):(console.log(callback),callback.apply(null,results))}load(modules,[])}}),require.ajouterConfig({paths:{layerTreeBuilderBuild:"libs/GeoExt.ux/LayerTreeBuilder/LayerTreeBuilder%-build%",layerTreeBuilderCSS:"libs/GeoExt.ux/LayerTreeBuilder/resources/css/LayerTreeBuilder"},shim:{layerTreeBuilderBuild:{deps:["css!layerTreeBuilderCSS"]}}}),define("arborescence",["panneau","contexteMenuArborescence","layerTreeBuilderBuild"],function(Panneau,ContexteMenuArborescence){function Arborescence(options){this.options=options||{}}return Arborescence.prototype=new Panneau,Arborescence.prototype.constructor=Arborescence
,Arborescence.prototype._init=function(){var that=this;this._panel=new GeoExt.ux.tree.LayerTreeBuilder({title:"Arborescence des couches",width:250,autoScroll:!0,rootVisible:!1,border:!1,enableDD:!1,lines:!1,checkableContainerGroupNodes:!1,id:"tree_panneau",listeners:{afterrender:function(e){that.callbackCreation()}}}),Panneau.prototype._init.call(this)},Arborescence.prototype.callbackCreation=function(){this.contexteMenu=new ContexteMenuArborescence({arborescence:this,selecteur:"#"+this.obtenirId(),cible:".x-tree-node"}),Panneau.prototype.callbackCreation.call(this),this.carte.gestionCouches.ajouterDeclencheur("enleverToutesLesCouches",this._enleverTousLesGroupes,{scope:this})},Arborescence.prototype._enleverTousLesGroupes=function(){while(this._panel.root.childNodes.length!==0)this._panel.root.childNodes[0].destroy()},Arborescence}),require.ajouterConfig({paths:{kmlMsp:"libs/extension/OpenLayers/kmlMsp"}}),require.estDansConfig("fileUploadField")||require.ajouterConfig({paths:{fileUploadField
:"libs/Ext.ux/FileUploadField/FileUploadField",fileUploadFieldCss:"libs/Ext.ux/FileUploadField/FileUploadField"},shim:{fileUploadField:{deps:["css!fileUploadFieldCss"]}}}),define("impression",["panneau","aide","kmlMsp","fileUploadField"],function(Panneau,Aide){function Impression(options){this.options=options||{},this.defautOptions.service=Aide.obtenirUrlServices()+"impression/printIGO.php",this.separator="&",this.aszPrintableLayerTypes=["OpenLayers.Layer.WMS","OpenLayers.Layer.WMS.Untiled","OpenLayers.Layer.MapServer"]}return Impression.prototype=new Panneau,Impression.prototype.constructor=Impression,Impression.prototype._init=function(){this.wms2pdf(),this._panel={title:"Impression",id:"widgetImpression",hidden:!1,border:!0,width:200,split:!0,collapsible:!0,collapseMode:"mini",autoScroll:!0,items:[this.printForm]}},Impression.prototype.wms2pdf=function(){var that=this,oOutputFormatStore=new Ext.data.SimpleStore({fields:["value","text"],data:[["img","Image"],["pdf","Document PDF"]]}),
szDefaultOutputFormat=oOutputFormatStore.data.items[0].data.value,oOutputFormatComboBox=new Ext.form.ComboBox({id:"printOutputFormat",fieldLabel:"Format",store:oOutputFormatStore,valueField:"value",value:szDefaultOutputFormat,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1,listWidth:150,submitValue:!1});oOutputFormatComboBox.on("change",function(){var nKey=that.printForm.items.indexOfKey("printComments")});var oPaperStore=new Ext.data.SimpleStore({fields:["value","text"],data:[["LETTER","Lettre	8.5 X 11"],["LEGAL","Legal	8.5 X 14"],["LEDGER","Tabloid	11 X 17"],["A1","A1	23 X 33"],["ANSI E","ANSI E	34 X 44"],["Personalis\u00e9","Personalis\u00e9"]]}),szDefaultPaper=oPaperStore.data.items[0].data.value,oPaperComboBox=new Ext.form.ComboBox({id:"printPaper",fieldLabel:"Format papier",store:oPaperStore,valueField:"value",value:szDefaultPaper,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1,listWidth:150,submitValue
:!1}),widthNumberField=new Ext.form.NumberField({id:"width",fieldLabel:"Largeur",name:"width",decimalPrecision:1,value:11,minValue:8.5,maxValue:44,submitValue:!1});widthNumberField.setDisabled(!0);var heightNumberField=new Ext.form.NumberField({id:"height",fieldLabel:"Hauteur",name:"height",decimalPrecision:1,value:8.5,minValue:8.5,maxValue:44,submitValue:!1});heightNumberField.setDisabled(!0),oPaperComboBox.on("select",function(){updatePaperNumberFields()});function updatePaperNumberFields(){var paper=oPaperComboBox.getValue(),orientation=oOrientationComboBox.getValue(),width=widthNumberField.getValue(),height=heightNumberField.getValue();if(paper=="Personalis\u00e9")widthNumberField.setDisabled(!1),heightNumberField.setDisabled(!1);else{paper=="LETTER"?(width=8.5,height=11):paper=="LEGAL"?(width=8.5,height=14):paper=="LEDGER"?(width=11,height=17):paper=="A1"?(width=23,height=33):paper=="ANSI E"&&(width=34,height=44),widthNumberField.setDisabled(!0),heightNumberField.setDisabled(!0);if(
orientation=="landscape"){var buffer=width;width=height,height=buffer}}widthNumberField.setValue(width),heightNumberField.setValue(height)}var oOrientationStore=new Ext.data.SimpleStore({fields:["value","text"],data:[["landscape","Paysage"],["portrait","Portrait"]]}),szDefaultOrientation=oOrientationStore.data.items[0].data.value,oOrientationComboBox=new Ext.form.ComboBox({id:"printOrientation",fieldLabel:"Orientation",store:oOrientationStore,valueField:"value",value:szDefaultOrientation,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1,listWidth:150,submitValue:!1});oOrientationComboBox.on("select",function(){updatePaperNumberFields()});var oUnitsStore=new Ext.data.SimpleStore({fields:["value","text"],data:[["default","Celle de la carte"],["in","Pouces"],["ft","Pieds"],["mi","Miles"],["m","M\u00e8tres"],["km","Kilom\u00e8tres"],["dd","Degr\u00e9s"]]}),szDefaultUnits=oUnitsStore.data.items[0].data.value,oUnitsComboBox=new Ext.form.ComboBox({id:"printUnits"
,fieldLabel:"Unit\u00e9",store:oUnitsStore,valueField:"value",value:szDefaultUnits,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1,listWidth:150,submitValue:!1}),oLegendeLocation=new Ext.data.SimpleStore({fields:["value","text"],data:[["UR","Haut-droit"],["UL","Haut-gauche"],["LR","Bas-droit"],["LL","Bas-gauche"]]}),szDefaultLegendeLocation=oLegendeLocation.data.items[0].data.value,oLegendeLocationComboBox=new Ext.form.ComboBox({id:"printLegendeLocation",fieldLabel:"Position de la l\u00e9gende",store:oLegendeLocation,valueField:"value",value:szDefaultLegendeLocation,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1,listWidth:150,submitValue:!1,hidden:!0});this.printForm=new Ext.FormPanel({labelWidth:100,frame:!0,border:!1,bodyStyle:"padding:5px 5px 0",defaults:{width:150},defaultType:"textfield",fileUpload:!0,items:[{fieldLabel:"Titre",id:"printTitle",maxLength:50,submitValue:!1},{xtype:"textarea",fieldLabel
:"Commentaires",id:"printComments",height:100,maxLength:256,submitValue:!1},oOutputFormatComboBox,oPaperComboBox,widthNumberField,heightNumberField,oOrientationComboBox,oUnitsComboBox,{xtype:"checkbox",id:"showLegendGraphics",fieldLabel:" Afficher la l\u00e9gende",submitValue:!1,listeners:{check:function(checkbox,checked){checked?(this.ownerCt.items.item("printLegendeLocation").setDisabled(!1),this.ownerCt.items.item("printLegendeLocation").setVisible(!0)):(this.ownerCt.items.item("printLegendeLocation").setDisabled(!0),this.ownerCt.items.item("printLegendeLocation").setVisible(!1))}}},oLegendeLocationComboBox,{xtype:"checkbox",id:"printDescription",fieldLabel:" Afficher les descriptions (couche vectoriel seulement)",submitValue:!1},{xtype:"checkbox",id:"printLogo",fieldLabel:" Afficher les droits",submitValue:!1,listeners:{check:function(checkbox,checked){checked?(this.ownerCt.items.item("printLogoPath").setDisabled(!1),this.ownerCt.items.item("printNomAuteur").setVisible(!0),this.ownerCt
.items.item("printLogoPath").setVisible(!0)):(this.ownerCt.items.item("printLogoPath").setDisabled(!0),this.ownerCt.items.item("printNomAuteur").setVisible(!1),this.ownerCt.items.item("printLogoPath").setVisible(!1))}}},{fieldLabel:"Auteur",id:"printNomAuteur",maxLength:50,hidden:!0,submitValue:!1},{xtype:"fileuploadfield",id:"printLogoPath",emptyText:"S\u00e9lectionner un fichier ...",fieldLabel:"Logo",buttonText:"Fichier",hidden:!0,submitValue:!1,listeners:{fileselected:function(inputNode,fileInput){inputNode.setValue(fileInput.replace("C:\\fakepath\\",""))}}}],buttons:[{id:"printButton",text:"Imprimer",tooltip:"G\u00e9n\u00e9rer un fichier pdf de la carte pr\u00e9sente",handler:function(){that.printMap()}},{text:"Restaurer",tooltip:"R\u00e9initialiser les valeurs des champs",handler:function(){that.printForm.getForm().reset()}}]}),this.printForm.on("beforeaction",function(form,action){if(action.type=="submit")return(form.items.get("printLogo").checked==0||form.items.get("printLogoPath"
).value==""||typeof form.items.get("printLogoPath").value=="undefined")&&form.items.get("printLogoPath").setDisabled(!0),!0}),this.printForm.on("actionfailed",function(form,action){if(action.type=="submit")return form.items.get("printLogoPath").setDisabled(!1),!0}),this.printForm.on("actioncomplete",function(form,action){if(action.type=="submit")return form.items.get("printLogoPath").setDisabled(!1),!0})},Impression.prototype.printMap=function(){var vecteursKml=this.exportVecteur();if(vecteursKml!=null)var aoLayers=this.getPrintableLayers(!1);else var aoLayers=this.getPrintableLayers(!0);if(!aoLayers)return!1;var szURL=this.options.service||this.defautOptions.service,oParams=this.getPrintParams(aoLayers),szTitle="Cr\u00e9ation du fichier",szWait="Cr\u00e9ation du fichier en cours, veuillez patienter quelques secondes...",szParams=OpenLayers.Util.getParameterString(oParams);szParams.length>0&&(szURL+="?"+szParams),szURL=Aide.utiliserProxy(szURL),this.printForm.getForm().isValid()&&this.printForm
.getForm().submit({url:szURL,headers:{"Content-type":"multipart/form-data;charset=UTF-8"},waitMsg:szWait,waitTitle:szTitle,params:{vecteurs:vecteursKml},method:"POST",scope:this,success:function(form,action){this.afficherImpression(action)},failure:function(form,action){this.afficherImpression(action)}})},Impression.prototype.getPrintableLayers=function(flagVecteur){var flagVecteur=typeof flagVecteur=="undefined"?!0:flagVecteur,aolBase=[],aolOverlays=[],aoLayers,oMap=Igo.nav.carte._carteOL;for(var i=0,len=oMap.layers.length;i<len;i++){var oLayer=oMap.layers[i],coucheIGO=Igo.nav.carte.gestionCouches.obtenirCoucheParId(oLayer.id);if(!oLayer.printOptions){if(oLayer.getVisibility()&&coucheIGO&&(coucheIGO.obtenirTypeClasse()==="Google"||coucheIGO.obtenirTypeClasse()==="OSM")){Aide.afficherMessage("Impression","Les couches Google et OpenStreetMap, ne sont pas disponible \u00e0 l'impression pour des raisons de  droits d'utilisation.","OK","ERREUR");return}if(OpenLayers.Util.indexOf(this.aszPrintableLayerTypes
,oLayer.CLASS_NAME)==-1)continue}if(OpenLayers.Util.indexOf(this.aszPrintableLayerTypes,oLayer.CLASS_NAME)==-1&&(!oLayer.printOptions.url||!oLayer.printOptions.layers||!oLayer.printOptions.mapformat||!oLayer.printOptions.format||oLayer.printOptions["fromLayer"]==1))continue;oLayer.isBaseLayer?oLayer.getVisibility()&&aolBase.push(oLayer):oLayer.inRange&&oLayer.getVisibility()&&aolOverlays.push(oLayer)}aoLayers=aolBase.concat(aolOverlays);if(aoLayers.length===0&&flagVecteur){Aide.afficherMessage("Impression","Aucune couche imprimable n'est s\u00e9lectionn\u00e9e","OK","ERREUR");return}return aoLayers},Impression.prototype.getPrintParams=function(aoLayers){var bbox_reprojete=new OpenLayers.Bounds.fromString(Igo.nav.carte._carteOL.getExtent().toBBOX());bbox_reprojete.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:32198"));var hasBaseLayer=!1;for(var i=0;i<aoLayers.length;i++)if(aoLayers[i].isBaseLayer){hasBaseLayer=!0;break}var oParams={BBOX:bbox_reprojete
.toBBOX(),SRS:"EPSG:32198",SCALE:Igo.nav.carte._carteOL.getScale(),MAPFORMAT:"png",LAYERS:this.getLayersPrintOption(aoLayers,"layers"),TITLE:this.getLayersPrintOption(aoLayers,"title"),TIME:this.getLayersPrintOption(aoLayers,"time"),URLS:this.getLayersPrintOption(aoLayers,"url"),FORMAT:this.getLayersPrintOption(aoLayers,"format"),OPACITY:this.getLayersPrintOption(aoLayers,"opacity"),HASBASELAYER:hasBaseLayer},aoElements,nElements;aoElements=this.printForm.items.items;for(var i=0,len=aoElements.length;i<len;i++){oElement=aoElements[i],oParams[oElement.getId()]=oElement.getValue();if(oElement.getId()=="printOutputFormat"){szOutputFormat=oElement.getValue();switch(szOutputFormat){case"pdf":this.szWindowTitle="Pr\u00e9sente carte en PDF.";break;default:this.szWindowTitle="Pr\u00e9sente carte en image.  Clique droit sur l'image pour la sauvegarder."}}else if(oElement.getId()=="printPaper"||oElement.getId()=="printOrientation")continue}return oParams},Impression.prototype.getLayersPrintOption=
function(aoLayers,szOption){var szOptionValues="";for(var i=0,len=aoLayers.length;i<len;i++){var oLayer=aoLayers[i];i>0&&(szOptionValues+="#"),szOptionValues+=this.getLayerPrintOption(oLayer,szOption),szOption=="url"&&szOptionValues.replace(/https:\/\//gi,"https://")}return szOptionValues},Impression.prototype.getLayerPrintOption=function(oLayer,szOption){var szOptionValue=oLayer.printOptions[szOption];if(szOptionValue){switch(szOption){case"url":szOptionValue.substring(0,1)=="/"&&(szOptionValue=Aide.obtenirHote()+szOptionValue)}return szOptionValue}switch(szOption){case"url":var szURL;oLayer.url instanceof Array&&oLayer.url.length>1?szURL=oLayer.url[0]:szURL=oLayer.url;var oParam=OpenLayers.Util.upperCaseObject(oLayer.params),szMap=oParam.MAP;if(szMap&&(szURL.indexOf("map=")==-1||szURL.indexOf("MAP=")==-1)){var szMapParam="map="+szMap;szURL+=szMapParam+this.separator}szURL.substring(0,1)=="/"&&(szURL=Aide.obtenirHote()+szURL),szOptionValue=szURL;break;case"layers":var oParam=OpenLayers
.Util.upperCaseObject(oLayer.params);szOptionValue=oParam.LAYERS;break;case"format":switch(oLayer.CLASS_NAME){case"OpenLayers.Layer.WMS":case"OpenLayers.Layer.WMS.Untiled":szOptionValue=oLayer.params.FORMAT;break;case"OpenLayers.Layer.MapServer":szOptionValue=oLayer.params.map_imagetype}break;case"mapformat":szOptionValue="png";break;case"opacity":szOptionValue=oLayer.opacity;break;case"time":oLayer.params.TIME?szOptionValue=oLayer.params.TIME:szOptionValue="null";break;case"title":szOptionValue=oLayer.name}return szOptionValue},Impression.prototype.exportVecteur=function(){var dataConvertie,vecteurCouches=Array(),vecteurCouchesIgo=Igo.nav.carte.gestionCouches.obtenirCouchesParType("Vecteur");$.each(vecteurCouchesIgo,function(key,layer){layer.estActive()&&vecteurCouches.push(layer)});if(vecteurCouches.length==0)return null;var kmlWriter=new OpenLayers.Format.KML_MSP({extractStyles:!0,extractAttributes:!0,externalProjection:new OpenLayers.Projection("EPSG:4326"),internalProjection:Igo.nav
.carte._carteOL.getProjectionObject(),foldersName:"vecteur",placemarksDesc:"",foldersDesc:"Export\u00e9 le "+new Date});return dataConvertie=kmlWriter.writeLayers(vecteurCouches),dataConvertie},Impression.prototype.afficherImpression=function(action){oMapComponent=Igo.nav.obtenirPanneauxParType("PanneauCarte")[0]._getMapComponent();var nWinHeight=oMapComponent.getSize().height,nWinWidth=oMapComponent.getSize().width,nIFrameHeight=nWinHeight-32,nIFrameWidth=nWinWidth-15,mConfig={mediaType:"PDF",url:"temp.pdf",unsupportedText:"Acrobat Viewer is not Installed",resizable:!0},htmlContent=null,afficherItineraire=!0;if(afficherItineraire&&$("#itineraire").css("display")==="block"){var itineraire=$("#itineraire").clone();itineraire.find(".button").remove(),htmlContent="<div id='impressionItineraire'> <a href='#' onClick='window.stop(); window.print()'> Imprimer </a>"+itineraire.html()+"</div><br/><img src="+action.response.responseText+"> ";var myWindow=window.open("","","scrollbars=1,width=800,height=800"
);return myWindow.document.write("<html><head>"),myWindow.document.write("<title>Impression</title>"),myWindow.document.write('<link rel="Stylesheet" type="text/css" href="'+Aide.obtenirCheminRacine()+'css/itineraire.css?version=0.2.0" />'),myWindow.document.write("</head><body>"),myWindow.document.write(htmlContent),myWindow.document.write("</body></html>"),!0}action.response.responseText.indexOf("html")==-1?htmlContent="<iframe src="+action.response.responseText+" width='"+nIFrameWidth+"px' height='"+nIFrameHeight+"px'> ":htmlContent=action.response.responseText,this.oPDFWindow=new Ext.Window({title:this.szWindowTitle,closable:!0,width:nWinWidth,height:nWinHeight,border:!1,modal:!0,plain:!0,resizable:!0,constrain:!0,region:"center",mediaCfg:mConfig,xtype:"application/pdf",hidden:!1,autoScroll:!0,items:[{html:htmlContent,border:!1}]});var oPrintButton=Ext.get("printButton");Ext.MessageBox.hide(),this.oPDFWindow.show(oPrintButton)},Impression}),define("panneauOnglet",["panneau"],function(
Panneau){function PanneauOnglet(options){this.options=options||{},this.monPanneauOnglet=new Ext.TabPanel({activeTab:0,enableTabScroll:!0}),this.defautOptions=$.extend({},this.defautOptions,{id:"onglet-panneau",items:[this.monPanneauOnglet],_layout:"fit"}),this.listeOnglets=[]}return PanneauOnglet.prototype=new Panneau,PanneauOnglet.prototype.constructor=PanneauOnglet,PanneauOnglet.prototype._init=function(){Panneau.prototype._init.call(this),this.options.panneaux&&this.ajouterPanneaux(this.options.panneaux)},PanneauOnglet.prototype.ajouterPanneaux=function(panneaux){var that=this;$.each(panneaux,function(key,value){that.ajouterPanneau(value)})},PanneauOnglet.prototype.ajouterPanneau=function(panneau){panneau.carte=this.carte,panneau.parent=this,panneau._init();var onglet=panneau._getPanel();panneau.options.fermable&&onglet.addListener("beforeclose",this._beforeCloseTab,this),this.monPanneauOnglet.add(onglet),this.listeOnglets.push(panneau),this._panel.items.items[0].activeTab||this._panel
.items.items[0].setActiveTab(0),this.declencher({type:"ajouterPanneau",panneau:panneau})},PanneauOnglet.prototype.enleverPanneau=function(panneau){if(!panneau||!panneau._getPanel)return!1;var onglet=panneau._getPanel();this._panel.items.items[0].remove(onglet),this.listeOnglets=$.grep(this.listeOnglets,function(value){return value!=panneau})},PanneauOnglet.prototype.activerPanneau=function(panneau){var onglet=panneau._getPanel();this._panel.items.items[0].setActiveTab(onglet)},PanneauOnglet.prototype.obtenirPanneaux=function(){return this.listeOnglets},PanneauOnglet.prototype.obtenirPanneauParId=function(id,niveau){var item;return niveau=niveau||1,$.each(this.obtenirPanneaux(),function(key,value){if(value.obtenirId()===id)return item=value,!1;if((niveau>1||niveau<0)&&value.obtenirPanneauParId){item=value.obtenirPanneauParId(id,niveau-1);if(item)return!1}}),item},PanneauOnglet.prototype.obtenirPanneauxParType=function(type,niveau){var panneaux=[];return niveau=niveau||1,$.each(this.obtenirPanneaux
(),function(key,value){value.obtenirTypeClasse()===type&&panneaux.push(value),(niveau>1||niveau<0)&&value.obtenirPanneauxParType&&(panneaux=panneaux.concat(value.obtenirPanneauxParType(type,niveau-1)))}),panneaux},PanneauOnglet.prototype._beforeCloseTab=function(element){this.listeOnglets=$.grep(this.listeOnglets,function(value){return value._panel===element&&value.avantFermeture(),value._panel!=element})},PanneauOnglet}),define("localisation",["panneauOnglet"],function(PanneauOnglet){function Localisation(options){this.options=options||{},this._lastIndexRadio=0,this.defautOptions.titre="Outil de localisation",this.defautOptions.id="localisation-panneau"}return Localisation.prototype=new PanneauOnglet,Localisation.prototype.constructor=Localisation,Localisation}),define("css",["aide"],function(Aide){return{load:function(name,req,onLoad,config){var deps=[];config.shim[name]&&(deps=config.shim[name].deps),req(deps,function(){name.substr(0,4)==="css/"&&(name="././"+name);var path=req.toUrl
(name),cssPath=path,indexOfQueryString=path.indexOf("?");indexOfQueryString>-1&&(cssPath=path.substring(0,indexOfQueryString)),Aide.chargerCSS(cssPath+".css",!1),onLoad(null)})}}}),define("recherche",["panneau","vecteur","aide","panneauTable","css!css/recherche"],function(Panneau,Vecteur,Aide,PanneauTable){function Recherche(options){this.vecteur,this.options=options||{},this.defautOptions={recherchePrefixe:"",typeRecherche:"",maxEnreg:40,proxy:!0,epingle:!0,sauvegarder:!0,id:"recherche",init:!1,zoom:15}}return Recherche.prototype=new Panneau,Recherche.prototype.constructor=Recherche,Recherche.prototype._init=function(){var that=this;this.defautOptions=$.extend({},Aide.obtenirConfig("Recherche"),this.defautOptions),this.parent.options.cle&&(this.defautOptions.cle=this.parent.options.cle),Panneau.prototype._init.call(this),this.indexDebut=0,this.indexFin=this.options.maxEnreg-1,this.aidePanneau=this.obtenirPanneauAide(),this.resultatPanneau=this.obtenirResultatPanneau(),this.formItems=this
.obtenirElementsRecherche();var items=[this.formItems,this.aidePanneau,this.resultatPanneau];Boolean(this.options.epingle)&&items.push(this.obtenirEpingleCheckbox()),Boolean(this.options.sauvegarder)&&items.push(this.obtenirSauvegarderCheckbox()),this._panel=new Ext.FormPanel({title:this.obtenirTitre(),id:this.options.id,hideLabel:!0,frame:!0,border:!1,bodyStyle:"padding:0px 17px 0 0px; overflow-y: auto;",scope:this,items:items,hidden:!1,buttons:this.obtenirBoutonsRecherche(),listeners:{afterrender:function(e){that.callbackCreation()},activate:function(e){that.declencher({type:that.obtenirTypeClasse()+"Active"})}}}),this.verifierParamsUrl()},Recherche.prototype.obtenirValeursRecherche=function(){return this._panel.getForm().getValues()},Recherche.prototype.obtenirPanneauAide=function(){return this.obtenirAideHTML()?Ext.create({xtype:"fieldset",title:"aide",id:"lbl_aide"+this.options.id,collapsible:!0,labelWidth:75,items:[{html:this.obtenirAideHTML()}]}):!1},Recherche.prototype.obtenirAideHTML=
function(){return!1},Recherche.prototype.obtenirLienPDF=function(){return"<a href='#here' onclick='window.open(\""+Aide.utiliserBaseUri("guides/200_Guide_Localisation_GeoCOG_V10_OMSC-ANALYSTE.pdf")+"\");'>"+"Cliquer ici pour avoir plus de d\u00e9tails...</a><br><br>"},Recherche.prototype.obtenirResultatPanneau=function(){return Ext.create({xtype:"fieldset",title:"R\u00e9sultat",id:"resul"+this.options.id,collapsible:!0,hidden:!0,items:[{html:"<p>Aucun resultat</p>"}]})},Recherche.prototype.obtenirElementsRecherche=function(){var that=this;return[{xtype:"textfield",fieldLabel:"Texte",hideLabel:!0,width:260,id:"RechercheTitle"+this.options.id,allowBlank:!1,blankText:"Vous devez saisir au moins 1 caract\u00e8re...",enableKeyEvents:!0,scope:this,listeners:{keyup:function(field,e){var key=e.getKey();key==13&&that.lancerRecherche()}}}]},Recherche.prototype.obtenirBoutonsRecherche=function(){var that=this;return[{id:"rechercherButton"+this.options.id,text:"Rechercher",tooltip:"Lancer la recherche"
,scope:this,handler:function(){that.lancerRecherche()}},{id:"reinitialiserButton"+this.options.id,text:"R\u00e9initialiser",tooltip:"R\u00e9initialiser les champs de recherche et la carte",scope:this,handler:function(){that.reinitialiserRecherche()}}]},Recherche.prototype.obtenirEpingleCheckbox=function(){return this.pineCheckbox=new Ext.create({xtype:"checkbox",name:"cb_showPine",ctCls:"styleEpingle",id:"cb_showPine"+this.options.id,boxLabel:"Afficher l'\u00e9pingle",checked:!0,scope:this,handler:function(e){e.getValue()?this.vecteur&&this.vecteur.activer():this.vecteur&&this.vecteur.desactiver()}}),this.pineCheckbox},Recherche.prototype.obtenirSauvegarderCheckbox=function(){return this.saveCheckbox=new Ext.create({xtype:"checkbox",name:"cb_SaveVecteur",ctCls:"styleEpingle",id:"cb_SaveVecteur"+this.options.id,boxLabel:"Sauvegarder le r\u00e9sultat",checked:!1,scope:this}),this.saveCheckbox},Recherche.prototype.appelerService=function(){var textUser=this.obtenirValeursRecherche()["RechercheTitle"+
this.options.id];if(!textUser)return Aide.afficherMessage({titre:"Recherche",message:"Veillez entrer un texte \u00e0 chercher"}),!1;Aide.afficherMessageChargement({message:"Recherche en cours, patientez un moment..."}),this.reinitialiserVecteur();var texte="";this.obtenirRecherchePrefixe()&&(texte+=this.obtenirRecherchePrefixe()+" "),texte+=textUser;var typeRecherche=this.obtenirTypeRecherche(),tjrsProxy=this.options.cle?!0:!1;$.ajax({url:Aide.utiliserProxy(this.options.service,tjrsProxy),data:{type:typeRecherche,texte:texte,epsg_sortie:this.carte.obtenirProjection().split(":")[1],indDebut:this.indexDebut,indFin:this.indexDebut+this.indexFin,format:this.options.format,groupe:1,urlappelant:this.options.cle?undefined:this.options.urlAppelant,_cle:this.options.cle},context:this,success:this.lireReponse,error:this.appelerServiceErreur}),this.declencher({type:"appelerServiceRecherche",recherche:this})},Recherche.prototype.appelerServiceErreur=function(jqXHR){var messageErreur=jqXHR.responseText
;jqXHR.responseJSON&&(messageErreur=jqXHR.responseJSON.message_erreur,jqXHR.responseJSON.detail_message&&$.each(jqXHR.responseJSON.detail_message,function(key,value){messageErreur+="<br>"+value})),jqXHR.status===404&&(messageErreur="Service introuvable."),this.definirResultat(messageErreur)},Recherche.prototype.traiterResultatVecteur=function(vecteur){vecteur.garderHistorique=!0;var occurence=vecteur.obtenirOccurences()[0];if(!occurence)return!1;vecteur.zoomerOccurence(occurence,this.options.zoom),occurence.selectionner();if(this.options.idResultatTable){var nav=Aide.obtenirNavigateur(),panneauTable=nav.obtenirPanneauParId(this.options.idResultatTable,-1);if(!panneauTable||!panneauTable.obtenirTypeClasse)return!0;if(panneauTable.obtenirTypeClasse()==="PanneauTable")panneauTable.ouvrirTableVecteur(vecteur);else if(panneauTable.obtenirTypeClasse()==="PanneauOnglet"){var nouvelleTable=new PanneauTable({reductible:!1,fermable:!0});panneauTable.ajouterPanneau(nouvelleTable),nouvelleTable.ouvrirTableVecteur
(vecteur),panneauTable.activerPanneau(nouvelleTable)}}},Recherche.prototype.creerVecteurRecherche=function(styles){var active=!1;if(!this.pineCheckbox||this.pineCheckbox.checked)active=!0;var visible=!1;this.saveCheckbox&&this.saveCheckbox.checked&&(visible=!0);var vecteur=new Vecteur({active:active,visible:visible,selectionnable:!1,suppressionPermise:!0,titre:"Resultats Recheche "+this.options.titre+" - "+this.obtenirValeursRecherche()["RechercheTitle"+this.options.id],styles:styles});return this.carte.gestionCouches.ajouterCouche(vecteur),vecteur},Recherche.prototype.lireReponse=function(response){this.definirResultat("<p> Surcharger la fonction lireReponse </p>")},Recherche.prototype.ajouterPagination=function(nombreResultats){var ajoutFleche="";return nombreResultats===this.indexFin+1?(ajoutFleche+="<div align='center'><table>",ajoutFleche+="<tr>",this.indexDebut-(this.indexFin+1)<0?ajoutFleche+="<td>Pr\u00e9c\u00e9dent</td>":ajoutFleche+="<td><span id='precedentRecherche'>Pr\u00e9c\u00e9dent</span></td>"
,ajoutFleche+="<td>&nbsp;&nbsp;&nbsp;</td>",ajoutFleche+="<td><span id='suivantRecherche'>Suivant</span></td>",ajoutFleche+="</tr>",ajoutFleche+="</table></div>"):this.indexDebut>0&&(ajoutFleche+="<div align='center'><table>",ajoutFleche+="<tr>",ajoutFleche+="<td><span id='precedentRecherche'>Pr\u00e9c\u00e9dent</span></td>",ajoutFleche+="<td>&nbsp;&nbsp;&nbsp;</td>",ajoutFleche+="<td>Suivant</td>",ajoutFleche+="</tr>",ajoutFleche+="</table></div>"),ajoutFleche},Recherche.prototype.initEventResultat=function(){$(this.resultatPanneau.items.items[0].body.dom).find("#precedentRecherche").click($.proxy(this.appelPrecedent,this)),$(this.resultatPanneau.items.items[0].body.dom).find("#suivantRecherche").click($.proxy(this.appelSuivant,this)),$(this.resultatPanneau.items.items[0].body.dom).find("li.rechercheResultatsListe").click($.proxy(this.eventResultatClique,this))},Recherche.prototype.eventResultatClique=function(e){var id=$(e.target).parents(".rechercheResultatsListe").data("id");this.vecteur
.deselectionnerTout();var occurence=this.vecteur.obtenirOccurenceParId(id);if(!occurence)return!1;this.vecteur.zoomerOccurence(occurence,this.options.zoom),occurence.selectionner()},Recherche.prototype.obtenirRecherchePrefixe=function(){return this.options.recherchePrefixe},Recherche.prototype.obtenirTypeRecherche=function(){return this.options.typeRecherche},Recherche.prototype.reinitialiserVecteur=function(){if(!this.vecteur)return!1;this.vecteur.options.visible||this.carte.gestionCouches.enleverCouche(this.vecteur)},Recherche.prototype.lancerRecherche=function(texte){texte&&this._panel.items.get("RechercheTitle"+this.options.id).setValue(texte),this.aidePanneau&&this.aidePanneau.collapse(),this.indexDebut=0,this.appelerService()},Recherche.prototype.relancerRecherche=function(requete){this.obtenirValeursRecherche()["RechercheTitle"+this.options.id]=requete,this._panel.items.items[0].setValue(requete),this.appelerService()},Recherche.prototype.appelSuivant=function(){this.indexDebut=this
.indexDebut+(this.indexFin+1),this.appelerService()},Recherche.prototype.appelPrecedent=function(){this.indexDebut=this.indexDebut-(this.indexFin+1),this.appelerService()},Recherche.prototype.definirResultat=function(resultatTexte,callback,target){Aide.cacherMessageChargement(),this.resultatPanneau.show().expand(),this.resultatPanneau.items.items[0].body.update(resultatTexte),typeof callback=="function"&&callback.call(target)},Recherche.prototype.verifierParamsUrl=function(){var recherche=Aide.obtenirParametreURL("recherche");if(recherche===this.obtenirTypeRecherche()){var texte=Aide.obtenirParametreURL("texte");if(texte){var that=this,zoomP=Number(Aide.obtenirParametreURL("zoom"));zoomP&&(this.options.zoom=zoomP);var nav=Aide.obtenirNavigateur();nav.isReady?that.traiterParamsUrl(texte):nav.ajouterDeclencheur("navigateurInit",function(){that.traiterParamsUrl(texte)})}}},Recherche.prototype.traiterParamsUrl=function(texte){var that=this;this.parent.ajouterDeclencheur("ajouterPanneau",function(
e){that===e.panneau&&(e.target.enleverDeclencheur("ajouterPanneau","rechercheTraiterParamsURL"),e.panneau.ajouterDeclencheur(that.obtenirTypeClasse()+"Active",function(e2){e2.target.enleverDeclencheur(that.obtenirTypeClasse()+"Active","rechercheTraiterParamsURL2"),e2.target.lancerRecherche(texte)},{id:"rechercheTraiterParamsURL2"}),e.target.activerPanneau(e.panneau))},{id:"rechercheTraiterParamsURL"}),this.parent.ouvrir()},Recherche.prototype.reinitialiserRecherche=function(){this.reinitialiserVecteur(),$.each(this._panel.items.items,function(index,item){(item.xtype=="textfield"||item.xtype=="numberfield"||item.xtype=="combo")&&item.reset()}),this.resultatPanneau.isVisible()&&this.definirResultat(this.obtenirAideHTML())},Recherche}),define("rechercheAdresse",["recherche","aide","point","style","limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheAdresse(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{typeRecherche:"adresse",titre
:"Adr."})}return RechercheAdresse.prototype=new Recherche,RechercheAdresse.prototype.constructor=RechercheAdresse,RechercheAdresse.prototype.obtenirAideHTML=function(){return"Ex: <br>->no. immeuble et nom de rue<br>->no. immeuble et nom de rue et ville<br>->nom de rue et ville<br>->nom de rue + nom de rue, ville (intersection)<br>"+this.obtenirLienPDF()+this.obtenirCopyright()},RechercheAdresse.prototype.obtenirCopyright=function(){return'<a href="http://adressesquebec.gouv.qc.ca/" target="_blank"><img src="'+Aide.utiliserBaseUri("images/quebec/AQhorizontal-copyrightPetit.png")+'" style=\'height:39px\' alt="Adresse Qu\u00e9bec" ></img></a>'},RechercheAdresse.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,
filtres:[{filtre:"[geocodeMatchCode]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[geocodeMatchCode]==100",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles);$.each(responseJSON.geocoderReponseListe,function(key,value){var point;if(!value.localisation)return!0;if(!value.localisation.point.x||!value.localisation.point.y){var x=Number(value.localisation.enveloppe.Xmin)+(Number(value.localisation.enveloppe.Xmax)-Number(value.localisation.enveloppe.Xmin))/2,y=Number(value.localisation.enveloppe.Ymin)+(Number(value.localisation.enveloppe.Ymax)-Number(value.localisation.enveloppe.Ymin))/2;point=new Point(x,y),point.limites=new Limites(value.localisation.enveloppe.Xmin,value.localisation.enveloppe.Ymin,value.localisation.enveloppe.Xmax,value.localisation.enveloppe.Ymax)}else point=new Point(value.localisation.point.x,value.localisation.
point.y);vecteur.creerOccurence(point,value)}),vecteur.templates.table={colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Adresse",triable:!0,propriete:"adresseLibre"}]},this.traiterResultatVecteur(vecteur,responseJSON.nombreResultat)},RechercheAdresse.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||vecteur.listeOccurences.length;var resultat=this.ajouterPagination(nombreResultats),debut=this.indexDebut+1,fin=this.indexDebut+vecteur.listeOccurences.length;if(fin===0)return this.definirResultat("Aucun r\u00e9sultat"),!1;resultat+="<h4><u>R\u00e9sultats ("+debut+" - "+fin+")</u></h4>",$.each(vecteur.listeOccurences,function(row,occurence){var title=occurence.proprietes.statut.description||"";occurence.proprietes.statut.commentaire&&(title+="\nCommentaire: "+occurence.proprietes.statut.commentaire);var couleur="blue";occurence.proprietes.statut.etat&&occurence.proprietes.statut.etat!=="Officiel"&&(couleur="#ff7200")
,resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='"+couleur+"' title='"+title+"'><b>\u00bb </b><u>"+occurence.obtenirPropriete("adresseLibre")+"</u></font></li>"}),this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheAdresse}),define("rechercheBorne",["recherche","aide","point","style","limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheBorne(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{typeRecherche:"borne",titre:"Borne"})}return RechercheBorne.prototype=new Recherche,RechercheBorne.prototype.constructor=RechercheBorne,RechercheBorne.prototype.obtenirAideHTML=function(){return"Ex: <br>->108 73 = borne(MTQ) du 108i\u00e8me kilom\u00e8tre de la route #73<br>->CN, 50 = toutes les bornes(CN) au 50i\u00e8me mile<br>->GCC H47(lettre chiffre) = bou\u00e9e dont l'identifiant est 'H47'<br>->SORTIE 315 = Toutes les sorties 315<br>->SORTIE 315 40 = Sortie 315 de la route 40<br>->SORTIE 315 Qu\u00e9bec = Sortie 315 de la municipalit\u00e9 de Qu\u00e9bec<br>->SORTIE Qu\u00e9bec = Toutes les sorties de la municipalit\u00e9 de Qu\u00e9bec<br>->PANNEAU st-raymond = Toutes les sorties dont l'affichage contient 'st-raymond'<br>"+
this.obtenirLienPDF()},RechercheBorne.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,filtres:[{filtre:"[geocodeMatchCode]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[geocodeMatchCode]==100",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles);$.each(responseJSON.borneReponseListe,function(key,value){var point;if(!value.localisation)return!0;if(!value.localisation.point.x||!value.localisation.point.y){var x=Number(value.localisation.enveloppe.Xmin)+(Number(value.localisation.enveloppe.Xmax)-Number(value.localisation.enveloppe.Xmin))/2,y=Number(value
.localisation.enveloppe.Ymin)+(Number(value.localisation.enveloppe.Ymax)-Number(value.localisation.enveloppe.Ymin))/2;point=new Point(x,y),point.limites=new Limites(value.localisation.enveloppe.Xmin,value.localisation.enveloppe.Ymin,value.localisation.enveloppe.Xmax,value.localisation.enveloppe.Ymax)}else point=new Point(value.localisation.point.x,value.localisation.point.y);vecteur.creerOccurence(point,value)}),vecteur.templates.table={colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Detail",triable:!0,propriete:"detail"}]},this.traiterResultatVecteur(vecteur,responseJSON.nombreResultat)},RechercheBorne.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||vecteur.listeOccurences.length;var resultat=this.ajouterPagination(nombreResultats),debut=this.indexDebut+1,fin=this.indexDebut+vecteur.listeOccurences.length;if(fin===0)return this.definirResultat("Aucun r\u00e9sultat"),!1;resultat+="<h4><u>R\u00e9sultats ("+debut+" - "+
fin+")</u></h4>",$.each(vecteur.listeOccurences,function(row,occurence){var couleur="blue";resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='"+couleur+"'><b>\u00bb </b><u>"+occurence.proprietes.detail+"</u></font></li>"}),this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheBorne}),define("rechercheCadastreReno",["limites","point","marqueurs","style","recherche","aide"],function(Limites,Point,Marqueurs,Style,Recherche,Aide){function RechercheCadastreReno(options){this.options=options||{},this.options.id="RechercheCadastreReno",this.options.typeRecherche="cadastreReno",this.defautOptions=$.extend({},this.defautOptions,{titre:"Cadastre r\u00e9nov\u00e9"}),this.defautOptions=$.extend({},Aide.obtenirConfig("RechercheCadastreReno"),this.defautOptions)}return RechercheCadastreReno.prototype=new Recherche,RechercheCadastreReno.prototype.constructor=RechercheCadastreReno
,RechercheCadastreReno.prototype.appelerService=function(){var tabValeursRecherche=this.obtenirValeursRecherche(),that=this,numCadastre=tabValeursRecherche["RechercheTitle"+this.options.id];if(!numCadastre)return Aide.afficherMessage({titre:"Recherche",message:"Vous devez saisir un cadastre r\u00e9nov\u00e9"}),!1;var codeEPSG=this.carte.obtenirProjection();page=this.options.url;var url=page;url+="?numero="+numCadastre,url+="&epsg="+codeEPSG.substr(5),Ext.Ajax.request({url:url,method:"GET",success:function(result,request){that.AfficherCadastreReno(result)},failure:function(result,request){that.afficherMessageErreur()}})},RechercheCadastreReno.prototype.AfficherCadastreReno=function(response){var Tabinfos=response.responseText.split(";"),numCadastre=Tabinfos[0],xmin=parseFloat(Tabinfos[1]),ymin=parseFloat(Tabinfos[2]),xmax=parseFloat(Tabinfos[3]),ymax=parseFloat(Tabinfos[4]),pointx=parseFloat(Tabinfos[5]),pointy=parseFloat(Tabinfos[6]),projection=parseFloat(Tabinfos[7]);if(isNaN(xmin)||isNaN
(ymin))return this.afficherMessageErreur(),!1;this.vecteur===undefined?this.creerCoucheVecteur():this.vecteur.enleverMarqueurs(),point=new Point(pointx,pointy),this.vecteur.ajouterMarqueur(point),this.vecteur.zoomerMarqueurs();var couche=this.carte.gestionCouches.obtenirCouchesParTitre("Cadastre r\u00e9nov\u00e9 - bas niveau")[0];couche!==undefined&&couche.activer()},RechercheCadastreReno.prototype.obtenirAideHTML=function(){return"Fournir un num\u00e9ro de cadastre r\u00e9nov\u00e9"},RechercheCadastreReno.prototype.afficherMessageErreur=function(){Aide.afficherMessage({titre:"Message",message:"Aucune donn\u00e9e trouv\u00e9e"})},RechercheCadastreReno.prototype.creerCoucheVecteur=function(){this.vecteur=new Marqueurs({nom:"couche"+this.typeRecherche,displayInLayerSwitcher:!1,visible:!1}),this.carte.gestionCouches.ajouterCouche(this.vecteur),(!this.pineCheckbox||this.pineCheckbox.checked)&&this.vecteur.activer()},RechercheCadastreReno}),define("rechercheGPS",["recherche","aide","point","style"
,"limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheGPS(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{typeRecherche:"gps",titre:"GPS"})}return RechercheGPS.prototype=new Recherche,RechercheGPS.prototype.constructor=RechercheGPS,RechercheGPS.prototype.obtenirAideHTML=function(){return"Ex: <br>->UTM-fuseau X,Y (utm-18 mmmmmm, mmmmmmm)<br>->MTM-fuseau X,Y (mtm-8 mmmmmm, mmmmmmm)<br>->Degr\u00e9 d\u00e9cimal - lon, lat (dd.ddd, dd.ddd)<br>->Degr\u00e9 minute d\u00e9cimale - lon, lat (dd mm.mmm, dd mm.mmm)<br>->Degr\u00e9 minute seconde - lon, lat (dd mm ss.sss, dd mm ss.sss)<br>->BELL (Lat: dd mm ss.s Long: dd mm ss.s UNC: CONF:)<br>"+this.obtenirLienPDF()},RechercheGPS.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"
),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,filtres:[{filtre:"[coteCertitude]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[coteCertitude]==100",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles),point;if(!(responseJSON.localisation&&responseJSON.localisation.point.x&&responseJSON.localisation.point.y))return this.definirResultat("Aucun r\u00e9sultat"),!1;point=new Point(responseJSON.localisation.point.x,responseJSON.localisation.point.y),vecteur.creerOccurence(point,responseJSON),vecteur.templates.table={proprietesBase:"proprietes.localisation",colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Municipalit\u00e9",triable:!0,propriete:"municipalite"},{titre:"Localit\u00e9",triable:!0,propriete:"localite"},{titre:"Distance",triable:!0,propriete:"distance"}]},this.traiterResultatVecteur
(vecteur,responseJSON.nombreResultat)},RechercheGPS.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||vecteur.listeOccurences.length;var occurence=vecteur.listeOccurences[0];if(!occurence)return this.definirResultat("Aucun r\u00e9sultat"),!1;var resultat=this.ajouterPagination(nombreResultats);resultat+="<font color='blue'><u id='convertirRechercheGPS' class='rechercheResultatsListe'>Convertir les coordonn\u00e9es GPS</u></font></br></br>",resultat+="<h4><u>"+occurence.proprietes.patternCoordInput+"</br></u>("+occurence.proprietes.formatCoordInput+")</h4>",resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='blue'><b>\u00bb </b><u>",occurence.proprietes.localisation.municipalite&&(resultat+="Dans la municipalit\u00e9 de "+occurence.proprietes.localisation.municipalite+", "),occurence.proprietes.localisation.distance&&(resultat+="\u00e0 "+occurence.proprietes.localisation.distance+" km de "+occurence.proprietes
.localisation.localite),resultat+="</u></font></li>",this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheGPS.prototype.initEventResultat=function(){$(this.resultatPanneau.items.items[0].body.dom).find("#convertirRechercheGPS").click($.proxy(this.convertirRechercheGPS,this)),Recherche.prototype.initEventResultat.call(this)},RechercheGPS.prototype.convertirRechercheGPS=function(){var occurence=this.vecteur.listeOccurences[0],p4326;try{p4326=occurence.projeter("EPSG:4326")}catch(e){return Aide.afficherMessage({titre:"Coordonn\u00e9es invalides",message:"Les coordonn\u00e9es semblent invalides"}),!1}var xAbs=Math.abs(p4326.x),yAbs=Math.abs(p4326.y),lonD=Math.trunc(xAbs),latD=Math.trunc(yAbs),lonC="E",latC="N";p4326.x<0&&(lonC="W"),p4326.y<0&&(latC="S");var lonM=(xAbs-lonD)*60,latM=(yAbs-latD)*60,lonS=(lonM-Math.trunc(lonM))*60,latS=(latM-Math.trunc(latM))*60,lon4326=Math.round(p4326.x*1e4)/1e4
,lat4326=Math.round(p4326.y*1e4)/1e4,lonD_DMS=lonD,latD_DMS=latD,lonM_DMS=Math.trunc(lonM),latM_DMS=Math.trunc(latM),lonS_DMS=Math.round(lonS),latS_DMS=Math.round(latS);latS_DMS>=60&&(latS_DMS=0,latM_DMS++),lonS_DMS>=60&&(lonS_DMS=0,lonM_DMS++),latM_DMS>=60&&(latM_DMS=0,latD_DMS++),lonM_DMS>=60&&(lonM_DMS=0,lonD_DMS++),lonM_DMS=lonM_DMS<10?"0"+lonM_DMS:lonM_DMS,latM_DMS=latM_DMS<10?"0"+latM_DMS:latM_DMS,lonS_DMS=lonS_DMS<10?"0"+lonS_DMS:lonS_DMS,latS_DMS=latS_DMS<10?"0"+latS_DMS:latS_DMS;var lonDMS=lonC+lonD_DMS+" "+lonM_DMS+" "+lonS_DMS,latDMS=latC+latD_DMS+" "+latM_DMS+" "+latS_DMS,lonD_GPS=lonD,latD_GPS=latD,lonM_GPS=Math.round(lonM*1e3)/1e3,latM_GPS=Math.round(latM*1e3)/1e3;latM_GPS>=60&&(latM_GPS=0,latD_GPS++),lonM_GPS>=60&&(lonM_GPS=0,lonD_GPS++),lonM_GPS=lonM_GPS<10?"0"+lonM_GPS.toFixed(3):lonM_GPS.toFixed(3),latM_GPS=latM_GPS<10?"0"+latM_GPS.toFixed(3):latM_GPS.toFixed(3);var lonGPS=lonC+" "+lonD_GPS+" "+lonM_GPS,latGPS=latC+" "+latD_GPS+" "+latM_GPS,zUTM=Math.trunc((180+p4326.x
)/6+1),xUTM,yUTM,zoneUTM;if(zUTM<1||zUTM>60)zoneUTM="invalide";else{var epsgUTM="EPSG:269"+zUTM,pUTM;try{pUTM=occurence.projeter(epsgUTM)}catch(e){return Aide.afficherMessage({titre:"Coordonn\u00e9es invalides",message:"Les coordonn\u00e9es semblent invalides"}),!1}xUTM=pUTM.x.toFixed(),yUTM=pUTM.y.toFixed(),zoneUTM=zUTM+latC}var html="";html+="<table border='0' style='width:100%'>",html+="<tr>",html+="<td colspan='2'><h4>Degr\u00e9s d\u00e9cimaux (WGS84)</h4></td>",html+="</tr>",html+="<tr>",html+="<td><u>Latitude</u></td>",html+="<td><u>Longitude</u></td>",html+="</tr>",html+="<tr>",html+="<td>"+lat4326+"</td>",html+="<td>"+lon4326+"</td>",html+="</tr>",html+="<tr>",html+="<td style='padding-bottom:5px'> </td>",html+="</tr>",html+="<tr>",html+="<td colspan='2'><h4>Degr\u00e9s Minutes Secondes</h4></td>",html+="</tr>",html+="<tr>",html+="<td><u>Latitude</u></td>",html+="<td><u>Longitude</u></td>",html+="</tr>",html+="<tr>",html+="<td>"+latDMS+"</td>",html+="<td>"+lonDMS+"</td>",html+="</tr>"
,html+="<tr>",html+="<td style='padding-bottom:5px'> </td>",html+="</tr>",html+="<tr>",html+="<td colspan='2'><h4>GPS</h4></td>",html+="</tr>",html+="<tr>",html+="<td><u>Latitude</u></td>",html+="<td><u>Longitude</u></td>",html+="</tr>",html+="<tr>",html+="<td>"+latGPS+"</td>",html+="<td>"+lonGPS+"</td>",html+="</tr>",html+="<tr>",html+="<td style='padding-bottom:5px'> </td>",html+="</tr>",html+="<tr>",html+="<td colspan='2'><h4>UTM (Zone "+zoneUTM+")</h4></td>",html+="</tr>",html+="<tr>",html+="<td><u>X</u></td>",html+="<td><u>Y</u></td>",html+="</tr>",html+="<tr>",html+="<td>"+xUTM+"</td>",html+="<td>"+yUTM+"</td>",html+="</tr>",html+="</table>";var $convertirRechercheGPS=$("#convertirRechercheGPS");$convertirRechercheGPS.parent().parent().prepend(html),$convertirRechercheGPS.remove()},RechercheGPS}),define("rechercheHQ",["recherche","aide","point","style","limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheHQ(options){this.options=options||{},this.defautOptions=
$.extend({},this.defautOptions,{typeRecherche:"hq",titre:"HQ"})}return RechercheHQ.prototype=new Recherche,RechercheHQ.prototype.constructor=RechercheHQ,RechercheHQ.prototype.obtenirAideHTML=function(){return"->Z8k5z<br>->65 788 = 65e pyl\u00f4ne de la ligne 788<br>"+this.obtenirLienPDF()},RechercheHQ.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,filtres:[{filtre:"[geocodeMatchCode]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[geocodeMatchCode]==100",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles);$.each(responseJSON.geocoderReponseListe,function(
key,value){var point;if(!value.localisation)return!0;if(!value.localisation.point.x||!value.localisation.point.y){var x=Number(value.localisation.enveloppe.Xmin)+(Number(value.localisation.enveloppe.Xmax)-Number(value.localisation.enveloppe.Xmin))/2,y=Number(value.localisation.enveloppe.Ymin)+(Number(value.localisation.enveloppe.Ymax)-Number(value.localisation.enveloppe.Ymin))/2;point=new Point(x,y),point.limites=new Limites(value.localisation.enveloppe.Xmin,value.localisation.enveloppe.Ymin,value.localisation.enveloppe.Xmax,value.localisation.enveloppe.Ymax)}else point=new Point(value.localisation.point.x,value.localisation.point.y);vecteur.creerOccurence(point,value)}),vecteur.templates.table={colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Adresse",triable:!0,propriete:"adresseLibre"}]},this.traiterResultatVecteur(vecteur,responseJSON.nombreResultat)},RechercheHQ.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||
vecteur.listeOccurences.length;var resultat=this.ajouterPagination(nombreResultats),debut=this.indexDebut+1,fin=this.indexDebut+vecteur.listeOccurences.length;if(fin===0)return this.definirResultat("Aucun r\u00e9sultat"),!1;resultat+="<h4><u>R\u00e9sultats ("+debut+" - "+fin+")</u></h4>",$.each(vecteur.listeOccurences,function(row,occurence){var title=occurence.proprietes.statut.description||"";occurence.proprietes.statut.commentaire&&(title+="\nCommentaire: "+occurence.proprietes.statut.commentaire);var couleur="blue";occurence.proprietes.statut.etat&&occurence.proprietes.statut.etat!=="Officiel"&&(couleur="#ff7200"),resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='"+couleur+"' title='"+title+"'><b>\u00bb </b><u>"+occurence.obtenirPropriete("adresseLibre")+"</u></font></li>"}),this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheHQ}),define("rechercheLieu"
,["recherche","aide","point","style","limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheLieu(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{typeRecherche:"lieu",titre:"Lieu"})}return RechercheLieu.prototype=new Recherche,RechercheLieu.prototype.constructor=RechercheLieu,RechercheLieu.prototype.obtenirAideHTML=function(){return"Ex: <br>->lac Poulin<br>->Mcdo Montr\u00e9al<br>->sortie Chauveau<br>->sortie Henri IV<br>"+this.obtenirLienPDF()},RechercheLieu.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,filtres:[{filtre:"[geocodeMatchCode]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[geocodeMatchCode]==100",style
:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles);$.each(responseJSON.geocoderReponseListe,function(key,value){var point;if(!value.localisation)return!0;if(!value.localisation.point.x||!value.localisation.point.y){var x=Number(value.localisation.enveloppe.Xmin)+(Number(value.localisation.enveloppe.Xmax)-Number(value.localisation.enveloppe.Xmin))/2,y=Number(value.localisation.enveloppe.Ymin)+(Number(value.localisation.enveloppe.Ymax)-Number(value.localisation.enveloppe.Ymin))/2;point=new Point(x,y),point.limites=new Limites(value.localisation.enveloppe.Xmin,value.localisation.enveloppe.Ymin,value.localisation.enveloppe.Xmax,value.localisation.enveloppe.Ymax)}else point=new Point(value.localisation.point.x,value.localisation.point.y);$.each(value.placeListe,function(keyPlace,place){place.type==="Municipalit\u00e9"?value.lieu=place.nom:place.type==="Lieu"&&(value.municipalite=
place.nom)}),vecteur.creerOccurence(point,value)}),vecteur.templates.table={colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Nom",triable:!0,propriete:"lieu"},{titre:"Municipalit\u00e9",triable:!0,propriete:"municipalite"},{titre:"Adresse",triable:!0,propriete:"adresseLibre"}]},this.traiterResultatVecteur(vecteur,responseJSON.nombreResultat)},RechercheLieu.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||vecteur.listeOccurences.length;var resultat=this.ajouterPagination(nombreResultats),debut=this.indexDebut+1,fin=this.indexDebut+vecteur.listeOccurences.length;if(fin===0)return this.definirResultat("Aucun r\u00e9sultat"),!1;resultat+="<h4><u>R\u00e9sultats ("+debut+" - "+fin+")</u></h4>",$.each(vecteur.listeOccurences,function(row,occurence){var couleur="blue";occurence.proprietes.statut.etat&&occurence.proprietes.statut.etat!=="Officiel"&&(couleur="#ff7200"),resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='"+
couleur+"'><b>\u00bb </b><u>"+occurence.proprietes.lieu,occurence.proprietes.municipalite&&(resultat+=" ("+occurence.proprietes.municipalite+")"),resultat+="</u></font><p class='rechercheResultatsListeDescription'>"+occurence.proprietes.adresseLibre+"</p></li>"}),this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheLieu.prototype.initEventResultat=function(){var that=this,resultatListe=$(this.resultatPanneau.items.items[0].body.dom).find("li.rechercheResultatsListe font");$.each(resultatListe,function(key,target){var p_nomTheme=that.vecteur.listeOccurences[key].proprietes.metadonnee.source,getThemeUrl=Aide.utiliserProxy(that.options.serviceMetadonnees+"?action=obtenirDetailTheme&p_nomTheme="+p_nomTheme+"&p_format=html&p_force=true");new Ext.ToolTip({target:target,autoLoad:getThemeUrl,showDelay:0,autoHeight:!0,width:300})}),Recherche.prototype.initEventResultat.call(this)},RechercheLieu}),define
("rechercheInverseAdresse",["recherche","aide","point","style","limites"],function(Recherche,Aide,Point,Style,Limites){function RechercheInverseAdresse(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{typeRecherche:"reverse",titre:"Inv. Adr."})}return RechercheInverseAdresse.prototype=new Recherche,RechercheInverseAdresse.prototype.constructor=RechercheInverseAdresse,RechercheInverseAdresse.prototype.obtenirAideHTML=function(){return"Ex: <br>->Degr\u00e9 d\u00e9cimal - lon, lat (dd.ddd, dd.ddd)<br>"+this.obtenirLienPDF()+this.obtenirCopyright()},RechercheInverseAdresse.prototype.obtenirCopyright=function(){return'<a href="http://adressesquebec.gouv.qc.ca/" target="_blank"><img src="'+Aide.utiliserBaseUri("images/quebec/AQhorizontal-copyrightPetit.png")+'" style=\'height:39px\' alt="Adresse Qu\u00e9bec" ></img></a>'},RechercheInverseAdresse.prototype.lireReponse=function(data,textStatus,jqXHR){if(!jqXHR.responseJSON)return this.definirResultat("Erreur lors de la recherche."
),!1;var responseJSON=jqXHR.responseJSON,style=new Style({visible:!0,icone:Aide.utiliserBaseUri("images/marqueur/marker-orange.png"),iconeHauteur:34,iconeLargeur:20,iconeOffsetX:-10,iconeOffsetY:-34,filtres:[{filtre:"[geocodeMatchCode]>0",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-yellow.png")}},{filtre:"[geocodeMatchCode]==100",style:{icone:Aide.utiliserBaseUri("images/marqueur/marker-green.png")}},{style:{}}]}),styles={defaut:{visible:!1},select:style},vecteur=this.creerVecteurRecherche(styles);$.each(responseJSON.geocoderReponseListe,function(key,value){var point;if(!value.localisation)return!0;if(!value.localisation.point.x||!value.localisation.point.y){var x=Number(value.localisation.enveloppe.Xmin)+(Number(value.localisation.enveloppe.Xmax)-Number(value.localisation.enveloppe.Xmin))/2,y=Number(value.localisation.enveloppe.Ymin)+(Number(value.localisation.enveloppe.Ymax)-Number(value.localisation.enveloppe.Ymin))/2;point=new Point(x,y),point.limites=new Limites(value
.localisation.enveloppe.Xmin,value.localisation.enveloppe.Ymin,value.localisation.enveloppe.Xmax,value.localisation.enveloppe.Ymax)}else point=new Point(value.localisation.point.x,value.localisation.point.y);vecteur.creerOccurence(point,value)}),vecteur.templates.table={colonnes:[{utiliserBase:!1,titre:"id",triable:!0,propriete:"id"},{titre:"Adresse",triable:!0,propriete:"adresseLibre"},{titre:"Distance (m)",triable:!0,propriete:"distance"}]},this.traiterResultatVecteur(vecteur,responseJSON.nombreResultat)},RechercheInverseAdresse.prototype.traiterResultatVecteur=function(vecteur,nombreResultats){nombreResultats=nombreResultats||vecteur.listeOccurences.length;var resultat=this.ajouterPagination(nombreResultats),debut=this.indexDebut+1,fin=this.indexDebut+vecteur.listeOccurences.length;if(fin===0)return this.definirResultat("Aucun r\u00e9sultat"),!1;resultat+="<h4><u>R\u00e9sultats ("+debut+" - "+fin+")</u></h4>",$.each(vecteur.listeOccurences,function(row,occurence){var title=occurence.
proprietes.statut.description||"";occurence.proprietes.statut.commentaire&&(title+="\nCommentaire: "+occurence.proprietes.statut.commentaire);var couleur="blue";occurence.proprietes.statut.etat&&occurence.proprietes.statut.etat!=="Officiel"&&(couleur="#ff7200"),resultat+="<li data-id='"+occurence.id+"' class='rechercheResultatsListe'><font color='"+couleur+"' title='"+title+"'><b>\u00bb </b><u>"+occurence.obtenirPropriete("adresseLibre")+"</u></font></li>"}),this.vecteur=vecteur,this.definirResultat(resultat,this.initEventResultat,this),Recherche.prototype.traiterResultatVecteur.call(this,vecteur)},RechercheInverseAdresse}),define("outilAide",["outil","aide"],function(Outil,Aide){function OutilAide(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{icone:"aide",id:"aide_igo",infobulle:"Guide d'auto-formation",lien:"guides/guide.pdf"})}return OutilAide.prototype=new Outil,OutilAide.prototype.constructor=OutilAide,OutilAide.prototype.executer=function(){var link=
Aide.utiliserBaseUri(this.options.lien);window.open(link)},OutilAide}),require.ajouterConfig({paths:{WMSBrowserBuild:"libs/GeoExt.ux/WMSBrowser/WMSBrowser%-build%"},shim:{WMSBrowserBuild:{deps:["libs/Ext.ux/statusbar/StatusBar","css!libs/Ext.ux/statusbar/css/statusbar"]}}}),define("outilAjoutWMS",["outil","aide"],function(Outil,Aide){function OutilAjoutWMS(options){this.options=options||{},this.options.urlPreenregistre||(this.options.urlPreenregistre=""),this.defautOptions=$.extend({},this.defautOptions,{id:"wmsbrowser",titre:"Ajout de services Web",icone:Aide.utiliserBaseUri("images/toolbar/mActionAddLayer.png"),infobulle:"Outil d'ajout de couches \u00e0 la carte"}),this._extOptions={scale:"medium"},this.configPhp=Aide.obtenirConfig(this.obtenirTypeClasse())}return OutilAjoutWMS.prototype=new Outil,OutilAjoutWMS.prototype.constructor=OutilAjoutWMS,OutilAjoutWMS.prototype.executer=function(){var that=this;this._MyWMSBrowser||this.chargerUrlPreenregistre(),require(["WMSBrowserBuild"],function(
){that.openWindow()})},OutilAjoutWMS.prototype.chargerUrlPreenregistre=function(){this._MyWMSBrowser={},this.configPhp&&this.configPhp.urlPreenregistre&&Aide.toBoolean(this.options.ajoutUrl)!==!1&&(this.options.urlPreenregistre===""?this.options.urlPreenregistre=this.configPhp.urlPreenregistre:this.options.urlPreenregistre=this.configPhp.urlPreenregistre.concat(",").concat(this.options.urlPreenregistre));var datastore_wms_msp=this.options.urlPreenregistre.split(",")||[];$.each(datastore_wms_msp,function(key,value){datastore_wms_msp[key]=[value]}),this._MyWMSBrowser.Store=new Ext.data.SimpleStore({fields:["url"],data:datastore_wms_msp})},OutilAjoutWMS.prototype.openWindow=function(){this._MyWMSBrowser.Window||(this._MyWMSBrowser.Browser=new GeoExt.ux.WMSBrowser({border:!1,zoomOnLayerAdded:!1,closeOnLayerAdded:!0,gridPanelOptions:{height:300},serverStore:this._MyWMSBrowser.Store,layerStore:this.carte.parent._getMapComponent().layers}),this._MyWMSBrowser.Browser.on({beforelayeradded:function(
args){var layer;if(args.layerRecord)layer=args.layerRecord.getLayer();else{if(!args.layer)return!1;layer=args.layer}return layer.options.typeContexte="ajout",layer.allowDelete=!0,layer.opacity||(layer.opacity=1),layer.printOptions={fromLayer:!0},layer.options.printOptions={fromLayer:!0},layer.options.group="Couches WMS ajout\u00e9es",!0},scope:this._MyWMSBrowser}),this._MyWMSBrowser.Window=new Ext.Window({id:"wmsBrowserWindow",resizable:!1,modal:!0,closeAction:"hide",width:600,height:400,title:OpenLayers.i18n("Ajout de couches WMS"),layout:"fit",items:[this._MyWMSBrowser.Browser]})),this._MyWMSBrowser.Window.show()},OutilAjoutWMS}),define("outilDeplacement",["outil"],function(Outil){function OutilDeplacement(options){this.options=options||{}}return OutilDeplacement.prototype=new Outil,OutilDeplacement.prototype.constructor=OutilDeplacement,OutilDeplacement.prototype._init=function(){this.carte.controles.initDeplacement(),this.defautOptions=$.extend({},this.defautOptions,{controle:this.carte
.controles._deplacementControle,icone:"pan",id:"idDragPan",groupe:"carte",_allowDepress:!0,infobulle:"D\u00e9placement : garder le bouton de gauche de la souris enfonc\u00e9 et d\u00e9placer la carte"}),Outil.prototype._init.call(this)},OutilDeplacement}),define("outilDeplacerCentre",["outil","point","aide"],function(Outil,Point,Aide){function OutilDeplacerCentre(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{id:"moveTo",icone:"moveto",infobulle:"Position du centre de la carte"})}return OutilDeplacerCentre.prototype=new Outil,OutilDeplacerCentre.prototype.constructor=OutilDeplacerCentre,OutilDeplacerCentre.prototype.getControlX=function(){return Ext.ComponentMgr.get("xcoord")},OutilDeplacerCentre.prototype.getControlY=function(){return Ext.ComponentMgr.get("ycoord")},OutilDeplacerCentre.prototype.getControlProj=function(){return Ext.ComponentMgr.get("outputProjList")},OutilDeplacerCentre.prototype.getProj=function(){return this.getControlProj().getValue
()},OutilDeplacerCentre.prototype.setX=function(x){this.getControlX().setValue(x.toFixed(6))},OutilDeplacerCentre.prototype.setY=function(y){this.getControlY().setValue(y.toFixed(6))},OutilDeplacerCentre.prototype.displayCoord=function(point){this.setX(point.x),this.setY(point.y)},OutilDeplacerCentre.prototype.updtWindowMoveTo=function(){var point=this.carte.obtenirCentre(),pointProj=point.projeter(this.getProj());this.displayCoord(pointProj)},OutilDeplacerCentre.prototype.moveMapTo=function(){var fieldX=this.getControlX();fieldX=fieldX.setValue(fieldX.getValue().replace(",","."));if(isNaN(fieldX.getValue())){Aide.afficherMessage("Erreur","La coordonn\u00e9e ["+fieldX.fieldLabel+"] est invalide.","OK","ERROR");return}var fieldY=this.getControlY();fieldY=fieldY.setValue(fieldY.getValue().replace(",","."));if(isNaN(fieldY.getValue())){Aide.afficherMessage("Erreur","La coordonn\u00e9e ["+fieldY.fieldLabel+"] est invalide.","OK","ERROR");return}var xf=parseFloat(fieldX.getValue()),yf=parseFloat
(fieldY.getValue()),point=new Point(xf,yf,this.getProj()),pointProj=point.projeter(this.carte.obtenirProjection());this.carte.obtenirLimitesMax().contientPoint(pointProj)?this.carte.definirCentre(pointProj):Aide.afficherMessage("Erreur","Les coordonn\u00e9es saisies sont \u00e0 l'ext\u00e9rieur des limites permises.","OK","ERROR")},OutilDeplacerCentre.prototype.creeWindow=function(){var thisOutil=this;if(!this.windowMoveTo){var oOutputProjStore=new Ext.data.SimpleStore({fields:["value","text"],data:[["EPSG:32198","Lambert-LCC-QC"],["EPSG:4326","G\u00e9ographique - WGS84"],["EPSG:900913","Google"]]}),szDefaultProj=oOutputProjStore.data.items[1].data.value,oOutputProjComboBox=new Ext.form.ComboBox({id:"outputProjList",fieldLabel:"Proj",anchor:"100%",store:oOutputProjStore,valueField:"value",value:szDefaultProj,displayField:"text",editable:!1,mode:"local",triggerAction:"all",lazyRender:!0,lazyInit:!1});oOutputProjComboBox.on("select",function(){var point=new Point(thisOutil.carte.obtenirCentre
().x.toFixed(6),thisOutil.carte.obtenirCentre().y.toFixed(6)),pointProj=point.projeter(this.value);thisOutil.displayCoord(pointProj)});var oFormMoveTo=new Ext.form.FormPanel({baseCls:"x-plain",labelWidth:25,defaultType:"textfield",items:[{id:"xcoord",fieldLabel:"X",anchor:"100%",allowBlank:!1,setSelectOnFocus:!0,maskRe:/^[-0-9.,]$/},{id:"ycoord",fieldLabel:"Y",anchor:"100%",allowBlank:!1,maskRe:/^[-0-9.,]$/},oOutputProjComboBox],buttons:[{text:"Ok",handler:function(){thisOutil.moveMapTo()}}]});this.windowMoveTo=new Ext.Window({title:"Centre de la carte",width:220,height:165,closeAction:"hide",minimizable:!0,resizable:!1,layout:"fit",plain:!0,bodyStyle:"padding:5px;",items:oFormMoveTo,listeners:{hide:function(){thisOutil.carte._carteOL.events.unregister("moveend",thisOutil,thisOutil._moveMapEvent)},scope:this}}),this.windowMoveTo.on("minimize",function(){this.toggleCollapse()}),this.windowMoveTo.on("activate",function(){thisOutil.updtWindowMoveTo(),thisOutil.carte._carteOL.events.register
("moveend",thisOutil,thisOutil._moveMapEvent)})}},OutilDeplacerCentre.prototype._moveMapEvent=function(){this.updtWindowMoveTo()},OutilDeplacerCentre.prototype.executer=function(){this.creeWindow(),this.windowMoveTo.show()},OutilDeplacerCentre}),define("outilSelection",["outil","aide"],function(Outil,Aide){function OutilSelection(options){this.options=options||{}}return OutilSelection.prototype=new Outil,OutilSelection.prototype.constructor=OutilSelection,OutilSelection.prototype._init=function(){this.controleBox=new OpenLayers.Handler.Box(this,{done:this.boxDone},{boxDivClassName:"olHandlerBoxSelectFeature"}),this.controleBox.setMap(this.carte._carteOL),this.defautOptions=$.extend({},this.defautOptions,{icone:Aide.obtenirCheminRacine()+"images/toolbar/gui-pointer.gif",id:"idSelection",groupe:"carte",_allowDepress:!0,infobulle:"S\u00e9lection"}),Outil.prototype._init.call(this)},OutilSelection.prototype.executer=function(){var that=this;this.controleBox.activate()},OutilSelection.prototype
.eteindre=function(){this.controleBox.deactivate()},OutilSelection.prototype.boxDone=function(position){if(position instanceof OpenLayers.Bounds){var minXY=this.carte._carteOL.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.carte._carteOL.getLonLatFromPixel({x:position.right,y:position.top}),bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat),layers=this.carte.gestionCouches.obtenirCouchesParType(["Vecteur","VecteurCluster","WFS"],!0),ctrlPressed=Aide.obtenirNavigateur().obtenirCtrl();for(var l=0;l<layers.length;++l){var layer=layers[l];if(!layer.estActive()||!layer.options.selectionnable)continue;ctrlPressed||layer.deselectionnerTout();var listeOccurences=layer.listeOccurences;layer.listeClusters&&(listeOccurences=listeOccurences.concat(layer.listeClusters));for(var i=0,len=listeOccurences.length;i<len;++i){var feature=listeOccurences[i];if(!feature.estVisible()||!feature.estAffichee())continue;if(bounds.toGeometry().intersects(feature._obtenirGeomOL
())){if(feature.estSelectionnee()){layer.deselectionnerOccurence(feature);continue}layer.selectionnerOccurence(feature)}}}}else position instanceof OpenLayers.Pixel&&(Aide.obtenirNavigateur().obtenirCtrl()||this.carte.gestionCouches.deselectionnerToutesOccurences(),$.each(this.carte.gestionCouches.obtenirListeOccurencesSurvols(),function(key,occurence){if(!occurence.vecteur.options.selectionnable)return!0;if(occurence.estSelectionnee())return occurence.vecteur.deselectionnerOccurence(occurence),!0;occurence.vecteur.selectionnerOccurence(occurence)}))},OutilSelection}),define("outilProfil",["outil","outilMenu","aide"],function(Outil,OutilMenu,Aide){function OutilProfil(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{titre:"Profil",id:"outilProfil",infobulle:"Gestion du compte"},Aide.obtenirProfil())}return OutilProfil.prototype=new OutilMenu,OutilProfil.prototype.constructor=OutilProfil,OutilProfil.prototype._init=function(){OutilMenu.prototype._init.
call(this);var outils=[];this.options.nbProfils>1&&outils.push(new Outil({titre:"Changer de profil",action:function(){var url=Aide.utiliserBaseUri("connexion/role");window.location.replace(url)}}));var contextes=Aide.obtenirConfigXML("contexte");if($.isArray(contextes)){var contexteOutils=[];$.each(contextes,function(key,value){var contexteAttributs=value["@attributes"]||value.attributs||{};contexteOutils.push(new Outil({titre:contexteAttributs.titre||contexteAttributs.id||contexteAttributs.code||"["+key+"]",icone:key===0?"crochet":undefined,action:function(){$.each(this.parent.listeOutils,function(key2,item){item.changerIcone()}),this.changerIcone("crochet"),Aide.obtenirNavigateur().analyseur.chargerContexte(key)}}))}),outils.push(new OutilMenu({titre:"Changer de contexte",outils:contexteOutils}))}outils.push(new Outil({titre:"D\u00e9connexion",action:function(){var url=Aide.utiliserBaseUri("connexion/deconnexion");window.location.replace(url)}})),this.ajouterOutils(outils)},OutilProfil
}),define("outilHistoriqueNavigation",["outil"],function(Outil){var oNavigationCtrl;function OutilHistoriqueNavigation(options){this.options=options||{}}return OutilHistoriqueNavigation.prototype=new Outil,OutilHistoriqueNavigation.prototype.constructor=OutilHistoriqueNavigation,OutilHistoriqueNavigation.prototype._init=function(){var opt=this.options;oNavigationCtrl||(oNavigationCtrl=new OpenLayers.Control.NavigationHistory,this.carte._getCarte().addControl(oNavigationCtrl),oNavigationCtrl.activate()),opt.type=="precedent"?this.defautOptions=$.extend({},this.defautOptions,{icone:"back",id:"idBackHistory",infobulle:"Navigation rapide : reculer",executer:oNavigationCtrl.previous.trigger}):this.defautOptions=$.extend({},this.defautOptions,{icone:"next",id:"idNextHistory",infobulle:"Navigation rapide : avancer",executer:oNavigationCtrl.next.trigger}),Outil.prototype._init.call(this)},OutilHistoriqueNavigation}),define("outilInfo",["outil","aide","browserDetect","fonctions","point"],function(
Outil,Aide,BrowserDetect,Fonctions,Point){function OutilInfo(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{icone:"getinfo",id:"getinfo_msp",groupe:"carte",infobulle:"Information : s\u00e9lectionner une couche additionnelle dans l'arborescence des couches puis cliquer \u00e0 l'endroit voulu sur la carte"})}return OutilInfo.prototype=new Outil,OutilInfo.prototype.constructor=OutilInfo,OutilInfo.prototype._init=function(){Outil.prototype._init.call(this)},OutilInfo.prototype.activerEvent=function(){this.carte.ajouterDeclencheur("desactiverClique",this.releverBouton,{scope:this}),this.carte.ajouterDeclencheur("clique",this.cliqueCarte,{scope:this})},OutilInfo.prototype.desactiverEvent=function(){this.carte.enleverDeclencheur("desactiverClique",this.releverBouton),this.carte.enleverDeclencheur("clique",this.cliqueCarte)},OutilInfo.prototype.executer=function(){this.activerEvent(),this.carte.controles.activerClique(),this.couchesInterroger=[],this.afficherProprietes=
[],this.executerAction=[],this.requetes=0,this.erreurs=0,this.px},OutilInfo.prototype.eteindre=function(){this.desactiverEvent(),this.carte.controles.desactiverClique(),this.reinitialiser()},OutilInfo.prototype.reinitialiser=function(){this.couchesInterroger=[],this.afficherProprietes=[],this.executerAction=[],this.requetes=0,this.erreurs=0,this.px},OutilInfo.prototype.cliqueCarte=function(e){var lonlat=e.point._obtenirLonLatOL();this.px=this.carte._carteOL.getViewPortPxFromLonLat(lonlat),this.couchesInterroger=this.obtCouchesInterrogable();if(this.couchesInterroger.length===0){var occurencesSurvolees=this.carte.gestionCouches.obtenirListeOccurencesSurvols().slice();if(occurencesSurvolees.length)Fonctions.afficherProprietes(occurencesSurvolees);else{var szErrMsg="Veuillez s\u00e9lectionner au moins une couche avant d'effectuer une requ\u00eate.";Aide.afficherMessage("Outil Information",szErrMsg,"OK","Info")}return}this.appelerGetInfo(this.couchesInterroger)},OutilInfo.prototype.obtCouchesInterrogable=
function(){var that=this,couchesInterrogable=[],couches=that.carte.gestionCouches.obtenirCouchesParType("WMS",!0);for(var l=0;l<couches.length;++l){var couche=couches[l];couche.options.estInterrogable=couche._layer.queryable,couche.estActive()&&!couche.estFond()&&couche._layer.getVisibility()&&couche._layer.calculateInRange()&&couche._layer.queryable&&couche._layer.inRange&&couchesInterrogable.push({layer:couche,id:couche.id,infoFormat:couche.options.infoFormat,infoEncodage:couche.options.infoEncodage,infoAction:couche.options.infoAction,infoUrl:couche.options.infoUrl,infoGabarit:couche.options.infoGabarit,estInterrogable:couche.options.estInterrogable,url:couche.options.url,nom:couche.options.nom,titre:couche.options.titre,version:couche.options.version})}return couchesInterrogable.sort(function(a){return a.infoFormat==="html"?1:a.infoFormat==="gml"?-1:a.infoFormat==="gml311"?-1:a.infoFormat==="xml"?-1:0}),couchesInterrogable},OutilInfo.prototype.formatUrl=function(url,args){var s=url,
i=args.length+1;while(i--)s=s.replace(new RegExp("\\{"+i+"\\}","gm"),args[i]);return s=s.replace(/\$/g,"&"),s},OutilInfo.prototype.appelerGetInfo=function(couchesInterroger){var that=this,jqXHRs=[];for(var j=0;j<couchesInterroger.length;j++){var oCoucheObtnInfo=couchesInterroger[j],nomCoucheLegende=oCoucheObtnInfo.titre,Template=oCoucheObtnInfo.infoGabarit,Declencheur=oCoucheObtnInfo.infoAction,coucheInfoFormat,coucheDataType,encodage,xslTemplate;switch(oCoucheObtnInfo.infoFormat){case"html":coucheInfoFormat="text/html",coucheDataType="html";break;case"gml":coucheInfoFormat="application/vnd.ogc.gml",coucheDataType="xml";break;case"gml311":coucheInfoFormat="application/vnd.ogc.gml/3.1.1",coucheDataType="text";break;case"xml":coucheInfoFormat="application/vnd.ogc.wms_xml",coucheDataType="text";break;default:coucheInfoFormat="application/vnd.ogc.gml",coucheDataType="xml"}oCoucheObtnInfo.layer.options.encodage?encodage=oCoucheObtnInfo.layer.options.encodage:BrowserDetect.browser==="Explorer"&&
(encodage=oCoucheObtnInfo.infoEncodage===undefined?"UTF-8":oCoucheObtnInfo.infoEncodage),oCoucheObtnInfo.infoGabarit!==undefined&&oCoucheObtnInfo.infoGabarit.substring(oCoucheObtnInfo.infoGabarit.lastIndexOf("."))===".xsl"&&(xslTemplate=oCoucheObtnInfo.infoGabarit);if(oCoucheObtnInfo.infoUrl!==undefined){var prmt=[],lonlat=this.carte._carteOL.getLonLatFromPixel(this.px),point=new Point(lonlat.lon,lonlat.lat);prmt.push({name:oCoucheObtnInfo.nom,projection:this.carte._carteOL.getProjection(),x:Math.floor(point.x),y:Math.floor(point.y)});var infoUrlFormat=this.formatUrl(oCoucheObtnInfo.infoUrl,[prmt[0].name,prmt[0].projection,prmt[0].x,prmt[0].y]);oCoucheObtnInfo.infoAction!==undefined?this.executerAction=this.executerAction.concat({scope:oCoucheObtnInfo,action:Declencheur,params:infoUrlFormat}):jqXHRs.push($.ajax({url:Aide.utiliserProxy(decodeURIComponent(infoUrlFormat)),context:this,dataType:coucheDataType,success:this.traiterRetourInfo(nomCoucheLegende,coucheInfoFormat,coucheDataType,Template
,oCoucheObtnInfo.id),error:this.gestionRetourErreur(nomCoucheLegende)}))}else jqXHRs.push($.ajax({url:Aide.utiliserProxy(decodeURIComponent(oCoucheObtnInfo.url)),data:{LAYERS:oCoucheObtnInfo.nom,SERVICE:"WMS",REQUEST:"GetFeatureInfo",EXCEPTIONS:"application/vnd.ogc.se_xml",VERSION:oCoucheObtnInfo.version,SRS:this.carte._carteOL.getProjection(),BBOX:this.carte._carteOL.getExtent().toBBOX(),QUERY_LAYERS:oCoucheObtnInfo.nom,X:Math.floor(this.px.x),Y:Math.floor(this.px.y),INFO_FORMAT:coucheInfoFormat,FEATURE_COUNT:100,WIDTH:this.carte._carteOL.size.w,HEIGHT:this.carte._carteOL.size.h,_encodage:encodage,xsl_template:xslTemplate},context:this,dataType:coucheDataType,beforeSend:function(jqXHR){oCoucheObtnInfo.infoEncodage!==undefined&&jqXHR.overrideMimeType&&jqXHR.overrideMimeType(coucheInfoFormat+"; charset="+oCoucheObtnInfo.infoEncodage)},success:this.traiterRetourInfo(nomCoucheLegende,coucheInfoFormat,coucheDataType,Declencheur,Template,oCoucheObtnInfo.id),error:this.gestionRetourErreur(nomCoucheLegende
)}))}$(function(){Aide.afficherMessageChargement({message:"Chargement de votre requ\u00eate, patientez un moment..."}),$.when.apply(null,jqXHRs).done(function(){that.afficherResultats()}).fail(function(jqXHRs,textStatus,errorThrown){Aide.afficherMessageConsole("Erreur: "+textStatus+" : "+jqXHRs.responseText+" : "+errorThrown),Aide.cacherMessageChargement()})})},OutilInfo.prototype.traiterRetourInfo=function(nomCoucheLegende,coucheInfoFormat,coucheDataType,coucheAction,nomGabarit,idCouche){var oGeoJSON=new OpenLayers.Format.GeoJSON,couche=this.carte._carteOL.getLayer(idCouche);return function gestionRetour(data,textStatus,jqXHR){coucheInfoFormat==="text/html"&&this.gestionRetourHtml(data)&&(this.afficherProprietes=this.afficherProprietes.concat({titre:nomCoucheLegende,html:data}));if(coucheDataType==="text"&&coucheInfoFormat==="application/vnd.ogc.wms_xml"){var oFormat=new OpenLayers.Format.WMSGetFeatureInfo,oFeatures=oFormat.read(data);coucheAction===undefined?this.gestionRetourXml(oFeatures
)&&(this.afficherProprietes=this.afficherProprietes.concat({titre:nomCoucheLegende,gabarit:nomGabarit,occurences:oGeoJSON.write(oFeatures)})):this.gestionRetourXml(oFeatures)&&(this.executerAction=this.executerAction.concat({scope:couche,action:coucheAction,params:oGeoJSON.write(oFeatures)}))}if(coucheDataType==="xml"&&coucheInfoFormat==="application/vnd.ogc.gml"){var oFeatures=this.lireGetInfoGml(data);coucheAction===undefined?this.gestionRetourXml(oFeatures)&&(this.afficherProprietes=this.afficherProprietes.concat({titre:nomCoucheLegende,gabarit:nomGabarit,occurences:oGeoJSON.write(oFeatures)})):this.gestionRetourXml(oFeatures)&&(this.executerAction=this.executerAction.concat({scope:couche,action:coucheAction,params:oGeoJSON.write(oFeatures)}))}if(coucheInfoFormat==="application/vnd.ogc.gml/3.1.1"){var oFeatures=this.lireGetInfoGml3(data);coucheAction===undefined?this.gestionRetourXml(oFeatures)&&(this.afficherProprietes=this.afficherProprietes.concat({titre:nomCoucheLegende,gabarit:nomGabarit
,occurences:oGeoJSON.write(oFeatures)})):this.gestionRetourXml(oFeatures)&&(this.executerAction=this.executerAction.concat({scope:couche,action:coucheAction,params:oGeoJSON.write(oFeatures)}))}}},OutilInfo.prototype.lireGetInfoGml=function(gml){var gmlOptions={featureType:"feature",featureName:"featureMember",featureNS:"http://www.opengis.net/gml"},gmlOptionsIn=OpenLayers.Util.extend(OpenLayers.Util.extend({},gmlOptions)),format=new OpenLayers.Format.GML(gmlOptionsIn),oFeatures=format.read(gml);if(oFeatures.length==0)var oFormat=new OpenLayers.Format.WMSGetFeatureInfo,oFeatures=oFormat.read_msGMLOutput(gml);return oFeatures},OutilInfo.prototype.lireGetInfoGml3=function(gml){var gmlOptions={featureType:"feature",featureName:"featureMembers",featureNS:"http://www.opengis.net/gml"},gmlOptionsIn=OpenLayers.Util.extend(OpenLayers.Util.extend({},gmlOptions)),format=new OpenLayers.Format.GML(gmlOptionsIn);return format.read(gml)},OutilInfo.prototype.gestionRetourXml=function(data){var xmlCheck=!1
;return data.toString().toLowerCase().indexOf("wms server error")>-1&&(xmlCheck=!1),data===""&&(xmlCheck=!1),data.length!==0&&(xmlCheck=!0),xmlCheck},OutilInfo.prototype.gestionRetourHtml=function(data){var htmlCheck=!1,strip=data.replace(/<(?:.|\n)*?>/gm,""),tbl=$("<div/>").html(data).find("table");return tbl.length===0&&strip.toLowerCase().indexOf("geoserver getfeatureinfo output")>-1&&(strip=""),tbl.length===0&&data.toLowerCase().indexOf("esri_wms")>-1&&(strip=""),strip.toLowerCase().indexOf("wms server error")>-1&&(strip=""),tbl.length!==0&&(htmlCheck=!0),strip.length!==0&&(htmlCheck=!0),data===""&&(htmlCheck=!1),htmlCheck},OutilInfo.prototype.gestionRetourErreur=function(nomCoucheLegende){return Aide.cacherMessageChargement(),function gestionRetour(data,textStatus,jqXhr){this.erreurs++;var responseBody=data.responseText,status=data.statusText+" ("+data.status+")";data.status===200&&(status="XML invalide",responseBody="La donn\u00e9e originale n'est pas valide pour cet outil.",Aide.
afficherMessageConsole(textStatus+": "+jqXhr.message)),Aide.afficherMessage(status,responseBody,"OK","ERROR")}},OutilInfo.prototype.afficherResultats=function(){var occurencesSurvolees=this.carte.gestionCouches.obtenirListeOccurencesSurvols().slice();occurencesSurvolees.length&&this.afficherProprietes.push(occurencesSurvolees);if(this.afficherProprietes.length===0&&this.executerAction.length===0){Aide.cacherMessageChargement();var szErrMsg="Aucun enregistrement n'a \u00e9t\u00e9 trouv\u00e9.",szErrTitle="Aucun enregistrement trouv\u00e9",szIcon="INFO";this.erreurs===1?(szErrMsg+="  De plus, "+this.erreurs+" erreur est survenue.",szErrTitle+=" et erreur",szIcon="ERROR"):this.erreurs>1&&(szErrMsg+="  De plus, "+this.erreurs+" erreurs sont survenues.",szErrTitle+=" et erreurs",szIcon="ERROR"),Aide.afficherMessage(szErrTitle,szErrMsg,"OK",szIcon),this.reinitialiser();return}this.afficherProprietes.length>0&&Fonctions.afficherProprietes(this.afficherProprietes),this.executerAction.length>0&&
$.each(this.executerAction,function(key,value){Fonctions.executerAction({scope:value.scope,action:value.action,params:value.params})}),Aide.cacherMessageChargement(),this.reinitialiser()},OutilInfo.prototype.cacherGetInfo=function(){$("#divGetInfo").hide()},OutilInfo.prototype.afficherGetInfo=function(){$("#divGetInfo").show()},OutilInfo}),define("outilMesure",["outil","aide","fonctions"],function(Outil,Aide,Fonctions){var oWindowMeasr;function OutilMesure(options){this.options=options||{},this.options.type=="lineaire"?this.defautOptions=$.extend({},this.defautOptions,{controle:this.outilMesureLineaire(),id:"mesure_lineraire",infobulle:"Outil de mesure lin\u00e9aire",groupe:"carte",_allowDepress:!0,icone:"measrlinear"}):this.defautOptions=$.extend({},this.defautOptions,{controle:this.outilMesureSurfacique(),id:"mesure_surface",infobulle:"Outil de mesure de surface",groupe:"carte",_allowDepress:!0,icone:"measrpolgn"})}return OutilMesure.prototype=new Outil,OutilMesure.prototype.constructor=
OutilMesure,OutilMesure.prototype.outilMesureLineaire=function(){var that=this,oMeasrLinearCtrlOptions={title:"Effectuer une mesure lin\u00e9aire.",geodesic:!0,eventListeners:{activate:function(e){that.displayMeasr(""),that.mesureSelection(undefined,"Ligne")},deactivate:function(e){that.$mesureComboPeriUnite&&(that.$mesureComboPeriUnite.off("change"),that.$mesureComboPeriUnite=undefined),that.$mesureComboAireUnite&&(that.$mesureComboAireUnite.off("change"),that.$mesureComboAireUnite=undefined)},measure:function(e){that.executerMeasr(e)},measurepartial:function(e){that.executerMeasr(e)}},handlerOptions:{persist:!0}};return this.controle=new OpenLayers.Control.Measure(OpenLayers.Handler.Path,oMeasrLinearCtrlOptions),this.controle},OutilMesure.prototype.outilMesureSurfacique=function(){var that=this,oMeasrPolgnCtrlOptions={title:"Effectuer une mesure surfacique.",geodesic:!0,eventListeners:{activate:function(e){that.displayMeasr("",""),that.mesureSelection(undefined,"Polygone")},deactivate
:function(e){that.$mesureComboPeriUnite&&(that.$mesureComboPeriUnite.off("change"),that.$mesureComboPeriUnite=undefined),that.$mesureComboAireUnite&&(that.$mesureComboAireUnite.off("change"),that.$mesureComboAireUnite=undefined)},measure:function(e){that.executerMeasr(e)},measurepartial:function(e){that.executerMeasr(e)}},handlerOptions:{persist:!0}};return this.controle=new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,oMeasrPolgnCtrlOptions),this.controle},OutilMesure.prototype.traiterMeasr=function(mesure,unite,type,changeAuto){var that=this;if(!this.$mesureComboPeriUnite){this.$mesureComboPeriUnite=$("#mesureComboPeriUnite");var previous;this.$mesureComboPeriUnite.on("focus",function(){}).change(function(e){that.changeUniteEvent("lineaire")})}this.$mesureComboAireUnite||(this.$mesureComboAireUnite=$("#mesureComboAireUnite"),this.$mesureComboAireUnite.on("focus",function(){}).change(function(e){that.changeUniteEvent("surface")}));var $mesureComboUnite;type==="lineaire"?$mesureComboUnite=
this.$mesureComboPeriUnite:$mesureComboUnite=this.$mesureComboAireUnite;if(changeAuto!==!1){if(!$mesureComboUnite.children()[0])return 0;$mesureComboUnite.children()[0].text="auto ("+unite+")"}var typeChoisi=$mesureComboUnite.val();if(typeChoisi==="auto"){var text=$mesureComboUnite.children()[0].text;typeChoisi=text.substring(6,text.length-1)}return mesure=Fonctions.convertirMesure(mesure,unite,typeChoisi),Math.round(mesure*1e3)/1e3},OutilMesure.prototype.changeUniteEvent=function(type){var $mesureComboUnite,oldUnite,mesure=0,oFormMeasr=oWindowMeasr.items.items[0].items.items[0],length=oFormMeasr.get("length").getValue(),area=oFormMeasr.get("area").value;type==="lineaire"?($mesureComboUnite=this.$mesureComboPeriUnite,oldUnite=this.lengthUnitOL,mesure=this.lengthOL):($mesureComboUnite=this.$mesureComboAireUnite,oldUnite=this.areaUnitOL,mesure=this.areaOL),mesure&&(mesure=this.traiterMeasr(mesure,oldUnite,type,!1));if(type==="lineaire")length=mesure;else{if(area===undefined)return!1;area=
mesure}this.displayMeasr(length,area)},OutilMesure.prototype.executerMeasr=function(event){if(event.order===1){this.lengthOL=event.measure,this.lengthUnitOL=event.units,this.areaOL=undefined;var length=this.traiterMeasr(event.measure,event.units,"lineaire");this.displayMeasr(length)}else{var area=this.traiterMeasr(event.measure,event.units+"\u00b2","surface"),lengthObj=this.controle.getBestLength(event.geometry),length=this.traiterMeasr(lengthObj[0],lengthObj[1],"lineaire");this.lengthOL=lengthObj[0],this.lengthUnitOL=lengthObj[1],this.areaOL=event.measure,this.areaUnitOL=event.units+"\u00b2",this.displayMeasr(length,area)}},OutilMesure.prototype.mesureSelection=function(event,type){var occurence;event?occurence=event.target:(this.controle.handler.layer.setZIndex(this.carte._carteOL.Z_INDEX_BASE.Feature),occurence=this.carte.gestionCouches.obtenirOccurencesSelectionnees(!1)[0]);if(!occurence||type&&occurence.type!==type&&occurence.type!=="Multi"+type){var area,length="";return type==="Polygone"&&
(area=""),this.displayMeasr(length,area),!1}if(occurence.type==="Ligne"||occurence.type==="MultiLigne"){var geometry=occurence._obtenirGeomOL(),lengthObj=this.controle.getBestLength(geometry),length=this.traiterMeasr(lengthObj[0],lengthObj[1],"lineaire");this.lengthOL=lengthObj[0],this.lengthUnitOL=lengthObj[1],this.areaOL=undefined,this.displayMeasr(length)}else if(occurence.type==="Polygone"||occurence.type==="MultiPolygone"){var geometry=occurence._obtenirGeomOL(),lengthObj=this.controle.getBestLength(geometry),length=this.traiterMeasr(lengthObj[0],lengthObj[1],"lineaire"),areaObj=this.controle.getBestArea(geometry),area=this.traiterMeasr(areaObj[0],areaObj[1]+"\u00b2","surface");this.lengthOL=lengthObj[0],this.lengthUnitOL=lengthObj[1],this.areaOL=areaObj[0],this.areaUnitOL=areaObj[1]+"\u00b2",this.displayMeasr(length,area)}},OutilMesure.prototype.displayMeasr=function(length,area){if(!oWindowMeasr){this.oFormMeasr=new Ext.form.FormPanel({columnWidth:1,baseCls:"x-plain",labelWidth:75
,defaultType:"textfield",items:[{id:"length",fieldLabel:"Longueur",anchor:"100%",readOnly:"readonly",xtype:"htmleditor",enableFont:!1,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableLists:!1,enableSourceEdit:!1,height:32},{id:"area",fieldLabel:"Superficie",anchor:"100%",readOnly:"readonly",xtype:"htmleditor",enableFont:!1,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableLists:!1,enableSourceEdit:!1,height:32}]});var oFormMeasrPanel=new Ext.Panel({baseCls:"x-plain",layout:"column",items:[this.oFormMeasr,{width:83,baseCls:"",items:[{baseCls:"",html:"<select id='mesureComboPeriUnite' class='mesureComboUnite'>\n                                        <option value='auto'>auto (km)</option> \n                                        <option value='m'>m</option> \n                                        <option value='km'>km</option>  \n                                        <option value='mile'>miles</option>\n                                    </select>"
},{baseCls:"",html:"<select id='mesureComboAireUnite' class='mesureComboUnite'>\n                                        <option value='auto'>auto (km\u00b2)</option> \n                                        <option value='m'>m\u00b2</option> \n                                        <option value='km\u00b2'>km\u00b2</option>  \n                                        <option value='mile\u00b2'>mile\u00b2</option> \n                                        <option value='acre'>acre</option> \n                                        <option value='hectare'>hectare</option>\n                                    </select>"}]}]});Ext.override(Ext.form.Field,{setLabel:function(text){this.label&&this.label.update(text+":"),this.fieldLabel=text}}),oWindowMeasr=new Ext.Window({title:"Mesure",width:280,height:120,closeAction:"hide",minimizable:!0,resizable:!0,layout:"fit",plain:!0,bodyStyle:"padding:5px;",items:oFormMeasrPanel});var that=this;oWindowMeasr.on("show",function(win){Aide.obtenirNavigateur
().evenements.ajouterDeclencheur("occurenceSelectionnee",function(evt){that.mesureSelection(evt,undefined)},{scope:this,id:"outilMesureOccurenceSelectionnee"})}),oWindowMeasr.on("hide",function(win){Aide.obtenirNavigateur().evenements.enleverDeclencheur("occurenceSelectionnee","outilMesureOccurenceSelectionnee")}),oWindowMeasr.on("minimize",function(){oWindowMeasr.toggleCollapse()})}var oFormMeasr=oWindowMeasr.items.items[0].items.items[0],l=oFormMeasr.get("length");l.setValue(length);var a=oFormMeasr.get("area");area===undefined?(l.setLabel("Longueur"),a.setValue(area),a.disable()):(l.setLabel("P\u00e9rim\u00e8tre"),a.setValue(area),a.enable(),a.iframe&&(a.getEditorBody().style.color="rgb(33,33,33)")),oWindowMeasr.show()},OutilMesure}),define("outilPartagerCarte",["outil","aide","browserDetect","WMS"],function(Outil,Aide,BrowserDetect,WMS){function OutilPartagerCarte(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{titre:"Partager la carte",id:"btnSaveContext"
,icone:Aide.utiliserBaseUri("images/toolbar/mActionFileSave.png"),infobulle:"Sauvegarder ou partager cette carte"});var contexteConfig=Aide.obtenirConfig("Contexte");contexteConfig&&contexteConfig.service&&(this.defautOptions.service=contexteConfig.service),this._extOptions={scale:"medium"}}return OutilPartagerCarte.prototype=new Outil,OutilPartagerCarte.prototype.constructor=OutilPartagerCarte,OutilPartagerCarte.prototype.executer=function(){var that=this;require(["libs/Ext.ux/statusbar/StatusBar","css!libs/Ext.ux/statusbar/css/statusbar"],function(){that.wizardSauvegarderContexte()})},OutilPartagerCarte.prototype.showBusy=function(statusBar,status,message){statusBar=Ext.getCmp(statusBar),statusBar.setVisible(!0),status==="busy"?(statusBar.addClass("x-statusbar"),statusBar.showBusy()):status==="notbusy"?(statusBar.clearStatus(),statusBar.setStatus({text:message}),statusBar.addClass("x-statusbarSucces")):(statusBar.clearStatus(),statusBar.setStatus({text:message}),statusBar.addClass("x-statusbarErreur"
))},OutilPartagerCarte.prototype.wizardSauvegarderContexte=function(){this.goSauvegardeContexteJSON={},this.windowWizardContexte||(this.frmWizardContexte=new Ext.form.FormPanel({labelWidth:50,width:600,height:100,autoHeight:!1,bodyStyle:"padding:0 10px 0;",items:[{id:"msgLien",width:450,xtype:"textfield",fieldLabel:"Lien",name:"lien"}],buttons:[{text:"Envoyer par courriel",formBind:!0,handler:function(){var lien=Ext.getCmp("msgLien");location.href="mailto:?body="+escape(lien.getValue())}},{text:"Fermer",scope:this,handler:function(){this.windowWizardContexte.hide()}}],bbar:new Ext.ux.StatusBar({defaultText:"",id:"frmWizardContexte-statusbar",busyText:"Construction de l'adresse...",hidden:!0,hideMode:"visibility"}),monitorValid:!0}),this.windowWizardContexte=new Ext.Window({title:"Partager le contexte",autoHeight:!0,width:575,closeAction:"hide",layout:"fit",plain:!0,bodyStyle:"padding:5px;",items:this.frmWizardContexte,modal:!0})),this.windowWizardContexte.show(),this.showBusy("frmWizardContexte-statusbar"
,"busy","construction de l'adresse en cours"),this.sauvegardeContexte();var url=Aide.utiliserProxy(this.options.service);Ext.Ajax.request({url:url,jsonData:Ext.util.JSON.encode(this.goSauvegardeContexteJSON),success:function(response){var szContexteURL="";if(response.responseText){szContexteURL=window.location.href,szContexteURL=szContexteURL.replace(/[?&]id=\w+/,""),szContexteURL.indexOf("?")>0?szContexteURL+="&":szContexteURL+="?";var oJSON;try{oJSON=Ext.util.JSON.decode(response.responseText)}catch(e){this.erreurContexteRequete("La sauvegarde n'a pas fonctionner. Veuillez r\u00e9essayer plus tard.")}oJSON&&oJSON.length>0&&oJSON[0]&&oJSON[0].id&&(szContexteURL+="id="+oJSON[0].id)}if(!szContexteURL){this.showBusy("frmWizardContexte-statusbar","notbusy","La sauvegarde n'a pas fonctionner. Veuillez r\u00e9essayer plus tard.");return}var lien=Ext.getCmp("msgLien");lien.setValue(szContexteURL),this.showBusy("frmWizardContexte-statusbar","notbusy","Utilisez l'adresse suivante pour r\u00e9ouvrir le pr\u00e9sent contexte de la carte."
)},failure:function(e){this.erreurContexteRequete("L'utilisation de l'outil 'partager carte' n'est pas permise.<br>"+e.responseText)},scope:this})},OutilPartagerCarte.prototype.erreurContexteRequete=function(erreur){Aide.afficherMessage("Outil indisponible",erreur),this.windowWizardContexte.hide(),this.windowWizardContexte=undefined,this.desactiver()},OutilPartagerCarte.prototype.sauvegardeContexte=function(){var options={center:[this.carte.obtenirCentre().x,this.carte.obtenirCentre().y],zoomlevel:this.carte.obtenirZoom(),layers:this.getContexteDesCouches()};this.goSauvegardeContexteJSON=OpenLayers.Util.applyDefaults(options,this.goSauvegardeContexteJSON)},OutilPartagerCarte.prototype.getContexteDesCouches=function(){var listeCouches=[];for(var i=0;i<this.carte._carteOL.getNumLayers();i++){var couche=this.carte._carteOL.layers[i];listeCouches[i]={name:couche.name,visibility:couche.getVisibility(),opacity:couche.opacity,index:Aide.obtenirNavigateur().obtenirPanneauxParType("PanneauCarte"
)[0]._getMapComponent().map.getLayerIndex(couche)},couche.options.group&&(listeCouches[i].group=couche.options.group),couche.options.typeContexte!="contexte"&&(listeCouches[i].wmsurl=couche.url,listeCouches[i].wmsparams=couche.params,listeCouches[i].wmsoptions=couche.options)}return listeCouches},OutilPartagerCarte}),define("outilRapporterBogue",["outil","aide"],function(Outil,Aide){function OutilRapporterBogue(options){this.options=options||{},this.defautOptions=$.extend({},this.defautOptions,{infobulle:"Adresse, lieu introuvable ou bogue dans l'application : soumettre une incoh\u00e9rence",icone:"bug",id:"geomantis_msp"})}return OutilRapporterBogue.prototype=new Outil,OutilRapporterBogue.prototype.constructor=OutilRapporterBogue,OutilRapporterBogue.prototype.executer=function(){var link=this.options.lien;window.open(link)},OutilRapporterBogue}),define("outilZoomEtendueMaximale",["outil","limites"],function(Outil,Limites){function OutilZoomEtendueMaximale(options){this.options=options||
{},this.gauche=this.options.gauche||-9077974.0862465,this.droite=this.options.droite||-5988695.1516261,this.bas=this.options.bas||5451617.843497,this.haut=this.options.haut||7090427.7296376,this.defautOptions.infobulle="Zoom sur le Qu\u00e9bec en entier",this.defautOptions.icone="zoomfull",this.defautOptions.id="zoom_qc"}return OutilZoomEtendueMaximale.prototype=new Outil,OutilZoomEtendueMaximale.prototype.constructor=OutilZoomEtendueMaximale,OutilZoomEtendueMaximale.prototype.executer=function(){var limites=new Limites(this.gauche,this.bas,this.droite,this.haut);this.carte.zoomer(limites)},OutilZoomEtendueMaximale}),define("outilZoomPreselection",["outil","limites","aide","style","occurence","vecteur"],function(Outil,Limites,Aide,Style,Occurence,Vecteur){function OutilZoomPreselection(options){this.options=options||{};if(this.options.type==="region-adm")this.defautOptions=$.extend({},this.defautOptions,{id:"recherche_par_region_adm",titre:"Par r\u00e9gion administrative",icone:"zoom-reg-adm"
,texteForm:"une r\u00e9gion administrative",fieldLabel:"R\u00e9gion administrative",requestParametre:"GetListeRegionAdm"});else if(this.options.type==="mrc")this.defautOptions=$.extend({},this.defautOptions,{id:"recherche_par_mrc",titre:"Par MRC",icone:"zoom-mrc",texteForm:"une MRC",fieldLabel:"MRC",requestParametre:"GetListeMrc"});else if(this.options.type==="mun")this.defautOptions=$.extend({},this.defautOptions,{id:"recherche_par_mun",titre:"Par municipalit\u00e9",icone:"zoom-mun",texteForm:"une municipalit\u00e9",fieldLabel:"Municipalit\u00e9",requestParametre:"GetListeMun"});else{if(this.options.type!=="hydro")throw new Error("OutilZoomPreselection a besoin d'un type");this.defautOptions=$.extend({},this.defautOptions,{id:"recherche_par_hydro",titre:"Par hydrographie",icone:"zoom-hydro",texteForm:"l'hydrographie",fieldLabel:"Hydrographie",requestParametre:"search_hydronyme"})}this.defautOptions.executer=this.afficherFormRecherche}return OutilZoomPreselection.prototype=new Outil,OutilZoomPreselection
.prototype.constructor=OutilZoomPreselection,OutilZoomPreselection.prototype.submitForm=function(comboBox){if(this.options.type==="hydro"){this.selection&&(this.goHydro(this.selection.st_xmax,this.selection.st_ymin,this.selection.st_xmin,this.selection.st_ymax,this.selection.x,this.selection.y,this.selection.reg_admin),this.cacherFormRecherche());return}var epsg=this.carte.obtenirProjection().split(":")[1],code=comboBox.getValue();code&&($.ajax({url:Aide.utiliserProxy(this.options.service),data:{request:"GetCoordonnees",type:this.options.type.replace("-","_"),id:code,epsg:epsg},async:!1,context:this,success:this.coordonneesZoomSuccess,dataType:"json",error:function(){alert("error...")}}),this.cacherFormRecherche()),comboBox.setValue(""),comboBox.clearInvalid()},OutilZoomPreselection.prototype.creerFormRecherche=function(){var url_coordonnees=Aide.utiliserProxy(this.options.service+"&request="+this.options.requestParametre),store,comboBox;this.selection;var id=this.obtenirId(),texteForm=
this.options.texteForm,fieldLabel=this.options.fieldLabel;if(this.options.type==="hydro"){store=new Ext.data.JsonStore({root:"data",fields:[{name:"affichage",type:"string"},{name:"hydronyme",type:"string"},{name:"ogc_fid",type:"numeric"},{name:"st_xmin",type:"numeric"},{name:"st_ymin",type:"numeric"},{name:"st_xmax",type:"numeric"},{name:"st_ymax",type:"numeric"},{name:"st_x",type:"numeric"},{name:"st_y",type:"numeric"},{name:"bassin_n1",type:"string"},{name:"reg_admin",type:"string"}],url:url_coordonnees});var that=this;comboBox=new Ext.form.ComboBox({id:"combo_"+id,name:"combo",fieldLabel:fieldLabel,typeAhead:!1,typeAheadDelay:2e3,triggerAction:"all",allowBlank:!1,width:400,height:75,emptyText:"Entrer le nom d'une rivi\u00e8re ou d'un lac",store:store,displayField:"affichage",valueField:"ogc_fid",forceSelection:!0,selectOnFocus:!0,anchor:"95%",listeners:{select:function(combo,record,index){that.selection=record.data,this.setValue(record.get("ogc_fid"))},beforeQuery:function(combo){combo
.query.indexOf(",")>0&&(combo.query=combo.query.substring(0,combo.query.indexOf(",")))}}})}else store=new Ext.data.JsonStore({url:url_coordonnees,root:"data",fields:["code","nom"],autoLoad:!0}),comboBox=new Ext.form.ComboBox({id:"combo_"+id,name:"combo",fieldLabel:fieldLabel,allowBlank:!1,emptyText:"S\u00e9lectionner "+texteForm,store:store,displayField:"nom",valueField:"code",forceSelection:!0,mode:"local",selectOnFocus:!0,width:250,scope:this,listeners:{specialkey:function(field,e){e.getKey()==e.ENTER&&this.scope.submitForm(comboBox)}}});store.on("exception",this.gestionErreurStore,this);var button_ok=new Ext.Button({id:"button_ok"+id,type:"button",width:50,text:"Zoomer",scope:this,handler:function(){this.submitForm(comboBox)}}),panneau=new Ext.form.FormPanel({id:"form_recherche_"+id,padding:"5 5 5 5",frame:!0,autoWidth:!0,width:"auto",labelAlign:"top",items:[comboBox],buttons:[button_ok],listeners:{afterrender:function(field){comboBox.focus(!1,250)}}});this.window_recherche=new Ext.Window
({title:"Zoom sur "+texteForm,width:300,closeAction:"hide",resizable:!0,minimizable:!1,plain:!0,items:[panneau]})},OutilZoomPreselection.prototype.goHydro=function(xmin,ymin,xmax,ymax,x,y,no_reg_admin){var limites=new Limites(xmax,ymin,xmin,ymax,"EPSG:32198"),limitesProj=limites.projeter("EPSG:3857");this.carte.zoomer(limitesProj)},OutilZoomPreselection.prototype.afficherFormRecherche=function(){this.window_recherche||this.creerFormRecherche(),this.window_recherche.show()},OutilZoomPreselection.prototype.cacherFormRecherche=function(){this.window_recherche.hide()},OutilZoomPreselection.prototype.gestionErreurStore=function(http_proxy,type,action,options,response){var reponse=response.responseText;response.status===404&&(reponse="Service introuvable."),Aide.afficherMessage("Outil indisponible","L'utilisation de l'outil 'zoom pr\u00e9s\u00e9lection' n'est pas permise.<br>"+reponse),this.cacherFormRecherche(),this.window_recherche=undefined,this.desactiver()},OutilZoomPreselection.prototype
.coordonneesZoomSuccess=function(data){if(data.success){var coordonnees=data.data[0],proprieteOccurence={};for(var propriete in coordonnees)coordonnees.hasOwnProperty(propriete)&&(proprieteOccurence[propriete]=coordonnees[propriete]);proprieteOccurence.regle="true";var etiquette=proprieteOccurence.res_nm_reg||proprieteOccurence.mrs_nm_reg||proprieteOccurence.mus_nm_mun,style=new Style({etiquette:etiquette,couleur:"#2e8cd6",limiteCouleur:"#2e8cd6",opacite:.05}),styleSelectionne=new Style({etiquette:etiquette,couleur:"#2e8cd6",limiteCouleur:"#2e8cd6",limiteEpaisseur:2,opacite:.3}),regle=new Style({etiquette:etiquette,filtres:[{titre:etiquette,filtre:"[regle]=='true'",style:style}]}),regleSelectionnee=new Style({etiquette:etiquette,filtres:[{titre:etiquette,filtre:"[regle]=='true'",style:styleSelectionne}]}),wkt=new OpenLayers.Format.WKT,featureOL=wkt.read(coordonnees.geom),occurence=new Occurence(featureOL.geometry,proprieteOccurence),couche=this.carte.gestionCouches.obtenirCouchesParTitre
("G\u00e9om\u00e9trie - Outil Zoom");if(couche.length>0)couche=couche[0],couche.enleverTout(),couche.definirStyle(regle),couche.definirStyle(regleSelectionnee,"select");else{var couche=new Vecteur({active:!0,suppressionPermise:!0,titre:"G\u00e9om\u00e9trie - Outil Zoom",styles:{defaut:regle,select:regleSelectionnee}});this.carte.gestionCouches.ajouterCouche(couche)}couche.ajouterOccurence(occurence),occurence.afficher(),couche.zoomerOccurences()}else alert(data.errors)},OutilZoomPreselection}),define("outilZoomRectangle",["outil"],function(Outil){function OutilZoomRectangle(options){this.options=options||{}}return OutilZoomRectangle.prototype=new Outil,OutilZoomRectangle.prototype.constructor=OutilZoomRectangle,OutilZoomRectangle.prototype._init=function(){if(this.options.type=="avant"){var oZoomBoxCtrl=new OpenLayers.Control.ZoomBox;this.defautOptions=$.extend({},this.defautOptions,{controle:oZoomBoxCtrl,icone:"zoomin",id:"idZoomBoxIn",groupe:"carte",infobulle:"Zoom avant: cliquer sur la carte ou utiliser le bouton gauche de la souris et d\u00e9placer pour former un rectangle de zoom"
})}else{var oZoomBoxOutCtrl=new OpenLayers.Control.ZoomBox({out:!0});this.defautOptions=$.extend({},this.defautOptions,{controle:oZoomBoxOutCtrl,icone:"zoomout",id:"idZoomBoxOut",groupe:"carte",infobulle:"Zoom arri\u00e8re: cliquer sur la carte ou utiliser le bouton gauche de la souris et d\u00e9placer pour former un rectangle de zoom"})}this.defautOptions._allowDepress=!0,Outil.prototype._init.call(this)},OutilZoomRectangle}),define("panneauAccordeon",["panneau"],function(Panneau){function PanneauAccordeon(options){this.options=options||{},this.listePanneaux=[],this.defautOptions=$.extend({},this.defautOptions,{id:"accordeon-panneau",_layout:"accordion",items:[]}),this._extOptions={layoutConfig:{animate:!0}}}return PanneauAccordeon.prototype=new Panneau,PanneauAccordeon.prototype.constructor=PanneauAccordeon,PanneauAccordeon.prototype.ajouterPanneau=function(panneau){this._extOptions.region="center",panneau.definirCarte(this.carte),panneau._init(),this.listePanneaux.push(panneau),this.
_panel?(this._panel.add(panneau._getPanel()),this.rafraichir()):this.defautOptions.items.push(panneau._getPanel())},PanneauAccordeon.prototype.enleverPanneau=function(panneau){var elExt=this._getPanel().items.get(panneau.obtenirId());elExt&&elExt.destroy()},PanneauAccordeon.prototype.obtenirPanneaux=function(){return this.listePanneaux},PanneauAccordeon.prototype.obtenirPanneauParId=function(id,niveau){var item;return niveau=niveau||1,$.each(this.obtenirPanneaux(),function(key,value){if(value.obtenirId()===id)return item=value,!1;if((niveau>1||niveau<0)&&value.obtenirPanneauParId){item=value.obtenirPanneauParId(id,niveau-1);if(item)return!1}}),item},PanneauAccordeon.prototype.obtenirPanneauxParType=function(type,niveau){var panneaux=[];return niveau=niveau||1,$.each(this.obtenirPanneaux(),function(key,value){value.obtenirTypeClasse()===type&&panneaux.push(value),(niveau>1||niveau<0)&&value.obtenirPanneauxParType&&(panneaux=panneaux.concat(value.obtenirPanneauxParType(type,niveau-1)))}),
panneaux},PanneauAccordeon}),define("panneauEntete",["panneau","aide"],function(Panneau,Aide){function PanneauEntete(options){this.options=options||{};var image=Aide.utiliserBaseUri(this.options.image||"images/bandeau_donnees_ouv_goloc.png"),html=this.options.html||"<div style='text-align: center;'><img style='text-align: center;' src=\""+image+'" alt="" name="Ent\u00eate IGO" border="0" /></div>';this.defautOptions.id="info-entete",this.defautOptions.items=[{id:"header",html:html}]}return PanneauEntete.prototype=new Panneau,PanneauEntete.prototype.constructor=PanneauEntete,PanneauEntete}),define("panneauInfo",["panneau"],function(Panneau){function PanneauInfo(options){this.options=options||{},this._timeUpdateCtrl=0;var firstExpand=!0,epsgArray=new Array;for(var index in Proj4js.defs)if(Proj4js.defs.hasOwnProperty(index)){var units=Proj4js.defs[index].match(/units=(\S*)/),title=Proj4js.defs[index].match(/title=(\S*)/),libelle=units!==null?index+"("+units[1]+")":index,info=title!==null?title
[1]:index;epsgArray.push([index,libelle,info])}var projStore=new Ext.data.ArrayStore({id:0,fields:["code","libelle","info"],data:epsgArray});this.defautOptions.items=[{id:"currentMousePositionComponent",title:"Position souris",items:[{ctCls:"x-form-field infoPosition"}]},{id:"currentScaleComponent",title:"\u00c9chelle",items:[{ctCls:"x-form-field infoPosition"}]},{id:"currentProjectionComponent",title:"Projection",items:[{id:"currentProjectionComboBox",tpl:'<tpl for="."><div ext:qtip="{libelle}. {info}" class="x-combo-list-item" style="text-align:center;">{libelle}</div></tpl>',xtype:"combo",store:projStore,valueField:"code",displayField:"libelle",typeAhead:!0,triggerAction:"all",selectOnFocus:!0,lazyRender:!0,mode:"local",editable:!1,forceSelection:!0,style:{"text-align":"center"},listeners:{select:function(combo,record,index){var projDemande=combo.getValue();Igo.nav.carte.definirProjectionAffichage(projDemande)}}}]}],this.defautOptions.defaults={split:!0,height:50,width:200,minSize:100
,maxSize:200,margins:"0 0 0 0"},this.defautOptions.position="sud",this.defautOptions.id="info-panneau",this.defautOptions.titre="Informations additionnelles",this.defautOptions.dimension=75,this.defautOptions.minDimension=75,this.defautOptions.maxDimension=400,this.defautOptions.ouvert=!1,this.defautOptions.listeners={expand:function(panneau){firstExpand&&(firstExpand=!1,panneau.scope.initialiserEchelle(),panneau.scope.initialiserPositionPointeur(),panneau.scope.afficherProjectionAffichage())},collapse:function(panneau){},afterrender:function(panneau){}}}return PanneauInfo.prototype=new Panneau,PanneauInfo.prototype.constructor=PanneauInfo,PanneauInfo.prototype.afficherHorloge=function(heure){if(!this._currentTimeBody){var body=this._getPanel().get("currentTimeComponent").body;if(!body)return;this._currentTimeBody=body.dom}heure=heure||this.obtenirHeure(),this._currentTimeBody.innerHTML=heure},PanneauInfo.prototype.afficherProjectionAffichage=function(){var combobox=this._getPanel().get
("currentProjectionComponent").getComponent("currentProjectionComboBox");combobox.setValue(this.carte.obtenirProjectionAffichage())},PanneauInfo.prototype.obtenirHeure=function(){var currentDate=new Date,currentHour=this.prefixerHeure(currentDate.getHours()),currentMinute=this.prefixerHeure(currentDate.getMinutes()),currentSecond=this.prefixerHeure(currentDate.getSeconds());return currentHour+":"+currentMinute+":"+currentSecond},PanneauInfo.prototype.prefixerHeure=function(t){return Number(t)<10?"0"+t:t},PanneauInfo.prototype.activerHorloge=function(){var that=this;that.afficherHorloge(),this._timeUpdateCtrl=setInterval(function(){that.afficherHorloge()},1e3)},PanneauInfo.prototype.desactiverHorloge=function(){clearInterval(this._timeUpdateCtrl),this.afficherHorloge(" ")},PanneauInfo.prototype.initialiserEchelle=function(){var body=this._getPanel().get("currentScaleComponent").body;if(body){var currentScaleBody=body.dom;this.carte._getCarte().addControl(new OpenLayers.Control.Scale(currentScaleBody
))}},PanneauInfo.prototype.initialiserPositionPointeur=function(){var body=this._getPanel().get("currentMousePositionComponent").body;if(body){var currentMousePositionBody=body.dom;this.carte._getCarte().addControl(new OpenLayers.Control.MousePosition({div:currentMousePositionBody,numDigits:6}))}},PanneauInfo}),define("panneauMenu",["panneauAccordeon","aide"],function(PanneauAccordeon,Aide){function PanneauMenu(options){this.options=options||{},this.defautOptions.position="ouest",this.defautOptions.id="menu-panneau",this.defautOptions.titre="Menu",this.defautOptions.dimension=300,this.defautOptions.minDimension=175,this.defautOptions.maxDimension=400,this.defautOptions._margins="0 0 0 5",this.defautOptions.items=[]}return PanneauMenu.prototype=new PanneauAccordeon,PanneauMenu.prototype.constructor=PanneauMenu,PanneauMenu.prototype._init=function(){this.estOuvertParDefaut=Aide.toBoolean(this.options.ouvert),this.options.ouvert=!0,PanneauAccordeon.prototype._init.call(this)},PanneauMenu.prototype
.ajouterPanneau=function(panneau){PanneauAccordeon.prototype.ajouterPanneau.call(this,panneau),!this.estOuvertParDefaut&&panneau.obtenirTypeClasse()==="Arborescence"&&this.fermer()},PanneauMenu}),define("text",["module"],function(module){"use strict";var text,fs,Cc,Ci,xpcIsWindows,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation=typeof location!="undefined"&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||undefined),buildMap={},masterConfig=module.config&&module.config()||{};text={version:"2.0.12",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content
.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var modName,ext,temp,strip=!1,index=name.indexOf("."),isRelative=name.indexOf("./")===0||name.indexOf("../")===0;return index!==-1&&(!isRelative||index>1)?(modName=name.substring(0,index),ext=name.substring(index+1,name.length)):modName=name,temp=ext||modName,index=temp.indexOf("!"),index!==-1&&(strip=temp.substring(index+1)==="strip",temp=temp.substring(0,index),ext?ext=temp:modName=temp),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(
url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);return match?(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName.toLowerCase()===hostname.toLowerCase())&&(!uPort&&!uHostName||uPort===port)):!0},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config&&config.isBuild&&!config.inlineText){onLoad();return}masterConfig.isBuild=config&&config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+(parsed.ext?"."+parsed.ext:""),url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;if(url.indexOf("empty:")===0){onLoad();return}!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content
,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)})},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),extPart=parsed.ext?"."+parsed.ext:"",nonStripName=parsed.moduleName+extPart,fileName=req.toUrl(parsed.moduleName+extPart)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}};if(masterConfig.env==="node"||!masterConfig.env&&typeof process!="undefined"&&process.versions&&!!
process.versions.node&&!process.versions["node-webkit"])fs=require.nodeRequire("fs"),text.get=function(url,callback,errback){try{var file=fs.readFileSync(url,"utf8");file.indexOf("\ufeff")===0&&(file=file.substring(1)),callback(file)}catch(e){errback&&errback(e)}};else if(masterConfig.env==="xhr"||!masterConfig.env&&text.createXhr())text.get=function(url,callback,errback,headers){var xhr=text.createXhr(),header;xhr.open("GET",url,!0);if(headers)for(header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header.toLowerCase(),headers[header]);masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;xhr.readyState===4&&(status=xhr.status||0,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback&&errback(err)):callback(xhr.responseText),masterConfig.onXhrComplete&&masterConfig.onXhrComplete(xhr,url))},xhr.send(null)};else if(masterConfig.env==="rhino"||!masterConfig.env&&typeof Packages!="undefined"&&typeof 
java!="undefined")text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&line.charAt(0)===65279&&(line=line.substring(1)),line!==null&&stringBuffer.append(line);while((line=input.readLine())!==null)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)};else if(masterConfig.env==="xpconnect"||!masterConfig.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)Cc=Components.classes,Ci=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),xpcIsWindows="@mozilla.org/windows-registry-key;1"in Cc,text.get=function(url,callback){var inStream,convertStream
,fileObj,readData={};xpcIsWindows&&(url=url.replace(/\//g,"\\")),fileObj=new FileUtils.File(url);try{inStream=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream),inStream.init(fileObj,1,0,!1),convertStream=Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream),convertStream.init(inStream,"utf-8",inStream.available(),Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),convertStream.readString(inStream.available(),readData),convertStream.close(),inStream.close(),callback(readData.value)}catch(e){throw new Error((fileObj&&fileObj.path||"")+": "+e)}};return text}),define("hbars",["text","handlebars"],function(text,Handlebars){var buildMap={},buildTemplateSource="define('{pluginName}!{moduleName}', ['handlebars'], function (Handlebars) { return Handlebars.template({content}); });\n";return{version:"0.0.2",load:function(moduleName,parentRequire,onload,config){if(buildMap[moduleName])onload(buildMap[moduleName]);else{var ext=
config.hbars&&config.hbars.extension||".html",path=config.hbars&&config.hbars.path||"",compileOptions=config.hbars&&config.hbars.compileOptions||{},textOnload=function(source){config.isBuild?(buildMap[moduleName]=Handlebars.precompile(source,compileOptions),onload()):(buildMap[moduleName]=Handlebars.compile(source),onload(buildMap[moduleName]))};textOnload.error=onload.error;var extModuleName=moduleName.substr(moduleName.lastIndexOf("."));if(extModuleName===".html"||extModuleName===".hbar")ext="";text.load(path+moduleName+ext,parentRequire,textOnload,config)}},write:function(pluginName,moduleName,write,config){var content=buildMap[moduleName];content&&write.asModule(pluginName+"!"+moduleName,buildTemplateSource.replace("{pluginName}",pluginName).replace("{moduleName}",moduleName).replace("{content}",content))}}}),define("async",[],function(){var DEFAULT_PARAM_NAME="callback",_uid=0;function injectScript(src){var s,t;s=document.createElement("script"),s.type="text/javascript",s.async=!0,
s.src=src,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(s,t)}function formatUrl(name,id){var paramRegex=/!(.+)/,url=name.replace(paramRegex,""),param=paramRegex.test(name)?name.replace(/.+!/,""):DEFAULT_PARAM_NAME;return url+=url.indexOf("?")<0?"?":"&",url+param+"="+id}function uid(){return _uid+=1,"__async_req_"+_uid+"__"}return{load:function(name,req,onLoad,config){if(config.isBuild)onLoad(null);else{var id=uid();window[id]=onLoad,injectScript(formatUrl(req.toUrl(name),id))}}}}),define("noAMD",["aide"],function(Aide){return{load:function(name,req,onLoad,config){var deps=[];config.shim[name]&&(deps=config.shim[name].deps),req(deps,function(){Aide.chargerJS(req.toUrl(name)+".js",function(){onLoad(null)})})}}}),Proj4js={defaultDatum:"WGS84",proxyScript:null,defsLookupService:"http://spatialreference.org/ref",libPath:"",transform:function(source,dest,point){if(!source.readyToUse||!dest.readyToUse){this.reportError("Proj4js initialization for "+source.srsCode+" not yet complete"
);return}if(point.transformed){this.log("point already transformed");return}if(source.srsProjNumber=="900913"&&dest.datumCode!="WGS84"||dest.srsProjNumber=="900913"&&source.datumCode!="WGS84"){var wgs84=Proj4js.WGS84;this.transform(source,wgs84,point),point.transformed=!1,source=wgs84}return source.projName=="longlat"?(point.x*=Proj4js.common.D2R,point.y*=Proj4js.common.D2R):(source.to_meter&&(point.x*=source.to_meter,point.y*=source.to_meter),source.inverse(point)),source.from_greenwich&&(point.x+=source.from_greenwich),point=this.datum_transform(source.datum,dest.datum,point),dest.from_greenwich&&(point.x-=dest.from_greenwich),dest.projName=="longlat"?(point.x*=Proj4js.common.R2D,point.y*=Proj4js.common.R2D):(dest.forward(point),dest.to_meter&&(point.x/=dest.to_meter,point.y/=dest.to_meter)),point.transformed=!0,point},datum_transform:function(source,dest,point){if(source.compare_datums(dest))return point;if(source.datum_type==Proj4js.common.PJD_NODATUM||dest.datum_type==Proj4js.common
.PJD_NODATUM)return point;source.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),dest.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet.");if(source.es!=dest.es||source.a!=dest.a||source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM||dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM)source.geodetic_to_geocentric(point),(source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM)&&source.geocentric_to_wgs84(point),(dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM)&&dest.geocentric_from_wgs84(point),dest.geocentric_to_geodetic(point);return dest.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),point},reportError:function(msg){},log:function(msg){},loadProjDefinition:function(
proj){if(this.defs[proj.srsCode])return this.defs[proj.srsCode];var options={method:"get",asynchronous:!1,onSuccess:this.defsLoadedFromDisk.bind(this,proj.srsCode)},url=this.libPath+"defs/"+proj.srsAuth.toUpperCase()+proj.srsProjNumber+".js";new OpenLayers.Ajax.Request(url,options);if(this.defs[proj.srsCode])return this.defs[proj.srsCode];if(this.proxyScript){var url=this.proxyScript+this.defsLookupService+"/"+proj.srsAuth+"/"+proj.srsProjNumber+"/proj4";options.onSuccess=this.defsLoadedFromService.bind(this,proj.srsCode),options.onFailure=this.defsFailed.bind(this,proj.srsCode),new OpenLayers.Ajax.Request(url,options)}return this.defs[proj.srsCode]},defsLoadedFromDisk:function(srsCode,transport){eval(transport.responseText)},defsLoadedFromService:function(srsCode,transport){this.defs[srsCode]=transport.responseText},defsFailed:function(srsCode){this.reportError("failed to load projection definition for: "+srsCode),OpenLayers.Util.extend(this.defs[srsCode],this.defs.WGS84)},loadProjCode
:function(projName){if(this.Proj[projName])return;var options={method:"get",asynchronous:!1,onSuccess:this.loadProjCodeSuccess.bind(this,projName),onFailure:this.loadProjCodeFailure.bind(this,projName)},url=this.libPath+"projCode/"+projName+".js";new OpenLayers.Ajax.Request(url,options)},loadProjCodeSuccess:function(projName,transport){eval(transport.responseText),this.Proj[projName].dependsOn&&this.loadProjCode(this.Proj[projName].dependsOn)},loadProjCodeFailure:function(projName){Proj4js.reportError("failed to find projection file for: "+projName)}},Proj4js.Proj=OpenLayers.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,initialize:function(srsCode){this.srsCode=srsCode.toUpperCase(),this.srsCode.indexOf("EPSG")==0?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):(this.srsAuth="",this.srsProjNumber=this.srsCode);var defs=Proj4js.loadProjDefinition(this);defs&&(this.parseDefs(defs),Proj4js.loadProjCode(this.projName),this.callInit
())},callInit:function(){Proj4js.log("projection script loaded for:"+this.projName),OpenLayers.Util.extend(this,Proj4js.Proj[this.projName]),this.init(),this.mapXYToLonLat=this.inverse,this.lonLatToMapXY=this.forward,this.readyToUse=!0},parseDefs:function(proj4opts){this.defData=proj4opts;var paramName,paramVal,paramArray=this.defData.split("+");for(var prop=0;prop<paramArray.length;prop++){var property=paramArray[prop].split("=");paramName=property[0].toLowerCase(),paramVal=property[1];switch(paramName.replace(/\s/gi,"")){case"":break;case"title":this.title=paramVal;break;case"proj":this.projName=paramVal.replace(/\s/gi,"");break;case"units":this.units=paramVal.replace(/\s/gi,"");break;case"datum":this.datumCode=paramVal.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=paramVal.replace(/\s/gi,"");break;case"ellps":this.ellps=paramVal.replace(/\s/gi,"");break;case"a":this.a=parseFloat(paramVal);break;case"b":this.b=parseFloat(paramVal);break;case"lat_0":this.lat0=paramVal*Proj4js.common
.D2R;break;case"lat_1":this.lat1=paramVal*Proj4js.common.D2R;break;case"lat_2":this.lat2=paramVal*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=paramVal*Proj4js.common.D2R;break;case"lon_0":this.long0=paramVal*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(paramVal);break;case"y_0":this.y0=parseFloat(paramVal);break;case"k_0":this.k0=parseFloat(paramVal);break;case"k":this.k0=parseFloat(paramVal);break;case"R_A":this.R=parseFloat(paramVal);break;case"zone":this.zone=parseInt(paramVal);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=paramVal.split(",");break;case"to_meter":this.to_meter=parseFloat(paramVal);break;case"from_greenwich":this.from_greenwich=paramVal*Proj4js.common.D2R;break;case"pm":paramVal=paramVal.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[paramVal]?Proj4js.PrimeMeridian[paramVal]*Proj4js.common.D2R:0;break;case"no_defs":break;default:Proj4js.log("Unrecognized parameter: "+paramName)}}this.deriveConstants()},deriveConstants
:function(){this.nagrids=="@null"&&(this.datumCode="none");if(this.datumCode&&this.datumCode!="none"){var datumDef=Proj4js.Datum[this.datumCode];datumDef&&(this.datum_params=datumDef.towgs84.split(","),this.ellps=datumDef.ellipse,this.datumName=datumDef.datumName)}if(!this.a){var ellipse=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;OpenLayers.Util.extend(this,ellipse)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(pt){return pt},inverse:function(pt){return pt}},Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84"
,"EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83"},Proj4js.common={PI:Math.PI,HALF_PI:Math.PI*.5,TWO_PI:Math.PI*2,FORTPI:.7853981633974483,R2D:57.2957795131,D2R:.0174532925199,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,msfnz:function(eccent,sinphi,cosphi){var con=eccent*sinphi;return cosphi/Math.sqrt(1-con*con)},tsfnz:function(eccent,phi,sinphi){var con=eccent*sinphi,com=.5*eccent;return con=Math.pow((1-con)/(1+con),com),Math.tan(.5*(this.HALF_PI-phi))/con},phi2z:function(eccent,ts){var eccnth=.5*eccent,con,dphi,phi=this.HALF_PI-2*Math.atan(ts);for(i=0;i<=15;i++){con=eccent*Math.sin(phi),dphi=this.HALF_PI-2*Math.atan(ts*Math.pow((1-con)/(1+con),eccnth))-phi,phi+=dphi;if(Math.abs(dphi)<=1e-10)return phi}return alert("phi2z has NoConvergence"),-9999},qsfnz:function(eccent
,sinphi,cosphi){var con;return eccent>1e-7?(con=eccent*sinphi,(1-eccent*eccent)*(sinphi/(1-con*con)-.5/eccent*Math.log((1-con)/(1+con)))):2*sinphi},asinz:function(x){return Math.abs(x)>1&&(x=x>1?1:-1),Math.asin(x)},e0fn:function(x){return 1-.25*x*(1+x/16*(3+1.25*x))},e1fn:function(x){return.375*x*(1+.25*x*(1+.46875*x))},e2fn:function(x){return.05859375*x*x*(1+.75*x)},e3fn:function(x){return x*x*x*(35/3072)},mlfn:function(e0,e1,e2,e3,phi){return e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi)},srat:function(esinp,exp){return Math.pow((1-esinp)/(1+esinp),exp)},sign:function(x){return x<0?-1:1},adjust_lon:function(x){return x=Math.abs(x)<this.PI?x:x-this.sign(x)*this.TWO_PI,x}},Proj4js.datum=OpenLayers.Class({initialize:function(proj){this.datum_type=Proj4js.common.PJD_WGS84,proj.datumCode&&proj.datumCode=="none"&&(this.datum_type=Proj4js.common.PJD_NODATUM);if(proj&&proj.datum_params){for(var i=0;i<proj.datum_params.length;i++)proj.datum_params[i]=parseFloat(proj.datum_params
[i]);if(proj.datum_params[0]!=0||proj.datum_params[1]!=0||proj.datum_params[2]!=0)this.datum_type=Proj4js.common.PJD_3PARAM;proj.datum_params.length>3&&(proj.datum_params[3]!=0||proj.datum_params[4]!=0||proj.datum_params[5]!=0||proj.datum_params[6]!=0)&&(this.datum_type=Proj4js.common.PJD_7PARAM,proj.datum_params[3]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[4]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[5]*=Proj4js.common.SEC_TO_RAD,proj.datum_params[6]=proj.datum_params[6]/1e6+1)}proj&&(this.a=proj.a,this.b=proj.b,this.es=proj.es,this.ep2=proj.ep2,this.datum_params=proj.datum_params)},compare_datums:function(dest){return this.datum_type!=dest.datum_type?!1:this.a!=dest.a||Math.abs(this.es-dest.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1
]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]&&this.datum_params[3]==dest.datum_params[3]&&this.datum_params[4]==dest.datum_params[4]&&this.datum_params[5]==dest.datum_params[5]&&this.datum_params[6]==dest.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?strcmp(pj_param(this.params,"snadgrids").s,pj_param(dest.params,"snadgrids").s)==0:!0},geodetic_to_geocentric:function(p){var Longitude=p.x,Latitude=p.y,Height=p.z?p.z:0,X,Y,Z,Error_Code=0,Rn,Sin_Lat,Sin2_Lat,Cos_Lat;if(Latitude<-Proj4js.common.HALF_PI&&Latitude>-1.001*Proj4js.common.HALF_PI)Latitude=-Proj4js.common.HALF_PI;else if(Latitude>Proj4js.common.HALF_PI&&Latitude<1.001*Proj4js.common.HALF_PI)Latitude=Proj4js.common.HALF_PI;else if(Latitude<-Proj4js.common.HALF_PI||Latitude>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+Latitude),null;return Longitude>Proj4js.common.PI&&(Longitude-=2*Proj4js.common.PI),Sin_Lat=Math.sin(Latitude),Cos_Lat=Math.cos(Latitude),Sin2_Lat=
Sin_Lat*Sin_Lat,Rn=this.a/Math.sqrt(1-this.es*Sin2_Lat),X=(Rn+Height)*Cos_Lat*Math.cos(Longitude),Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude),Z=(Rn*(1-this.es)+Height)*Sin_Lat,p.x=X,p.y=Y,p.z=Z,Error_Code},geocentric_to_geodetic:function(p){var genau=1e-12,genau2=genau*genau,maxiter=30,P,RR,CT,ST,RX,RK,RN,CPHI0,SPHI0,CPHI,SPHI,SDPHI,At_Pole,iter,X=p.x,Y=p.y,Z=p.z?p.z:0,Longitude,Latitude,Height;At_Pole=!1,P=Math.sqrt(X*X+Y*Y),RR=Math.sqrt(X*X+Y*Y+Z*Z);if(P/this.a<genau){At_Pole=!0,Longitude=0;if(RR/this.a<genau){Latitude=Proj4js.common.HALF_PI,Height=-this.b;return}}else Longitude=Math.atan2(Y,X);CT=Z/RR,ST=P/RR,RX=1/Math.sqrt(1-this.es*(2-this.es)*ST*ST),CPHI0=ST*(1-this.es)*RX,SPHI0=CT*RX,iter=0;do iter++,RN=this.a/Math.sqrt(1-this.es*SPHI0*SPHI0),Height=P*CPHI0+Z*SPHI0-RN*(1-this.es*SPHI0*SPHI0),RK=this.es*RN/(RN+Height),RX=1/Math.sqrt(1-RK*(2-RK)*ST*ST),CPHI=ST*(1-RK)*RX,SPHI=CT*RX,SDPHI=SPHI*CPHI0-CPHI*SPHI0,CPHI0=CPHI,SPHI0=SPHI;while(SDPHI*SDPHI>genau2&&iter<maxiter);return Latitude=
Math.atan(SPHI/Math.abs(CPHI)),p.x=Longitude,p.y=Latitude,p.z=Height,p},geocentric_to_geodetic_noniter:function(p){var X=p.x,Y=p.y,Z=p.z?p.z:0,Longitude,Latitude,Height,W,W2,T0,T1,S0,S1,Sin_B0,Sin3_B0,Cos_B0,Sin_p1,Cos_p1,Rn,Sum,At_Pole;X=parseFloat(X),Y=parseFloat(Y),Z=parseFloat(Z),At_Pole=!1;if(X!=0)Longitude=Math.atan2(Y,X);else if(Y>0)Longitude=Proj4js.common.HALF_PI;else if(Y<0)Longitude=-Proj4js.common.HALF_PI;else{At_Pole=!0,Longitude=0;if(Z>0)Latitude=Proj4js.common.HALF_PI;else{if(!(Z<0)){Latitude=Proj4js.common.HALF_PI,Height=-this.b;return}Latitude=-Proj4js.common.HALF_PI}}return W2=X*X+Y*Y,W=Math.sqrt(W2),T0=Z*Proj4js.common.AD_C,S0=Math.sqrt(T0*T0+W2),Sin_B0=T0/S0,Cos_B0=W/S0,Sin3_B0=Sin_B0*Sin_B0*Sin_B0,T1=Z+this.b*this.ep2*Sin3_B0,Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0,S1=Math.sqrt(T1*T1+Sum*Sum),Sin_p1=T1/S1,Cos_p1=Sum/S1,Rn=this.a/Math.sqrt(1-this.es*Sin_p1*Sin_p1),Cos_p1>=Proj4js.common.COS_67P5?Height=W/Cos_p1-Rn:Cos_p1<=-Proj4js.common.COS_67P5?Height=W/-Cos_p1-Rn
:Height=Z/Sin_p1+Rn*(this.es-1),At_Pole==0&&(Latitude=Math.atan(Sin_p1/Cos_p1)),p.x=Longitude,p.y=Latitude,p.z=Height,p},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)p.x+=this.datum_params[0],p.y+=this.datum_params[1],p.z+=this.datum_params[2];else{var Dx_BF=this.datum_params[0],Dy_BF=this.datum_params[1],Dz_BF=this.datum_params[2],Rx_BF=this.datum_params[3],Ry_BF=this.datum_params[4],Rz_BF=this.datum_params[5],M_BF=this.datum_params[6],x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF,y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF,z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;p.x=x_out,p.y=y_out,p.z=z_out}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM)p.x-=this.datum_params[0],p.y-=this.datum_params[1],p.z-=this.datum_params[2];else{var Dx_BF=this.datum_params[0],Dy_BF=this.datum_params[1],Dz_BF=this.datum_params[2],Rx_BF=this.datum_params[3],Ry_BF=this.datum_params[4],Rz_BF=this.datum_params[5],M_BF=this.datum_params[6],x_tmp=(p.x-
Dx_BF)/M_BF,y_tmp=(p.y-Dy_BF)/M_BF,z_tmp=(p.z-Dz_BF)/M_BF;p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp,p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp,p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp}}}),Proj4js.Point=OpenLayers.Class({initialize:function(x,y,z){typeof x=="object"?(this.x=x[0],this.y=x[1],this.z=x[2]||0):(this.x=x,this.y=y,this.z=z||0)},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76
:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345
,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"
},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:""},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel"
,datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");return}this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative")},forward:function(p){return p.x=Proj4js.common.adjust_lon(p.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[p]),sinc=Math.sin(p.y),cosc=Math.cos(p.y),cosl=Math.cos(p.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),p.x=k*cosc*Math
.sin(p.x),p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),p.x=this.a*p.x+this.x0,p.y=this.a*p.y+this.y0,p},inverse:function(p){var lon,lat;return p.x=(p.x-this.x0)/this.a,p.y=(p.y-this.y0)/this.a,p.x/=this.k0,p.y/=this.k0,(rho=Math.sqrt(p.x*p.x+p.y*p.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho),lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc)):(lat=this.phic0,lon=0),p.x=lon,p.y=lat,Proj4js.Proj.gauss.inverse.apply(this,[p]),p.x=Proj4js.common.adjust_lon(p.x+this.long0),p}},Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");return}this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this
.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0},forward:function(p){var lon=p.x,lat=p.y;this.sin_phi=Math.sin(lat),this.cos_phi=Math.cos(lat);var qs=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0,theta=this.ns0*Proj4js.common.adjust_lon(lon-this.long0),x=rh1*Math.sin(theta)+this.x0,y=this.rh-rh1*Math.cos(theta)+this.y0;return p.x=x,p.y=y,p},inverse:function(p){var rh1,qs
,con,theta,lon,lat;return p.x-=this.x0,p.y=this.rh-p.y+this.y0,this.ns0>=0?(rh1=Math.sqrt(p.x*p.x+p.y*p.y),con=1):(rh1=-Math.sqrt(p.x*p.x+p.y*p.y),con=-1),theta=0,rh1!=0&&(theta=Math.atan2(con*p.x,con*p.y)),con=rh1*this.ns0/this.a,qs=(this.c-con*con)/this.ns0,this.e3>=1e-10?(con=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,Math.abs(Math.abs(con)-Math.abs(qs))>1e-10?lat=this.phi1z(this.e3,qs):qs>=0?lat=.5*PI:lat=-0.5*PI):lat=this.phi1z(e3,qs),lon=Proj4js.common.adjust_lon(theta/this.ns0+this.long0),p.x=lon,p.y=lat,p},phi1z:function(eccent,qs){var con,com,dphi,phi=Proj4js.common.asinz(.5*qs);if(eccent<Proj4js.common.EPSLN)return phi;var eccnts=eccent*eccent;for(var i=1;i<=25;i++){sinphi=Math.sin(phi),cosphi=Math.cos(phi),con=eccent*sinphi,com=1-con*con,dphi=.5*com*com/cosphi*(qs/(1-eccnts)-sinphi/com+.5/eccent*Math.log((1-con)/(1+con))),phi+=dphi;if(Math.abs(dphi)<=1e-7)return phi}return Proj4js.reportError("aea:phi1z:Convergence error"),null}};function phi4z(eccent,e0,e1,e2
,e3,a,b,c,phi){var sinphi,sin2ph,tanph,ml,mlp,con1,con2,con3,dphi,i;phi=a;for(i=1;i<=15;i++){sinphi=Math.sin(phi),tanphi=Math.tan(phi),c=tanphi*Math.sqrt(1-eccent*sinphi*sinphi),sin2ph=Math.sin(2*phi),ml=e0*phi-e1*sin2ph+e2*Math.sin(4*phi)-e3*Math.sin(6*phi),mlp=e0-2*e1*Math.cos(2*phi)+4*e2*Math.cos(4*phi)-6*e3*Math.cos(6*phi),con1=2*ml+c*(ml*ml+b)-2*a*(c*ml+1),con2=eccent*sin2ph*(ml*ml+b-2*a*ml)/(2*c),con3=2*(a-ml)*(c*mlp-2/sin2ph)-2*mlp,dphi=con1/(con2+con3),phi+=dphi;if(Math.abs(dphi)<=1e-10)return phi}return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(x){var con,com;return con=1+x,com=1-x,Math.sqrt(Math.pow(con,con)*Math.pow(com,com))}Proj4js.Proj.poly={init:function(){var temp;if(this.lat0=0)this.lat0=90;this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this
.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(p){var sinphi,cosphi,al,c,con,ml,ms,x,y,lon=p.x,lat=p.y;return con=Proj4js.common.adjust_lon(lon-this.long0),Math.abs(lat)<=1e-7?(x=this.x0+this.a*con,y=this.y0-this.a*this.ml0):(sinphi=Math.sin(lat),cosphi=Math.cos(lat),ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat),ms=Proj4js.common.msfnz(this.e,sinphi,cosphi),con=sinphi,x=this.x0+this.a*ms*Math.sin(con)/sinphi,y=this.y0+this.a*(ml-this.ml0+ms*(1-Math.cos(con))/sinphi)),p.x=x,p.y=y,p},inverse:function(p){var sin_phi,cos_phi,al,b,c,con,ml,iflg,lon,lat;p.x-=this.x0,p.y-=this.y0,al=this.ml0+p.y/this.a,iflg=0;if(Math.abs(al)<=1e-7)lon=p.x/this.a+this.long0,lat=0;else{b=al*al+p.x/this.a*(p.x/this.a),iflg=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,c,lat);if(iflg!=1)return iflg;lon=Proj4js.common.adjust_lon(asinz(p.x*c/this.a)/Math.sin(lat)+this.long0)}return p.x=lon,p.y=lat,p}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.
lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+this.a*dlon*Math.cos(this.lat0),y=this.y0+this.a*lat;return this.t1=x,this.t2=Math.cos(this.lat0),p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0,p.y-=this.y0;var lat=p.y/this.a;Math.abs(lat)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var lon=Proj4js.common.adjust_lon(this.long0+p.x/(this.a*Math.cos(this.lat0)));p.x=lon,p.y=lat}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(p){var lon=p.x,lat=p.y;if(lat*Proj4js.common.R2D>90&&lat*Proj4js.common.R2D<-90&&lon*Proj4js.common.R2D>180&&lon*Proj4js.common.R2D<-180)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+lon+" : "+lat),null;var x,y;if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js
.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0),y=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*lat));else{var sinphi=Math.sin(lat),ts=Proj4js.common.tsfnz(this.e,lat,sinphi);x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0),y=this.y0-this.a*this.k0*Math.log(ts)}return p.x=x,p.y=y,p},inverse:function(p){var x=p.x-this.x0,y=p.y-this.y0,lon,lat;if(this.sphere)lat=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-y/this.a*this.k0));else{var ts=Math.exp(-y/(this.a*this.k0));lat=Proj4js.common.phi2z(this.e,ts);if(lat==-9999)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return lon=Proj4js.common.adjust_lon(this.long0+x/(this.a*this.k0)),p.x=lon,p.y=lat,p}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");return}this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5
,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,this.inverse=Proj4js.Proj.tmerc.inverse}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),this.mode!=0?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),Math.abs(this.lat1-this.lat2)>=Proj4js.common
.EPSLN?this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1):this.ns=this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(p){var lon=p.x,lat=p.y,ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat),rh1=this.a*(this.g-ml),theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0),x=this.x0+rh1*Math.sin(theta),y=this.y0+this.rh-rh1*Math.cos(theta);return p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0,p.y=this.rh-p.y+this.y0;var con,rh1;if(this.ns>=0)var rh1=Math.sqrt(p.x*p.x+p.y*p.y),con=1;else rh1=-Math.sqrt(p.x*p.x+p.y*p.y),con=-1;var theta=0;rh1!=0&&(theta=Math.atan2(con*p.x,con*p.y));var ml=this.g-rh1/this.a,lat=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3),lon=Proj4js.common.adjust_lon(this.long0+theta/this.ns);return p.x=lon,p.y=lat,p},phi3z:function(ml,e0,e1,e2,e3){var phi,dphi;phi=ml;for(var i=0;i<15;i++){dphi=(ml+e1*Math.sin(2*phi)-e2*Math.sin
(4*phi)+e3*Math.sin(6*phi))/e0-phi,phi+=dphi;if(Math.abs(dphi)<=1e-10)return phi}return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(p){var lon=p.x,lat=p.y,delta_lon=Proj4js.common.adjust_lon(lon-this.long0),con,x,y,sin_phi=Math.sin(lat),cos_phi=Math.cos(lat);if(this.sphere){var b=cos_phi*Math.sin(delta_lon);if(Math.abs(Math.abs(b)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;x=.5*this.a*this.k0*Math.log((1+b)/(1-b)),con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1-b*b)),lat<0&&(con=-con),y=this.a*this.k0*(con-this.lat0)}else{var al=cos_phi*delta_lon,als=Math.pow(al,2),c=this.ep2*Math.pow(cos_phi,2),tq=Math.tan(lat),t=Math
.pow(tq,2);con=1-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con),ml=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);x=this.k0*n*al*(1+als/6*(1-t+c+als/20*(5-18*t+Math.pow(t,2)+72*c-58*this.ep2)))+this.x0,y=this.k0*(ml-this.ml0+n*tq*als*(.5+als/24*(5-t+9*c+4*Math.pow(c,2)+als/30*(61-58*t+Math.pow(t,2)+600*c-330*this.ep2))))+this.y0}return p.x=x,p.y=y,p},inverse:function(p){var con,phi,delta_phi,i,max_iter=6,lat,lon;if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0)),g=.5*(f-1/f),temp=this.lat0+p.y/(this.a*this.k0),h=Math.cos(temp);con=Math.sqrt((1-h*h)/(1+g*g)),lat=Math.asinz(con),temp<0&&(lat=-lat),g==0&&h==0?lon=this.long0:lon=Proj4js.common.adjust_lon(Math.atan2(g,h)+this.long0)}else{var x=p.x-this.x0,y=p.y-this.y0;con=(this.ml0+y/this.k0)/this.a,phi=con;for(i=0;;i++){delta_phi=(con+this.e1*Math.sin(2*phi)-this.e2*Math.sin(4*phi)+this.e3*Math.sin(6*phi))/this.e0-phi,phi+=delta_phi;if(Math.abs(delta_phi)<=Proj4js.common.EPSLN)break;if(i>=max_iter)return Proj4js
.reportError("tmerc:inverse: Latitude failed to converge"),95}if(Math.abs(phi)<Proj4js.common.HALF_PI){var sin_phi=Math.sin(phi),cos_phi=Math.cos(phi),tan_phi=Math.tan(phi),c=this.ep2*Math.pow(cos_phi,2),cs=Math.pow(c,2),t=Math.pow(tan_phi,2),ts=Math.pow(t,2);con=1-this.es*Math.pow(sin_phi,2);var n=this.a/Math.sqrt(con),r=n*(1-this.es)/con,d=x/(n*this.k0),ds=Math.pow(d,2);lat=phi-n*tan_phi*ds/r*(.5-ds/24*(5+3*t+10*c-4*cs-9*this.ep2-ds/30*(61+90*t+298*c+45*ts-252*this.ep2-3*cs))),lon=Proj4js.common.adjust_lon(this.long0+d*(1-ds/6*(1+2*t+c-ds/20*(5-2*c+28*t-3*cs+8*this.ep2+24*ts)))/cos_phi)}else lat=Proj4js.common.HALF_PI*Proj4js.common.sign(y),lon=this.long0}return p.x=lon,p.y=lat,p}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.ortho={init:function(def){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(p)
{var sinphi,cosphi,dlon,coslon,ksp,g,lon=p.x,lat=p.y;dlon=Proj4js.common.adjust_lon(lon-this.long0),sinphi=Math.sin(lat),cosphi=Math.cos(lat),coslon=Math.cos(dlon),g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon,ksp=1;if(g>0||Math.abs(g)<=Proj4js.common.EPSLN)var x=this.a*ksp*cosphi*Math.sin(dlon),y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon);else Proj4js.reportError("orthoFwdPointError");return p.x=x,p.y=y,p},inverse:function(p){var rh,z,sinz,cosz,temp,con,lon,lat;p.x-=this.x0,p.y-=this.y0,rh=Math.sqrt(p.x*p.x+p.y*p.y),rh>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),z=Proj4js.common.asinz(rh/this.a),sinz=Math.sin(z),cosi=Math.cos(z),lon=this.long0,Math.abs(rh)<=Proj4js.common.EPSLN&&(lat=this.lat0),lat=Proj4js.common.asinz(cosz*this.sin_p14+y*sinz*this.cos_p14/rh),con=Math.abs(lat0)-Proj4js.common.HALF_PI,Math.abs(con)<=Proj4js.common.EPSLN&&(this.lat0>=0?lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y)):lon=Proj4js.common.adjust_lon(this.
long0-Math.atan2(-p.x,p.y))),con=cosz-this.sin_p14*Math.sin(lat);if(Math.abs(con)>=Proj4js.common.EPSLN||Math.abs(x)>=Proj4js.common.EPSLN)lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sinz*this.cos_p14,con*rh));return p.x=lon,p.y=lat,p}},Proj4js.Proj.stere={ssfn_:function(phit,sinphi,eccen){return sinphi*=eccen,Math.tan(.5*(Proj4js.common.HALF_PI+phit))*Math.pow((1-sinphi)/(1+sinphi),.5*eccen)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var t=Math.abs(this.lat0);Math.abs(t)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:this.mode=t>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits);if(this.es){var X;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(t=Math.sin(this.phits
),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,t),t*=this.e,this.akm1/=Math.sqrt(1-t*t));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:t=Math.sin(this.lat0),X=2*Math.atan(this.ssfn_(this.lat0,t,this.e))-Proj4js.common.HALF_PI,t*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-t*t),this.sinX1=Math.sin(X),this.cosX1=Math.cos(X)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(p){var lon=p.x,lat=p.y,x,y;if(this.sphere){var sinphi,cosphi,coslam,sinlam;sinphi=Math.sin(lat),cosphi=Math.cos(lat),coslam=Math.cos(lon),sinlam=Math.sin(lon);switch(this.mode){case this.EQUIT:y=1+cosphi*coslam,y<=Proj4js.common.EPSLN&&F_ERROR,y=this.akm1/y,x=y*cosphi*
sinlam,y*=sinphi;break;case this.OBLIQ:y=1+this.sinph0*sinphi+this.cosph0*cosphi*coslam,y<=Proj4js.common.EPSLN&&F_ERROR,y=this.akm1/y,x=y*cosphi*sinlam,y*=this.cosph0*sinphi-this.sinph0*cosphi*coslam;break;case this.N_POLE:coslam=-coslam,lat=-lat;case this.S_POLE:Math.abs(lat-Proj4js.common.HALF_PI)<this.TOL&&F_ERROR,y=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*lat),x=sinlam*y,y*=coslam}}else{coslam=Math.cos(lon),sinlam=Math.sin(lon),sinphi=Math.sin(lat);if(this.mode==this.OBLIQ||this.mode==this.EQUIT)X=2*Math.atan(this.ssfn_(lat,sinphi,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X);switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*coslam)),y=A*(this.cosX1*sinX-this.sinX1*cosX*coslam),x=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*coslam),y=A*sinX,x=A*cosX;break;case this.S_POLE:lat=-lat,coslam=-coslam,sinphi=-sinphi;case this.N_POLE:x=this.akm1*Proj4js.common.tsfnz(this.e,lat,sinphi),y=-x*coslam}x*=sinlam}return p.x=
x*this.a+this.x0,p.y=y*this.a+this.y0,p},inverse:function(p){var x=(p.x-this.x0)/this.a,y=(p.y-this.y0)/this.a,lon,lat,cosphi,sinphi,tp=0,phi_l=0,rho,halfe=0,pi2=0,i;if(this.sphere){var c,rh,sinc,cosc;rh=Math.sqrt(x*x+y*y),c=2*Math.atan(rh/this.akm1),sinc=Math.sin(c),cosc=Math.cos(c),lon=0;switch(this.mode){case this.EQUIT:Math.abs(rh)<=Proj4js.common.EPSLN?lat=0:lat=Math.asin(y*sinc/rh);if(cosc!=0||x!=0)lon=Math.atan2(x*sinc,cosc*rh);break;case this.OBLIQ:Math.abs(rh)<=Proj4js.common.EPSLN?lat=this.phi0:lat=Math.asin(cosc*sinph0+y*sinc*cosph0/rh),c=cosc-sinph0*Math.sin(lat);if(c!=0||x!=0)lon=Math.atan2(x*sinc*cosph0,c*rh);break;case this.N_POLE:y=-y;case this.S_POLE:Math.abs(rh)<=Proj4js.common.EPSLN?lat=this.phi0:lat=Math.asin(this.mode==this.S_POLE?-cosc:cosc),lon=x==0&&y==0?0:Math.atan2(x,y)}}else{rho=Math.sqrt(x*x+y*y);switch(this.mode){case this.OBLIQ:case this.EQUIT:tp=2*Math.atan2(rho*this.cosX1,this.akm1),cosphi=Math.cos(tp),sinphi=Math.sin(tp),rho==0?phi_l=Math.asin(cosphi*this
.sinX1):phi_l=Math.asin(cosphi*this.sinX1+y*sinphi*this.cosX1/rho),tp=Math.tan(.5*(Proj4js.common.HALF_PI+phi_l)),x*=sinphi,y=rho*this.cosX1*cosphi-y*this.sinX1*sinphi,pi2=Proj4js.common.HALF_PI,halfe=.5*this.e;break;case this.N_POLE:y=-y;case this.S_POLE:tp=-rho/this.akm1,phi_l=Proj4js.common.HALF_PI-2*Math.atan(tp),pi2=-Proj4js.common.HALF_PI,halfe=-0.5*this.e}for(i=this.NITER;i--;phi_l=lat){sinphi=this.e*Math.sin(phi_l),lat=2*Math.atan(tp*Math.pow((1+sinphi)/(1-sinphi),halfe))-pi2;if(Math.abs(phi_l-lat)<this.CONV)return this.mode==this.S_POLE&&(lat=-lat),lon=x==0&&y==0?0:Math.atan2(x,y),p.x=lon,p.y=lat,p}}}},Proj4js.Proj.mill={init:function(){},forward:function(p){var lon=p.x,lat=p.y;dlon=Proj4js.common.adjust_lon(lon-this.long0);var x=this.x0+this.R*dlon,y=this.y0+this.R*Math.log(Math.tan(Proj4js.common.PI/4+lat/2.5))*1.25;return p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0,p.y-=this.y0;var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.R),lat=2.5*(Math.atan(Math.exp(p.y/this.
R/1.25))-Proj4js.common.PI/4);return p.x=lon,p.y=lat,p}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(p){var x,y,delta_lon,lon=p.x,lat=p.y;return delta_lon=Proj4js.common.adjust_lon(lon-this.long0),x=this.R*delta_lon*Math.cos(lat)+this.x0,y=this.R*lat+this.y0,p.x=x,p.y=y,p},inverse:function(p){var lat,temp,lon;return p.x-=this.x0,p.y-=this.y0,lat=p.y/this.R,Math.abs(lat)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),temp=Math.abs(lat)-Proj4js.common.HALF_PI,Math.abs(temp)>Proj4js.common.EPSLN?(temp=this.long0+p.x/(this.R*Math.cos(lat)),lon=Proj4js.common.adjust_lon(temp)):lon=this.long0,p.x=lon,p.y=lat,p}};var GEOCENT_LAT_ERROR=1,COS_67P5=.3826834323650898,AD_C=1.0026;function cs_geodetic_to_geocentric(cs,p){var Longitude=p.x,Latitude=p.y,Height=p.z,X,Y,Z,Error_Code=0,Rn,Sin_Lat,Sin2_Lat,Cos_Lat;if(Latitude<-HALF_PI&&Latitude>-1.001*HALF_PI)Latitude=-HALF_PI;else if(Latitude>HALF_PI&&Latitude<1.001*HALF_PI)Latitude=HALF_PI;else if(Latitude<-HALF_PI||
Latitude>HALF_PI)Error_Code|=GEOCENT_LAT_ERROR;return Error_Code||(Longitude>PI&&(Longitude-=2*PI),Sin_Lat=Math.sin(Latitude),Cos_Lat=Math.cos(Latitude),Sin2_Lat=Sin_Lat*Sin_Lat,Rn=cs.a/Math.sqrt(1-cs.es*Sin2_Lat),X=(Rn+Height)*Cos_Lat*Math.cos(Longitude),Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude),Z=(Rn*(1-cs.es)+Height)*Sin_Lat),p.x=X,p.y=Y,p.z=Z,Error_Code}function cs_geocentric_to_geodetic(cs,p){var X=p.x,Y=p.y,Z=p.z,Longitude,Latitude,Height,W,W2,T0,T1,S0,S1,Sin_B0,Sin3_B0,Cos_B0,Sin_p1,Cos_p1,Rn,Sum,At_Pole;X=parseFloat(X),Y=parseFloat(Y),Z=parseFloat(Z),At_Pole=!1;if(X!=0)Longitude=Math.atan2(Y,X);else if(Y>0)Longitude=HALF_PI;else if(Y<0)Longitude=-HALF_PI;else{At_Pole=!0,Longitude=0;if(Z>0)Latitude=HALF_PI;else{if(!(Z<0)){Latitude=HALF_PI,Height=-cs.b;return}Latitude=-HALF_PI}}return W2=X*X+Y*Y,W=Math.sqrt(W2),T0=Z*AD_C,S0=Math.sqrt(T0*T0+W2),Sin_B0=T0/S0,Cos_B0=W/S0,Sin3_B0=Sin_B0*Sin_B0*Sin_B0,T1=Z+cs.b*cs.ep2*Sin3_B0,Sum=W-cs.a*cs.es*Cos_B0*Cos_B0*Cos_B0,S1=Math.sqrt(T1*T1+Sum*
Sum),Sin_p1=T1/S1,Cos_p1=Sum/S1,Rn=cs.a/Math.sqrt(1-cs.es*Sin_p1*Sin_p1),Cos_p1>=COS_67P5?Height=W/Cos_p1-Rn:Cos_p1<=-COS_67P5?Height=W/-Cos_p1-Rn:Height=Z/Sin_p1+Rn*(cs.es-1),At_Pole==0&&(Latitude=Math.atan(Sin_p1/Cos_p1)),p.x=Longitude,p.y=Latitude,p.z=Height,0}function cs_geocentric_to_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM)p.x+=defn.datum_params[0],p.y+=defn.datum_params[1],p.z+=defn.datum_params[2];else{var Dx_BF=defn.datum_params[0],Dy_BF=defn.datum_params[1],Dz_BF=defn.datum_params[2],Rx_BF=defn.datum_params[3],Ry_BF=defn.datum_params[4],Rz_BF=defn.datum_params[5],M_BF=defn.datum_params[6],x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF,y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF,z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;p.x=x_out,p.y=y_out,p.z=z_out}}function cs_geocentric_from_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM)p.x-=defn.datum_params[0],p.y-=defn.datum_params[1],p.z-=defn.datum_params[2];else{var Dx_BF=defn.datum_params[0],Dy_BF=defn.datum_params[1],Dz_BF=defn.datum_params
[2],Rx_BF=defn.datum_params[3],Ry_BF=defn.datum_params[4],Rz_BF=defn.datum_params[5],M_BF=defn.datum_params[6],x_tmp=(p.x-Dx_BF)/M_BF,y_tmp=(p.y-Dy_BF)/M_BF,z_tmp=(p.z-Dz_BF)/M_BF;p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp,p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp,p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp}}Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(p){var lon=p.x,lat=p.y,dlon=Proj4js.common.adjust_lon(lon-this.long0),x,y;Math.abs(lat)<=Proj4js.common.EPSLN&&(x=this.x0+this.R*dlon,y=this.y0);var theta=Proj4js.common.asinz(2*Math.abs(lat/Proj4js.common.PI));if(Math.abs(dlon)<=Proj4js.common.EPSLN||Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)x=this.x0,lat>=0?y=this.y0+Proj4js.common.PI*this.R*Math.tan(.5*theta):y=this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*theta);var al=.5*Math.abs(Proj4js.common.PI/dlon-dlon/Proj4js.common.PI),asq=al*al,sinth=Math.sin(theta),costh=Math.cos(theta),g=costh/(sinth+costh-1),gsq=g*g,m=g*(2/sinth-1),msq=m*m,con=Proj4js.common.PI*this
.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);return dlon<0&&(con=-con),x=this.x0+con,con=Math.abs(con/(Proj4js.common.PI*this.R)),lat>=0?y=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con):y=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con),p.x=x,p.y=y,p},inverse:function(p){var dlon,xx,yy,xys,c1,c2,c3,al,asq,a1,m1,con,th1,d;return p.x-=this.x0,p.y-=this.y0,con=Proj4js.common.PI*this.R,xx=p.x/con,yy=p.y/con,xys=xx*xx+yy*yy,c1=-Math.abs(yy)*(1+xys),c2=c1-2*yy*yy+xx*xx,c3=-2*c1+1+2*yy*yy+xys*xys,d=yy*yy/c3+(2*c2*c2*c2/c3/c3/c3-9*c1*c2/c3/c3)/27,a1=(c1-c2*c2/3/c3)/c3,m1=2*Math.sqrt(-a1/3),con=3*d/a1/m1,Math.abs(con)>1&&(con>=0?con=1:con=-1),th1=Math.acos(con)/3,p.y>=0?lat=(-m1*Math.cos(th1+Proj4js.common.PI/3)-c2/3/c3)*Proj4js.common.PI:lat=-(-m1*Math.cos(th1+PI/3)-c2/3/c3)*Proj4js.common.PI,Math.abs(xx)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(xys-1+Math.sqrt(1+2*(xx*xx-yy*yy
)+xys*xys))/2/xx),p.x=lon,p.y=lat,p}},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(p){var lon=p.x,lat=p.y;return p.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*lat+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(lat),this.ratexp))-Proj4js.common.HALF_PI,p.x=this.C*lon,p},inverse:function(p){var DEL_TOL=1e-14,lon=p.x/this.C,lat=p.y;num=Math.pow(Math.tan(.5*lat+Proj4js.common.FORTPI)/this.K,1/this.C);for(var i=Proj4js.common.MAX_ITER;i>0;--i){lat=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(p.y),-0.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(lat-p.y)<DEL_TOL)break;p.y=lat}return i?
(p.x=lon,p.y=lat,p):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);var temp=this.b/this.a,es=1-Math.pow(temp,2),e=Math.sqrt(es);this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-es),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-es)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.d*this.d-1>0?this.lat0>=0?this.f=this.d+Math.sqrt(this.d*this.d-1):this.f=this.d-Math.sqrt(this.d*this.d-1):this.f=this.d,this.el=this.f*Math.pow(this.ts,this.bl)),this.mode!=0?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(
this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.lat0>=0?this.u=this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this
.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.lat0>=0?this.u=this.al/this.bl*Math.atan(Math.sqrt(this.d*this.
d-1)/this.cosaz):this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(p){var theta,sin_phi,cos_phi,b,c,t,tq,con,n,ml,q,us,vl,ul,vs,s,dlon,ts1,lon=p.x,lat=p.y;sin_phi=Math.sin(lat),dlon=Proj4js.common.adjust_lon(lon-this.longc),vl=Math.sin(this.bl*dlon),Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(ts1=Proj4js.common.tsfnz(this.e,lat,sin_phi),q=this.el/Math.pow(ts1,this.bl),s=.5*(q-1/q),t=.5*(q+1/q),ul=(s*this.singam-vl*this.cosgam)/t,con=Math.cos(this.bl*dlon),Math.abs(con)<1e-7?us=this.al*this.bl*dlon:(us=this.al*Math.atan((s*this.cosgam+vl*this.singam)/con)/this.bl,con<0&&(us+=Proj4js.common.PI*this.al/this.bl))):(lat>=0?ul=this.singam:ul=-this.singam,us=this.al*lat/this.bl),Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),vs=.5*this.al*Math.log((1-ul)/(1+ul))/this.bl,us-=this.u;var x=this.x0+vs*this.cosaz+us*this.sinaz,y=this.y0+us*this.cosaz-vs*this.sinaz;return p.x=x,p.y=y,p},inverse
:function(p){var delta_lon,theta,delta_theta,sin_phi,cos_phi,b,c,t,tq,con,n,ml,vs,us,q,s,ts1,vl,ul,bs,dlon,flag;return p.x-=this.x0,p.y-=this.y0,flag=0,vs=p.x*this.cosaz-p.y*this.sinaz,us=p.y*this.cosaz+p.x*this.sinaz,us+=this.u,q=Math.exp(-this.bl*vs/this.al),s=.5*(q-1/q),t=.5*(q+1/q),vl=Math.sin(this.bl*us/this.al),ul=(vl*this.cosgam+s*this.singam)/t,Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN?(lon=this.longc,ul>=0?lat=Proj4js.common.HALF_PI:lat=-Proj4js.common.HALF_PI):(con=1/this.bl,ts1=Math.pow(this.el/Math.sqrt((1+ul)/(1-ul)),con),lat=Proj4js.common.phi2z(this.e,ts1),theta=this.longc-Math.atan2(s*this.cosgam-vl*this.singam,con)/this.bl,lon=Proj4js.common.adjust_lon(theta)),p.x=lon,p.y=lat,p}},Proj4js.Proj.lcc={init:function(){this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1);if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");return}var temp=this.b/this.a;this.e=Math.sqrt(1-temp*temp);var sin1=Math.sin(this.lat1),cos1=Math
.cos(this.lat1),ms1=Proj4js.common.msfnz(this.e,sin1,cos1),ts1=Proj4js.common.tsfnz(this.e,this.lat1,sin1),sin2=Math.sin(this.lat2),cos2=Math.cos(this.lat2),ms2=Proj4js.common.msfnz(this.e,sin2,cos2),ts2=Proj4js.common.tsfnz(this.e,this.lat2,sin2),ts0=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?this.ns=Math.log(ms1/ms2)/Math.log(ts1/ts2):this.ns=sin1,this.f0=ms1/(this.ns*Math.pow(ts1,this.ns)),this.rh=this.a*this.f0*Math.pow(ts0,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(p){var lon=p.x,lat=p.y;if(lat<=90&&lat>=-90&&lon<=180&&lon>=-180){var con=Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI),ts;if(con>Proj4js.common.EPSLN)ts=Proj4js.common.tsfnz(this.e,lat,Math.sin(lat)),rh1=this.a*this.f0*Math.pow(ts,this.ns);else{con=lat*this.ns;if(con<=0)return Proj4js.reportError("lcc:forward: No Projection"),null;rh1=0}var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);return p.x=this.k0*rh1*
Math.sin(theta)+this.x0,p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0,p}return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+lon+" : "+lat),null},inverse:function(p){var rh1,con,ts,lat,lon;x=(p.x-this.x0)/this.k0,y=this.rh-(p.y-this.y0)/this.k0,this.ns>0?(rh1=Math.sqrt(x*x+y*y),con=1):(rh1=-Math.sqrt(x*x+y*y),con=-1);var theta=0;rh1!=0&&(theta=Math.atan2(con*x,con*y));if(rh1!=0||this.ns>0){con=1/this.ns,ts=Math.pow(rh1/(this.a*this.f0),con),lat=Proj4js.common.phi2z(this.e,ts);if(lat==-9999)return null}else lat=-Proj4js.common.HALF_PI;return lon=Proj4js.common.adjust_lon(theta/this.ns+this.long0),p.x=lon,p.y=lat,p}},Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0),this.cos_lat_o=Math.cos(this.lat0)},forward:function(p){var lon=p.x,lat=p.y,delta_lon=Proj4js.common.adjust_lon(lon-this.long0),sin_lat=Math.sin(lat),cos_lat=Math.cos(lat),sin_delta_lon=Math.sin(delta_lon),cos_delta_lon=Math.cos(delta_lon),g=this.sin_lat_o*sin_lat+this.cos_lat_o*cos_lat*cos_delta_lon
;if(g==-1)return Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R),null;var ksp=this.a*Math.sqrt(2/(1+g)),x=ksp*cos_lat*sin_delta_lon+this.x0,y=ksp*(this.cos_lat_o*sin_lat-this.sin_lat_o*cos_lat*cos_delta_lon)+this.x0;return p.x=x,p.y=y,p},inverse:function(p){p.x-=this.x0,p.y-=this.y0;var Rh=Math.sqrt(p.x*p.x+p.y*p.y),temp=Rh/(2*this.a);if(temp>1)return Proj4js.reportError("laea:Inv:DataError"),null;var z=2*Proj4js.common.asinz(temp),sin_z=Math.sin(z),cos_z=Math.cos(z),lon=this.long0;if(Math.abs(Rh)>Proj4js.common.EPSLN){var lat=Proj4js.common.asinz(this.sin_lat_o*cos_z+this.cos_lat_o*sin_z*p.y/Rh),temp=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(temp)>Proj4js.common.EPSLN?(temp=cos_z-this.sin_lat_o*Math.sin(lat),temp!=0&&(lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sin_z*this.cos_lat_o,temp*Rh)))):this.lat0<0?lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y)):lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))}else lat=
this.lat0;return p.x=lon,p.y=lat,p}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(p){var lon=p.x,lat=p.y,ksp,sinphi=Math.sin(p.y),cosphi=Math.cos(p.y),dlon=Proj4js.common.adjust_lon(lon-this.long0),coslon=Math.cos(dlon),g=this.sin_p12*sinphi+this.cos_p12*cosphi*coslon;if(Math.abs(Math.abs(g)-1)<Proj4js.common.EPSLN){ksp=1;if(g<0){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var z=Math.acos(g);ksp=z/Math.sin(z)}return p.x=this.x0+this.a*ksp*cosphi*Math.sin(dlon),p.y=this.y0+this.a*ksp*(this.cos_p12*sinphi-this.sin_p12*cosphi*coslon),p},inverse:function(p){p.x-=this.x0,p.y-=this.y0;var rh=Math.sqrt(p.x*p.x+p.y*p.y);if(rh>2*Proj4js.common.HALF_PI*this.a){Proj4js.reportError("aeqdInvDataError");return}var z=rh/this.a,sinz=Math.sin(z),cosz=Math.cos(z),lon=this.long0,lat;if(Math.abs(rh)<=Proj4js.common.EPSLN)lat=this.lat0;else{lat=Proj4js.common.asinz(cosz*this.sin_p12+p.y*sinz*this.cos_p12/rh);var con=Math.abs
(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(con)<=Proj4js.common.EPSLN)lat0>=0?lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y)):lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y));else{con=cosz-this.sin_p12*Math.sin(lat);if(!(Math.abs(con)<Proj4js.common.EPSLN&&Math.abs(p.x)<Proj4js.common.EPSLN)){var temp=Math.atan2(p.x*sinz*this.cos_p12,con*rh);lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sinz*this.cos_p12,con*rh))}}}return p.x=lon,p.y=lat,p}},Proj4js.Proj.moll={init:function(){},forward:function(p){var lon=p.x,lat=p.y,delta_lon=Proj4js.common.adjust_lon(lon-this.long0),theta=lat,con=Proj4js.common.PI*Math.sin(lat);for(var i=0;;i++){var delta_theta=-(theta+Math.sin(theta)-con)/(1+Math.cos(theta));theta+=delta_theta;if(Math.abs(delta_theta)<Proj4js.common.EPSLN)break;i>=50&&Proj4js.reportError("moll:Fwd:IterationError")}theta/=2,Proj4js.common.PI/2-Math.abs(lat)<Proj4js.common.EPSLN&&(delta_lon=0);var x=.900316316158*this.R*delta_lon*Math.cos(theta
)+this.x0,y=1.4142135623731*this.R*Math.sin(theta)+this.y0;return p.x=x,p.y=y,p},inverse:function(p){var theta,arg;p.x-=this.x0;var arg=p.y/(1.4142135623731*this.R);Math.abs(arg)>.999999999999&&(arg=.999999999999);var theta=Math.asin(arg),lon=Proj4js.common.adjust_lon(this.long0+p.x/(.900316316158*this.R*Math.cos(theta)));lon<-Proj4js.common.PI&&(lon=-Proj4js.common.PI),lon>Proj4js.common.PI&&(lon=Proj4js.common.PI),arg=(2*theta+Math.sin(2*theta))/Proj4js.common.PI,Math.abs(arg)>1&&(arg=1);var lat=Math.asin(arg);return p.x=lon,p.y=lat,p}},define("proj4js",function(){}),Proj4js.defs["EPSG:32189"]="+title=NAD83/MTM_zone_9 +proj=tmerc +lat_0=0 +lon_0=-76.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32188"]="+title=NAD83/MTM_zone_8 +proj=tmerc +lat_0=0 +lon_0=-73.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32187"]="+title=NAD83/MTM_zone_7 +proj=tmerc +lat_0=0 +lon_0=-70.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
,Proj4js.defs["EPSG:32186"]="+title=NAD83/MTM_zone_6 +proj=tmerc +lat_0=0 +lon_0=-67.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32185"]="+title=NAD83/MTM_zone_5 +proj=tmerc +lat_0=0 +lon_0=-64.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32184"]="+title=NAD83/MTM_zone_4 +proj=tmerc +lat_0=0 +lon_0=-61.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32183"]="+title=NAD83/MTM_zone_3 +proj=tmerc +lat_0=0 +lon_0=-58.5 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32182"]="+title=NAD83/MTM_zone_2 +proj=tmerc +lat_0=0 +lon_0=-56 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:32181"]="+title=NAD83/MTM_zone_1 +proj=tmerc +lat_0=0 +lon_0=-53 +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
,Proj4js.defs["EPSG:3857"]="+title=Google_Mercator EPSG:3857 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:32198"]="+title=Lambert_conique_conforme +proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs  no_defs",Proj4js.defs["EPSG:26917"]="+proj=utm +zone=17 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:26918"]="+proj=utm +zone=18 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:26919"]="+proj=utm +zone=19 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:26920"]="+proj=utm +zone=20 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:26921"]="+proj=utm +zone=21 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs",Proj4js.defs["EPSG:3798"]="+title=Lambert_conique_conforme_MTQ +proj=lcc +lat_1=50 +lat_2=46 +lat_0=44 +lon_0=-70 +x_0=800000 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"
,define("epsgDef",function(){}),require(["analyseurConfig","analyseurGML","analyseurGeoJSON","contexteMenu","contexteMenuArborescence","contexteMenuCarte","gestionCouches","OSM","TMS","WMS","blanc","couche","google","marqueurs","vecteur","vecteurCluster","ligne","limites","multiPolygone","occurence","cluster","point","polygone","style","aide","browserDetect","contexte","evenement","fonctions","metadonnee","requireAide","arborescence","impression","localisation","recherche","rechercheAdresse","rechercheBorne","rechercheCadastreReno","rechercheGPS","rechercheHQ","rechercheLieu","rechercheInverseAdresse","outil","outilAide","outilAjoutWMS","outilControleMenu","outilDeplacement","outilDeplacerCentre","outilSelection","outilProfil","outilHistoriqueNavigation","outilInfo","outilMenu","outilMesure","outilPartagerCarte","outilRapporterBogue","outilZoomEtendueMaximale","outilZoomPreselection","outilZoomRectangle","panneau","panneauAccordeon","panneauCarte","panneauEntete","panneauInfo","panneauMenu"
,"panneauOnglet","panneauTable","barreOutils","carte","navigateur","css","text","hbars","async","noAMD","proj4js","epsgDef"],function(){}),define("../build/main",function(){});